<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
                                       http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd">

    <changeSet id="3.1-dnovikov-1" author="dnovikov">
        <update tableName="DECLARATION_TEMPLATE">
            <column name="CREATE_SCRIPT" valueClobFile="templates-3.1/ndfl/report_2ndfl_1/v2016/report_2ndfl.groovy"/>
            <where>declaration_type_id = 102</where>
        </update>
    </changeSet>
    <changeSet id="3.1-dnovikov-2" author="dnovikov">
        <update tableName="DECLARATION_TEMPLATE">
            <column name="CREATE_SCRIPT" valueClobFile="templates-3.1/ndfl/report_2ndfl_1/v2016/report_2ndfl.groovy"/>
            <where>declaration_type_id = 104</where>
        </update>
    </changeSet>

    <changeSet id="3.1-dnovikov-3" author="dnovikov">
        <update tableName="DECLARATION_TEMPLATE">
            <column name="CREATE_SCRIPT" valueClobFile="templates-3.1/ndfl/report_6ndfl/v2016/report_6ndfl.groovy"/>
            <where>declaration_type_id = 103</where>
        </update>
    </changeSet>

    <changeSet id="3.1-dnovikov-4" author="dnovikov">
        <update tableName="DECLARATION_TEMPLATE">
            <column name="CREATE_SCRIPT" valueClobFile="templates-3.1/ndfl/report_6ndfl/v2016/report_6ndfl.groovy"/>
            <where>declaration_type_id = 103</where>
        </update>
    </changeSet>

    <changeSet id="3.1-ytrofimov-0" author="ytrofimov">
        <update tableName="BLOB_DATA">
            <column name="data"
                    valueBlobFile="templates-3.1/refbook/declaration_type.groovy"/>
            <where>id in (select script_id from ref_book r where r.id = 207)</where>
        </update>
    </changeSet>

    <changeSet id="3.1-ytrofimov-1" author="ytrofimov">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script" valueClobFile="templates-3.1/ndfl/consolidated_rnu_ndfl/v2016/consolidated_rnu_ndfl_calculate.groovy"/>
            <where>DECLARATION_TEMPLATE_ID = 101 and EVENT_ID = 3</where>
        </update>
    </changeSet>

    <changeSet id="3.1-dnovikov-5" author="dnovikov">
        <update tableName="async_task_type">
            <column name="name" value="Формирование уведомления о задолженности"/>
            <where>id = 35</where>
        </update>
    </changeSet>

    <changeSet id="3.1-ytrofimov-2" author="ytrofimov">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script" valueClobFile="templates-3.1/ndfl/consolidated_rnu_ndfl/v2016/consolidated_rnu_ndfl_calculate.groovy"/>
            <where>DECLARATION_TEMPLATE_ID = 101 and EVENT_ID = 3</where>
        </update>
    </changeSet>

	<!--https://jira.aplana.com/browse/SBRFNDFL-4982 Уведомление об отсутствии пары КПП/ОКТМО в справочнике "Настройки подразделений" -->
	<changeSet id="3.1-rnurgaleev-0" author="rnurgaleev">
        <sql>
            update ref_book_ndfl_detail a set oktmo=(select max(id) from ref_book_oktmo where code=(select code from ref_book_oktmo where id=a.oktmo) and status=0)
			where oktmo in (select id from ref_book_oktmo where status=2);
        </sql>
    </changeSet>

	<!-- https://jira.aplana.com/browse/SBRFNDFL-4947 "Дата окончания актуальности" для "Кодов видов вычета" = 221 не соответствует постановке -->
	<changeSet id="3.1-rnurgaleev-1" author="rnurgaleev">
        <sql>
			update ref_book_deduction_type set version=to_date('26.12.16','DD.MM.YY')
			where code in ('221')
			and version=to_date('25.12.16','DD.MM.YY');
		</sql>
    </changeSet>

	<!-- https://jira.aplana.com/browse/SBRFNDFL-4984 Уведомление об отсутствии пары "Код дохода"/"Признак дохода" в справочнике "Виды дохода" -->
	<changeSet id="3.1-rnurgaleev-2" author="rnurgaleev">
        <sql>
			merge into ref_book_income_kind a using
			(select (select id from (select id,version from ref_book_income_type where code='1011' and status=0 order by version desc) where rownum=1) as income_type_id,
			'00' as mark, '-' as name,
			to_date('01.01.2017','DD.MM.YYYY') as version from dual
			) b
			on (a.income_type_id=b.income_type_id and a.mark=b.mark)
			when not matched then
			insert (id, income_type_id, mark, name, version, record_id)
			values (seq_ref_book_record.nextval, b.income_type_id, b.mark, b.name, b.version, seq_ref_book_record.nextval);
		</sql>
    </changeSet>

    <changeSet id="3.1-ytrofimov-3" author="ytrofimov">
        <sql>
            update ref_book_attribute set visible = 1 where ref_book_id = 902 and lower(alias) = 'duplicate_record_id'
        </sql>
    </changeSet>
    <changeSet id="3.1-apronin-1" author="apronin">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script" valueClobFile="templates-3.1/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl_move_accepted_to_created.groovy"/>
            <where>DECLARATION_TEMPLATE_ID = 100 and EVENT_ID = 106</where>
        </update>
    </changeSet>

    <!-- ВНИМАНИЕ  changeSet id="3.1-ytrofimov-4" не добавлять в патч!!!-->
    <changeSet id="3.1-ytrofimov-4" author="ytrofimov">
        <update tableName="BLOB_DATA">
            <column name="data"
                    valueBlobFile="templates-3.1/ndfl/primary_rnu_ndfl/v2016/report.jrxml"/>
            <where>id in (select jrxml from declaration_template dt where dt.id = 101)</where>
        </update>
    </changeSet>

    <changeSet id="3.1-apronin-2" author="apronin">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script" valueClobFile="templates-3.1/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl_move_accepted_to_created.groovy"/>
            <where>DECLARATION_TEMPLATE_ID = 100 and EVENT_ID = 106</where>
        </update>
    </changeSet>

	<!-- https://jira.aplana.com/browse/SBRFNDFL-5066 Изучить причины высокого потребления памяти СУБД при консолидации НФ -->
	<changeSet id="3.1-rnurgaleev-3" author="rnurgaleev">
        <sql>
			create global temporary table tmp_cons_data(
				operation_id varchar2(100 char),
				asnu_id number(18),
				inp varchar2(25 char),
				year number(4),
				period_code varchar2(2 char),
				correction_date date)
			on commit delete rows;
		</sql>
    </changeSet>

	<!-- https://jira.aplana.com/browse/SBRFNDFL-4984 Уведомление об отсутствии пары "Код дохода"/"Признак дохода" в справочнике "Виды дохода" -->
	<changeSet id="3.1-rnurgaleev-4" author="rnurgaleev">
        <sql>
			update ref_book_income_kind b
				set record_id=(select max(record_id) from ref_book_income_kind a
					where exists(select 1 from ref_book_income_type where id=a.income_type_id and code='1011')
					and a.version=to_date('01.01.2016','DD.MM.YYYY')
					and a.mark='00' and a.status=0)
			where exists(select 1 from ref_book_income_type where id=b.income_type_id and code='1011') and b.version=to_date('01.01.2017','DD.MM.YYYY')
			and b.mark='00' and b.status=0;
		</sql>
    </changeSet>

    <changeSet id="3.1-dnovikov-6" author="dnovikov">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script" valueClobFile="templates-3.1/ndfl/consolidated_rnu_ndfl/v2016/consolidated_rnu_ndfl_check.groovy"/>
            <where>DECLARATION_TEMPLATE_ID = 101 and EVENT_ID = 5</where>
        </update>
    </changeSet>

    <changeSet id="3.1-apronin-3" author="apronin">
        <update tableName="DECLARATION_TEMPLATE">
            <column name="CREATE_SCRIPT" valueClobFile="templates-3.1/ndfl/report_2ndfl_1/v2016/report_2ndfl.groovy"/>
            <where>declaration_type_id = 104</where>
        </update>
    </changeSet>
    <changeSet id="3.1-apronin-4" author="apronin">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script" valueClobFile="templates-3.1/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl_move_accepted_to_created.groovy"/>
            <where>DECLARATION_TEMPLATE_ID = 100 and EVENT_ID = 106</where>
        </update>
    </changeSet>

    <changeSet id="3.1-apronin-5" author="apronin">
        <insert tableName="blob_data">
            <column name="id" value="4b85f92c-7fd0-4d67-834d-e61g34684336"/>
            <column name="name" value="report.xlsx"/>
            <column name="data" valueBlobFile="templates-3.1/ndfl/primary_rnu_ndfl/v2016/report.xlsx"/>
            <column name="creation_date" valueDate="2018-07-10"/>
        </insert>
    </changeSet>

    <changeSet id="3.1-apronin-6" author="apronin">
        <insert tableName="declaration_template_file">
            <column name="DECLARATION_TEMPLATE_ID" value="100"/>
            <column name="BLOB_DATA_ID" value="4b85f92c-7fd0-4d67-834d-e61g34684336"/>
        </insert>
    </changeSet>

    <changeSet id="3.1-apronin-7" author="apronin">
        <update tableName="DECLARATION_TEMPLATE">
            <column name="CREATE_SCRIPT" valueClobFile="templates-3.1/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl.groovy"/>
            <where>declaration_type_id = 100</where>
        </update>
    </changeSet>

    <changeSet id="3.1-apronin-8" author="apronin">
        <update tableName="DECLARATION_TEMPLATE">
            <column name="CREATE_SCRIPT" valueClobFile="templates-3.1/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl.groovy"/>
            <where>declaration_type_id = 100</where>
        </update>
    </changeSet>

    <changeSet id="3.1-apronin-9" author="apronin">
        <update tableName="DECLARATION_TEMPLATE">
            <column name="CREATE_SCRIPT" valueClobFile="templates-3.1/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl.groovy"/>
            <where>declaration_type_id = 100</where>
        </update>
    </changeSet>

    <changeSet id="3.1-ytrofimov-5" author="ytrofimov">
        <update tableName="DECLARATION_TEMPLATE">
            <column name="CREATE_SCRIPT" valueClobFile="templates-3.1/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl.groovy"/>
            <where>declaration_type_id = 100</where>
        </update>
    </changeSet>

    <changeSet id="3.1-ytrofimov-6" author="ytrofimov">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script" valueClobFile="templates-3.1/ndfl/consolidated_rnu_ndfl/v2016/consolidated_rnu_ndfl_check.groovy"/>
            <where>DECLARATION_TEMPLATE_ID = 101 and EVENT_ID = 5</where>
        </update>
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script" valueClobFile="templates-3.1/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl_check.groovy"/>
            <where>DECLARATION_TEMPLATE_ID = 100 and EVENT_ID = 5</where>
        </update>
    </changeSet>

    <changeSet id="3.1-ytrofimov-7" author="ytrofimov">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script" valueClobFile="templates-3.1/ndfl/consolidated_rnu_ndfl/v2016/consolidated_rnu_ndfl_check.groovy"/>
            <where>DECLARATION_TEMPLATE_ID = 101 and EVENT_ID = 5</where>
        </update>
    </changeSet>

    <changeSet id="3.1-ytrofimov-8" author="ytrofimov">
        <insert tableName="declaration_template_file">
            <column name="DECLARATION_TEMPLATE_ID" value="101"/>
            <column name="BLOB_DATA_ID" value="4b85f92c-7fd0-4d67-834d-e61g34684336"/>
        </insert>
        <update tableName="DECLARATION_TEMPLATE">
            <column name="CREATE_SCRIPT" valueClobFile="templates-3.1/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl.groovy"/>
            <where>declaration_type_id = 100</where>
        </update>
        <update tableName="DECLARATION_TEMPLATE">
            <column name="CREATE_SCRIPT" valueClobFile="templates-3.1/ndfl/consolidated_rnu_ndfl/v2016/consolidated_rnu_ndfl.groovy"/>
            <where>declaration_type_id = 101</where>
        </update>
    </changeSet>

    <!-- https://jira.aplana.com/browse/SBRFNDFL-5088 Реализовать изменения в форматах чисел в шаблонах файлов Excel-->
    <changeSet id="3.1-ytrofimov-8" author="ytrofimov">
        <insert tableName="declaration_template_file">
            <column name="DECLARATION_TEMPLATE_ID" value="101"/>
            <column name="BLOB_DATA_ID" value="4b85f92c-7fd0-4d67-834d-e61g34684336"/>
        </insert>
        <update tableName="DECLARATION_TEMPLATE">
            <column name="CREATE_SCRIPT" valueClobFile="templates-3.1/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl.groovy"/>
            <where>declaration_type_id = 100</where>
        </update>
        <update tableName="DECLARATION_TEMPLATE">
            <column name="CREATE_SCRIPT" valueClobFile="templates-3.1/ndfl/consolidated_rnu_ndfl/v2016/consolidated_rnu_ndfl.groovy"/>
            <where>declaration_type_id = 101</where>
        </update>
    </changeSet>

    <!--https://jira.aplana.com/browse/SBRFNDFL-5088 Реализовать изменения в форматах чисел в шаблонах файлов Excel-->
    <changeSet id="3.1-ytrofimov-9" author="ytrofimov">
        <update tableName="DECLARATION_TEMPLATE">
            <column name="JRXML" value=""/>
            <where>declaration_type_id = 100</where>
        </update>
        <update tableName="DECLARATION_TEMPLATE">
            <column name="JRXML" value=""/>
            <where>declaration_type_id = 101</where>
        </update>
    </changeSet>

    <!-- https://jira.aplana.com/browse/SBRFNDFL-5088 Реализовать изменения в форматах чисел в шаблонах файлов Excel-->
    <changeSet id="3.1-ytrofimov-10" author="ytrofimov">
        <update tableName="DECLARATION_TEMPLATE">
            <column name="CREATE_SCRIPT" valueClobFile="templates-3.1/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl.groovy"/>
            <where>declaration_type_id = 100</where>
        </update>
        <update tableName="DECLARATION_TEMPLATE">
            <column name="CREATE_SCRIPT" valueClobFile="templates-3.1/ndfl/consolidated_rnu_ndfl/v2016/consolidated_rnu_ndfl.groovy"/>
            <where>declaration_type_id = 101</where>
        </update>
    </changeSet>


    <changeSet id="3.1-dnovikov-7" author="dnovikov">
        <insert tableName="CONFIGURATION">
            <column name="code" value="REPORT_PERIOD_YEAR_MIN"/>
            <column name="department_id" value="0"/>
            <column name="value" value="2003"/>
        </insert>
    </changeSet>

    <changeSet id="3.1-dnovikov-8" author="dnovikov">
        <insert tableName="CONFIGURATION">
            <column name="code" value="REPORT_PERIOD_YEAR_MAX"/>
            <column name="department_id" value="0"/>
            <column name="value" value="2100"/>
        </insert>
    </changeSet>

    <changeSet id="3.1-ytrofimov-11" author="ytrofimov">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script" valueClobFile="templates-3.1/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl_calculate.groovy"/>
            <where>DECLARATION_TEMPLATE_ID = 100 and EVENT_ID = 3</where>
        </update>
    </changeSet>

    <!--https://jira.aplana.com/browse/SBRFNDFL-5245 Изменить возможные значения поля format из справочника ref_book_attribute -->
    <changeSet id="3.1-akorobko-0" author="akorobko">
        <sql>
            alter table ref_book_attribute drop constraint REF_BOOK_ATTRIBUTE_CHK_FORMAT;
        </sql>
    </changeSet>

    <!--https://jira.aplana.com/browse/SBRFNDFL-5245 Изменить возможные значения поля format из справочника ref_book_attribute -->
    <changeSet id="3.1-akorobko-1" author="akorobko">
        <sql>
            alter table ref_book_attribute add constraint REF_BOOK_ATTRIBUTE_CHK_FORMAT CHECK (format in (0,1,2,3,4,5,6,7)) ENABLE;
        </sql>
    </changeSet>

    <!--https://jira.aplana.com/browse/SBRFNDFL-5245 Изменить возможные значения поля format из справочника ref_book_attribute -->
    <changeSet id="3.1-akorobko-2" author="akorobko">
        <sql>
            comment on column ref_book_attribute.format is 'Формат. (Для дат: 0 - "", 1 - "dd.MM.yyyy", 2 - "MM.yyyy", 3 - "MMMM yyyy", 4 - "yyyy", 5 - "dd.MM", 7 - "dd.MM.yyyy HH:mm:ss"; Для чисел: 6 - чекбокс)';
        </sql>
    </changeSet>

    <!--https://jira.aplana.com/browse/SBRFNDFL-5245 Изменить возможные значения поля format из справочника ref_book_attribute -->
    <changeSet id="3.1-akorobko-3" author="akorobko">
        <sql>
            update ref_book_attribute set format=7 where id=9083;
        </sql>
    </changeSet>

    <!-- https://jira.aplana.com/browse/SBRFNDFL-5315 Не присваивается АСНУ при первичной загрузке ФЛ -->
    <changeSet id="3.1-apronin-10" author="apronin">
        <update tableName="BLOB_DATA">
            <column name="data"
                    valueBlobFile="templates-3.1/refbook/person.groovy"/>
            <where>id in (select script_id from ref_book r where r.id = 904)</where>
        </update>
    </changeSet>

    <!-- https://jira.aplana.com/browse/SBRFNDFL-5271 Добавить фатальную ошибку при проверке ПНФ, если авансовые платежи указаны для налогоплательщика,статус которого не равен 6 -->
    <changeSet id="3.1-apronin-11" author="apronin">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script" valueClobFile="templates-3.1/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl_check.groovy"/>
            <where>DECLARATION_TEMPLATE_ID = 100 and EVENT_ID = 5</where>
        </update>
    </changeSet>

    <!-- https://jira.aplana.com/browse/SBRFNDFL-5134 Реализовать изменения в алгоритме проверки допустимости имен и фамилий -->
    <changeSet id="3.1-snazin-0" author="snazin">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script"
                    valueClobFile="templates/ndfl/report_2ndfl_1/v2016/report_2ndfll_check.groovy"/>
            <where>id in (8, 12)</where>
        </update>
    </changeSet>

    <!-- https://jira.aplana.com/browse/SBRFNDFL-5315 Не присваивается АСНУ при первичной загрузке ФЛ -->
    <changeSet id="3.1-apronin-10" author="apronin">
        <update tableName="BLOB_DATA">
            <column name="data"
                    valueBlobFile="templates-3.1/refbook/person.groovy"/>
            <where>id in (select script_id from ref_book r where r.id = 904)</where>
        </update>
    </changeSet>

    <!-- https://jira.aplana.com/browse/SBRFNDFL-5271 Добавить фатальную ошибку при проверке ПНФ, если авансовые платежи указаны для налогоплательщика,статус которого не равен 6 -->
    <changeSet id="3.1-apronin-11" author="apronin">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script" valueClobFile="templates-3.1/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl_check.groovy"/>
            <where>DECLARATION_TEMPLATE_ID = 100 and EVENT_ID = 5</where>
        </update>
    </changeSet>

    <!--https://jira.aplana.com/browse/SBRFNDFL-5294 Убрать неиспользуемые последовательности в БД -->
    <changeSet id="3.1-akorobko-4" author="akorobko">
        <sql>
            drop sequence SEQ_DEPARTMENT;
        </sql>
    </changeSet>

    <!--https://jira.aplana.com/browse/SBRFNDFL-5294 Убрать неиспользуемые последовательности в БД -->
    <changeSet id="3.1-akorobko-5" author="akorobko">
        <sql>
            drop sequence SEQ_DEPARTMENT_FORM_TYPE;
        </sql>
    </changeSet>

    <!--https://jira.aplana.com/browse/SBRFNDFL-5294 Убрать неиспользуемые последовательности в БД -->
    <changeSet id="3.1-akorobko-6" author="akorobko">
        <sql>
            drop sequence SEQ_FORM_COLUMN;
        </sql>
    </changeSet>

    <!--https://jira.aplana.com/browse/SBRFNDFL-5294 Убрать неиспользуемые последовательности в БД -->
    <changeSet id="3.1-akorobko-7" author="akorobko">
        <sql>
            drop sequence SEQ_FORM_DATA;
        </sql>
    </changeSet>

    <!--https://jira.aplana.com/browse/SBRFNDFL-5294 Убрать неиспользуемые последовательности в БД -->
    <changeSet id="3.1-akorobko-8" author="akorobko">
        <sql>
            drop sequence SEQ_FORM_DATA_NNN;
        </sql>
    </changeSet>

    <!--https://jira.aplana.com/browse/SBRFNDFL-5294 Убрать неиспользуемые последовательности в БД -->
    <changeSet id="3.1-akorobko-9" author="akorobko">
        <sql>
            drop sequence SEQ_FORM_DATA_SIGNER;
        </sql>
    </changeSet>

    <!--https://jira.aplana.com/browse/SBRFNDFL-5294 Убрать неиспользуемые последовательности в БД -->
    <changeSet id="3.1-akorobko-10" author="akorobko">
        <sql>
            drop sequence SEQ_FORM_SEARCH_RESULT;
        </sql>
    </changeSet>

    <!--https://jira.aplana.com/browse/SBRFNDFL-5294 Убрать неиспользуемые последовательности в БД -->
    <changeSet id="3.1-akorobko-11" author="akorobko">
        <sql>
            drop sequence SEQ_FORM_STYLE;
        </sql>
    </changeSet>

    <!--https://jira.aplana.com/browse/SBRFNDFL-5294 Убрать неиспользуемые последовательности в БД -->
    <changeSet id="3.1-akorobko-12" author="akorobko">
        <sql>
            drop sequence SEQ_FORM_TEMPLATE;
        </sql>
    </changeSet>

    <!--https://jira.aplana.com/browse/SBRFNDFL-5294 Убрать неиспользуемые последовательности в БД -->
    <changeSet id="3.1-akorobko-13" author="akorobko">
        <sql>
            drop sequence SEQ_FORM_TYPE;
        </sql>
    </changeSet>

    <!--https://jira.aplana.com/browse/SBRFNDFL-5294 Убрать неиспользуемые последовательности в БД -->
    <changeSet id="3.1-akorobko-14" author="akorobko">
        <sql>
            drop sequence SEQ_LOG_ENTRY;
        </sql>
    </changeSet>

    <!--https://jira.aplana.com/browse/SBRFNDFL-5294 Убрать неиспользуемые последовательности в БД -->
    <changeSet id="3.1-akorobko-15" author="akorobko">
        <sql>
            drop sequence SEQ_LOG_QUERY;
        </sql>
    </changeSet>

    <!--https://jira.aplana.com/browse/SBRFNDFL-5294 Убрать неиспользуемые последовательности в БД -->
    <changeSet id="3.1-akorobko-16" author="akorobko">
        <sql>
            drop sequence SEQ_LOG_QUERY_SESSION;
        </sql>
    </changeSet>

    <!--https://jira.aplana.com/browse/SBRFNDFL-5294 Убрать неиспользуемые последовательности в БД -->
    <changeSet id="3.1-akorobko-17" author="akorobko">
        <sql>
            drop sequence SEQ_SEC_USER;
        </sql>
    </changeSet>

    <!--https://jira.aplana.com/browse/SBRFNDFL-5294 Убрать неиспользуемые последовательности в БД -->
    <changeSet id="3.1-akorobko-18" author="akorobko">
        <sql>
            drop sequence SEQ_SEC_USER_ASNU_ID;
        </sql>
    </changeSet>

    <!--https://jira.aplana.com/browse/SBRFNDFL-5294 Убрать неиспользуемые последовательности в БД -->
    <changeSet id="3.1-akorobko-19" author="akorobko">
        <sql>
            drop sequence SEQ_TASK_CONTEXT;
        </sql>
    </changeSet>

    <!--https://jira.aplana.com/browse/SBRFNDFL-5294 Убрать неиспользуемые последовательности в БД -->
    <changeSet id="3.1-akorobko-20" author="akorobko">
        <sql>
            drop sequence SEQ_RASCHSV_KOL_LIC_TIP;
        </sql>
    </changeSet>

    <!--https://jira.aplana.com/browse/SBRFNDFL-5294 Убрать неиспользуемые последовательности в БД -->
    <changeSet id="3.1-akorobko-21" author="akorobko">
        <sql>
            drop sequence SEQ_RASCHSV_OBYAZ_PLAT_SV;
        </sql>
    </changeSet>

    <!--https://jira.aplana.com/browse/SBRFNDFL-5294 Убрать неиспользуемые последовательности в БД -->
    <changeSet id="3.1-akorobko-22" author="akorobko">
        <sql>
            drop sequence SEQ_RASCHSV_OSS_VNM;
        </sql>
    </changeSet>

    <!--https://jira.aplana.com/browse/SBRFNDFL-5294 Убрать неиспользуемые последовательности в БД -->
    <changeSet id="3.1-akorobko-23" author="akorobko">
        <sql>
            drop sequence SEQ_RASCHSV_PERS_SV_STRAH_LIC;
        </sql>
    </changeSet>

    <!--https://jira.aplana.com/browse/SBRFNDFL-5294 Убрать неиспользуемые последовательности в БД -->
    <changeSet id="3.1-akorobko-24" author="akorobko">
        <sql>
            drop sequence SEQ_RASCHSV_PRAV_TARIF3_1_427;
        </sql>
    </changeSet>

    <!--https://jira.aplana.com/browse/SBRFNDFL-5294 Убрать неиспользуемые последовательности в БД -->
    <changeSet id="3.1-akorobko-25" author="akorobko">
        <sql>
            drop sequence SEQ_RASCHSV_PRAV_TARIF5_1_427;
        </sql>
    </changeSet>

    <!--https://jira.aplana.com/browse/SBRFNDFL-5294 Убрать неиспользуемые последовательности в БД -->
    <changeSet id="3.1-akorobko-26" author="akorobko">
        <sql>
            drop sequence SEQ_RASCHSV_PRAV_TARIF7_1_427;
        </sql>
    </changeSet>

    <!--https://jira.aplana.com/browse/SBRFNDFL-5294 Убрать неиспользуемые последовательности в БД -->
    <changeSet id="3.1-akorobko-27" author="akorobko">
        <sql>
            drop sequence SEQ_RASCHSV_RASH_OSS_ZAK;
        </sql>
    </changeSet>

    <!--https://jira.aplana.com/browse/SBRFNDFL-5294 Убрать неиспользуемые последовательности в БД -->
    <changeSet id="3.1-akorobko-28" author="akorobko">
        <sql>
            drop sequence SEQ_RASCHSV_RASH_OSS_ZAK_RASH;
        </sql>
    </changeSet>

    <!--https://jira.aplana.com/browse/SBRFNDFL-5294 Убрать неиспользуемые последовательности в БД -->
    <changeSet id="3.1-akorobko-29" author="akorobko">
        <sql>
            drop sequence SEQ_RASCHSV_RASH_VYPL;
        </sql>
    </changeSet>

    <!--https://jira.aplana.com/browse/SBRFNDFL-5294 Убрать неиспользуемые последовательности в БД -->
    <changeSet id="3.1-akorobko-30" author="akorobko">
        <sql>
            drop sequence SEQ_RASCHSV_SVED_OBUCH;
        </sql>
    </changeSet>

    <!--https://jira.aplana.com/browse/SBRFNDFL-5294 Убрать неиспользуемые последовательности в БД -->
    <changeSet id="3.1-akorobko-31" author="akorobko">
        <sql>
            drop sequence SEQ_RASCHSV_SVNP_PODPISANT;
        </sql>
    </changeSet>

    <!--https://jira.aplana.com/browse/SBRFNDFL-5294 Убрать неиспользуемые последовательности в БД -->
    <changeSet id="3.1-akorobko-32" author="akorobko">
        <sql>
            drop sequence SEQ_RASCHSV_SV_OPS_OMS;
        </sql>
    </changeSet>

    <!--https://jira.aplana.com/browse/SBRFNDFL-5294 Убрать неиспользуемые последовательности в БД -->
    <changeSet id="3.1-akorobko-33" author="akorobko">
        <sql>
            drop sequence SEQ_RASCHSV_SV_OPS_OMS_RASCH;
        </sql>
    </changeSet>

    <!--https://jira.aplana.com/browse/SBRFNDFL-5294 Убрать неиспользуемые последовательности в БД -->
    <changeSet id="3.1-akorobko-34" author="akorobko">
        <sql>
            drop sequence SEQ_RASCHSV_SV_PRIM_TARIF1_422;
        </sql>
    </changeSet>

    <!--https://jira.aplana.com/browse/SBRFNDFL-5294 Убрать неиспользуемые последовательности в БД -->
    <changeSet id="3.1-akorobko-35" author="akorobko">
        <sql>
            drop sequence SEQ_RASCHSV_SV_PRIM_TARIF2_425;
        </sql>
    </changeSet>

    <!--https://jira.aplana.com/browse/SBRFNDFL-5294 Убрать неиспользуемые последовательности в БД -->
    <changeSet id="3.1-akorobko-36" author="akorobko">
        <sql>
            drop sequence SEQ_RASCHSV_SV_PRIM_TARIF9_427;
        </sql>
    </changeSet>

    <!--https://jira.aplana.com/browse/SBRFNDFL-5294 Убрать неиспользуемые последовательности в БД -->
    <changeSet id="3.1-akorobko-37" author="akorobko">
        <sql>
           drop sequence SEQ_RASCHSV_SV_REESTR_MDO;
        </sql>
    </changeSet>

    <!--https://jira.aplana.com/browse/SBRFNDFL-5294 Убрать неиспользуемые последовательности в БД -->
    <changeSet id="3.1-akorobko-38" author="akorobko">
        <sql>
            drop sequence SEQ_RASCHSV_SV_SUM_1TIP;
        </sql>
    </changeSet>

    <!--https://jira.aplana.com/browse/SBRFNDFL-5294 Убрать неиспользуемые последовательности в БД -->
    <changeSet id="3.1-akorobko-39" author="akorobko">
        <sql>
            drop sequence SEQ_RASCHSV_SV_VYPL;
        </sql>
    </changeSet>

    <!--https://jira.aplana.com/browse/SBRFNDFL-5294 Убрать неиспользуемые последовательности в БД -->
    <changeSet id="3.1-akorobko-40" author="akorobko">
        <sql>
            drop sequence SEQ_RASCHSV_SV_VYPL_MK;
        </sql>
    </changeSet>

    <!--https://jira.aplana.com/browse/SBRFNDFL-5294 Убрать неиспользуемые последовательности в БД -->
    <changeSet id="3.1-akorobko-41" author="akorobko">
        <sql>
            drop sequence SEQ_RASCHSV_UPL_PER;
        </sql>
    </changeSet>

    <!--https://jira.aplana.com/browse/SBRFNDFL-5294 Убрать неиспользуемые последовательности в БД -->
    <changeSet id="3.1-akorobko-42" author="akorobko">
        <sql>
            drop sequence SEQ_RASCHSV_UPL_PREV_OSS;
        </sql>
    </changeSet>

    <!--https://jira.aplana.com/browse/SBRFNDFL-5294 Убрать неиспользуемые последовательности в БД -->
    <changeSet id="3.1-akorobko-43" author="akorobko">
        <sql>
            drop sequence SEQ_RASCHSV_UPL_SV_PREV;
        </sql>
    </changeSet>

    <!--https://jira.aplana.com/browse/SBRFNDFL-5294 Убрать неиспользуемые последовательности в БД -->
    <changeSet id="3.1-akorobko-44" author="akorobko">
        <sql>
            drop sequence SEQ_RASCHSV_VYPL_FIN_FB;
        </sql>
    </changeSet>

    <!--https://jira.aplana.com/browse/SBRFNDFL-5294 Убрать неиспользуемые последовательности в БД -->
    <changeSet id="3.1-akorobko-45" author="akorobko">
        <sql>
            drop sequence SEQ_RASCHSV_VYPL_PRICHINA;
        </sql>
    </changeSet>

    <!--https://jira.aplana.com/browse/SBRFNDFL-5294 Убрать неиспользуемые последовательности в БД -->
    <changeSet id="3.1-akorobko-46" author="akorobko">
        <sql>
            drop sequence SEQ_RASCHSV_VYPL_SV_DOP;
        </sql>
    </changeSet>

    <!--https://jira.aplana.com/browse/SBRFNDFL-5294 Убрать неиспользуемые последовательности в БД -->
    <changeSet id="3.1-akorobko-47" author="akorobko">
        <sql>
            drop sequence SEQ_RASCHSV_VYPL_SV_DOP_MT;
        </sql>
    </changeSet>

    <!-- https://jira.aplana.com/browse/SBRFNDFL-5134 Реализовать изменения в алгоритме проверки допустимости имен и фамилий -->
    <changeSet id="3.1-snazin-1" author="snazin">
        <update tableName="BLOB_DATA">
            <column name="data"
                    valueBlobFile="templates-3.1/refbook/person.groovy"/>
            <where>id in (select script_id from ref_book r where r.id = 904)</where>
        </update>
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script" valueClobFile="templates-3.1/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl_check.groovy"/>
            <where>DECLARATION_TEMPLATE_ID = 100 and EVENT_ID = 5</where>
        </update>
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script" valueClobFile="templates-3.1/ndfl/consolidated_rnu_ndfl/v2016/consolidated_rnu_ndfl_check.groovy"/>
            <where>DECLARATION_TEMPLATE_ID = 101 and EVENT_ID = 5</where>
        </update>
    </changeSet>

    <!--https://jira.aplana.com/browse/SBRFNDFL-5245 Изменить возможные значения поля format из справочника ref_book_attribute -->
    <changeSet id="3.1-akorobko-48" author="akorobko">
        <sql>
            update ref_book_attribute set format=7 where id=9083;
        </sql>
    </changeSet>

    <!-- https://jira.aplana.com/browse/SBRFNDFL-5330 -->
    <changeSet id="3.1-dnovikov-9" author="dnovikov">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script" valueClobFile="templates-3.1/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl_check.groovy"/>
            <where>DECLARATION_TEMPLATE_ID = 100 and EVENT_ID = 5</where>
        </update>
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script" valueClobFile="templates-3.1/ndfl/consolidated_rnu_ndfl/v2016/consolidated_rnu_ndfl_check.groovy"/>
            <where>DECLARATION_TEMPLATE_ID = 101 and EVENT_ID = 5</where>
        </update>
    </changeSet>

    <!-- В скрипте 3.1-snazin-0 указан путь к файлу не в той папке, нужно из templates-3.1 -->
    <changeSet id="3.1-snazin-2" author="snazin">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script"
                    valueClobFile="templates-3.1/ndfl/report_2ndfl_1/v2016/report_2ndfll_check.groovy"/>
            <where>id in (8, 12)</where>
        </update>
    </changeSet>

    <!-- У файлов скриптов были ошибочные названия -->
    <changeSet id="3.1-snazin-3" author="snazin">
        <update tableName="blob_data">
            <column name="name" value="id_doc.groovy"/>
            <where>id = '375ba56a-2509-11e7-93ae-92361f002671'</where>
        </update>
        <update tableName="blob_data">
            <column name="name" value="person.groovy"/>
            <where>id = '884b9f2e-1678-4d69-9652-b036bba2f728'</where>
        </update>
    </changeSet>

    <!--https://jira.aplana.com/browse/SBRFNDFL-5334 Создание недостающих связей между новыми подразделениями и периодами -->
    <changeSet id="3.1-akorobko-49" author="akorobko">
        <sql>
	insert into department_report_period(id,department_id,report_period_id,is_active,correction_date)
	select seq_department_report_period.nextval,id,report_period_id,is_active,correction_date from (
	select d_child.id,drp_parent.report_period_id,drp_parent.is_active,drp_parent.correction_date from department_child_view dcv
	join department d_parent on dcv.parent_id=d_parent.id and d_parent.type=2
	join department_report_period drp_parent on drp_parent.department_id=d_parent.id
	join department d_child on dcv.id=d_child.id
	where not exists (select * from department_report_period drp_child
			where drp_child.department_id=d_child.id and drp_child.report_period_id=drp_parent.report_period_id and
				(drp_child.correction_date=drp_parent.correction_date or (drp_child.correction_date is null and drp_parent.correction_date is null)))
	order by d_child.id,drp_parent.report_period_id,drp_parent.correction_date nulls first) a
        </sql>
    </changeSet>

    <changeSet id="3.1-dnovikov-10" author="dnovikov">
        <insert tableName="CONFIGURATION">
            <column name="code" value="WEIGHT_LAST_NAME"/>
            <column name="department_id" value="0"/>
            <column name="value" value="5"/>
        </insert>
        <insert tableName="CONFIGURATION">
            <column name="code" value="WEIGHT_FIRST_NAME"/>
            <column name="department_id" value="0"/>
            <column name="value" value="10"/>
        </insert>
        <insert tableName="CONFIGURATION">
            <column name="code" value="WEIGHT_MIDDLE_NAME"/>
            <column name="department_id" value="0"/>
            <column name="value" value="5"/>
        </insert>
        <insert tableName="CONFIGURATION">
            <column name="code" value="WEIGHT_BIRTHDAY"/>
            <column name="department_id" value="0"/>
            <column name="value" value="10"/>
        </insert>
        <insert tableName="CONFIGURATION">
            <column name="code" value="WEIGHT_CITIZENSHIP"/>
            <column name="department_id" value="0"/>
            <column name="value" value="1"/>
        </insert>
        <insert tableName="CONFIGURATION">
            <column name="code" value="WEIGHT_INP"/>
            <column name="department_id" value="0"/>
            <column name="value" value="15"/>
        </insert>
        <insert tableName="CONFIGURATION">
            <column name="code" value="WEIGHT_INN"/>
            <column name="department_id" value="0"/>
            <column name="value" value="10"/>
        </insert>
        <insert tableName="CONFIGURATION">
            <column name="code" value="WEIGHT_INN_FOREIGN"/>
            <column name="department_id" value="0"/>
            <column name="value" value="10"/>
        </insert>
        <insert tableName="CONFIGURATION">
            <column name="code" value="WEIGHT_SNILS"/>
            <column name="department_id" value="0"/>
            <column name="value" value="15"/>
        </insert>
        <insert tableName="CONFIGURATION">
            <column name="code" value="WEIGHT_TAX_PAYER_STATUS"/>
            <column name="department_id" value="0"/>
            <column name="value" value="1"/>
        </insert>
        <insert tableName="CONFIGURATION">
            <column name="code" value="WEIGHT_DUL"/>
            <column name="department_id" value="0"/>
            <column name="value" value="10"/>
        </insert>
        <insert tableName="CONFIGURATION">
            <column name="code" value="WEIGHT_ADDRESS"/>
            <column name="department_id" value="0"/>
            <column name="value" value="1"/>
        </insert>
        <insert tableName="CONFIGURATION">
            <column name="code" value="WEIGHT_ADDRESS_INO"/>
            <column name="department_id" value="0"/>
            <column name="value" value="1"/>
        </insert>
    </changeSet>

    <!--https://jira.aplana.com/browse/SBRFNDFL-5396 Добавление значения в справочник ОКТМО на серверах Апланы -->
    <changeSet id="3.1-akorobko-50" author="akorobko">
        <sql>
	merge into ref_book_oktmo a using
	(select '04614454' as code, 'сельсовет Памяти 13 Борцов' as name, 1 as razd, to_date('01.01.2012','dd.mm.yyyy') as version from dual
	 union all
	 select '04647454' as code, 'Уральский сельсовет' as name, 1 as razd, to_date('01.01.2012','dd.mm.yyyy') as version from dual
	 union all
	 select '04610433' as code, 'Предивинский сельсовет' as name, 1 as razd, to_date('01.01.2012','dd.mm.yyyy') as version from dual
	 union all
	 select '04635426' as code, 'Южно-Енисейский сельсовет' as name, 1 as razd, to_date('01.01.2012','dd.mm.yyyy') as version from dual
	 union all
	 select '04654439' as code, 'Светлогорский сельсовет' as name, 1 as razd, to_date('01.01.2012','dd.mm.yyyy') as version from dual
	) b
	on (a.code=b.code and a.status=0)
	when not matched then
	insert (id, record_id, version, status, code, name, razd)
	values (seq_ref_book_record.nextval,seq_ref_book_record_row_id.nextval, b.version, 0, b.code, b.name, b.razd);
        </sql>
    </changeSet>

    <!--start https://jira.aplana.com/browse/SBRFNDFL-5299 Реализовать добавление в РНУ колонки с АСНУ и фильтра по этой колонке-->
    <changeSet id="3.1-apronin-12" author="apronin">
        <addColumn tableName="ndfl_person">
            <column name="asnu_id" type="number(18)"/>
        </addColumn>
        <addColumn tableName="ndfl_person_deduction">
            <column name="asnu_id" type="number(18)"/>
        </addColumn>
        <addColumn tableName="ndfl_person_income">
            <column name="asnu_id" type="number(18)"/>
        </addColumn>
        <addColumn tableName="ndfl_person_prepayment">
            <column name="asnu_id" type="number(18)"/>
        </addColumn>
    </changeSet>

    <changeSet id="3.1-apronin-13" author="apronin">
        <sql>update (select np.ID as np_id, np.DECLARATION_DATA_ID as np_dd_id, np.ASNU_ID as np_asnu, dd.ID as dd_id, dd.ASNU_ID as dd_asnu
                from NDFL_PERSON np
                    left join DECLARATION_DATA dd on np.DECLARATION_DATA_ID = dd.ID
                where dd.DECLARATION_TEMPLATE_ID = (select dt.ID from DECLARATION_TEMPLATE dt where dt.DECLARATION_TYPE_ID = 100)) sub
            set sub.np_asnu = sub.dd_asnu
            where sub.dd_id = sub.np_dd_id
        </sql>
    </changeSet>
    <changeSet id="3.1-apronin-14" author="apronin">
        <sql>
            update (select npd.ASNU_ID as npd_asnu, dd.ASNU_ID as dd_asnu, dd.ID as dd_id, np.DECLARATION_DATA_ID as np_dd_id, npd.NDFL_PERSON_ID as npd_np_id, np.ID as np_id
                from NDFL_PERSON_DEDUCTION npd
                    left join NDFL_PERSON np on npd.NDFL_PERSON_ID = np.ID
                    left join DECLARATION_DATA dd on np.DECLARATION_DATA_ID = dd.ID
                where dd.DECLARATION_TEMPLATE_ID = (select dt.ID from DECLARATION_TEMPLATE dt where dt.DECLARATION_TYPE_ID = 100)) sub
            set sub.npd_asnu = sub.dd_asnu
            where sub.dd_id = sub.np_dd_id and sub.npd_np_id = sub.np_id;
        </sql>
    </changeSet>
    <changeSet id="3.1-apronin-15" author="apronin">
        <sql>
            update (select npi.ASNU_ID as npi_asnu, dd.ASNU_ID as dd_asnu, dd.ID as dd_id, np.DECLARATION_DATA_ID as np_dd_id, npi.NDFL_PERSON_ID as npi_np_id, np.ID as np_id
                from NDFL_PERSON_INCOME npi
                    left join NDFL_PERSON np on npi.NDFL_PERSON_ID = np.ID
                    left join DECLARATION_DATA dd on np.DECLARATION_DATA_ID = dd.ID
                where dd.DECLARATION_TEMPLATE_ID = (select dt.ID from DECLARATION_TEMPLATE dt where dt.DECLARATION_TYPE_ID = 100)) sub
            set sub.npi_asnu = sub.dd_asnu
            where sub.dd_id = sub.np_dd_id and sub.npi_np_id = sub.np_id
        </sql>
    </changeSet>
    <changeSet id="3.1-apronin-16" author="apronin">
        <sql>
            update (select npp.ASNU_ID as npp_asnu, dd.ASNU_ID as dd_asnu, dd.ID as dd_id, np.DECLARATION_DATA_ID as np_dd_id, npp.NDFL_PERSON_ID as npp_np_id, np.ID as np_id
            from NDFL_PERSON_PREPAYMENT npp
            left join NDFL_PERSON np on npp.NDFL_PERSON_ID = np.ID
            left join DECLARATION_DATA dd on np.DECLARATION_DATA_ID = dd.ID
            where dd.DECLARATION_TEMPLATE_ID = (select dt.ID from DECLARATION_TEMPLATE dt where dt.DECLARATION_TYPE_ID = 100)) sub
            set sub.npp_asnu = sub.dd_asnu
            where sub.dd_id = sub.np_dd_id and sub.npp_np_id = sub.np_id
        </sql>
    </changeSet>
    <changeSet id="3.1-apronin-17" author="apronin">
        <sql>
            update (
            select npi.ASNU_ID as npi_asnu, npi.SOURCE_ID as npi_source, npi.ID as npi_id
            from NDFL_PERSON_INCOME npi
            where npi.SOURCE_ID is not null ) sub
            set sub.npi_asnu = (select outer_npi.ASNU_ID from NDFL_PERSON_INCOME outer_npi where outer_npi.id = sub.npi_source)
        </sql>
    </changeSet>
    <changeSet id="3.1-apronin-18" author="apronin">
        <sql>
            update (
            select npd.ASNU_ID as npd_asnu, npd.SOURCE_ID as npd_source, npd.ID as npd_id
            from NDFL_PERSON_DEDUCTION npd
            where npd.SOURCE_ID is not null) sub
            set sub.npd_asnu = (select outer_npd.ASNU_ID from NDFL_PERSON_DEDUCTION outer_npd where outer_npd.id = sub.npd_source)
        </sql>
    </changeSet>
    <changeSet id="3.1-apronin-19" author="apronin">
        <sql>
            update (
            select npp.ASNU_ID as npp_asnu, npp.SOURCE_ID as npp_source, npp.ID as npp_id
            from NDFL_PERSON_PREPAYMENT npp
            where npp.SOURCE_ID is not null) sub
            set sub.npp_asnu = (select outer_npp.ASNU_ID from NDFL_PERSON_PREPAYMENT outer_npp where outer_npp.id = sub.npp_source)
        </sql>
    </changeSet>
    <changeSet id="3.1-apronin-20" author="apronin">
        <sql>
            comment on column ndfl_person.asnu_id
            is 'Идентификатор АСНУ';
        </sql>
        <sql>
            comment on column ndfl_person_income.asnu_id
            is 'Идентификатор АСНУ';
        </sql>
        <sql>
            comment on column ndfl_person_deduction.asnu_id
            is 'Идентификатор АСНУ';
        </sql>
        <sql>
            comment on column ndfl_person_prepayment.asnu_id
            is 'Идентификатор АСНУ';
        </sql>
    </changeSet>
    <changeSet id="3.1-apronin-21" author="apronin">
        <update tableName="DECLARATION_TEMPLATE">
            <column name="CREATE_SCRIPT" valueClobFile="templates-3.1/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl.groovy"/>
            <where>declaration_type_id = 100</where>
        </update>
    </changeSet>
    <changeSet id="3.1-apronin-22" author="apronin">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script" valueClobFile="templates-3.1/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl_import.groovy"/>
            <where>DECLARATION_TEMPLATE_ID = 100 and EVENT_ID = 7</where>
        </update>
    </changeSet>
    <!--end https://jira.aplana.com/browse/SBRFNDFL-5299 Реализовать добавление в РНУ колонки с АСНУ и фильтра по этой колонке-->
</databaseChangeLog>