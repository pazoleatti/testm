<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
                                       http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd">

    <changeSet id="2.2-ytrofimov-0" author="ytrofimov">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script" valueClobFile="templates/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl_check.groovy"/>
            <where>id=2</where>
        </update>
    </changeSet>

    <changeSet id="2.2-ytrofimov-1" author="ytrofimov">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script"
                    valueClobFile="templates/ndfl/consolidated_rnu_ndfl/v2016/consolidated_rnu_ndfl_check.groovy"/>
            <where>id=6</where>
        </update>
    </changeSet>

    <changeSet id="2.2-ytrofimov-2" author="ytrofimov">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script"
                    valueClobFile="templates/ndfl/consolidated_rnu_ndfl/v2016/consolidated_rnu_ndfl_check.groovy"/>
            <where>id=6</where>
        </update>
    </changeSet>

    <!-- https://jira.aplana.com/browse/SBRFNDFL-3072 -->
    <changeSet id="2.2-ytrofimov-3" author="ytrofimov">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script"
                    valueClobFile="templates/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl_calculate.groovy"/>
            <where>id=1</where>
        </update>
    </changeSet>

    <changeSet id="2.2-ytrofimov-4" author="ytrofimov">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script"
                    valueClobFile="templates/ndfl/consolidated_rnu_ndfl/v2016/consolidated_rnu_ndfl_check.groovy"/>
            <where>id=6</where>
        </update>
    </changeSet>

    <!-- https://jira.aplana.com/browse/SBRFNDFL-3076 -->
    <changeSet id="2.2-ytrofimov-5" author="ytrofimov">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script"
                    valueClobFile="templates/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl_calculate.groovy"/>
            <where>id=1</where>
        </update>
    </changeSet>

    <!--https://jira.aplana.com/browse/SBRFNDFL-2930 -->
    <changeSet id="2.2-afateev-0" author="afateev">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script"
                    valueClobFile="templates/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl_calculate.groovy"/>
            <where>id=1</where>
        </update>
    </changeSet>

    <!--https://jira.aplana.com/browse/SBRFNDFL-2930 -->
    <changeSet id="2.2-afateev-1" author="afateev">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script"
                    valueClobFile="templates/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl_calculate.groovy"/>
            <where>id=1</where>
        </update>
    </changeSet>

    <changeSet id="2.2-dnovikov-0" author="dnovikov">
        <update tableName="BLOB_DATA">
            <column name="data" valueBlobFile="templates/refbook/declaration_type.groovy"/>
            <where>id='352adf59-372b-4020-98fe-8960dd5bc972'</where>
        </update>
    </changeSet>

    <changeSet id="2.2-dnovikov-1" author="dnovikov">
        <update tableName="BLOB_DATA">
            <column name="data" valueBlobFile="templates/refbook/declaration_type.groovy"/>
            <where>id='352adf59-372b-4020-98fe-8960dd5bc972'</where>
        </update>
    </changeSet>

    <!-- https://jira.aplana.com/browse/SBRFNDFL-3076 -->
    <changeSet id="2.2-ytrofimov-6" author="ytrofimov">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script"
                    valueClobFile="templates/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl_calculate.groovy"/>
            <where>id=1</where>
        </update>
    </changeSet>

    <!-- https://jira.aplana.com/browse/SBRFNDFL-2750 -->
    <changeSet id="2.2-aokunev-1" author="aokunev">
        <update tableName="DECLARATION_TYPE">
            <column name="NAME" value="РНУ НДФЛ (первичная)"/>
            <where>id=100</where>
        </update>
        <update tableName="DECLARATION_TYPE">
            <column name="NAME" value="РНУ НДФЛ (консолидированная)"/>
            <where>id=101</where>
        </update>
        <update tableName="DECLARATION_TEMPLATE">
            <column name="NAME" value="РНУ НДФЛ (первичная)"/>
            <where>id=100</where>
        </update>
        <update tableName="DECLARATION_TEMPLATE">
            <column name="NAME" value="РНУ НДФЛ (консолидированная)"/>
            <where>id=101</where>
        </update>
    </changeSet>

    <!-- https://jira.aplana.com/browse/SBRFNDFL-3133 - проверка -->
    <changeSet id="2.2-dloshkarev-0" author="dloshkarev">
        <insert tableName="LOCK_DATA">
            <column name="id" value="1"/>
            <column name="key" value="TEST_LOCK"/>
            <column name="user_id" value="13276"/>
        </insert>
    </changeSet>
    <!-- https://jira.aplana.com/browse/SBRFNDFL-3133 - откат -->
    <changeSet id="2.2-dloshkarev-1" author="dloshkarev">
        <delete tableName="LOCK_DATA">
            <where>id = 1</where>
        </delete>
    </changeSet>

    <!-- https://jira.aplana.com/browse/SBRFNDFL-2891 -->
    <changeSet id="2.2-aokunev-2" author="aokunev">
        <update tableName="BLOB_DATA">
            <column name="data" valueBlobFile="templates/refbook/declaration_type.groovy"/>
            <where>id='352adf59-372b-4020-98fe-8960dd5bc972'</where>
        </update>
    </changeSet>

    <!-- https://jira.aplana.com/browse/SBRFNDFL-2583 -->
    <changeSet id="2.2-ytrofimov-7" author="ytrofimov">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script"
                    valueClobFile="templates/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl_calculate.groovy"/>
            <where>id=1</where>
        </update>
    </changeSet>

    <changeSet id="2.2-dnovikov-2" author="dnovikov">
        <update tableName="BLOB_DATA">
            <column name="data" valueBlobFile="templates/refbook/declaration_type.groovy"/>
            <where>id='352adf59-372b-4020-98fe-8960dd5bc972'</where>
        </update>
    </changeSet>

    <!-- https://jira.aplana.com/browse/SBRFNDFL-2583 -->
    <changeSet id="2.2-ytrofimov-8" author="ytrofimov">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script"
                    valueClobFile="templates/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl_calculate.groovy"/>
            <where>id=1</where>
        </update>
    </changeSet>

    <changeSet id="2.2-ytrofimov-9" author="ytrofimov">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script" valueClobFile="templates/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl_check.groovy"/>
            <where>id=2</where>
        </update>
    </changeSet>

    <changeSet id="2.2-ytrofimov-10" author="ytrofimov">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script"
                    valueClobFile="templates/ndfl/consolidated_rnu_ndfl/v2016/consolidated_rnu_ndfl_check.groovy"/>
            <where>id=6</where>
        </update>
    </changeSet>

    <changeSet id="2.2-ytrofimov-11" author="ytrofimov">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script"
                    valueClobFile="templates/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl_calculate.groovy"/>
            <where>id=1</where>
        </update>
    </changeSet>

    <changeSet id="2.2-ytrofimov-12" author="ytrofimov">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script"
                    valueClobFile="templates/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl_calculate.groovy"/>
            <where>id=1</where>
        </update>
    </changeSet>

    <!--https://jira.aplana.com/browse/SBRFNDFL-3025 -->
    <changeSet id="2.2-dloshkarev-2" author="dloshkarev">
        <update tableName="DECLARATION_TEMPLATE">
            <column name="create_script" valueClobFile="templates/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl.groovy"/>
            <where>id=100</where>
        </update>
    </changeSet>

    <changeSet id="2.2-ytrofimov-13" author="ytrofimov">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script"
                    valueClobFile="templates/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl_calculate.groovy"/>
            <where>id=1</where>
        </update>
    </changeSet>

    <!-- https://jira.aplana.com/browse/SBRFNDFL-2583 -->
    <changeSet id="2.2-ytrofimov-14" author="ytrofimov">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script"
                    valueClobFile="templates/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl_calculate.groovy"/>
            <where>id=1</where>
        </update>
    </changeSet>

    <!-- https://jira.aplana.com/browse/SBRFNDFL-2583 -->
    <changeSet id="2.2-ytrofimov-15" author="ytrofimov">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script"
                    valueClobFile="templates/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl_calculate.groovy"/>
            <where>id=1</where>
        </update>
    </changeSet>

    <changeSet id="2.2-ytrofimov-16" author="ytrofimov">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script"
                    valueClobFile="templates/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl_calculate.groovy"/>
            <where>id=1</where>
        </update>
    </changeSet>

    <changeSet id="2.2-ytrofimov-17" author="ytrofimov">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script"
                    valueClobFile="templates/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl_calculate.groovy"/>
            <where>id=1</where>
        </update>
    </changeSet>

    <changeSet id="2.2-dnovikov-3" author="dnovikov">
        <sql>
            CREATE global TEMPORARY TABLE tmp_numbers0 (
                num NUMBER(18,0)
            ) ON COMMIT DELETE ROWS ;
            CREATE global TEMPORARY TABLE tmp_numbers1 (
                num NUMBER(18,0)
            ) ON COMMIT DELETE ROWS ;
        </sql>
    </changeSet>

	<!--https://jira.aplana.com/browse/SBRFNDFL-1382 Исправить наполнение справочника REF_BOOK_TARIFF_PAYER. Нужно удалить таблицу-->
	<changeSet id="2.1-rnurgaleev-0" author="rnurgaleev">
        <dropTable cascadeConstraints="true"
                   tableName="ref_book_tariff_payer"/>
    </changeSet>

	<changeSet id="2.2-rnurgaleev-1" author="rnurgaleev">
        <delete
                tableName="ref_book_attribute">
            <where>ref_book_id=938
            </where>
        </delete>
    </changeSet>

    <changeSet id="2.2-rnurgaleev-2" author="rnurgaleev">
        <delete
                tableName="ref_book">
            <where>table_name='REF_BOOK_TARIFF_PAYER'</where>
        </delete>
    </changeSet>

    <!--https://jira.aplana.com/browse/SBRFNDFL-2898 В журнале "Список налоговых форм" заменить кнопку "Рассчитать" на кнопки "Идентифицировать ФЛ" и "Консолидировать"-->
    <changeSet id="2.2-ytrofimov-18" author="ytrofimov">
        <insert tableName="async_task_type">
            <column name="id" value="8"/>
            <column name="name" value="Расчет налоговой формы (формирование XML-файла)"/>
            <column name="handler_bean" value="IdentifyAsyncTask"/>
            <column name="short_queue_limit" value="3000"/>
            <column name="limit_kind" value="Количество ФЛ в НФ"/>
        </insert>
    </changeSet>

    <changeSet id="2.2-ytrofimov-19" author="ytrofimov">
        <insert tableName="async_task_type">
            <column name="id" value="9"/>
            <column name="name" value="Расчет налоговой формы (формирование XML-файла)"/>
            <column name="handler_bean" value="ConsolidateAsyncTask"/>
            <column name="short_queue_limit" value="3000"/>
            <column name="limit_kind" value="Количество ФЛ в НФ"/>
        </insert>
    </changeSet>

    <!--https://jira.aplana.com/browse/SBRFNDFL-3062 -->
    <changeSet id="2.2-ytrofimov-22" author="ytrofimov">
        <update tableName="DECLARATION_TEMPLATE">
            <column name="create_script" valueClobFile="templates/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl.groovy"/>
            <where>id=100</where>
        </update>
    </changeSet>

    <!--https://jira.aplana.com/browse/SBRFNDFL-3201 -->
    <changeSet id="2.2-ytrofimov-23" author="ytrofimov">
        <update tableName="BLOB_DATA">
            <column name="data" valueBlobFile="templates/refbook/declaration_type.groovy"/>
            <where>id='352adf59-372b-4020-98fe-8960dd5bc972'</where>
        </update>
    </changeSet>

    <changeSet id="2.2-ytrofimov-24" author="ytrofimov">
        <update tableName="DECLARATION_TEMPLATE">
            <column name="CREATE_SCRIPT" valueClobFile="templates/ndfl/report_2ndfl_1/v2016/report_2ndfl.groovy"/>
            <where>id=102</where>
        </update>
    </changeSet>

    <changeSet id="2.2-ytrofimov-25" author="ytrofimov">
        <update tableName="DECLARATION_TEMPLATE">
            <column name="CREATE_SCRIPT" valueClobFile="templates/ndfl/report_6ndfl/v2016/report_6ndfl.groovy"/>
            <where>id=103</where>
        </update>
    </changeSet>

    <changeSet id="2.2-ytrofimov-26" author="ytrofimov">
        <update tableName="DECLARATION_TEMPLATE">
            <column name="CREATE_SCRIPT" valueClobFile="templates/ndfl/report_2ndfl_1/v2016/report_2ndfl.groovy"/>
            <where>id=104</where>
        </update> 
    </changeSet>
	
	<!--https://jira.aplana.com/browse/SBRFNDFL-3361 ФИАС: не находит адрес в справочнике-->
	<changeSet id="2.2-rnurgaleev-3" author="rnurgaleev">
        <sql splitStatements="false">
            declare
				v_count number;
			begin
				select count(1) into v_count from user_mviews where mview_name='MV_FIAS_LOCALITY_ACT';
				if v_count>0 then
					execute immediate 'DROP MATERIALIZED VIEW MV_FIAS_LOCALITY_ACT';
				end if;

				select count(1) into v_count from user_mviews where mview_name='MV_FIAS_LOCALITY_ACT';
				if v_count=0 then
					execute immediate 'CREATE MATERIALIZED VIEW MV_FIAS_LOCALITY_ACT (ID, AOID, FORMALNAME, SHORTNAME, REGIONCODE, LIVESTATUS, CURRSTATUS, AOLEVEL, POSTALCODE, PARENTGUID, FNAME, FTYPE, HAS_CHILD)
    NOLOGGING
    BUILD IMMEDIATE
    USING INDEX
    REFRESH COMPLETE ON DEMAND
    USING DEFAULT LOCAL ROLLBACK SEGMENT
    USING ENFORCED CONSTRAINTS DISABLE QUERY REWRITE
    AS select distinct f.id, f.aoid, f.formalname, f.shortname, f.regioncode, f.livestatus, f.currstatus, f.aolevel, f.postalcode, 
    nvl(d.parentguid,f.parentguid) parentguid,
       replace(lower(f.formalname),'' '','''') fname,
       trim(lower(f.shortname)) ftype,
       nvl2(c.id,1,0) has_child
    from fias_addrobj f left join fias_addrobj c on (c.parentguid=f.aoid and c.currstatus=0)
    left join fias_addrobj d on (f.parentguid=d.aoid and d.currstatus=0 and d.aolevel=5)
    where f.currstatus=0
    and f.aolevel in (6,90)';
	
					execute immediate 'CREATE INDEX IDX_MV_FIAS_LOCALITY_AOID ON MV_FIAS_LOCALITY_ACT (AOID)';
					execute immediate 'CREATE INDEX IDX_MV_FIAS_LOCALITY_FNAME ON MV_FIAS_LOCALITY_ACT (FNAME)';
					execute immediate 'CREATE INDEX IDX_MV_FIAS_LOCALITY_PGUID ON MV_FIAS_LOCALITY_ACT (PARENTGUID)';
					execute immediate 'CREATE INDEX SRCH_MV_FIAS_LOCAL_REG_FN_TP ON MV_FIAS_LOCALITY_ACT (REGIONCODE, FNAME, FTYPE, HAS_CHILD)';
					execute immediate 'CREATE UNIQUE INDEX PK_MV_FIAS_LOCALITY_ACT ON MV_FIAS_LOCALITY_ACT (ID)';

					execute immediate 'COMMENT ON COLUMN MV_FIAS_LOCALITY_ACT.ID IS ''Уникальный идентификатор''';
					execute immediate 'COMMENT ON COLUMN MV_FIAS_LOCALITY_ACT.AOID IS ''Идентификатор объекта''';
					execute immediate 'COMMENT ON COLUMN MV_FIAS_LOCALITY_ACT.FORMALNAME IS ''Формализованное наименование''';
					execute immediate 'COMMENT ON COLUMN MV_FIAS_LOCALITY_ACT.SHORTNAME IS ''Тип адресного объекта''';
					execute immediate 'COMMENT ON COLUMN MV_FIAS_LOCALITY_ACT.REGIONCODE IS ''Код региона''';
					execute immediate 'COMMENT ON COLUMN MV_FIAS_LOCALITY_ACT.LIVESTATUS IS ''Статус актуальности ФИАС: 1 - актуальная, 0 - устаревшая''';
					execute immediate 'COMMENT ON COLUMN MV_FIAS_LOCALITY_ACT.CURRSTATUS IS ''Статус актуальности КЛАДР: 0 - актуальная, ..''';
					execute immediate 'COMMENT ON COLUMN MV_FIAS_LOCALITY_ACT.AOLEVEL IS ''Уровень объекта''';
					execute immediate 'COMMENT ON COLUMN MV_FIAS_LOCALITY_ACT.POSTALCODE IS ''Почтовый индекс''';
					execute immediate 'COMMENT ON COLUMN MV_FIAS_LOCALITY_ACT.PARENTGUID IS ''Идентификатор родительского объекта''';
					execute immediate 'COMMENT ON COLUMN MV_FIAS_LOCALITY_ACT.FNAME IS ''Наименование, адаптированное для проверки адреса (строчными буквами, без пробелов)''';
					execute immediate 'COMMENT ON COLUMN MV_FIAS_LOCALITY_ACT.FTYPE IS ''Тип, адаптированный для проверки адреса (строчными буквами, без пробелов)''';
					execute immediate 'COMMENT ON COLUMN MV_FIAS_LOCALITY_ACT.HAS_CHILD IS ''Наличие дочерних элементов''';
					execute immediate 'COMMENT ON MATERIALIZED VIEW MV_FIAS_LOCALITY_ACT  IS ''Актуальные населенные пункты из справочника ФИАС''';
				end if;

				select count(1) into v_count from user_mviews where mview_name='MV_FIAS_STREET_ACT';
				if v_count>0 then
					execute immediate 'DROP MATERIALIZED VIEW MV_FIAS_STREET_ACT';
				end if;

				select count(1) into v_count from user_mviews where mview_name='MV_FIAS_STREET_ACT';
				if v_count=0 then
					execute immediate 'CREATE MATERIALIZED VIEW MV_FIAS_STREET_ACT (ID, AOID, FORMALNAME, SHORTNAME, REGIONCODE, LIVESTATUS, CURRSTATUS, AOLEVEL, POSTALCODE, PARENTGUID, FNAME, FTYPE, HAS_CHILD)
    NOLOGGING
    BUILD IMMEDIATE
    USING INDEX
    REFRESH COMPLETE ON DEMAND
    USING DEFAULT LOCAL ROLLBACK SEGMENT
    USING ENFORCED CONSTRAINTS DISABLE QUERY REWRITE
    AS select distinct f.id, f.aoid, f.formalname, f.shortname, f.regioncode, f.livestatus, f.currstatus, f.aolevel, f.postalcode, 
coalesce(e.parentguid,d.parentguid,f.parentguid) parentguid,
       replace(lower(f.formalname),'' '','''') fname,
       trim(lower(f.shortname)) ftype,
       nvl2(c.id,1,0) has_child
    from fias_addrobj f left join fias_addrobj c on (c.parentguid=f.aoid and c.currstatus=0)
    left join fias_addrobj d on (f.parentguid=d.aoid and d.currstatus=0 and d.aolevel in (5,65))
    left join fias_addrobj e on (d.parentguid=e.aoid and d.currstatus=0 and d.aolevel=65 and e.aolevel=5)
    where f.currstatus=0
    and f.aolevel in (7,91)';

					execute immediate 'CREATE UNIQUE INDEX PK_MV_FIAS_STREET_ACT ON MV_FIAS_STREET_ACT (ID)';
					execute immediate 'CREATE INDEX IDX_MV_FIAS_STREET_AOID ON MV_FIAS_STREET_ACT (AOID)';
					execute immediate 'CREATE INDEX IDX_MV_FIAS_STREET_FNAME ON MV_FIAS_STREET_ACT (FNAME)';
					execute immediate 'CREATE INDEX IDX_MV_FIAS_STREET_PGUID ON MV_FIAS_STREET_ACT (PARENTGUID)';
					execute immediate 'CREATE INDEX SRCH_MV_FIAS_STREET_REG_FN_TP ON MV_FIAS_STREET_ACT (REGIONCODE, FNAME, FTYPE, HAS_CHILD)';
					execute immediate 'CREATE INDEX IDX_MV_FIAS_STREET_POST ON MV_FIAS_STREET_ACT (POSTALCODE)';

					execute immediate 'COMMENT ON COLUMN MV_FIAS_STREET_ACT.ID IS ''Уникальный идентификатор''';
					execute immediate 'COMMENT ON COLUMN MV_FIAS_STREET_ACT.AOID IS ''Идентификатор объекта''';
					execute immediate 'COMMENT ON COLUMN MV_FIAS_STREET_ACT.FORMALNAME IS ''Формализованное наименование''';
					execute immediate 'COMMENT ON COLUMN MV_FIAS_STREET_ACT.SHORTNAME IS ''Тип адресного объекта''';
					execute immediate 'COMMENT ON COLUMN MV_FIAS_STREET_ACT.REGIONCODE IS ''Код региона''';
					execute immediate 'COMMENT ON COLUMN MV_FIAS_STREET_ACT.LIVESTATUS IS ''Статус актуальности ФИАС: 1 - актуальная, 0 - устаревшая''';
					execute immediate 'COMMENT ON COLUMN MV_FIAS_STREET_ACT.CURRSTATUS IS ''Статус актуальности КЛАДР: 0 - актуальная, ..''';
					execute immediate 'COMMENT ON COLUMN MV_FIAS_STREET_ACT.AOLEVEL IS ''Уровень объекта''';
					execute immediate 'COMMENT ON COLUMN MV_FIAS_STREET_ACT.POSTALCODE IS ''Почтовый индекс''';
					execute immediate 'COMMENT ON COLUMN MV_FIAS_STREET_ACT.PARENTGUID IS ''Идентификатор родительского объекта''';
					execute immediate 'COMMENT ON COLUMN MV_FIAS_STREET_ACT.FNAME IS ''Наименование, адаптированное для проверки адреса (строчными буквами, без пробелов)''';
					execute immediate 'COMMENT ON COLUMN MV_FIAS_STREET_ACT.FTYPE IS ''Тип, адаптированный для проверки адреса (строчными буквами, без пробелов)''';
					execute immediate 'COMMENT ON COLUMN MV_FIAS_STREET_ACT.HAS_CHILD IS ''Наличие дочерних элементов''';
					execute immediate 'COMMENT ON MATERIALIZED VIEW MV_FIAS_STREET_ACT  IS ''Актуальные улицы из справочника ФИАС''';
				end if;
			end;
        </sql>
    </changeSet>

    <!-- https://jira.aplana.com/browse/SBRFNDFL-3441 -->
    <changeSet id="2.2-ytrofimov-27" author="ytrofimov">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script"
                    valueClobFile="templates/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl_calculate.groovy"/>
            <where>id=1</where>
        </update>
    </changeSet>

    <!--https://jira.aplana.com/browse/SBRFNDFL-3259 -->
    <changeSet id="2.2-ytrofimov-28" author="ytrofimov">
        <update tableName="DECLARATION_TEMPLATE">
            <column name="create_script" valueClobFile="templates/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl.groovy"/>
            <where>id=100</where>
        </update>
    </changeSet>

    <changeSet id="2.2-ytrofimov-29" author="ytrofimov">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script" valueClobFile="templates/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl_check.groovy"/>
            <where>id=2</where>
        </update>
    </changeSet>

    <changeSet id="2.2-ytrofimov-30" author="ytrofimov">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script"
                    valueClobFile="templates/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl_import.groovy"/>
            <where>id=14</where>
        </update>
    </changeSet>

    <changeSet id="2.2-ytrofimov-31" author="ytrofimov">
        <update tableName="DECLARATION_TEMPLATE">
            <column name="create_script"
                    valueClobFile="templates/ndfl/consolidated_rnu_ndfl/v2016/consolidated_rnu_ndfl.groovy"/>
            <where>id=101</where>
        </update>
    </changeSet>

    <changeSet id="2.2-ytrofimov-32" author="ytrofimov">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script"
                    valueClobFile="templates/ndfl/consolidated_rnu_ndfl/v2016/consolidated_rnu_ndfl_calculate.groovy"/>
            <where>id=5</where>
        </update>
    </changeSet>

    <changeSet id="2.2-ytrofimov-33" author="ytrofimov">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script"
                    valueClobFile="templates/ndfl/consolidated_rnu_ndfl/v2016/consolidated_rnu_ndfl_check.groovy"/>
            <where>id=6</where>
        </update>
    </changeSet>

    <changeSet id="2.2-ytrofimov-34" author="ytrofimov">
        <update tableName="DECLARATION_TEMPLATE">
            <column name="CREATE_SCRIPT" valueClobFile="templates/ndfl/report_2ndfl_1/v2016/report_2ndfl.groovy"/>
            <where>id=102</where>
        </update>
    </changeSet>

    <changeSet id="2.2-ytrofimov-35" author="ytrofimov">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script"
                    valueClobFile="templates/ndfl/report_2ndfl_1/v2016/report_2ndfll_check.groovy"/>
            <where>id=8</where>
        </update>
    </changeSet>

    <changeSet id="2.2-ytrofimov-36" author="ytrofimov">
        <update tableName="DECLARATION_TEMPLATE">
            <column name="CREATE_SCRIPT" valueClobFile="templates/ndfl/report_6ndfl/v2016/report_6ndfl.groovy"/>
            <where>id=103</where>
        </update>
    </changeSet>

    <changeSet id="2.2-ytrofimov-37" author="ytrofimov">
        <update tableName="DECLARATION_TEMPLATE">
            <column name="CREATE_SCRIPT" valueClobFile="templates/ndfl/report_2ndfl_1/v2016/report_2ndfl.groovy"/>
            <where>id=104</where>
        </update>
    </changeSet>

    <changeSet id="2.2-ytrofimov-38" author="ytrofimov">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script"
                    valueClobFile="templates/ndfl/report_2ndfl_1/v2016/report_2ndfll_check.groovy"/>
            <where>id=12</where>
        </update>
    </changeSet>

    <!--https://jira.aplana.com/browse/SBRFNDFL-3269 -->
    <changeSet id="2.2-ytrofimov-39" author="ytrofimov">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script"
                    valueClobFile="templates/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl_calculate.groovy"/>
            <where>id=1</where>
        </update>
    </changeSet>

    <changeSet id="2.2-dnovikov-4" author="dnovikov">
        <update tableName="REPORT_PERIOD_TYPE">
            <column name="NAME" value="первый квартал при реорганизации (ликвидации) организации"/>
            <where>code='51'</where>
        </update>
    </changeSet>

    <changeSet id="2.2-dnovikov-5" author="dnovikov">
        <update tableName="REPORT_PERIOD_TYPE">
            <column name="NAME" value="полугодие при реорганизации (ликвидации) организации"/>
            <where>code='52'</where>
        </update>
    </changeSet>

    <changeSet id="2.2-dnovikov-6" author="dnovikov">
        <update tableName="REPORT_PERIOD_TYPE">
            <column name="NAME" value="9 месяцев при реорганизации (ликвидации) организации"/>
            <where>code='53'</where>
        </update>
    </changeSet>

    <!--https://jira.aplana.com/browse/SBRFNDFL-3521 -->
    <changeSet id="2.2-ytrofimov-40" author="ytrofimov">
        <update tableName="DECLARATION_TEMPLATE">
            <column name="CREATE_SCRIPT" valueClobFile="templates/ndfl/report_2ndfl_1/v2016/report_2ndfl.groovy"/>
            <where>id=102</where>
        </update>
    </changeSet>

    <changeSet id="2.2-ytrofimov-41" author="ytrofimov">
        <update tableName="DECLARATION_TEMPLATE">
            <column name="CREATE_SCRIPT" valueClobFile="templates/ndfl/report_2ndfl_1/v2016/report_2ndfl.groovy"/>
            <where>id=104</where>
        </update>
    </changeSet>

    <changeSet id="2.2-dnovikov-7" author="dnovikov">
        <sql>
            alter table ASYNC_TASK modify (DESCRIPTION VARCHAR2(400 CHAR));
        </sql>
    </changeSet>
	
	<!--https://jira.aplana.com/browse/SBRFNDFL-3524 Обновить данные справочников кодов видов дохода и вычетов по НДФЛ-->
	
	<changeSet id="2.2-rnurgaleev-4" author="rnurgaleev">
        <sql splitStatements="false">
            begin
				update ref_book_income_type set name='Проценты (за исключением процентов по облигациям с ипотечным покрытием, эмитированным до 01.01.2007, доходов в виде процентов, получаемых по вкладам в банках, и доходов, получаемых при погашении векселя), включая дисконт, полученный по долговому обязательству любого вида, за исключением сумм дохода в виде процента (купона), получаемого налогоплательщиком по обращающимся облигациям российских организаций, номинированным в рублях и эмитированным после 1 января 2017 года'
				where code='1011' and status=0;
				
				insert into ref_book_income_type (id,record_id,version,status,code,name) 
				values (seq_ref_book_record.nextval,seq_ref_book_record_row_id.nextval,to_date('24.10.2017','DD.MM.YYYY'),0,'2013','Сумма компенсации за неиспользованный отпуск');
				insert into ref_book_income_type (id,record_id,version,status,code,name) 
				values (seq_ref_book_record.nextval,seq_ref_book_record_row_id.nextval,to_date('24.10.2017','DD.MM.YYYY'),0,'2014','Сумма выплаты в виде выходного пособия, среднего месячного заработка на период трудоустройства, компенсации руководителю, заместителям руководителя и главному бухгалтеру организации в части, превышающей в целом трехкратный размер среднего месячного заработка или шестикратный размер среднего месячного заработка для работников, уволенных из организаций, расположенных в районах Крайнего Севера и приравненных к ним местностях');
				insert into ref_book_income_type (id,record_id,version,status,code,name) 
				values (seq_ref_book_record.nextval,seq_ref_book_record_row_id.nextval,to_date('24.10.2017','DD.MM.YYYY'),0,'2301','Суммы штрафов и неустойки, выплачиваемые организацией на основании решения суда за несоблюдение в добровольном порядке удовлетворения требований потребителей в соответствии с Законом Российской Федерации от 07.02.1992 N 2300-1 "О защите прав потребителей"');
				insert into ref_book_income_type (id,record_id,version,status,code,name) 
				values (seq_ref_book_record.nextval,seq_ref_book_record_row_id.nextval,to_date('24.10.2017','DD.MM.YYYY'),0,'2611','Сумма списанного в установленном порядке безнадежного долга с баланса организации');
				insert into ref_book_income_type (id,record_id,version,status,code,name) 
				values (seq_ref_book_record.nextval,seq_ref_book_record_row_id.nextval,to_date('24.10.2017','DD.MM.YYYY'),0,'3023','Сумма дохода в виде процента (купона), получаемого налогоплательщиком по обращающимся облигациям российских организаций, номинированным в рублях и эмитированным после 1 января 2017 года');
			
				insert into ref_book_deduction_type (id,record_id,version,status,code,name,deduction_mark) 
				values (seq_ref_book_record.nextval,seq_ref_book_record_row_id.nextval,to_date('24.10.2017','dd.mm.yyyy'),0,'619','Вычет в сумме положительного финансового результата, полученного по операциям, учитываемым на индивидуальном инвестиционном счете',(select id from ref_book_deduction_mark where code='3'));
				
			end;
        </sql>
    </changeSet>
	
	
	<!--https://jira.aplana.com/browse/SBRFNDFL-3452 Изменение разделителей при сравнении ДУЛ-->
	<changeSet id="2.2-rnurgaleev-5" author="rnurgaleev">
        <sqlFile dbms="oracle"
                 encoding="utf8"
                 endDelimiter=""
                 path="/scripts/person_pkg5.sql"
                 relativeToChangelogFile="true"
                 splitStatements="false"/>
    </changeSet>

    <changeSet id="2.2-rnurgaleev-6" author="rnurgaleev">
        <sqlFile dbms="oracle"
                 encoding="utf8"
                 endDelimiter=""
                 path="/scripts/person_pkg_body5.sql"
                 relativeToChangelogFile="true"
                 splitStatements="false"/>
    </changeSet>

    <changeSet id="2.2-ytrofimov-42" author="ytrofimov">
        <update tableName="BLOB_DATA">
            <column name="data"
                    valueBlobFile="templates/ndfl/primary_rnu_ndfl/v2016/rnu_ndfl_person_all_db.xlsx"/>
            <where>id = '4b84692c-7f70-4d11-844d-e61e81655336'</where>
        </update>
    </changeSet>

    <changeSet id="2.2-ytrofimov-43" author="ytrofimov">
        <update tableName="BLOB_DATA">
            <column name="data"
                    valueBlobFile="templates/ndfl/consolidated_rnu_ndfl/v2016/rnu_ndfl_person_all_db.xlsx"/>
            <where>id = '64536272-05bc-42e8-82c5-347faf22da20'</where>
        </update>
    </changeSet>
	
	<!--https://jira.aplana.com/browse/SBRFNDFL-2670 Проверка адресов по ФИАС. Обязательно наличие краткого наименования района-->
	<changeSet id="2.2-rnurgaleev-7" author="rnurgaleev">
        <sqlFile dbms="oracle"
                 encoding="utf8"
                 endDelimiter=""
                 path="/scripts/fias_pkg_body10.sql"
                 relativeToChangelogFile="true"
                 splitStatements="false"/>
    </changeSet>

    <!--https://jira.aplana.com/browse/SBRFNDFL-3430 -->
    <changeSet id="2.2-ytrofimov-44" author="ytrofimov">
        <update tableName="BLOB_DATA">
            <column name="data"
                    valueBlobFile="templates/ndfl/report_6ndfl/v2016/report.jrxml"/>
            <where>id in (select jrxml from declaration_template dt where dt.id = 103)</where>
        </update>
    </changeSet>

    <!--https://jira.aplana.com/browse/SBRFNDFL-3025 -->
    <changeSet id="2.2-dloshkarev-3" author="dloshkarev">
        <update tableName="DECLARATION_TEMPLATE">
            <column name="create_script" valueClobFile="templates/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl.groovy"/>
            <where>id=100</where>
        </update>
    </changeSet>

    <!--https://jira.aplana.com/browse/SBRFNDFL-3430 -->
    <changeSet id="2.2-ytrofimov-45" author="ytrofimov">
        <update tableName="BLOB_DATA">
            <column name="data"
                    valueBlobFile="templates/ndfl/report_6ndfl/v2016/report.jrxml"/>
            <where>id in (select jrxml from declaration_template dt where dt.id = 103)</where>
        </update>
    </changeSet>
	
	<!--https://jira.aplana.com/browse/SBRFNDFL-3524 Обновить данные справочников кодов видов дохода и вычетов по НДФЛ-->
	
	<changeSet id="2.2-rnurgaleev-8" author="rnurgaleev">
        <sql splitStatements="false">
            begin
				insert into REF_BOOK_INCOME_KIND(id,income_type_id,mark,name)
				values(seq_ref_book_record.nextval,(select id from (select id,version from ref_book_income_type where code='1532' and status=0 order by version desc) where rownum=1),'01','Начисление дохода при выводе денежных средств с брокерского счёта');

				insert into REF_BOOK_INCOME_KIND(id,income_type_id,mark,name)
				values(seq_ref_book_record.nextval,(select id from (select id,version from ref_book_income_type where code='1532' and status=0 order by version desc) where rownum=1),'02','Начисление дохода при выводе ценных бумаг с торгового раздела счёта депо');

				insert into REF_BOOK_INCOME_KIND(id,income_type_id,mark,name)
				values(seq_ref_book_record.nextval,(select id from (select id,version from ref_book_income_type where code='1532' and status=0 order by version desc) where rownum=1),'03','Начисление дохода при расторжении договора брокерского обслуживания');

				insert into REF_BOOK_INCOME_KIND(id,income_type_id,mark,name)
				values(seq_ref_book_record.nextval,(select id from (select id,version from ref_book_income_type where code='1532' and status=0 order by version desc) where rownum=1),'04','Начисление дохода по окончанию налогового периода за который начислен доход');

				insert into REF_BOOK_INCOME_KIND(id,income_type_id,mark,name)
				values(seq_ref_book_record.nextval,(select id from (select id,version from ref_book_income_type where code='2003' and status=0 order by version desc) where rownum=1),'05','Процентная надбавка');

				insert into REF_BOOK_INCOME_KIND(id,income_type_id,mark,name)
				values(seq_ref_book_record.nextval,(select id from (select id,version from ref_book_income_type where code='2003' and status=0 order by version desc) where rownum=1),'06','Процентная надбавка при увольнении');

				insert into REF_BOOK_INCOME_KIND(id,income_type_id,mark,name)
				values(seq_ref_book_record.nextval,(select id from (select id,version from ref_book_income_type where code='2003' and status=0 order by version desc) where rownum=1),'07','Разовая премия');

				insert into REF_BOOK_INCOME_KIND(id,income_type_id,mark,name)
				values(seq_ref_book_record.nextval,(select id from (select id,version from ref_book_income_type where code='2003' and status=0 order by version desc) where rownum=1),'08','Ежемесячная премия');

				insert into REF_BOOK_INCOME_KIND(id,income_type_id,mark,name)
				values(seq_ref_book_record.nextval,(select id from (select id,version from ref_book_income_type where code='2003' and status=0 order by version desc) where rownum=1),'09','Ежеквартальная премия');

				insert into REF_BOOK_INCOME_KIND(id,income_type_id,mark,name)
				values(seq_ref_book_record.nextval,(select id from (select id,version from ref_book_income_type where code='2003' and status=0 order by version desc) where rownum=1),'10','Премия по итогам года');

				insert into REF_BOOK_INCOME_KIND(id,income_type_id,mark,name)
				values(seq_ref_book_record.nextval,(select id from (select id,version from ref_book_income_type where code='2013' and status=0 order by version desc) where rownum=1),'13','Выплата дохода в денежной форме');

				insert into REF_BOOK_INCOME_KIND(id,income_type_id,mark,name)
				values(seq_ref_book_record.nextval,(select id from (select id,version from ref_book_income_type where code='2014' and status=0 order by version desc) where rownum=1),'13','Выплата дохода в денежной форме');

				insert into REF_BOOK_INCOME_KIND(id,income_type_id,mark,name)
				values(seq_ref_book_record.nextval,(select id from (select id,version from ref_book_income_type where code='2520' and status=0 order by version desc) where rownum=1),'13','Выплата дохода в денежной форме');

				insert into REF_BOOK_INCOME_KIND(id,income_type_id,mark,name)
				values(seq_ref_book_record.nextval,(select id from (select id,version from ref_book_income_type where code='1552' and status=0 order by version desc) where rownum=1),'00','-');

				insert into REF_BOOK_INCOME_KIND(id,income_type_id,mark,name)
				values(seq_ref_book_record.nextval,(select id from (select id,version from ref_book_income_type where code='2301' and status=0 order by version desc) where rownum=1),'00','-');

				insert into REF_BOOK_INCOME_KIND(id,income_type_id,mark,name)
				values(seq_ref_book_record.nextval,(select id from (select id,version from ref_book_income_type where code='2611' and status=0 order by version desc) where rownum=1),'00','-');

				insert into REF_BOOK_INCOME_KIND(id,income_type_id,mark,name)
				values(seq_ref_book_record.nextval,(select id from (select id,version from ref_book_income_type where code='3023' and status=0 order by version desc) where rownum=1),'00','-');
				
				delete from REF_BOOK_INCOME_KIND where
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='1544' and status=0 order by version desc) where rownum=1) and mark='01')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='1545' and status=0 order by version desc) where rownum=1) and mark='01')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='1546' and status=0 order by version desc) where rownum=1) and mark='01')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='1547' and status=0 order by version desc) where rownum=1) and mark='01')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='1548' and status=0 order by version desc) where rownum=1) and mark='01')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='1549' and status=0 order by version desc) where rownum=1) and mark='01')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='1552' and status=0 order by version desc) where rownum=1) and mark='01')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='1544' and status=0 order by version desc) where rownum=1) and mark='02')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='1545' and status=0 order by version desc) where rownum=1) and mark='02')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='1546' and status=0 order by version desc) where rownum=1) and mark='02')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='1547' and status=0 order by version desc) where rownum=1) and mark='02')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='1548' and status=0 order by version desc) where rownum=1) and mark='02')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='1549' and status=0 order by version desc) where rownum=1) and mark='02')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='1552' and status=0 order by version desc) where rownum=1) and mark='02')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='1544' and status=0 order by version desc) where rownum=1) and mark='03')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='1545' and status=0 order by version desc) where rownum=1) and mark='03')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='1546' and status=0 order by version desc) where rownum=1) and mark='03')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='1547' and status=0 order by version desc) where rownum=1) and mark='03')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='1548' and status=0 order by version desc) where rownum=1) and mark='03')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='1549' and status=0 order by version desc) where rownum=1) and mark='03')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='1552' and status=0 order by version desc) where rownum=1) and mark='03')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='1544' and status=0 order by version desc) where rownum=1) and mark='04')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='1545' and status=0 order by version desc) where rownum=1) and mark='04')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='1546' and status=0 order by version desc) where rownum=1) and mark='04')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='1547' and status=0 order by version desc) where rownum=1) and mark='04')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='1548' and status=0 order by version desc) where rownum=1) and mark='04')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='1549' and status=0 order by version desc) where rownum=1) and mark='04')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='1552' and status=0 order by version desc) where rownum=1) and mark='04')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='2000' and status=0 order by version desc) where rownum=1) and mark='07')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='2000' and status=0 order by version desc) where rownum=1) and mark='08')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='2000' and status=0 order by version desc) where rownum=1) and mark='09')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='2000' and status=0 order by version desc) where rownum=1) and mark='10')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='2003' and status=0 order by version desc) where rownum=1) and mark='13')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='1120' and status=0 order by version desc) where rownum=1) and mark='00')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='1200' and status=0 order by version desc) where rownum=1) and mark='00')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='1201' and status=0 order by version desc) where rownum=1) and mark='00')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='1202' and status=0 order by version desc) where rownum=1) and mark='00')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='1203' and status=0 order by version desc) where rownum=1) and mark='00')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='1211' and status=0 order by version desc) where rownum=1) and mark='00')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='1212' and status=0 order by version desc) where rownum=1) and mark='00')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='1213' and status=0 order by version desc) where rownum=1) and mark='00')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='1215' and status=0 order by version desc) where rownum=1) and mark='00')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='1219' and status=0 order by version desc) where rownum=1) and mark='00')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='1220' and status=0 order by version desc) where rownum=1) and mark='00')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='1240' and status=0 order by version desc) where rownum=1) and mark='00')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='1300' and status=0 order by version desc) where rownum=1) and mark='00')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='1301' and status=0 order by version desc) where rownum=1) and mark='00')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='1532' and status=0 order by version desc) where rownum=1) and mark='00')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='1538' and status=0 order by version desc) where rownum=1) and mark='00')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='1540' and status=0 order by version desc) where rownum=1) and mark='00')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='1550' and status=0 order by version desc) where rownum=1) and mark='00')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='1553' and status=0 order by version desc) where rownum=1) and mark='00')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='2201' and status=0 order by version desc) where rownum=1) and mark='00')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='2202' and status=0 order by version desc) where rownum=1) and mark='00')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='2203' and status=0 order by version desc) where rownum=1) and mark='00')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='2204' and status=0 order by version desc) where rownum=1) and mark='00')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='2205' and status=0 order by version desc) where rownum=1) and mark='00')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='2206' and status=0 order by version desc) where rownum=1) and mark='00')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='2207' and status=0 order by version desc) where rownum=1) and mark='00')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='2208' and status=0 order by version desc) where rownum=1) and mark='00')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='2209' and status=0 order by version desc) where rownum=1) and mark='00')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='2210' and status=0 order by version desc) where rownum=1) and mark='00')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='2400' and status=0 order by version desc) where rownum=1) and mark='00')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='2510' and status=0 order by version desc) where rownum=1) and mark='00')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='2530' and status=0 order by version desc) where rownum=1) and mark='00')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='2630' and status=0 order by version desc) where rownum=1) and mark='00')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='2730' and status=0 order by version desc) where rownum=1) and mark='00')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='2761' and status=0 order by version desc) where rownum=1) and mark='00')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='3010' and status=0 order by version desc) where rownum=1) and mark='00')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='3022' and status=0 order by version desc) where rownum=1) and mark='00');
			end;
        </sql>
    </changeSet>

    <!--https://jira.aplana.com/browse/SBRFNDFL-3436 -->
    <changeSet id="2.2-ytrofimov-46" author="ytrofimov">
        <update tableName="BLOB_DATA">
            <column name="data"
                    valueBlobFile="templates/ndfl/report_6ndfl/v2016/report.jrxml"/>
            <where>id in (select jrxml from declaration_template dt where dt.id = 103)</where>
        </update>
    </changeSet>
	
	<!--https://jira.aplana.com/browse/SBRFNDFL-3574 Оптимизация процедур идентификации-->
    <changeSet id="2.2-rnurgaleev-9" author="rnurgaleev">
        <sqlFile dbms="oracle"
                 encoding="utf8"
                 endDelimiter=""
                 path="/scripts/person_pkg_body6.sql"
                 relativeToChangelogFile="true"
                 splitStatements="false"/>
    </changeSet>

</databaseChangeLog>