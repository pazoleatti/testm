<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
                                       http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd">

    <changeSet id="2.2-ytrofimov-0" author="ytrofimov">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script" valueClobFile="templates/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl_check.groovy"/>
            <where>id=2</where>
        </update>
    </changeSet>

    <changeSet id="2.2-ytrofimov-1" author="ytrofimov">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script"
                    valueClobFile="templates/ndfl/consolidated_rnu_ndfl/v2016/consolidated_rnu_ndfl_check.groovy"/>
            <where>id=6</where>
        </update>
    </changeSet>

    <changeSet id="2.2-ytrofimov-2" author="ytrofimov">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script"
                    valueClobFile="templates/ndfl/consolidated_rnu_ndfl/v2016/consolidated_rnu_ndfl_check.groovy"/>
            <where>id=6</where>
        </update>
    </changeSet>

    <!-- https://jira.aplana.com/browse/SBRFNDFL-3072 -->
    <changeSet id="2.2-ytrofimov-3" author="ytrofimov">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script"
                    valueClobFile="templates/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl_calculate.groovy"/>
            <where>id=1</where>
        </update>
    </changeSet>

    <changeSet id="2.2-ytrofimov-4" author="ytrofimov">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script"
                    valueClobFile="templates/ndfl/consolidated_rnu_ndfl/v2016/consolidated_rnu_ndfl_check.groovy"/>
            <where>id=6</where>
        </update>
    </changeSet>

    <!-- https://jira.aplana.com/browse/SBRFNDFL-3076 -->
    <changeSet id="2.2-ytrofimov-5" author="ytrofimov">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script"
                    valueClobFile="templates/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl_calculate.groovy"/>
            <where>id=1</where>
        </update>
    </changeSet>

    <!--https://jira.aplana.com/browse/SBRFNDFL-2930 -->
    <changeSet id="2.2-afateev-0" author="afateev">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script"
                    valueClobFile="templates/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl_calculate.groovy"/>
            <where>id=1</where>
        </update>
    </changeSet>

    <!--https://jira.aplana.com/browse/SBRFNDFL-2930 -->
    <changeSet id="2.2-afateev-1" author="afateev">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script"
                    valueClobFile="templates/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl_calculate.groovy"/>
            <where>id=1</where>
        </update>
    </changeSet>

    <changeSet id="2.2-dnovikov-0" author="dnovikov">
        <update tableName="BLOB_DATA">
            <column name="data" valueBlobFile="templates/refbook/declaration_type.groovy"/>
            <where>id='352adf59-372b-4020-98fe-8960dd5bc972'</where>
        </update>
    </changeSet>

    <changeSet id="2.2-dnovikov-1" author="dnovikov">
        <update tableName="BLOB_DATA">
            <column name="data" valueBlobFile="templates/refbook/declaration_type.groovy"/>
            <where>id='352adf59-372b-4020-98fe-8960dd5bc972'</where>
        </update>
    </changeSet>

    <!-- https://jira.aplana.com/browse/SBRFNDFL-3076 -->
    <changeSet id="2.2-ytrofimov-6" author="ytrofimov">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script"
                    valueClobFile="templates/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl_calculate.groovy"/>
            <where>id=1</where>
        </update>
    </changeSet>

    <!-- https://jira.aplana.com/browse/SBRFNDFL-2750 -->
    <changeSet id="2.2-aokunev-1" author="aokunev">
        <update tableName="DECLARATION_TYPE">
            <column name="NAME" value="РНУ НДФЛ (первичная)"/>
            <where>id=100</where>
        </update>
        <update tableName="DECLARATION_TYPE">
            <column name="NAME" value="РНУ НДФЛ (консолидированная)"/>
            <where>id=101</where>
        </update>
        <update tableName="DECLARATION_TEMPLATE">
            <column name="NAME" value="РНУ НДФЛ (первичная)"/>
            <where>id=100</where>
        </update>
        <update tableName="DECLARATION_TEMPLATE">
            <column name="NAME" value="РНУ НДФЛ (консолидированная)"/>
            <where>id=101</where>
        </update>
    </changeSet>

    <!-- https://jira.aplana.com/browse/SBRFNDFL-3133 - проверка -->
    <changeSet id="2.2-dloshkarev-0" author="dloshkarev">
        <insert tableName="LOCK_DATA">
            <column name="id" value="1"/>
            <column name="key" value="TEST_LOCK"/>
            <column name="user_id" value="13276"/>
        </insert>
    </changeSet>
    <!-- https://jira.aplana.com/browse/SBRFNDFL-3133 - откат -->
    <changeSet id="2.2-dloshkarev-1" author="dloshkarev">
        <delete tableName="LOCK_DATA">
            <where>id = 1</where>
        </delete>
    </changeSet>

    <!-- https://jira.aplana.com/browse/SBRFNDFL-2891 -->
    <changeSet id="2.2-aokunev-2" author="aokunev">
        <update tableName="BLOB_DATA">
            <column name="data" valueBlobFile="templates/refbook/declaration_type.groovy"/>
            <where>id='352adf59-372b-4020-98fe-8960dd5bc972'</where>
        </update>
    </changeSet>

    <!-- https://jira.aplana.com/browse/SBRFNDFL-2583 -->
    <changeSet id="2.2-ytrofimov-7" author="ytrofimov">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script"
                    valueClobFile="templates/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl_calculate.groovy"/>
            <where>id=1</where>
        </update>
    </changeSet>

    <changeSet id="2.2-dnovikov-2" author="dnovikov">
        <update tableName="BLOB_DATA">
            <column name="data" valueBlobFile="templates/refbook/declaration_type.groovy"/>
            <where>id='352adf59-372b-4020-98fe-8960dd5bc972'</where>
        </update>
    </changeSet>

    <!-- https://jira.aplana.com/browse/SBRFNDFL-2583 -->
    <changeSet id="2.2-ytrofimov-8" author="ytrofimov">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script"
                    valueClobFile="templates/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl_calculate.groovy"/>
            <where>id=1</where>
        </update>
    </changeSet>

    <changeSet id="2.2-ytrofimov-9" author="ytrofimov">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script" valueClobFile="templates/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl_check.groovy"/>
            <where>id=2</where>
        </update>
    </changeSet>

    <changeSet id="2.2-ytrofimov-10" author="ytrofimov">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script"
                    valueClobFile="templates/ndfl/consolidated_rnu_ndfl/v2016/consolidated_rnu_ndfl_check.groovy"/>
            <where>id=6</where>
        </update>
    </changeSet>

    <changeSet id="2.2-ytrofimov-11" author="ytrofimov">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script"
                    valueClobFile="templates/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl_calculate.groovy"/>
            <where>id=1</where>
        </update>
    </changeSet>

    <changeSet id="2.2-ytrofimov-12" author="ytrofimov">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script"
                    valueClobFile="templates/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl_calculate.groovy"/>
            <where>id=1</where>
        </update>
    </changeSet>

    <!--https://jira.aplana.com/browse/SBRFNDFL-3025 -->
    <changeSet id="2.2-dloshkarev-2" author="dloshkarev">
        <update tableName="DECLARATION_TEMPLATE">
            <column name="create_script" valueClobFile="templates/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl.groovy"/>
            <where>id=100</where>
        </update>
    </changeSet>

    <changeSet id="2.2-ytrofimov-13" author="ytrofimov">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script"
                    valueClobFile="templates/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl_calculate.groovy"/>
            <where>id=1</where>
        </update>
    </changeSet>

    <!-- https://jira.aplana.com/browse/SBRFNDFL-2583 -->
    <changeSet id="2.2-ytrofimov-14" author="ytrofimov">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script"
                    valueClobFile="templates/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl_calculate.groovy"/>
            <where>id=1</where>
        </update>
    </changeSet>

    <!-- https://jira.aplana.com/browse/SBRFNDFL-2583 -->
    <changeSet id="2.2-ytrofimov-15" author="ytrofimov">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script"
                    valueClobFile="templates/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl_calculate.groovy"/>
            <where>id=1</where>
        </update>
    </changeSet>

    <changeSet id="2.2-ytrofimov-16" author="ytrofimov">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script"
                    valueClobFile="templates/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl_calculate.groovy"/>
            <where>id=1</where>
        </update>
    </changeSet>

    <changeSet id="2.2-ytrofimov-17" author="ytrofimov">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script"
                    valueClobFile="templates/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl_calculate.groovy"/>
            <where>id=1</where>
        </update>
    </changeSet>

    <changeSet id="2.2-dnovikov-3" author="dnovikov">
        <sql>
            CREATE global TEMPORARY TABLE tmp_numbers0 (
                num NUMBER(18,0)
            ) ON COMMIT DELETE ROWS ;
            CREATE global TEMPORARY TABLE tmp_numbers1 (
                num NUMBER(18,0)
            ) ON COMMIT DELETE ROWS ;
        </sql>
    </changeSet>

	<!--https://jira.aplana.com/browse/SBRFNDFL-1382 Исправить наполнение справочника REF_BOOK_TARIFF_PAYER. Нужно удалить таблицу-->
	<changeSet id="2.1-rnurgaleev-0" author="rnurgaleev">
        <dropTable cascadeConstraints="true"
                   tableName="ref_book_tariff_payer"/>
    </changeSet>

	<changeSet id="2.2-rnurgaleev-1" author="rnurgaleev">
        <delete
                tableName="ref_book_attribute">
            <where>ref_book_id=938
            </where>
        </delete>
    </changeSet>

    <changeSet id="2.2-rnurgaleev-2" author="rnurgaleev">
        <delete
                tableName="ref_book">
            <where>table_name='REF_BOOK_TARIFF_PAYER'</where>
        </delete>
    </changeSet>

    <!--https://jira.aplana.com/browse/SBRFNDFL-2898 В журнале "Список налоговых форм" заменить кнопку "Рассчитать" на кнопки "Идентифицировать ФЛ" и "Консолидировать"-->
    <changeSet id="2.2-ytrofimov-18" author="ytrofimov">
        <insert tableName="async_task_type">
            <column name="id" value="8"/>
            <column name="name" value="Расчет налоговой формы (формирование XML-файла)"/>
            <column name="handler_bean" value="IdentifyAsyncTask"/>
            <column name="short_queue_limit" value="3000"/>
            <column name="limit_kind" value="Количество ФЛ в НФ"/>
        </insert>
    </changeSet>

    <changeSet id="2.2-ytrofimov-19" author="ytrofimov">
        <insert tableName="async_task_type">
            <column name="id" value="9"/>
            <column name="name" value="Расчет налоговой формы (формирование XML-файла)"/>
            <column name="handler_bean" value="ConsolidateAsyncTask"/>
            <column name="short_queue_limit" value="3000"/>
            <column name="limit_kind" value="Количество ФЛ в НФ"/>
        </insert>
    </changeSet>

    <!-- https://jira.aplana.com/browse/SBRFNDFL-3103 -->
    <changeSet id="2.2-ytrofimov-20" author="ytrofimov">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script" valueClobFile="templates/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl_check.groovy"/>
            <where>id=2</where>
        </update>
    </changeSet>

    <changeSet id="2.2-ytrofimov-21" author="ytrofimov">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script"
                    valueClobFile="templates/ndfl/consolidated_rnu_ndfl/v2016/consolidated_rnu_ndfl_check.groovy"/>
            <where>id=6</where>
        </update>
    </changeSet>

    <!--https://jira.aplana.com/browse/SBRFNDFL-3062 -->
    <changeSet id="2.2-ytrofimov-22" author="ytrofimov">
        <update tableName="DECLARATION_TEMPLATE">
            <column name="create_script" valueClobFile="templates/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl.groovy"/>
            <where>id=100</where>
        </update>
    </changeSet>

    <!--https://jira.aplana.com/browse/SBRFNDFL-3201 -->
    <changeSet id="2.2-ytrofimov-23" author="ytrofimov">
        <update tableName="BLOB_DATA">
            <column name="data" valueBlobFile="templates/refbook/declaration_type.groovy"/>
            <where>id='352adf59-372b-4020-98fe-8960dd5bc972'</where>
        </update>
    </changeSet>

    <changeSet id="2.2-ytrofimov-24" author="ytrofimov">
        <update tableName="DECLARATION_TEMPLATE">
            <column name="CREATE_SCRIPT" valueClobFile="templates/ndfl/report_2ndfl_1/v2016/report_2ndfl.groovy"/>
            <where>id=102</where>
        </update>
    </changeSet>

    <changeSet id="2.2-ytrofimov-25" author="ytrofimov">
        <update tableName="DECLARATION_TEMPLATE">
            <column name="CREATE_SCRIPT" valueClobFile="templates/ndfl/report_6ndfl/v2016/report_6ndfl.groovy"/>
            <where>id=103</where>
        </update>
    </changeSet>

    <changeSet id="2.2-ytrofimov-26" author="ytrofimov">
        <update tableName="DECLARATION_TEMPLATE">
            <column name="CREATE_SCRIPT" valueClobFile="templates/ndfl/report_2ndfl_1/v2016/report_2ndfl.groovy"/>
            <where>id=104</where>
        </update>
    </changeSet>

	<!--https://jira.aplana.com/browse/SBRFNDFL-3361 ФИАС: не находит адрес в справочнике-->
	<changeSet id="2.2-rnurgaleev-3" author="rnurgaleev">
        <sql splitStatements="false">
            declare
				v_count number;
			begin
				select count(1) into v_count from user_mviews where mview_name='MV_FIAS_LOCALITY_ACT';
				if v_count>0 then
					execute immediate 'DROP MATERIALIZED VIEW MV_FIAS_LOCALITY_ACT';
				end if;

				select count(1) into v_count from user_mviews where mview_name='MV_FIAS_LOCALITY_ACT';
				if v_count=0 then
					execute immediate 'CREATE MATERIALIZED VIEW MV_FIAS_LOCALITY_ACT (ID, AOID, FORMALNAME, SHORTNAME, REGIONCODE, LIVESTATUS, CURRSTATUS, AOLEVEL, POSTALCODE, PARENTGUID, FNAME, FTYPE, HAS_CHILD)
    NOLOGGING
    BUILD IMMEDIATE
    USING INDEX
    REFRESH COMPLETE ON DEMAND
    USING DEFAULT LOCAL ROLLBACK SEGMENT
    USING ENFORCED CONSTRAINTS DISABLE QUERY REWRITE
    AS select distinct f.id, f.aoid, f.formalname, f.shortname, f.regioncode, f.livestatus, f.currstatus, f.aolevel, f.postalcode,
    nvl(d.parentguid,f.parentguid) parentguid,
       replace(lower(f.formalname),'' '','''') fname,
       trim(lower(f.shortname)) ftype,
       nvl2(c.id,1,0) has_child
    from fias_addrobj f left join fias_addrobj c on (c.parentguid=f.aoid and c.currstatus=0)
    left join fias_addrobj d on (f.parentguid=d.aoid and d.currstatus=0 and d.aolevel=5)
    where f.currstatus=0
    and f.aolevel in (6,90)';

					execute immediate 'CREATE INDEX IDX_MV_FIAS_LOCALITY_AOID ON MV_FIAS_LOCALITY_ACT (AOID)';
					execute immediate 'CREATE INDEX IDX_MV_FIAS_LOCALITY_FNAME ON MV_FIAS_LOCALITY_ACT (FNAME)';
					execute immediate 'CREATE INDEX IDX_MV_FIAS_LOCALITY_PGUID ON MV_FIAS_LOCALITY_ACT (PARENTGUID)';
					execute immediate 'CREATE INDEX SRCH_MV_FIAS_LOCAL_REG_FN_TP ON MV_FIAS_LOCALITY_ACT (REGIONCODE, FNAME, FTYPE, HAS_CHILD)';
					execute immediate 'CREATE UNIQUE INDEX PK_MV_FIAS_LOCALITY_ACT ON MV_FIAS_LOCALITY_ACT (ID)';

					execute immediate 'COMMENT ON COLUMN MV_FIAS_LOCALITY_ACT.ID IS ''Уникальный идентификатор''';
					execute immediate 'COMMENT ON COLUMN MV_FIAS_LOCALITY_ACT.AOID IS ''Идентификатор объекта''';
					execute immediate 'COMMENT ON COLUMN MV_FIAS_LOCALITY_ACT.FORMALNAME IS ''Формализованное наименование''';
					execute immediate 'COMMENT ON COLUMN MV_FIAS_LOCALITY_ACT.SHORTNAME IS ''Тип адресного объекта''';
					execute immediate 'COMMENT ON COLUMN MV_FIAS_LOCALITY_ACT.REGIONCODE IS ''Код региона''';
					execute immediate 'COMMENT ON COLUMN MV_FIAS_LOCALITY_ACT.LIVESTATUS IS ''Статус актуальности ФИАС: 1 - актуальная, 0 - устаревшая''';
					execute immediate 'COMMENT ON COLUMN MV_FIAS_LOCALITY_ACT.CURRSTATUS IS ''Статус актуальности КЛАДР: 0 - актуальная, ..''';
					execute immediate 'COMMENT ON COLUMN MV_FIAS_LOCALITY_ACT.AOLEVEL IS ''Уровень объекта''';
					execute immediate 'COMMENT ON COLUMN MV_FIAS_LOCALITY_ACT.POSTALCODE IS ''Почтовый индекс''';
					execute immediate 'COMMENT ON COLUMN MV_FIAS_LOCALITY_ACT.PARENTGUID IS ''Идентификатор родительского объекта''';
					execute immediate 'COMMENT ON COLUMN MV_FIAS_LOCALITY_ACT.FNAME IS ''Наименование, адаптированное для проверки адреса (строчными буквами, без пробелов)''';
					execute immediate 'COMMENT ON COLUMN MV_FIAS_LOCALITY_ACT.FTYPE IS ''Тип, адаптированный для проверки адреса (строчными буквами, без пробелов)''';
					execute immediate 'COMMENT ON COLUMN MV_FIAS_LOCALITY_ACT.HAS_CHILD IS ''Наличие дочерних элементов''';
					execute immediate 'COMMENT ON MATERIALIZED VIEW MV_FIAS_LOCALITY_ACT  IS ''Актуальные населенные пункты из справочника ФИАС''';
				end if;

				select count(1) into v_count from user_mviews where mview_name='MV_FIAS_STREET_ACT';
				if v_count>0 then
					execute immediate 'DROP MATERIALIZED VIEW MV_FIAS_STREET_ACT';
				end if;

				select count(1) into v_count from user_mviews where mview_name='MV_FIAS_STREET_ACT';
				if v_count=0 then
					execute immediate 'CREATE MATERIALIZED VIEW MV_FIAS_STREET_ACT (ID, AOID, FORMALNAME, SHORTNAME, REGIONCODE, LIVESTATUS, CURRSTATUS, AOLEVEL, POSTALCODE, PARENTGUID, FNAME, FTYPE, HAS_CHILD)
    NOLOGGING
    BUILD IMMEDIATE
    USING INDEX
    REFRESH COMPLETE ON DEMAND
    USING DEFAULT LOCAL ROLLBACK SEGMENT
    USING ENFORCED CONSTRAINTS DISABLE QUERY REWRITE
    AS select distinct f.id, f.aoid, f.formalname, f.shortname, f.regioncode, f.livestatus, f.currstatus, f.aolevel, f.postalcode,
coalesce(e.parentguid,d.parentguid,f.parentguid) parentguid,
       replace(lower(f.formalname),'' '','''') fname,
       trim(lower(f.shortname)) ftype,
       nvl2(c.id,1,0) has_child
    from fias_addrobj f left join fias_addrobj c on (c.parentguid=f.aoid and c.currstatus=0)
    left join fias_addrobj d on (f.parentguid=d.aoid and d.currstatus=0 and d.aolevel in (5,65))
    left join fias_addrobj e on (d.parentguid=e.aoid and d.currstatus=0 and d.aolevel=65 and e.aolevel=5)
    where f.currstatus=0
    and f.aolevel in (7,91)';

					execute immediate 'CREATE UNIQUE INDEX PK_MV_FIAS_STREET_ACT ON MV_FIAS_STREET_ACT (ID)';
					execute immediate 'CREATE INDEX IDX_MV_FIAS_STREET_AOID ON MV_FIAS_STREET_ACT (AOID)';
					execute immediate 'CREATE INDEX IDX_MV_FIAS_STREET_FNAME ON MV_FIAS_STREET_ACT (FNAME)';
					execute immediate 'CREATE INDEX IDX_MV_FIAS_STREET_PGUID ON MV_FIAS_STREET_ACT (PARENTGUID)';
					execute immediate 'CREATE INDEX SRCH_MV_FIAS_STREET_REG_FN_TP ON MV_FIAS_STREET_ACT (REGIONCODE, FNAME, FTYPE, HAS_CHILD)';
					execute immediate 'CREATE INDEX IDX_MV_FIAS_STREET_POST ON MV_FIAS_STREET_ACT (POSTALCODE)';

					execute immediate 'COMMENT ON COLUMN MV_FIAS_STREET_ACT.ID IS ''Уникальный идентификатор''';
					execute immediate 'COMMENT ON COLUMN MV_FIAS_STREET_ACT.AOID IS ''Идентификатор объекта''';
					execute immediate 'COMMENT ON COLUMN MV_FIAS_STREET_ACT.FORMALNAME IS ''Формализованное наименование''';
					execute immediate 'COMMENT ON COLUMN MV_FIAS_STREET_ACT.SHORTNAME IS ''Тип адресного объекта''';
					execute immediate 'COMMENT ON COLUMN MV_FIAS_STREET_ACT.REGIONCODE IS ''Код региона''';
					execute immediate 'COMMENT ON COLUMN MV_FIAS_STREET_ACT.LIVESTATUS IS ''Статус актуальности ФИАС: 1 - актуальная, 0 - устаревшая''';
					execute immediate 'COMMENT ON COLUMN MV_FIAS_STREET_ACT.CURRSTATUS IS ''Статус актуальности КЛАДР: 0 - актуальная, ..''';
					execute immediate 'COMMENT ON COLUMN MV_FIAS_STREET_ACT.AOLEVEL IS ''Уровень объекта''';
					execute immediate 'COMMENT ON COLUMN MV_FIAS_STREET_ACT.POSTALCODE IS ''Почтовый индекс''';
					execute immediate 'COMMENT ON COLUMN MV_FIAS_STREET_ACT.PARENTGUID IS ''Идентификатор родительского объекта''';
					execute immediate 'COMMENT ON COLUMN MV_FIAS_STREET_ACT.FNAME IS ''Наименование, адаптированное для проверки адреса (строчными буквами, без пробелов)''';
					execute immediate 'COMMENT ON COLUMN MV_FIAS_STREET_ACT.FTYPE IS ''Тип, адаптированный для проверки адреса (строчными буквами, без пробелов)''';
					execute immediate 'COMMENT ON COLUMN MV_FIAS_STREET_ACT.HAS_CHILD IS ''Наличие дочерних элементов''';
					execute immediate 'COMMENT ON MATERIALIZED VIEW MV_FIAS_STREET_ACT  IS ''Актуальные улицы из справочника ФИАС''';
				end if;
			end;
        </sql>
    </changeSet>

    <!-- https://jira.aplana.com/browse/SBRFNDFL-3441 -->
    <changeSet id="2.2-ytrofimov-27" author="ytrofimov">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script"
                    valueClobFile="templates/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl_calculate.groovy"/>
            <where>id=1</where>
        </update>
    </changeSet>

    <!--https://jira.aplana.com/browse/SBRFNDFL-3259 -->
    <changeSet id="2.2-ytrofimov-28" author="ytrofimov">
        <update tableName="DECLARATION_TEMPLATE">
            <column name="create_script" valueClobFile="templates/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl.groovy"/>
            <where>id=100</where>
        </update>
    </changeSet>

    <changeSet id="2.2-ytrofimov-29" author="ytrofimov">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script" valueClobFile="templates/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl_check.groovy"/>
            <where>id=2</where>
        </update>
    </changeSet>

    <changeSet id="2.2-ytrofimov-30" author="ytrofimov">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script"
                    valueClobFile="templates/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl_import.groovy"/>
            <where>id=14</where>
        </update>
    </changeSet>

    <changeSet id="2.2-ytrofimov-31" author="ytrofimov">
        <update tableName="DECLARATION_TEMPLATE">
            <column name="create_script"
                    valueClobFile="templates/ndfl/consolidated_rnu_ndfl/v2016/consolidated_rnu_ndfl.groovy"/>
            <where>id=101</where>
        </update>
    </changeSet>

    <changeSet id="2.2-ytrofimov-32" author="ytrofimov">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script"
                    valueClobFile="templates/ndfl/consolidated_rnu_ndfl/v2016/consolidated_rnu_ndfl_calculate.groovy"/>
            <where>id=5</where>
        </update>
    </changeSet>

    <changeSet id="2.2-ytrofimov-33" author="ytrofimov">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script"
                    valueClobFile="templates/ndfl/consolidated_rnu_ndfl/v2016/consolidated_rnu_ndfl_check.groovy"/>
            <where>id=6</where>
        </update>
    </changeSet>

    <changeSet id="2.2-ytrofimov-34" author="ytrofimov">
        <update tableName="DECLARATION_TEMPLATE">
            <column name="CREATE_SCRIPT" valueClobFile="templates/ndfl/report_2ndfl_1/v2016/report_2ndfl.groovy"/>
            <where>id=102</where>
        </update>
    </changeSet>

    <changeSet id="2.2-ytrofimov-35" author="ytrofimov">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script"
                    valueClobFile="templates/ndfl/report_2ndfl_1/v2016/report_2ndfll_check.groovy"/>
            <where>id=8</where>
        </update>
    </changeSet>

    <changeSet id="2.2-ytrofimov-36" author="ytrofimov">
        <update tableName="DECLARATION_TEMPLATE">
            <column name="CREATE_SCRIPT" valueClobFile="templates/ndfl/report_6ndfl/v2016/report_6ndfl.groovy"/>
            <where>id=103</where>
        </update>
    </changeSet>

    <changeSet id="2.2-ytrofimov-37" author="ytrofimov">
        <update tableName="DECLARATION_TEMPLATE">
            <column name="CREATE_SCRIPT" valueClobFile="templates/ndfl/report_2ndfl_1/v2016/report_2ndfl.groovy"/>
            <where>id=104</where>
        </update>
    </changeSet>

    <changeSet id="2.2-ytrofimov-38" author="ytrofimov">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script"
                    valueClobFile="templates/ndfl/report_2ndfl_1/v2016/report_2ndfll_check.groovy"/>
            <where>id=12</where>
        </update>
    </changeSet>

    <!--https://jira.aplana.com/browse/SBRFNDFL-3269 -->
    <changeSet id="2.2-ytrofimov-39" author="ytrofimov">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script"
                    valueClobFile="templates/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl_calculate.groovy"/>
            <where>id=1</where>
        </update>
    </changeSet>

    <changeSet id="2.2-dnovikov-4" author="dnovikov">
        <update tableName="REPORT_PERIOD_TYPE">
            <column name="NAME" value="первый квартал при реорганизации (ликвидации) организации"/>
            <where>code='51'</where>
        </update>
    </changeSet>

    <changeSet id="2.2-dnovikov-5" author="dnovikov">
        <update tableName="REPORT_PERIOD_TYPE">
            <column name="NAME" value="полугодие при реорганизации (ликвидации) организации"/>
            <where>code='52'</where>
        </update>
    </changeSet>

    <changeSet id="2.2-dnovikov-6" author="dnovikov">
        <update tableName="REPORT_PERIOD_TYPE">
            <column name="NAME" value="9 месяцев при реорганизации (ликвидации) организации"/>
            <where>code='53'</where>
        </update>
    </changeSet>

    <!--https://jira.aplana.com/browse/SBRFNDFL-3521 -->
    <changeSet id="2.2-ytrofimov-40" author="ytrofimov">
        <update tableName="DECLARATION_TEMPLATE">
            <column name="CREATE_SCRIPT" valueClobFile="templates/ndfl/report_2ndfl_1/v2016/report_2ndfl.groovy"/>
            <where>id=102</where>
        </update>
    </changeSet>

    <changeSet id="2.2-ytrofimov-41" author="ytrofimov">
        <update tableName="DECLARATION_TEMPLATE">
            <column name="CREATE_SCRIPT" valueClobFile="templates/ndfl/report_2ndfl_1/v2016/report_2ndfl.groovy"/>
            <where>id=104</where>
        </update>
    </changeSet>

    <changeSet id="2.2-dnovikov-7" author="dnovikov">
        <sql>
            alter table ASYNC_TASK modify (DESCRIPTION VARCHAR2(400 CHAR));
        </sql>
    </changeSet>

	<!--https://jira.aplana.com/browse/SBRFNDFL-3524 Обновить данные справочников кодов видов дохода и вычетов по НДФЛ-->

	<changeSet id="2.2-rnurgaleev-4" author="rnurgaleev">
        <sql splitStatements="false">
            begin
				update ref_book_income_type set name='Проценты (за исключением процентов по облигациям с ипотечным покрытием, эмитированным до 01.01.2007, доходов в виде процентов, получаемых по вкладам в банках, и доходов, получаемых при погашении векселя), включая дисконт, полученный по долговому обязательству любого вида, за исключением сумм дохода в виде процента (купона), получаемого налогоплательщиком по обращающимся облигациям российских организаций, номинированным в рублях и эмитированным после 1 января 2017 года'
				where code='1011' and status=0;

				insert into ref_book_income_type (id,record_id,version,status,code,name)
				values (seq_ref_book_record.nextval,seq_ref_book_record_row_id.nextval,to_date('24.10.2017','DD.MM.YYYY'),0,'2013','Сумма компенсации за неиспользованный отпуск');
				insert into ref_book_income_type (id,record_id,version,status,code,name)
				values (seq_ref_book_record.nextval,seq_ref_book_record_row_id.nextval,to_date('24.10.2017','DD.MM.YYYY'),0,'2014','Сумма выплаты в виде выходного пособия, среднего месячного заработка на период трудоустройства, компенсации руководителю, заместителям руководителя и главному бухгалтеру организации в части, превышающей в целом трехкратный размер среднего месячного заработка или шестикратный размер среднего месячного заработка для работников, уволенных из организаций, расположенных в районах Крайнего Севера и приравненных к ним местностях');
				insert into ref_book_income_type (id,record_id,version,status,code,name)
				values (seq_ref_book_record.nextval,seq_ref_book_record_row_id.nextval,to_date('24.10.2017','DD.MM.YYYY'),0,'2301','Суммы штрафов и неустойки, выплачиваемые организацией на основании решения суда за несоблюдение в добровольном порядке удовлетворения требований потребителей в соответствии с Законом Российской Федерации от 07.02.1992 N 2300-1 "О защите прав потребителей"');
				insert into ref_book_income_type (id,record_id,version,status,code,name)
				values (seq_ref_book_record.nextval,seq_ref_book_record_row_id.nextval,to_date('24.10.2017','DD.MM.YYYY'),0,'2611','Сумма списанного в установленном порядке безнадежного долга с баланса организации');
				insert into ref_book_income_type (id,record_id,version,status,code,name)
				values (seq_ref_book_record.nextval,seq_ref_book_record_row_id.nextval,to_date('24.10.2017','DD.MM.YYYY'),0,'3023','Сумма дохода в виде процента (купона), получаемого налогоплательщиком по обращающимся облигациям российских организаций, номинированным в рублях и эмитированным после 1 января 2017 года');

				insert into ref_book_deduction_type (id,record_id,version,status,code,name,deduction_mark)
				values (seq_ref_book_record.nextval,seq_ref_book_record_row_id.nextval,to_date('24.10.2017','dd.mm.yyyy'),0,'619','Вычет в сумме положительного финансового результата, полученного по операциям, учитываемым на индивидуальном инвестиционном счете',(select id from ref_book_deduction_mark where code='3'));

			end;
        </sql>
    </changeSet>


	<!--https://jira.aplana.com/browse/SBRFNDFL-3452 Изменение разделителей при сравнении ДУЛ-->
	<changeSet id="2.2-rnurgaleev-5" author="rnurgaleev">
        <sqlFile dbms="oracle"
                 encoding="utf8"
                 endDelimiter=""
                 path="/scripts/person_pkg5.sql"
                 relativeToChangelogFile="true"
                 splitStatements="false"/>
    </changeSet>

    <changeSet id="2.2-rnurgaleev-6" author="rnurgaleev">
        <sqlFile dbms="oracle"
                 encoding="utf8"
                 endDelimiter=""
                 path="/scripts/person_pkg_body5.sql"
                 relativeToChangelogFile="true"
                 splitStatements="false"/>
    </changeSet>

    <changeSet id="2.2-ytrofimov-42" author="ytrofimov">
        <update tableName="BLOB_DATA">
            <column name="data"
                    valueBlobFile="templates/ndfl/primary_rnu_ndfl/v2016/rnu_ndfl_person_all_db.xlsx"/>
            <where>id = '4b84692c-7f70-4d11-844d-e61e81655336'</where>
        </update>
    </changeSet>

    <changeSet id="2.2-ytrofimov-43" author="ytrofimov">
        <update tableName="BLOB_DATA">
            <column name="data"
                    valueBlobFile="templates/ndfl/consolidated_rnu_ndfl/v2016/rnu_ndfl_person_all_db.xlsx"/>
            <where>id = '64536272-05bc-42e8-82c5-347faf22da20'</where>
        </update>
    </changeSet>

	<!--https://jira.aplana.com/browse/SBRFNDFL-2670 Проверка адресов по ФИАС. Обязательно наличие краткого наименования района-->
	<changeSet id="2.2-rnurgaleev-7" author="rnurgaleev">
        <sqlFile dbms="oracle"
                 encoding="utf8"
                 endDelimiter=""
                 path="/scripts/fias_pkg_body10.sql"
                 relativeToChangelogFile="true"
                 splitStatements="false"/>
    </changeSet>

    <!--https://jira.aplana.com/browse/SBRFNDFL-3430 -->
    <changeSet id="2.2-ytrofimov-44" author="ytrofimov">
        <update tableName="BLOB_DATA">
            <column name="data"
                    valueBlobFile="templates/ndfl/report_6ndfl/v2016/report.jrxml"/>
            <where>id in (select jrxml from declaration_template dt where dt.id = 103)</where>
        </update>
    </changeSet>

    <!--https://jira.aplana.com/browse/SBRFNDFL-3025 -->
    <changeSet id="2.2-dloshkarev-3" author="dloshkarev">
        <update tableName="DECLARATION_TEMPLATE">
            <column name="create_script" valueClobFile="templates/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl.groovy"/>
            <where>id=100</where>
        </update>
    </changeSet>

    <!--https://jira.aplana.com/browse/SBRFNDFL-3430 -->
    <changeSet id="2.2-ytrofimov-45" author="ytrofimov">
        <update tableName="BLOB_DATA">
            <column name="data"
                    valueBlobFile="templates/ndfl/report_6ndfl/v2016/report.jrxml"/>
            <where>id in (select jrxml from declaration_template dt where dt.id = 103)</where>
        </update>
    </changeSet>

	<!--https://jira.aplana.com/browse/SBRFNDFL-3524 Обновить данные справочников кодов видов дохода и вычетов по НДФЛ-->

	<changeSet id="2.2-rnurgaleev-8" author="rnurgaleev">
        <sql splitStatements="false">
            begin
				insert into REF_BOOK_INCOME_KIND(id,income_type_id,mark,name)
				values(seq_ref_book_record.nextval,(select id from (select id,version from ref_book_income_type where code='1532' and status=0 order by version desc) where rownum=1),'01','Начисление дохода при выводе денежных средств с брокерского счёта');

				insert into REF_BOOK_INCOME_KIND(id,income_type_id,mark,name)
				values(seq_ref_book_record.nextval,(select id from (select id,version from ref_book_income_type where code='1532' and status=0 order by version desc) where rownum=1),'02','Начисление дохода при выводе ценных бумаг с торгового раздела счёта депо');

				insert into REF_BOOK_INCOME_KIND(id,income_type_id,mark,name)
				values(seq_ref_book_record.nextval,(select id from (select id,version from ref_book_income_type where code='1532' and status=0 order by version desc) where rownum=1),'03','Начисление дохода при расторжении договора брокерского обслуживания');

				insert into REF_BOOK_INCOME_KIND(id,income_type_id,mark,name)
				values(seq_ref_book_record.nextval,(select id from (select id,version from ref_book_income_type where code='1532' and status=0 order by version desc) where rownum=1),'04','Начисление дохода по окончанию налогового периода за который начислен доход');

				insert into REF_BOOK_INCOME_KIND(id,income_type_id,mark,name)
				values(seq_ref_book_record.nextval,(select id from (select id,version from ref_book_income_type where code='2003' and status=0 order by version desc) where rownum=1),'05','Процентная надбавка');

				insert into REF_BOOK_INCOME_KIND(id,income_type_id,mark,name)
				values(seq_ref_book_record.nextval,(select id from (select id,version from ref_book_income_type where code='2003' and status=0 order by version desc) where rownum=1),'06','Процентная надбавка при увольнении');

				insert into REF_BOOK_INCOME_KIND(id,income_type_id,mark,name)
				values(seq_ref_book_record.nextval,(select id from (select id,version from ref_book_income_type where code='2003' and status=0 order by version desc) where rownum=1),'07','Разовая премия');

				insert into REF_BOOK_INCOME_KIND(id,income_type_id,mark,name)
				values(seq_ref_book_record.nextval,(select id from (select id,version from ref_book_income_type where code='2003' and status=0 order by version desc) where rownum=1),'08','Ежемесячная премия');

				insert into REF_BOOK_INCOME_KIND(id,income_type_id,mark,name)
				values(seq_ref_book_record.nextval,(select id from (select id,version from ref_book_income_type where code='2003' and status=0 order by version desc) where rownum=1),'09','Ежеквартальная премия');

				insert into REF_BOOK_INCOME_KIND(id,income_type_id,mark,name)
				values(seq_ref_book_record.nextval,(select id from (select id,version from ref_book_income_type where code='2003' and status=0 order by version desc) where rownum=1),'10','Премия по итогам года');

				insert into REF_BOOK_INCOME_KIND(id,income_type_id,mark,name)
				values(seq_ref_book_record.nextval,(select id from (select id,version from ref_book_income_type where code='2013' and status=0 order by version desc) where rownum=1),'13','Выплата дохода в денежной форме');

				insert into REF_BOOK_INCOME_KIND(id,income_type_id,mark,name)
				values(seq_ref_book_record.nextval,(select id from (select id,version from ref_book_income_type where code='2014' and status=0 order by version desc) where rownum=1),'13','Выплата дохода в денежной форме');

				insert into REF_BOOK_INCOME_KIND(id,income_type_id,mark,name)
				values(seq_ref_book_record.nextval,(select id from (select id,version from ref_book_income_type where code='2520' and status=0 order by version desc) where rownum=1),'13','Выплата дохода в денежной форме');

				insert into REF_BOOK_INCOME_KIND(id,income_type_id,mark,name)
				values(seq_ref_book_record.nextval,(select id from (select id,version from ref_book_income_type where code='1552' and status=0 order by version desc) where rownum=1),'00','-');

				insert into REF_BOOK_INCOME_KIND(id,income_type_id,mark,name)
				values(seq_ref_book_record.nextval,(select id from (select id,version from ref_book_income_type where code='2301' and status=0 order by version desc) where rownum=1),'00','-');

				insert into REF_BOOK_INCOME_KIND(id,income_type_id,mark,name)
				values(seq_ref_book_record.nextval,(select id from (select id,version from ref_book_income_type where code='2611' and status=0 order by version desc) where rownum=1),'00','-');

				insert into REF_BOOK_INCOME_KIND(id,income_type_id,mark,name)
				values(seq_ref_book_record.nextval,(select id from (select id,version from ref_book_income_type where code='3023' and status=0 order by version desc) where rownum=1),'00','-');

				delete from REF_BOOK_INCOME_KIND where
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='1544' and status=0 order by version desc) where rownum=1) and mark='01')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='1545' and status=0 order by version desc) where rownum=1) and mark='01')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='1546' and status=0 order by version desc) where rownum=1) and mark='01')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='1547' and status=0 order by version desc) where rownum=1) and mark='01')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='1548' and status=0 order by version desc) where rownum=1) and mark='01')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='1549' and status=0 order by version desc) where rownum=1) and mark='01')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='1552' and status=0 order by version desc) where rownum=1) and mark='01')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='1544' and status=0 order by version desc) where rownum=1) and mark='02')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='1545' and status=0 order by version desc) where rownum=1) and mark='02')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='1546' and status=0 order by version desc) where rownum=1) and mark='02')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='1547' and status=0 order by version desc) where rownum=1) and mark='02')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='1548' and status=0 order by version desc) where rownum=1) and mark='02')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='1549' and status=0 order by version desc) where rownum=1) and mark='02')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='1552' and status=0 order by version desc) where rownum=1) and mark='02')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='1544' and status=0 order by version desc) where rownum=1) and mark='03')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='1545' and status=0 order by version desc) where rownum=1) and mark='03')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='1546' and status=0 order by version desc) where rownum=1) and mark='03')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='1547' and status=0 order by version desc) where rownum=1) and mark='03')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='1548' and status=0 order by version desc) where rownum=1) and mark='03')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='1549' and status=0 order by version desc) where rownum=1) and mark='03')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='1552' and status=0 order by version desc) where rownum=1) and mark='03')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='1544' and status=0 order by version desc) where rownum=1) and mark='04')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='1545' and status=0 order by version desc) where rownum=1) and mark='04')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='1546' and status=0 order by version desc) where rownum=1) and mark='04')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='1547' and status=0 order by version desc) where rownum=1) and mark='04')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='1548' and status=0 order by version desc) where rownum=1) and mark='04')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='1549' and status=0 order by version desc) where rownum=1) and mark='04')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='1552' and status=0 order by version desc) where rownum=1) and mark='04')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='2000' and status=0 order by version desc) where rownum=1) and mark='07')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='2000' and status=0 order by version desc) where rownum=1) and mark='08')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='2000' and status=0 order by version desc) where rownum=1) and mark='09')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='2000' and status=0 order by version desc) where rownum=1) and mark='10')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='2003' and status=0 order by version desc) where rownum=1) and mark='13')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='1120' and status=0 order by version desc) where rownum=1) and mark='00')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='1200' and status=0 order by version desc) where rownum=1) and mark='00')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='1201' and status=0 order by version desc) where rownum=1) and mark='00')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='1202' and status=0 order by version desc) where rownum=1) and mark='00')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='1203' and status=0 order by version desc) where rownum=1) and mark='00')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='1211' and status=0 order by version desc) where rownum=1) and mark='00')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='1212' and status=0 order by version desc) where rownum=1) and mark='00')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='1213' and status=0 order by version desc) where rownum=1) and mark='00')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='1215' and status=0 order by version desc) where rownum=1) and mark='00')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='1219' and status=0 order by version desc) where rownum=1) and mark='00')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='1220' and status=0 order by version desc) where rownum=1) and mark='00')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='1240' and status=0 order by version desc) where rownum=1) and mark='00')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='1300' and status=0 order by version desc) where rownum=1) and mark='00')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='1301' and status=0 order by version desc) where rownum=1) and mark='00')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='1532' and status=0 order by version desc) where rownum=1) and mark='00')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='1538' and status=0 order by version desc) where rownum=1) and mark='00')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='1540' and status=0 order by version desc) where rownum=1) and mark='00')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='1550' and status=0 order by version desc) where rownum=1) and mark='00')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='1553' and status=0 order by version desc) where rownum=1) and mark='00')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='2201' and status=0 order by version desc) where rownum=1) and mark='00')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='2202' and status=0 order by version desc) where rownum=1) and mark='00')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='2203' and status=0 order by version desc) where rownum=1) and mark='00')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='2204' and status=0 order by version desc) where rownum=1) and mark='00')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='2205' and status=0 order by version desc) where rownum=1) and mark='00')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='2206' and status=0 order by version desc) where rownum=1) and mark='00')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='2207' and status=0 order by version desc) where rownum=1) and mark='00')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='2208' and status=0 order by version desc) where rownum=1) and mark='00')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='2209' and status=0 order by version desc) where rownum=1) and mark='00')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='2210' and status=0 order by version desc) where rownum=1) and mark='00')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='2400' and status=0 order by version desc) where rownum=1) and mark='00')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='2510' and status=0 order by version desc) where rownum=1) and mark='00')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='2530' and status=0 order by version desc) where rownum=1) and mark='00')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='2630' and status=0 order by version desc) where rownum=1) and mark='00')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='2730' and status=0 order by version desc) where rownum=1) and mark='00')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='2761' and status=0 order by version desc) where rownum=1) and mark='00')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='3010' and status=0 order by version desc) where rownum=1) and mark='00')
				or
				(income_type_id=(select id from (select id,version from ref_book_income_type where code='3022' and status=0 order by version desc) where rownum=1) and mark='00');
			end;
        </sql>
    </changeSet>

    <!--https://jira.aplana.com/browse/SBRFNDFL-3436 -->
    <changeSet id="2.2-ytrofimov-46" author="ytrofimov">
        <update tableName="BLOB_DATA">
            <column name="data"
                    valueBlobFile="templates/ndfl/report_6ndfl/v2016/report.jrxml"/>
            <where>id in (select jrxml from declaration_template dt where dt.id = 103)</where>
        </update>
    </changeSet>

	<!--https://jira.aplana.com/browse/SBRFNDFL-3574 Оптимизация процедур идентификации-->
    <changeSet id="2.2-rnurgaleev-9" author="rnurgaleev">
        <sqlFile dbms="oracle"
                 encoding="utf8"
                 endDelimiter=""
                 path="/scripts/person_pkg_body6.sql"
                 relativeToChangelogFile="true"
                 splitStatements="false"/>
    </changeSet>

	<changeSet id="2.2-rnurgaleev-10" author="rnurgaleev">
        <sqlFile dbms="oracle"
                 encoding="utf8"
                 endDelimiter=""
                 path="/scripts/person_pkg_body7.sql"
                 relativeToChangelogFile="true"
                 splitStatements="false"/>
    </changeSet>

    <!--https://jira.aplana.com/browse/SBRFNDFL-3432 -->
    <changeSet id="2.2-ytrofimov-47" author="ytrofimov">
        <update tableName="BLOB_DATA">
            <column name="data"
                    valueBlobFile="templates/ndfl/report_6ndfl/v2016/report.jrxml"/>
            <where>id in (select dt.jrxml from declaration_template dt where dt.id = 103)</where>
        </update>
    </changeSet>

    <!--https://jira.aplana.com/browse/SBRFNDFL-3602 -->
    <changeSet id="2.2-ytrofimov-48" author="ytrofimov">
        <update tableName="BLOB_DATA">
            <column name="data"
                    valueBlobFile="templates/ndfl/report_6ndfl/v2016/report.jrxml"/>
            <where>id in (select dt.jrxml from declaration_template dt where dt.id = 103)</where>
        </update>
    </changeSet>

    <!--https://jira.aplana.com/browse/SBRFNDFL-3544 -->
    <changeSet id="2.2-ytrofimov-49" author="ytrofimov">
        <update tableName="REF_BOOK">
            <column name="READ_ONLY" value="0"/>
            <where>id in (8, 922, 933)</where>
        </update>
    </changeSet>

    <!--https://jira.aplana.com/browse/SBRFNDFL-3025 -->
    <changeSet id="2.2-ytrofimov-50" author="ytrofimov">
        <update tableName="DECLARATION_TEMPLATE">
            <column name="create_script" valueClobFile="templates/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl.groovy"/>
            <where>id=100</where>
        </update>
    </changeSet>

    <!--https://jira.aplana.com/browse/SBRFNDFL-3025 -->
    <changeSet id="2.2-ytrofimov-51" author="ytrofimov">
        <update tableName="BLOB_DATA">
            <column name="data" valueBlobFile="templates/ndfl/primary_rnu_ndfl/v2016/rnu_ndfl_light.xsd"/>
            <where>id in (select dt.xsd from declaration_template dt where dt.id = 100)</where>
        </update>
    </changeSet>

    <changeSet id="2.2-ytrofimov-52" author="ytrofimov">
        <update tableName="DECLARATION_TEMPLATE">
            <column name="CREATE_SCRIPT" valueClobFile="templates/ndfl/report_2ndfl_1/v2016/report_2ndfl.groovy"/>
            <where>id in (102, 104)</where>
        </update>
    </changeSet>

    <changeSet id="2.2-ytrofimov-53" author="ytrofimov">
        <sql splitStatements="false">
            begin
            insert into ref_book_doc_type(id, record_id, status, version, code, name, priority)
            values(seq_ref_book_record.nextval,seq_ref_book_record_row_id.nextval, 0, to_date('01.01.2016','DD.MM.YYYY'), '22', 'Загранпаспорт гражданина Российской Федерации', '4');

            insert into ref_book_doc_type(id, record_id, status, version, code, name, priority)
            values(seq_ref_book_record.nextval,seq_ref_book_record_row_id.nextval, 0, to_date('01.01.2016','DD.MM.YYYY'), '09', 'Дипломатический паспорт', '5');

            insert into ref_book_doc_type(id, record_id, status, version, code, name, priority)
            values(seq_ref_book_record.nextval,seq_ref_book_record_row_id.nextval, 0, to_date('01.01.2016','DD.MM.YYYY'), '28', 'Служебный паспорт гражданина Российской Федерации', '6');

            insert into ref_book_doc_type(id, record_id, status, version, code, name, priority)
            values(seq_ref_book_record.nextval,seq_ref_book_record_row_id.nextval, 0, to_date('01.01.2016','DD.MM.YYYY'), '26', 'Паспорт моряка', '7');

            insert into ref_book_doc_type(id, record_id, status, version, code, name, priority)
            values(seq_ref_book_record.nextval,seq_ref_book_record_row_id.nextval, 0, to_date('01.01.2016','DD.MM.YYYY'), '19', 'Свидетельство о предоставлении временного убежища на территории Российской Федерации', '15');

            insert into ref_book_doc_type(id, record_id, status, version, code, name, priority)
            values(seq_ref_book_record.nextval,seq_ref_book_record_row_id.nextval, 0, to_date('01.01.2016','DD.MM.YYYY'), '27', 'Военный билет офицера запаса', '18');

            insert into ref_book_doc_type(id, record_id, status, version, code, name, priority)
            values(seq_ref_book_record.nextval,seq_ref_book_record_row_id.nextval, 0, to_date('01.01.2016','DD.MM.YYYY'), '05', 'Справка об освобождении из места лишения свободы', '19');

            insert into ref_book_doc_type(id, record_id, status, version, code, name, priority)
            values(seq_ref_book_record.nextval,seq_ref_book_record_row_id.nextval, 0, to_date('01.01.2016','DD.MM.YYYY'), '81', 'Свидетельство о смерти', '20');

            insert into ref_book_doc_type(id, record_id, status, version, code, name, priority)
            values(seq_ref_book_record.nextval,seq_ref_book_record_row_id.nextval, 0, to_date('01.01.2016','DD.MM.YYYY'), '60', 'Документы, подтверждающие факт регистрации по месту жительства (пребывания)', '21');

            insert into ref_book_doc_type(id, record_id, status, version, code, name, priority)
            values(seq_ref_book_record.nextval,seq_ref_book_record_row_id.nextval, 0, to_date('01.01.2016','DD.MM.YYYY'), '61', 'Свидетельство о регистрации по месту жительства', '22');

            insert into ref_book_doc_type(id, record_id, status, version, code, name, priority)
            values(seq_ref_book_record.nextval,seq_ref_book_record_row_id.nextval, 0, to_date('01.01.2016','DD.MM.YYYY'), '62', 'Вид на жительство иностранного гражданина', '23');

            insert into ref_book_doc_type(id, record_id, status, version, code, name, priority)
            values(seq_ref_book_record.nextval,seq_ref_book_record_row_id.nextval, 0, to_date('01.01.2016','DD.MM.YYYY'), '63', 'Свидетельство о регистрации по месту пребывания', '24');

            insert into ref_book_doc_type(id, record_id, status, version, code, name, priority)
            values(seq_ref_book_record.nextval,seq_ref_book_record_row_id.nextval, 0, to_date('01.01.2016','DD.MM.YYYY'), '01', 'Паспорт гражданина СССР', '25');

            insert into ref_book_doc_type(id, record_id, status, version, code, name, priority)
            values(seq_ref_book_record.nextval,seq_ref_book_record_row_id.nextval, 0, to_date('01.01.2016','DD.MM.YYYY'), '02', 'Загранпаспорт гражданина СССР', '26');

            insert into ref_book_doc_type(id, record_id, status, version, code, name, priority)
            values(seq_ref_book_record.nextval,seq_ref_book_record_row_id.nextval, 0, to_date('01.01.2016','DD.MM.YYYY'), '04', 'Удостоверение личности офицера', '28');

            insert into ref_book_doc_type(id, record_id, status, version, code, name, priority)
            values(seq_ref_book_record.nextval,seq_ref_book_record_row_id.nextval, 0, to_date('01.01.2016','DD.MM.YYYY'), '06', 'Паспорт Минморфлота', '29');

            update ref_book_doc_type set priority=1
            where code='21';

            update ref_book_doc_type set priority=2
            where code='03';

            update ref_book_doc_type set priority=3
            where code='07';

            update ref_book_doc_type set priority=8
            where code='08';

            update ref_book_doc_type set priority=9
            where code='10';

            update ref_book_doc_type set priority=10
            where code='11';

            update ref_book_doc_type set priority=11
            where code='12';

            update ref_book_doc_type set priority=12
            where code='13';

            update ref_book_doc_type set priority=13
            where code='14';

            update ref_book_doc_type set priority=14
            where code='15';

            update ref_book_doc_type set priority=16
            where code='23';

            update ref_book_doc_type set priority=17
            where code='24';

            update ref_book_doc_type set priority=27, name='Свидетельство о предоставлении временного убежища на территории Российской Федерации (до 01.01.2013)'
            where code='18';

            update ref_book_doc_type set priority=30
            where code='91';
            end;
        </sql>
    </changeSet>

    <!--https://jira.aplana.com/browse/SBRFNDFL-3639 -->
    <changeSet id="2.2-ytrofimov-54" author="ytrofimov">
        <update tableName="BLOB_DATA">
            <column name="data"
                    valueBlobFile="templates/ndfl/report_6ndfl/v2016/report.jrxml"/>
            <where>id in (select dt.jrxml from declaration_template dt where dt.id = 103)</where>
        </update>
    </changeSet>

    <!--https://jira.aplana.com/browse/SBRFNDFL-3614 -->
    <changeSet id="2.2-ytrofimov-55" author="ytrofimov">
        <update tableName="BLOB_DATA">
            <column name="data"
                    valueBlobFile="templates/ndfl/report_6ndfl/v2016/report.jrxml"/>
            <where>id in (select dt.jrxml from declaration_template dt where dt.id = 103)</where>
        </update>
    </changeSet>

    <!-- https://jira.aplana.com/browse/SBRFNDFL-3689 Редактирование данных НФ через загрузку ТФ (Excel). Правки по БД РНУ НДФЛ.-->
    <changeSet id="2.2-ytrofimov-56" author="ytrofimov">
        <addColumn tableName="ndfl_person">
            <column name="editing_date" type="date"/>
            <column name="updated_by" type="varchar2(255 char)" />
        </addColumn>
        <addColumn tableName="ndfl_person_income" >
            <column name="editing_date" type="date"/>
            <column name="updated_by" type="varchar2(255 char)" />
        </addColumn>
        <addColumn tableName="ndfl_person_deduction" >
            <column name="editing_date" type="date"/>
            <column name="updated_by" type="varchar2(255 char)" />
        </addColumn>
        <addColumn tableName="ndfl_person_prepayment" >
            <column name="editing_date" type="date"/>
            <column name="updated_by" type="varchar2(255 char)" />
        </addColumn>
    </changeSet>

	<!--https://jira.aplana.com/browse/SBRFNDFL-3380 DECLARATION_TYPE. Удалить IS_IFRS, IFRS_NAME изменения по БД-->
	<changeSet id="2.2-rnurgaleev-11" author="rnurgaleev">
        <dropColumn
                columnName="IS_IFRS"
                tableName="DECLARATION_TYPE"/>
    </changeSet>

	<changeSet id="2.2-rnurgaleev-12" author="rnurgaleev">
        <dropColumn
                columnName="IFRS_NAME"
                tableName="DECLARATION_TYPE"/>
    </changeSet>

	<changeSet id="2.2-rnurgaleev-13" author="rnurgaleev">
        <sql>
            comment on table declaration_type is ' Виды деклараций';
        </sql>
    </changeSet>
	
	<!--https://jira.aplana.com/browse/SBRFNDFL-3105 ФИАС. Удаление параметра p_check_type (правки по БД)-->
	<changeSet id="2.2-rnurgaleev-14" author="rnurgaleev">
        <sqlFile dbms="oracle"
                 encoding="utf8"
                 endDelimiter=""
                 path="/scripts/fias_pkg11.sql"
                 relativeToChangelogFile="true"
                 splitStatements="false"/>
    </changeSet>

	<changeSet id="2.2-rnurgaleev-15" author="rnurgaleev">
        <sqlFile dbms="oracle"
                 encoding="utf8"
                 endDelimiter=""
                 path="/scripts/fias_pkg_body11.sql"
                 relativeToChangelogFile="true"
                 splitStatements="false"/>
    </changeSet>
	
	<!--https://jira.aplana.com/browse/SBRFNDFL-3380 DECLARATION_TYPE. Удалить IS_IFRS, IFRS_NAME изменения по БД. Лишний пробел в комментарии-->
	<changeSet id="2.2-rnurgaleev-16" author="rnurgaleev">
        <sql>
            comment on table declaration_type is 'Виды деклараций';
        </sql>
    </changeSet>

    <!-- https://jira.aplana.com/browse/SBRFNDFL-3103 -->
    <changeSet id="2.2-ytrofimov-57" author="ytrofimov">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script"
                    valueClobFile="templates/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl_calculate.groovy"/>
            <where>id=1</where>
        </update>
    </changeSet>

    <!-- https://jira.aplana.com/browse/SBRFNDFL-3691 -->
    <changeSet id="2.2-ytrofimov-58" author="ytrofimov">
        <update tableName="DECLARATION_TEMPLATE">
            <column name="create_script" valueClobFile="templates/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl.groovy"/>
            <where>id=100</where>
        </update>
    </changeSet>

	<!--https://jira.aplana.com/browse/SBRFNDFL-3672 Обновить состав справочника "Коды места представления расчета"-->
	<changeSet id="2.2-rnurgaleev-17" author="rnurgaleev">
        <sql splitStatements="false">
            begin
				merge into ref_book_present_place a using
				(select 0 as status, to_date('01.01.2018','DD.MM.YYYY') as version, '124' as code, 'По месту жительства члена (главы) крестьянского (фермерского) хозяйства' as name from dual
				union all
				select 2 as status, to_date('01.01.2018','DD.MM.YYYY') as version, '212' as code, 'по месту учета российской организации' as name from dual
				union all
				select 0 as status, to_date('01.01.2018','DD.MM.YYYY') as version, '214' as code, 'По месту нахождения российской организации, не являющейся крупнейшим налогоплательщиком ' as name from dual
				union all
				select 0 as status, to_date('01.01.2018','DD.MM.YYYY') as version, '215' as code, 'По месту нахождения правопреемника, не являющегося крупнейшим налогоплательщиком' as name from dual
				union all
				select 0 as status, to_date('01.01.2018','DD.MM.YYYY') as version, '216' as code, 'По месту учета правопреемника, являющегося крупнейшим налогоплательщиком' as name from dual) b
				on (a.status=b.status and a.version=b.version and a.code=b.code and a.name=b.name)
				when not matched then
				insert (id, record_id, status, version, code, name)
				values (seq_ref_book_record.nextval,seq_ref_book_record_row_id.nextval, b.status, b.version, b.code, b.name);
            end;
        </sql>
    </changeSet>

	<!--https://jira.aplana.com/browse/SBRFNDFL-3672 Обновить состав справочника "Коды места представления расчета". У записей с 212 кодом разный record_id-->
	<changeSet id="2.2-rnurgaleev-18" author="rnurgaleev">
        <sql splitStatements="false">
            begin
				update ref_book_present_place set record_id=(select max(record_id) from ref_book_present_place where code='212' and status=0)
				where code='212' and status=2;
            end;
        </sql>
    </changeSet>

	<!--https://jira.aplana.com/browse/SBRFNDFL-3513 2.2 Справочник "коды периодов": неверная календарная дата начала периода: год при реорганизации (ликвидации)-->
    <changeSet id="2.2-rnurgaleev-19" author="rnurgaleev">
        <update tableName="REPORT_PERIOD_TYPE">
            <column name="CALENDAR_START_DATE" valueDate="1970-01-01"/>
            <where>code='90'</where>
        </update>
    </changeSet>

    <changeSet id="2.2-ytrofimov-59" author="ytrofimov">
        <renameColumn tableName="ndfl_person" oldColumnName="editing_date" newColumnName="modified_date" remarks="Дата и время редактирования. Заполняется при редактировании данных НФ через загрузку Excel файла"/>
        <renameColumn tableName="ndfl_person" oldColumnName="updated_by" newColumnName="modified_by" remarks="Значение имени пользователя и логин из Справочника пользователей системы. Заполняется при редактировании данных НФ через загрузку Excel файла"/>
        <renameColumn tableName="ndfl_person_income" oldColumnName="editing_date" newColumnName="modified_date" remarks="Дата и время редактирования. Заполняется при редактировании данных НФ через загрузку Excel файла"/>
        <renameColumn tableName="ndfl_person_income" oldColumnName="updated_by" newColumnName="modified_by" remarks="Значение имени пользователя и логин из Справочника пользователей системы. Заполняется при редактировании данных НФ через загрузку Excel файла"/>
        <renameColumn tableName="ndfl_person_deduction" oldColumnName="editing_date" newColumnName="modified_date" remarks="Дата и время редактирования. Заполняется при редактировании данных НФ через загрузку Excel файла"/>
        <renameColumn tableName="ndfl_person_deduction" oldColumnName="updated_by" newColumnName="modified_by" remarks="Значение имени пользователя и логин из Справочника пользователей системы. Заполняется при редактировании данных НФ через загрузку Excel файла"/>
        <renameColumn tableName="ndfl_person_prepayment" oldColumnName="editing_date" newColumnName="modified_date" remarks="Дата и время редактирования. Заполняется при редактировании данных НФ через загрузку Excel файла"/>
        <renameColumn tableName="ndfl_person_prepayment" oldColumnName="updated_by" newColumnName="modified_by" remarks="Значение имени пользователя и логин из Справочника пользователей системы. Заполняется при редактировании данных НФ через загрузку Excel файла"/>
    </changeSet>

    <changeSet id="2.2-ytrofimov-60" author="ytrofimov">
        <sql splitStatements="false">
            begin
            execute immediate 'comment on column ndfl_person.modified_date is ''Дата и время редактирования. Заполняется при редактировании данных НФ через загрузку Excel файла''';
            execute immediate 'comment on column ndfl_person.modified_by is ''Значение имени пользователя и логин из Справочника пользователей системы. Заполняется при редактировании данных НФ через загрузку Excel файла''';
            execute immediate 'comment on column ndfl_person_income.modified_date is ''Дата и время редактирования. Заполняется при редактировании данных НФ через загрузку Excel файла''';
            execute immediate 'comment on column ndfl_person_income.modified_by is ''Значение имени пользователя и логин из Справочника пользователей системы. Заполняется при редактировании данных НФ через загрузку Excel файла''';
            execute immediate 'comment on column ndfl_person_deduction.modified_date is ''Дата и время редактирования. Заполняется при редактировании данных НФ через загрузку Excel файла''';
            execute immediate 'comment on column ndfl_person_deduction.modified_by is ''Значение имени пользователя и логин из Справочника пользователей системы. Заполняется при редактировании данных НФ через загрузку Excel файла''';
            execute immediate 'comment on column ndfl_person_prepayment.modified_date is ''Дата и время редактирования. Заполняется при редактировании данных НФ через загрузку Excel файла''';
            execute immediate 'comment on column ndfl_person_prepayment.modified_by is ''Значение имени пользователя и логин из Справочника пользователей системы. Заполняется при редактировании данных НФ через загрузку Excel файла''';
            end;
        </sql>
    </changeSet>


    <changeSet id="2.2-dnovikov-8" author="dnovikov">
        <insert tableName="async_task_type">
            <column name="id" value="33"/>
            <column name="name" value="Загрузка данных xml в справочник"/>
            <column name="handler_bean" value="ImportRefBookXmlAsyncTask"/>
            <column name="short_queue_limit" value="10000"/>
            <column name="limit_kind" value="Размер файла (Кбайт)"/>
        </insert>
    </changeSet>

    <changeSet id="2.2-dnovikov-9" author="dnovikov">
        <update tableName="BLOB_DATA">
            <column name="data" valueBlobFile="templates/refbook/person.groovy"/>
            <where>id='884b9f2e-1678-4d69-9652-b036bba2f728'</where>
        </update>
    </changeSet>

    <changeSet id="2.2-dnovikov-10" author="dnovikov">
        <insert tableName="configuration">
            <column name="code" value="ENABLE_IMPORT_PERSON"/>
            <column name="department_id" value="0"/>
            <column name="value" value="1"/>
        </insert>
    </changeSet>

    <changeSet id="2.2-dnovikov-11" author="dnovikov">
        <update tableName="BLOB_DATA">
            <column name="data" valueBlobFile="templates/refbook/person.groovy"/>
            <where>id='884b9f2e-1678-4d69-9652-b036bba2f728'</where>
        </update>
    </changeSet>

    <!--https://jira.aplana.com/browse/SBRFNDFL-3730 -->
    <changeSet id="2.2-dloshkarev-4" author="dloshkarev">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script" valueClobFile="templates/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl_check.groovy"/>
            <where>id=2</where>
        </update>
    </changeSet>
    <changeSet id="2.2-dloshkarev-5" author="dloshkarev">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script"
                    valueClobFile="templates/ndfl/consolidated_rnu_ndfl/v2016/consolidated_rnu_ndfl_check.groovy"/>
            <where>id=6</where>
        </update>
    </changeSet>

    <!--https://jira.aplana.com/browse/SBRFNDFL-3742 -->
    <changeSet id="2.2-dloshkarev-6" author="dloshkarev">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script"
                    valueClobFile="templates/ndfl/consolidated_rnu_ndfl/v2016/consolidated_rnu_ndfl_calculate.groovy"/>
            <where>id=5</where>
        </update>
    </changeSet>


    <!-- https://jira.aplana.com/browse/SBRFNDFL-3691 -->
    <changeSet id="2.2-ytrofimov-61" author="ytrofimov">
        <update tableName="DECLARATION_TEMPLATE">
            <column name="create_script" valueClobFile="templates/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl.groovy"/>
            <where>id=100</where>
        </update>
    </changeSet>

    <changeSet id="2.2-dnovikov-12" author="dnovikov">
        <update tableName="BLOB_DATA">
            <column name="data" valueBlobFile="templates/refbook/person.groovy"/>
            <where>id='884b9f2e-1678-4d69-9652-b036bba2f728'</where>
        </update>
    </changeSet>

    <!-- https://jira.aplana.com/browse/SBRFNDFL-3677 -->
    <changeSet id="2.2-apronin-1" author="apronin">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script" valueClobFile="templates/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl_check.groovy"/>
            <where>id=2</where>
        </update>
    </changeSet>

    <!-- https://jira.aplana.com/browse/SBRFNDFL-3678 -->
    <changeSet id="2.2-apronin-2" author="apronin">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script" valueClobFile="templates/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl_check.groovy"/>
            <where>id=2</where>
        </update>
    </changeSet>

	<!--https://jira.aplana.com/browse/SBRFNDFL-3756 В справочнике АСНУ в наименовании АС "Back Office" лишний пробел в конце-->
	<changeSet id="2.2-rnurgaleev-20" author="rnurgaleev">
        <update tableName="ref_book_asnu">
            <column name="name"
                    value="АС &quot;Back Office&quot;"/>
            <where>code='8000'</where>
        </update>
    </changeSet>

	<changeSet id="2.2-rnurgaleev-21" author="rnurgaleev">
        <update tableName="BLOB_DATA">
            <column name="data" valueBlobFile="templates/refbook/person.groovy"/>
            <where>id='884b9f2e-1678-4d69-9652-b036bba2f728'</where>
        </update>
    </changeSet>

	<!--https://jira.aplana.com/browse/SBRFNDFL-1449 Добавить в XSD РНУ НДФЛ допустимое значение "00.00.0000" для элемента СрокПрчслНал вернул прежнюю версию до 9f785268c7df43310e6fc2402c407210e6071b46-->
    <changeSet id="2.2-rnurgaleev-22" author="rnurgaleev">
        <update tableName="BLOB_DATA">
            <column name="data" valueBlobFile="templates/ndfl/primary_rnu_ndfl/v2016/rnu_ndfl_light.xsd"/>
            <where>id in (select dt.xsd from declaration_template dt where dt.id = 100)</where>
        </update>
    </changeSet>

    <!-- https://jira.aplana.com/browse/SBRFNDFL-3757 -->
    <changeSet id="2.2-apronin-2" author="apronin">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script" valueClobFile="templates/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl_check.groovy"/>
            <where>id=2</where>
        </update>
    </changeSet>

    <!--https://jira.aplana.com/browse/SBRFNDFL-3675 -->
    <changeSet id="2.2-dloshkarev-7" author="dloshkarev">
        <update tableName="DECLARATION_TEMPLATE">
            <column name="CREATE_SCRIPT" valueClobFile="templates/ndfl/report_6ndfl/v2016/report_6ndfl.groovy"/>
            <where>id=103</where>
        </update>
    </changeSet>
    <changeSet id="2.2-dloshkarev-8" author="dloshkarev">
        <update tableName="BLOB_DATA">
            <column name="data"
                    valueBlobFile="templates/ndfl/report_6ndfl/v2016/NO_NDFL6_1_152_00_05_01_02.xsd"/>
            <where>id in (SELECT xsd FROM declaration_template WHERE id=103)</where>
        </update>
    </changeSet>

	<!--https://jira.aplana.com/browse/SBRFNDFL-3765 Увеличить размеры полей: "Район", "Город", "Населенный пункт", "Улица" в справочнике ФЛ-->
	<changeSet id="2.2-rnurgaleev-23" author="rnurgaleev">
        <modifyDataType
                tableName="ref_book_address"
                columnName="district"
                newDataType="varchar2(100 char)"
        />
    </changeSet>

	<changeSet id="2.2-rnurgaleev-24" author="rnurgaleev">
        <modifyDataType
                tableName="ref_book_address"
                columnName="city"
                newDataType="varchar2(100 char)"
        />
    </changeSet>

	<changeSet id="2.2-rnurgaleev-25" author="rnurgaleev">
        <modifyDataType
                tableName="ref_book_address"
                columnName="locality"
                newDataType="varchar2(100 char)"
        />
    </changeSet>

	<changeSet id="2.2-rnurgaleev-26" author="rnurgaleev">
        <modifyDataType
                tableName="ref_book_address"
                columnName="street"
                newDataType="varchar2(100 char)"
        />
    </changeSet>

	<changeSet id="2.2-rnurgaleev-27" author="rnurgaleev">
        <sql>
            update ref_book_attribute set max_length=100 where ref_book_id=901 and alias in ('DISTRICT','CITY','LOCALITY','STREET');
        </sql>
    </changeSet>

    <!-- https://jira.aplana.com/browse/SBRFNDFL-3678 -->
    <changeSet id="2.2-apronin-3" author="apronin">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script" valueClobFile="templates/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl_check.groovy"/>
            <where>id=2</where>
        </update>
    </changeSet>

	<!--https://jira.aplana.com/browse/SBRFNDFL-3704 НДФЛ: Обновить печатное представление 6-НДФЛ-->
	<changeSet id="2.2-rnurgaleev-28" author="rnurgaleev">
        <update tableName="BLOB_DATA">
            <column name="data"
                    valueBlobFile="templates/ndfl/report_6ndfl/v2016/report.jrxml"/>
            <where>id in (select jrxml from declaration_template where id=103)</where>
        </update>
    </changeSet>

	<!--https://jira.aplana.com/browse/SBRFNDFL-3789 2.2 Параметры асинхронных заданий: некорректное название операций "Расчет", "Идентификация", "Консолидация"-->
	<changeSet id="2.2-rnurgaleev-29" author="rnurgaleev">
		<update tableName="async_task_type">
            <column name="name" value="Идентификация ФЛ налоговой формы"/>
            <where>id = 8</where>
        </update>
    </changeSet>

    <changeSet id="2.2-rnurgaleev-30" author="rnurgaleev">
		<update tableName="async_task_type">
            <column name="name" value="Консолидация налоговой формы"/>
            <where>id = 9</where>
        </update>
    </changeSet>

    <!--https://jira.aplana.com/browse/SBRFNDFL-3692 -->
    <changeSet id="2.2-ytrofimov-62" author="ytrofimov">
        <insert tableName="event">
            <column name="id" value="10"/>
            <column name="name" value="Изменение данных"/>
        </insert>
    </changeSet>

    <changeSet id="2.2-ytrofimov-63" author="ytrofimov">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script"
                    valueClobFile="templates/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl_import.groovy"/>
            <where>id=14</where>
        </update>
    </changeSet>

    <!--https://jira.aplana.com/browse/SBRFNDFL-3809 -->
    <changeSet id="2.2-ytrofimov-64" author="ytrofimov">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script"
                    valueClobFile="templates/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl_import.groovy"/>
            <where>id=14</where>
        </update>
    </changeSet>

</databaseChangeLog>