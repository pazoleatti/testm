<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
                                       http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd">

	<!--Прежнее значение '01.01.0001' выдает ошибку при импорте схемы-->
	<changeSet id="2.2.2-rnurgaleev-0" author="rnurgaleev">
        <sql>
            alter table REF_BOOK_INCOME_KIND modify version date default to_date('01.01.0001','DD.MM.YYYY');
            alter table REPORT_PERIOD_TYPE modify version date default to_date('01.01.0001','DD.MM.YYYY');
        </sql>
    </changeSet>

    <changeSet id="2.2.2-ytrofimov-0" author="ytrofimov">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script"
                    valueClobFile="templates/ndfl/report_2ndfl_1/v2016/report_2ndfll_check.groovy"/>
            <where>id in (8, 12)</where>
        </update>
    </changeSet>

    <changeSet id="2.2.2-ytrofimov-1" author="ytrofimov">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script"
                    valueClobFile="templates/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl_import.groovy"/>
            <where>id=14</where>
        </update>
    </changeSet>

    <changeSet id="2.2.2-apronin-1" author="apronin">
        <update tableName="DECLARATION_TEMPLATE">
            <column name="create_script" valueClobFile="templates/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl.groovy"/>
            <where>id=100</where>
        </update>
    </changeSet>

    <changeSet id="2.2.2-ytrofimov-2" author="apronin">
        <update tableName="DECLARATION_TEMPLATE">
            <column name="create_script"
                    valueClobFile="templates/ndfl/consolidated_rnu_ndfl/v2016/consolidated_rnu_ndfl.groovy"/>
            <where>id=101</where>
        </update>
    </changeSet>

    <changeSet id="2.2.2-ytrofimov-2" author="ytrofimov">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script"
                    valueClobFile="templates/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl_import.groovy"/>
            <where>id=14</where>
        </update>
    </changeSet>

    <changeSet id="2.2.2-ytrofimov-3" author="ytrofimov">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script"
                    valueClobFile="templates/ndfl/report_2ndfl_1/v2016/report_2ndfll_check.groovy"/>
            <where>id in (8, 12)</where>
        </update>
    </changeSet>

    <!-- https://jira.aplana.com/browse/SBRFNDFL-4120 -->
    <changeSet id="2.2.2-apronin-2" author="apronin">
        <update tableName="DECLARATION_TEMPLATE">
            <column name="create_script" valueClobFile="templates/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl.groovy"/>
            <where>id=100</where>
        </update>
    </changeSet>

    <changeSet id="2.2.2-ytrofimov-4" author="ytrofimov">
        <update tableName="DECLARATION_TEMPLATE">
            <column name="create_script" valueClobFile="templates/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl.groovy"/>
            <where>id=100</where>
        </update>
    </changeSet>

    <!-- https://jira.aplana.com/browse/SBRFNDFL-4120 -->
    <changeSet id="2.2.2-apronin-3" author="apronin">
        <update tableName="DECLARATION_TEMPLATE">
            <column name="create_script" valueClobFile="templates/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl.groovy"/>
            <where>id=100</where>
        </update>
    </changeSet>

	<!--https://jira.aplana.com/browse/SBRFNDFL-4137 Печатное представление 6-НДФЛ: в разделе 2 в графе 130 не отображается 00 при целочисленном значении графы-->
	<changeSet id="2.2.2-rnurgaleev-1" author="rnurgaleev">
        <update tableName="BLOB_DATA">
            <column name="data"
                    valueBlobFile="templates/ndfl/report_6ndfl/v2016/report.jrxml"/>
            <where>id in (select jrxml from declaration_template dt where dt.id = 103)</where>
        </update>
    </changeSet>

    <changeSet id="2.2.2-ytrofimov-5" author="ytrofimov">
        <insert tableName="async_task_type">
            <column name="id" value="34"/>
            <column name="name" value="Обновление данных ФЛ в КНФ"/>
            <column name="handler_bean" value="UpdatePersonsDataAsyncTask"/>
            <column name="short_queue_limit" value="3000"/>
            <column name="limit_kind" value="Количество ФЛ в НФ"/>
        </insert>
    </changeSet>

    <changeSet id="2.2.2-ytrofimov-6" author="ytrofimov">
        <insert tableName="event">
            <column name="id" value="11"/>
            <column name="name" value="Обновление данных ФЛ в КНФ"/>
        </insert>
    </changeSet>

    <changeSet id="2.2.2-ytrofimov-7" author="ytrofimov">
        <insert tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="id" value="15"/>
            <column name="declaration_template_id" value="101"/>
            <column name="event_id" value="11"/>
            <column name="script"
                    valueClobFile="templates/ndfl/consolidated_rnu_ndfl/v2016/consolidated_rnu_ndfl_update_persons_data.groovy"/>
        </insert>
    </changeSet>

    <changeSet id="2.2.2-ytrofimov-8" author="ytrofimov">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script"
                    valueClobFile="templates/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl_import.groovy"/>
            <where>id=14</where>
        </update>
    </changeSet>

    <!--https://jira.aplana.com/browse/SBRFNDFL-4034-->
    <changeSet id="2.2.2-aokunev-1" author="aokunev">
        <update tableName="DECLARATION_TEMPLATE">
            <column name="create_script" valueClobFile="templates/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl.groovy"/>
            <where>id=100</where>
        </update>
    </changeSet>
	
	<!--https://jira.aplana.com/browse/SBRFNDFL-4189 Для РНУ-НДФЛ установить "строгую" xsd-схему-->
	<changeSet id="2.2.2-rnurgaleev-2" author="rnurgaleev">
        <update tableName="BLOB_DATA">
            <column name="data" valueBlobFile="templates/ndfl/primary_rnu_ndfl/v2016/rnu_ndfl.xsd"/>
            <column name="name" value="rnu_ndfl.xsd"/>
            <where>id in (select dt.xsd from declaration_template dt where dt.id = 100)</where>
        </update>
    </changeSet>

    <!--https://jira.aplana.com/browse/SBRFNDFL-4190-->
    <changeSet id="2.2.2-aokunev-2" author="aokunev">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script"
                    valueClobFile="templates/ndfl/consolidated_rnu_ndfl/v2016/consolidated_rnu_ndfl_calculate.groovy"/>
            <where>id=5</where>
        </update>
    </changeSet>

    <changeSet id="2.2.2-ytrofimov-9" author="ytrofimov">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script"
                    valueClobFile="templates/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl_import.groovy"/>
            <where>id=14</where>
        </update>
    </changeSet>

    <changeSet id="2.2.2-dnovikov-1" author="dnovikov">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script" valueClobFile="templates/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl_check.groovy"/>
            <where>id=2</where>
        </update>
    </changeSet>

    <changeSet id="2.2.2-dnovikov-2" author="dnovikov">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script"
                    valueClobFile="templates/ndfl/consolidated_rnu_ndfl/v2016/consolidated_rnu_ndfl_check.groovy"/>
            <where>id=6</where>
        </update>
    </changeSet>

    <changeSet id="2.2.2-ytrofimov-10" author="ytrofimov">
        <addColumn tableName="ASYNC_TASK">
            <column name="TASK_GROUP" type="number(3)"/>
        </addColumn>
    </changeSet>

    <changeSet id="2.2.2-ytrofimov-11" author="ytrofimov">
        <sql>
            COMMENT ON COLUMN ASYNC_TASK.TASK_GROUP IS 'Группа асинхронной задачи';
        </sql>
    </changeSet>

</databaseChangeLog>