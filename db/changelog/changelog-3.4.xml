<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
                                       http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd">

	<!--https://jira.aplana.com/browse/SBRFNDFL-5447 изменил имя атрибута справочника-->
	<changeSet id="3.4-dnovikov-1" author="dnovikov">
		<sql>
			update ref_book_attribute set name = 'Тип вычета' where id = 9213;
		</sql>
	</changeSet>

	<changeSet id="3.4-dnovikov-2" author="dnovikov" runAlways="true">
		<update tableName="BLOB_DATA">
			<column name="data"
					valueBlobFile="templates-3.4/refbook/person.groovy"/>
			<where>id in (select script_id from ref_book r where r.id = 904)</where>
		</update>
	</changeSet>

	<changeSet id="3.4-dnovikov-3" author="dnovikov" runAlways="true">
		<update tableName="blob_data">
			<column name="data"
					valueBlobFile="templates-3.4/refbook/department_configs.groovy"/>
			<where>id = (select script_id from ref_book r where r.id = 951)</where>
		</update>
	</changeSet>

    <!--https://jira.aplana.com/browse/SBRFNDFL-6233 Поменять размерность поля "phone" в настройках подразделений-->
	<!-- вывести в логи патча БД те записи что обрезались: where phone is not null and length(phone)>20 -->
    <changeSet id="3.4-amandzyak-1" author="amandzyak">
        <sql>
			update REF_BOOK_NDFL_DETAIL  
			set phone = substr(phone, 1, 20)
			where phone is not null and length(phone)>20
        </sql>
    </changeSet>

    <!--https://jira.aplana.com/browse/SBRFNDFL-6233 Поменять размерность поля "phone" в настройках подразделений-->
    <changeSet id="3.4-amandzyak-2" author="amandzyak">
        <sql>
			ALTER TABLE REF_BOOK_NDFL_DETAIL MODIFY phone VARCHAR2(20 CHAR)
        </sql>
    </changeSet>

</databaseChangeLog>