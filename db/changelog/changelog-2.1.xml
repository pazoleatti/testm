<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
                                       http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd">

    <changeSet id="2.1-rnurgaleev-1" author="rnurgaleev">
        <modifyDataType
                tableName="notification"
                columnName="id"
                newDataType="number(18)"
        />
    </changeSet>

    <changeSet id="2.1-rnurgaleev-2" author="rnurgaleev">
        <createTable
                remarks="Настройки задач планировщика"
                tableName="configuration_scheduler">
            <column name="id" type="number(9)" remarks="Идентификатор задачи">
                <constraints nullable="false"/>
            </column>
            <column name="task_name" type="varchar2(200 char)" remarks="Название">
                <constraints nullable="false"/>
            </column>
            <column name="schedule" type="varchar2(100 char)" remarks="Расписание">
            </column>
            <column name="active" type="number(1)" remarks="Признак активности">
                <constraints nullable="false"/>
            </column>
            <column name="modification_date" type="date" remarks="Дата редактирования">
                <constraints nullable="false"/>
            </column>
            <column name="last_fire_date" type="date" remarks="Дата последнего запуска">
            </column>
        </createTable>
    </changeSet>

    <changeSet id="2.1-rnurgaleev-3" author="rnurgaleev">
        <createTable
                remarks="Параметры задач планировщика"
                tableName="configuration_scheduler_param">
            <column name="id" type="number(9)" remarks="Идентификатор параметра">
                <constraints nullable="false"/>
            </column>
            <column name="param_name" type="varchar2(200 char)">
                <constraints nullable="false"/>
            </column>
            <column name="task_id" type="number(9)" remarks="Ссылка на задачу планировщика">
                <constraints nullable="false"/>
            </column>
            <column name="ord" type="number(9)" remarks="Порядок следования">
                <constraints nullable="false"/>
            </column>
            <column name="type" type="number(1)"
                    remarks="Тип параметра(1 - Строка, 2 - Целое число, 3 - Число с плавающей запятой)">
                <constraints nullable="false"/>
            </column>
            <column name="value" type="varchar2(200 char)" remarks="Значение">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet id="2.1-rnurgaleev-4" author="rnurgaleev">
        <createTable
                remarks="Асинхронные задачи"
                tableName="async_task">
            <column name="id" type="number(18)" remarks="Идентификатор задачи">
                <constraints nullable="false"/>
            </column>
            <column name="type_id" type="number(18)" remarks="Ссылка на тип задачи">
                <constraints nullable="false"/>
            </column>
            <column name="create_date" type="timestamp" remarks="Дата создания задачи"
                    defaultValueComputed="CURRENT_TIMESTAMP">
            </column>
            <column name="start_process_date" type="timestamp" remarks="Дата начала выполнения задачи">
            </column>
            <column name="node" type="varchar2(500)" remarks="Название узла, на котором выполняется задача">
            </column>
            <column name="balancing_variant" type="number(1)"
                    remarks="Тип очереди, в которую помещена задача. 1 - короткие, 2 - длинные">
                <constraints nullable="false"/>
            </column>
            <column name="serialized_params" type="blob"
                    remarks="Сериализованные параметры, которые нужны для выполнения задачи">
            </column>
        </createTable>
    </changeSet>

    <changeSet id="2.1-rnurgaleev-5" author="rnurgaleev">
        <createTable
                tableName="decl_template_event_script">
            <column name="id" type="number(19)">
                <constraints nullable="false" primaryKey="true" primaryKeyName="pk_decl_template_event_script"/>
            </column>
            <column name="declaration_template_id" type="number(19)">
                <constraints nullable="false" foreignKeyName="fk_dec_temp_event_scr_dec_temp"
                             references="declaration_template(id)"/>
            </column>
            <column name="event_id" type="number(19)">
                <constraints nullable="false" foreignKeyName="fk_dec_temp_event_id" references="event(id)"/>
            </column>
            <column name="script" type="clob">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet id="2.1-rnurgaleev-6" author="rnurgaleev">
        <addUniqueConstraint tableName="decl_template_event_script"
                             columnNames="declaration_template_id, event_id"
                             constraintName="uc_dec_temp_even_dec_temp_even"/>
    </changeSet>

    <changeSet id="2.1-rnurgaleev-7" author="rnurgaleev">
        <addPrimaryKey
                columnNames="id"
                constraintName="CONF_SCHEDULER_PK"
                tableName="configuration_scheduler"/>
    </changeSet>

    <changeSet id="2.1-rnurgaleev-8" author="rnurgaleev">
        <addPrimaryKey
                columnNames="id"
                constraintName="CONF_SCHEDULER_PARAM_PK"
                tableName="configuration_scheduler_param"/>
    </changeSet>

    <changeSet id="2.1-rnurgaleev-9" author="rnurgaleev">
        <addPrimaryKey
                columnNames="id"
                constraintName="ASYNC_TASK_PK"
                tableName="async_task"/>
    </changeSet>

    <changeSet id="2.1-rnurgaleev-10" author="rnurgaleev">
        <addForeignKeyConstraint baseColumnNames="task_id"
                                 baseTableName="configuration_scheduler_param"
                                 constraintName="conf_scheduler_param_fk_conf"
                                 onDelete="CASCADE"
                                 referencedColumnNames="id"
                                 referencedTableName="configuration_scheduler"/>
    </changeSet>

    <changeSet id="2.1-rnurgaleev-11" author="rnurgaleev">
        <addForeignKeyConstraint baseColumnNames="type_id"
                                 baseTableName="async_task"
                                 constraintName="async_task_fk_type"
                                 referencedColumnNames="id"
                                 referencedTableName="async_task_type"/>
    </changeSet>

    <changeSet id="2.1-rnurgaleev-12" author="rnurgaleev">
        <sql>
            alter table configuration_scheduler add constraint conf_scheduler_chk_active check(active in (0, 1));
        </sql>
    </changeSet>

    <changeSet id="2.1-rnurgaleev-13" author="rnurgaleev">
        <sql>
            alter table configuration_scheduler_param add constraint conf_scheduler_param_chk_type check(type in (1, 2,
            3));
        </sql>
    </changeSet>

    <changeSet id="2.1-rnurgaleev-14" author="rnurgaleev">
        <dropColumn
                columnName="dev_mode"
                tableName="async_task_type"/>
    </changeSet>

    <changeSet id="2.1-rnurgaleev-15" author="rnurgaleev">
        <renameColumn
                newColumnName="handler_bean"
                oldColumnName="handler_jndi"
                remarks="Имя spring бина-обработчика задачи"
                tableName="async_task_type"/>
    </changeSet>

    <changeSet id="2.1-rnurgaleev-16" author="rnurgaleev">
        <addColumn
                tableName="configuration">
            <column name="value2" type="varchar2(2048 char)"/>
        </addColumn>
    </changeSet>

    <changeSet id="2.1-rnurgaleev-17" author="rnurgaleev">
        <sql>
            update configuration set value2=value;
        </sql>
    </changeSet>

    <changeSet id="2.1-rnurgaleev-18" author="rnurgaleev">
        <dropColumn
                columnName="value"
                tableName="configuration"/>
    </changeSet>

    <changeSet id="2.1-rnurgaleev-19" author="rnurgaleev">
        <renameColumn
                newColumnName="value"
                oldColumnName="value2"
                tableName="configuration"/>
    </changeSet>

    <changeSet id="2.1-rnurgaleev-20" author="rnurgaleev">
        <modifyDataType
                tableName="declaration_type"
                columnName="id"
                newDataType="number(18)"
        />
    </changeSet>

    <changeSet id="2.1-rnurgaleev-21" author="rnurgaleev">
        <modifyDataType
                tableName="department_declaration_type"
                columnName="DECLARATION_TYPE_ID"
                newDataType="number(18)"
        />
    </changeSet>

    <changeSet id="2.1-rnurgaleev-22" author="rnurgaleev">
        <modifyDataType
                tableName="declaration_template"
                columnName="DECLARATION_TYPE_ID"
                newDataType="number(18)"
        />
    </changeSet>

    <changeSet id="2.1-rnurgaleev-23" author="rnurgaleev">
        <modifyDataType
                tableName="ref_book_asnu"
                columnName="id"
                newDataType="number(18)"
        />
    </changeSet>

    <changeSet id="2.1-rnurgaleev-24" author="rnurgaleev">
        <sql splitStatements="false">
            begin
            for rec in (select table_name from user_tables where table_name like 'RASCHSV_%')
            loop
            for rec2 in (select constraint_name from user_constraints WHERE table_name=rec.table_name and
            constraint_type='R')
            loop
            execute immediate 'ALTER TABLE '||rec.table_name||' DROP CONSTRAINT '||rec2.constraint_name;
            end loop;
            end loop;

            for rec in (select table_name from user_tables where table_name like 'RASCHSV_%')
            loop
            execute immediate 'DROP TABLE '||rec.table_name;
            end loop;
            end;
        </sql>
    </changeSet>

    <changeSet id="2.1-rnurgaleev-25" author="rnurgaleev">
        <sql splitStatements="false">
            begin
            for rec in (select constraint_name from user_constraints where constraint_type='P' and table_name like
            'FORM_%')
            loop
            for rec2 in (select constraint_name, table_name from user_constraints WHERE
            r_constraint_name=rec.constraint_name and constraint_type='R')
            loop
            execute immediate 'ALTER TABLE '||rec2.table_name||' DROP CONSTRAINT '||rec2.constraint_name;
            end loop;
            end loop;

            for rec in (select table_name from user_tables where table_name like 'FORM_%')
            loop
            execute immediate 'DROP TABLE '||rec.table_name;
            end loop;
            end;
        </sql>
    </changeSet>

    <changeSet id="2.1-rnurgaleev-26" author="rnurgaleev">
        <dropTable cascadeConstraints="true"
                   tableName="IFRS_DATA"/>
    </changeSet>

    <changeSet id="2.1-rnurgaleev-27" author="rnurgaleev">
        <dropTable cascadeConstraints="true"
                   tableName="DEPARTMENT_CHANGE"/>
    </changeSet>

    <changeSet id="2.1-rnurgaleev-28" author="rnurgaleev">
        <createSequence
                incrementBy="100"
                sequenceName="seq_async_task"
                startValue="100000"/>
    </changeSet>

    <changeSet id="2.1-rnurgaleev-29" author="rnurgaleev">
        <createSequence
                incrementBy="1"
                sequenceName="seq_decl_template_event_script"
                startValue="1"/>
    </changeSet>

    <changeSet id="2.1-rnurgaleev-30" author="rnurgaleev">
        <sqlFile dbms="oracle"
                 encoding="utf8"
                 endDelimiter=""
                 path="/scripts/DEP_REP_PER_BEFORE_DELETE.sql"
                 relativeToChangelogFile="true"
                 splitStatements="false"/>
    </changeSet>

    <changeSet id="2.1-rnurgaleev-31" author="rnurgaleev">
        <sqlFile dbms="oracle"
                 encoding="utf8"
                 endDelimiter=""
                 path="/scripts/DEP_REP_PER_BEFORE_INS_UPD.sql"
                 relativeToChangelogFile="true"
                 splitStatements="false"/>
    </changeSet>

    <changeSet id="2.1-rnurgaleev-32" author="rnurgaleev">
        <sqlFile dbms="oracle"
                 encoding="utf8"
                 endDelimiter=""
                 path="/scripts/person_pkg.sql"
                 relativeToChangelogFile="true"
                 splitStatements="false"/>
    </changeSet>

    <changeSet id="2.1-rnurgaleev-33" author="rnurgaleev">
        <sqlFile dbms="oracle"
                 encoding="utf8"
                 endDelimiter=""
                 path="/scripts/person_pkg_body.sql"
                 relativeToChangelogFile="true"
                 splitStatements="false"/>
    </changeSet>

    <changeSet id="2.1-rnurgaleev-34" author="rnurgaleev">
        <delete
                tableName="ref_book_attribute">
            <where>ref_book_id in (select id from ref_book where table_name in
                ('REF_BOOK_FOND','REF_BOOK_FOND_DETAIL'))
            </where>
        </delete>
    </changeSet>

    <changeSet id="2.1-rnurgaleev-35" author="rnurgaleev">
        <delete
                tableName="ref_book">
            <where>table_name in ('REF_BOOK_FOND','REF_BOOK_FOND_DETAIL')</where>
        </delete>
    </changeSet>

    <changeSet id="2.1-rnurgaleev-36" author="rnurgaleev">
        <delete
                tableName="report_period">
            <where>tax_period_id in (select id from tax_period where tax_type='F')</where>
        </delete>
    </changeSet>

    <changeSet id="2.1-rnurgaleev-37" author="rnurgaleev">
        <delete
                tableName="tax_period">
            <where>tax_type='F'</where>
        </delete>
    </changeSet>

    <changeSet id="2.1-rnurgaleev-38" author="rnurgaleev">
        <delete
                tableName="tax_type">
            <where>id='F'</where>
        </delete>
    </changeSet>

    <changeSet id="2.1-rnurgaleev-39" author="rnurgaleev">
        <delete
                tableName="async_task_type">
            <where>id in (103, 104, 105, 106, 107, 110, 111, 112, 113, 114, 115, 123, 124, 125, 126, 127, 128, 129)
            </where>
        </delete>
    </changeSet>

    <changeSet id="2.1-rnurgaleev-40" author="rnurgaleev">
        <update
                tableName="async_task_type">
            <column name="handler_bean" value="XlsxGeneratorAsyncTask"/>
            <where>id = 5</where>
        </update>
    </changeSet>

    <changeSet id="2.1-rnurgaleev-41" author="rnurgaleev">
        <update
                tableName="async_task_type">
            <column name="handler_bean" value="XmlGeneratorAsyncTask"/>
            <where>id = 6</where>
        </update>
    </changeSet>

    <changeSet id="2.1-rnurgaleev-42" author="rnurgaleev">
        <update
                tableName="async_task_type">
            <column name="handler_bean" value="PdfGeneratorAsyncTask"/>
            <where>id = 7</where>
        </update>
    </changeSet>

    <changeSet id="2.1-rnurgaleev-43" author="rnurgaleev">
        <update
                tableName="async_task_type">
            <column name="handler_bean" value="CsvAuditArchiveGeneratorAsyncTask"/>
            <where>id = 10</where>
        </update>
    </changeSet>

    <changeSet id="2.1-rnurgaleev-44" author="rnurgaleev">
        <update
                tableName="async_task_type">
            <column name="handler_bean" value="CsvAuditGeneratorAsyncTask"/>
            <where>id = 11</where>
        </update>
    </changeSet>

    <changeSet id="2.1-rnurgaleev-45" author="rnurgaleev">
        <update
                tableName="async_task_type">
            <column name="handler_bean" value="LoadAllTransportDataAsyncTask"/>
            <where>id = 13</where>
        </update>
    </changeSet>

    <changeSet id="2.1-rnurgaleev-46" author="rnurgaleev">
        <update
                tableName="async_task_type">
            <column name="handler_bean" value="CheckDeclarationAsyncTask"/>
            <where>id = 14</where>
        </update>
    </changeSet>

    <changeSet id="2.1-rnurgaleev-47" author="rnurgaleev">
        <update
                tableName="async_task_type">
            <column name="handler_bean" value="AcceptDeclarationAsyncTask"/>
            <where>id = 15</where>
        </update>
    </changeSet>

    <changeSet id="2.1-rnurgaleev-48" author="rnurgaleev">
        <update
                tableName="async_task_type">
            <column name="handler_bean" value="ExcelReportRefBookAsyncTask"/>
            <where>id = 23</where>
        </update>
    </changeSet>

    <changeSet id="2.1-rnurgaleev-49" author="rnurgaleev">
        <update
                tableName="async_task_type">
            <column name="handler_bean" value="CsvReportRefBookAsyncTask"/>
            <where>id = 24</where>
        </update>
    </changeSet>

    <changeSet id="2.1-rnurgaleev-50" author="rnurgaleev">
        <update
                tableName="async_task_type">
            <column name="handler_bean" value="SpecificReportRefBookAsyncTask"/>
            <where>id = 25</where>
        </update>
    </changeSet>

    <changeSet id="2.1-rnurgaleev-51" author="rnurgaleev">
        <update
                tableName="async_task_type">
            <column name="handler_bean" value="SpecificReportDeclarationDataAsyncTask"/>
            <where>id = 26</where>
        </update>
    </changeSet>

    <changeSet id="2.1-rnurgaleev-52" author="rnurgaleev">
        <update
                tableName="async_task_type">
            <column name="handler_bean" value="UploadRefBookAsyncTask"/>
            <where>id = 27</where>
        </update>
    </changeSet>

    <changeSet id="2.1-rnurgaleev-53" author="rnurgaleev">
        <update
                tableName="async_task_type">
            <column name="handler_bean" value="CreateFormsAsyncTask"/>
            <where>id = 28</where>
        </update>
    </changeSet>

    <changeSet id="2.1-rnurgaleev-54" author="rnurgaleev">
        <update
                tableName="async_task_type">
            <column name="handler_bean" value="CreateReportsAsyncTask"/>
            <where>id = 29</where>
        </update>
    </changeSet>

    <changeSet id="2.1-rnurgaleev-55" author="rnurgaleev">
        <insert tableName="CONFIGURATION_SCHEDULER">
            <column name="id" value="1"/>
            <column name="task_name" value="Очистка файлового хранилища"/>
            <column name="schedule" value="0 15 22 * * ?"/>
            <column name="active" value="1"/>
            <column name="modification_date" valueDate="sysdate"/>
            <column name="last_fire_date" valueDate="sysdate"/>
        </insert>
    </changeSet>

    <changeSet id="2.1-rnurgaleev-56" author="rnurgaleev">
        <insert tableName="CONFIGURATION_SCHEDULER">
            <column name="id" value="2"/>
            <column name="task_name" value="Удаление истекших блокировок"/>
            <column name="schedule" value="0 10 22 * * ?"/>
            <column name="active" value="1"/>
            <column name="modification_date" valueDate="sysdate"/>
            <column name="last_fire_date" valueDate="sysdate"/>
        </insert>
    </changeSet>

    <changeSet id="2.1-rnurgaleev-57" author="rnurgaleev">
        <insert tableName="CONFIGURATION_SCHEDULER">
            <column name="id" value="3"/>
            <column name="task_name" value="Очистка хранилища временных файлов"/>
            <column name="schedule" value="0 5 22 * * ?"/>
            <column name="active" value="1"/>
            <column name="modification_date" valueDate="sysdate"/>
            <column name="last_fire_date" valueDate="sysdate"/>
        </insert>
    </changeSet>

    <changeSet id="2.1-rnurgaleev-58" author="rnurgaleev">
        <insert tableName="CONFIGURATION_SCHEDULER">
            <column name="id" value="4"/>
            <column name="task_name" value="Мониторинг асинхронных задач"/>
            <column name="schedule" value="0/5 * * * * ?"/>
            <column name="active" value="1"/>
            <column name="modification_date" valueDate="sysdate"/>
            <column name="last_fire_date" valueDate="sysdate"/>
        </insert>
    </changeSet>

    <changeSet id="2.1-rnurgaleev-59" author="rnurgaleev">
        <insert tableName="configuration_scheduler_param">
            <column name="id" value="20"/>
            <column name="param_name" value="Время жизни блокировки (секунд)"/>
            <column name="task_id" value="2"/>
            <column name="ord" value="1"/>
            <column name="type" value="2"/>
            <column name="value" value="172800"/>
        </insert>
    </changeSet>

    <changeSet id="2.1-rnurgaleev-60" author="rnurgaleev">
        <update tableName="DECLARATION_TEMPLATE">
            <column name="create_script" valueClobFile="templates/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl.groovy"/>
            <where>id=100</where>
        </update>
    </changeSet>

    <changeSet id="2.1-rnurgaleev-61" author="rnurgaleev">
        <update tableName="DECLARATION_TEMPLATE">
            <column name="create_script"
                    valueClobFile="templates/ndfl/consolidated_rnu_ndfl/v2016/consolidated_rnu_ndfl.groovy"/>
            <where>id=101</where>
        </update>
    </changeSet>

    <changeSet id="2.1-rnurgaleev-62" author="rnurgaleev">
        <update tableName="DECLARATION_TEMPLATE">
            <column name="create_script" valueClobFile="templates/ndfl/report_2ndfl_1/v2016/report_2ndfl.groovy"/>
            <where>id=102</where>
        </update>
    </changeSet>

    <changeSet id="2.1-rnurgaleev-63" author="rnurgaleev">
        <update tableName="DECLARATION_TEMPLATE">
            <column name="create_script" valueClobFile="templates/ndfl/report_6ndfl/v2016/report_6ndfl.groovy"/>
            <where>id=103</where>
        </update>
    </changeSet>

    <changeSet id="2.1-rnurgaleev-64" author="rnurgaleev">
        <update tableName="DECLARATION_TEMPLATE">
            <column name="create_script" valueClobFile="templates/ndfl/report_2ndfl_1/v2016/report_2ndfl.groovy"/>
            <where>id=104</where>
        </update>
    </changeSet>

    <changeSet id="2.1-rnurgaleev-65" author="rnurgaleev">
        <insert tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="id" value="1"/>
            <column name="declaration_template_id" value="100"/>
            <column name="event_id" value="3"/>
            <column name="script"
                    valueClobFile="templates/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl_calculate.groovy"/>
        </insert>
    </changeSet>

    <changeSet id="2.1-rnurgaleev-66" author="rnurgaleev">
        <insert tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="id" value="2"/>
            <column name="declaration_template_id" value="100"/>
            <column name="event_id" value="5"/>
            <column name="script" valueClobFile="templates/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl_check.groovy"/>
        </insert>
    </changeSet>

    <changeSet id="2.1-rnurgaleev-67" author="rnurgaleev">
        <insert tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="id" value="3"/>
            <column name="declaration_template_id" value="100"/>
            <column name="event_id" value="106"/>
            <column name="script"
                    valueClobFile="templates/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl_move_accepted_to_created.groovy"/>
        </insert>
    </changeSet>

    <changeSet id="2.1-rnurgaleev-68" author="rnurgaleev">
        <insert tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="id" value="4"/>
            <column name="declaration_template_id" value="100"/>
            <column name="event_id" value="105"/>
            <column name="script"
                    valueClobFile="templates/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl_move_created_to_accepted.groovy"/>
        </insert>
    </changeSet>

    <changeSet id="2.1-rnurgaleev-69" author="rnurgaleev">
        <insert tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="id" value="5"/>
            <column name="declaration_template_id" value="101"/>
            <column name="event_id" value="3"/>
            <column name="script"
                    valueClobFile="templates/ndfl/consolidated_rnu_ndfl/v2016/consolidated_rnu_ndfl_calculate.groovy"/>
        </insert>
    </changeSet>

    <changeSet id="2.1-rnurgaleev-70" author="rnurgaleev">
        <insert tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="id" value="6"/>
            <column name="declaration_template_id" value="101"/>
            <column name="event_id" value="5"/>
            <column name="script"
                    valueClobFile="templates/ndfl/consolidated_rnu_ndfl/v2016/consolidated_rnu_ndfl_check.groovy"/>
        </insert>
    </changeSet>

    <changeSet id="2.1-rnurgaleev-71" author="rnurgaleev">
        <insert tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="id" value="7"/>
            <column name="declaration_template_id" value="101"/>
            <column name="event_id" value="105"/>
            <column name="script"
                    valueClobFile="templates/ndfl/consolidated_rnu_ndfl/v2016/consolidated_rnu_ndfl_move_created_to_accepted.groovy"/>
        </insert>
    </changeSet>

    <changeSet id="2.1-rnurgaleev-72" author="rnurgaleev">
        <insert tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="id" value="8"/>
            <column name="declaration_template_id" value="102"/>
            <column name="event_id" value="5"/>
            <column name="script" valueClobFile="templates/ndfl/report_2ndfl_1/v2016/report_2ndfll_check.groovy"/>
        </insert>
    </changeSet>

    <changeSet id="2.1-rnurgaleev-73" author="rnurgaleev">
        <insert tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="id" value="9"/>
            <column name="declaration_template_id" value="102"/>
            <column name="event_id" value="105"/>
            <column name="script"
                    valueClobFile="templates/ndfl/report_2ndfl_1/v2016/report_2ndfl_move_created_to_accepted.groovy"/>
        </insert>
    </changeSet>

    <changeSet id="2.1-rnurgaleev-74" author="rnurgaleev">
        <insert tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="id" value="10"/>
            <column name="declaration_template_id" value="103"/>
            <column name="event_id" value="5"/>
            <column name="script" valueClobFile="templates/ndfl/report_6ndfl/v2016/report_6ndfl_check.groovy"/>
        </insert>
    </changeSet>

    <changeSet id="2.1-rnurgaleev-75" author="rnurgaleev">
        <insert tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="id" value="11"/>
            <column name="declaration_template_id" value="103"/>
            <column name="event_id" value="105"/>
            <column name="script"
                    valueClobFile="templates/ndfl/report_6ndfl/v2016/report_6ndfl_move_created_to_accepted.groovy"/>
        </insert>
    </changeSet>

    <changeSet id="2.1-rnurgaleev-76" author="rnurgaleev">
        <insert tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="id" value="12"/>
            <column name="declaration_template_id" value="104"/>
            <column name="event_id" value="5"/>
            <column name="script" valueClobFile="templates/ndfl/report_2ndfl_1/v2016/report_2ndfll_check.groovy"/>
        </insert>
    </changeSet>

    <changeSet id="2.1-rnurgaleev-77" author="rnurgaleev">
        <insert tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="id" value="13"/>
            <column name="declaration_template_id" value="104"/>
            <column name="event_id" value="105"/>
            <column name="script"
                    valueClobFile="templates/ndfl/report_2ndfl_1/v2016/report_2ndfl_move_created_to_accepted.groovy"/>
        </insert>
    </changeSet>

    <changeSet id="2.1-rnurgaleev-78" author="rnurgaleev">
        <update tableName="BLOB_DATA">
            <column name="data" valueBlobFile="templates/refbook/classificator_country.groovy"/>
            <where>id='ce397da5-cf59-457f-9e91-2a31a478b510'</where>
        </update>
    </changeSet>

    <changeSet id="2.1-rnurgaleev-79" author="rnurgaleev">
        <update tableName="BLOB_DATA">
            <column name="data" valueBlobFile="templates/refbook/classificator_oktmo.groovy"/>
            <where>id='3ec53b66-624d-45cd-aa17-f046e3a1f1fc'</where>
        </update>
    </changeSet>

    <changeSet id="2.1-rnurgaleev-80" author="rnurgaleev">
        <update tableName="BLOB_DATA">
            <column name="data" valueBlobFile="templates/refbook/classificator_okved.groovy"/>
            <where>id='99034f20-18c3-11e5-b60b-1697f925ec7b'</where>
        </update>
    </changeSet>

    <changeSet id="2.1-rnurgaleev-81" author="rnurgaleev">
        <update tableName="BLOB_DATA">
            <column name="data" valueBlobFile="templates/refbook/declaration_type.groovy"/>
            <where>id='352adf59-372b-4020-98fe-8960dd5bc972'</where>
        </update>
    </changeSet>

    <changeSet id="2.1-rnurgaleev-82" author="rnurgaleev">
        <update tableName="BLOB_DATA">
            <column name="data" valueBlobFile="templates/refbook/department.groovy"/>
            <where>id='4e387483-0330-4e05-ad46-e9b03a3b025d'</where>
        </update>
    </changeSet>

    <changeSet id="2.1-rnurgaleev-83" author="rnurgaleev">
        <update tableName="BLOB_DATA">
            <column name="data" valueBlobFile="templates/refbook/fias.groovy"/>
            <where>id='39327388-9684-4fd5-a522-c40a21680156'</where>
        </update>
    </changeSet>

    <changeSet id="2.1-rnurgaleev-84" author="rnurgaleev">
        <update tableName="BLOB_DATA">
            <column name="data" valueBlobFile="templates/refbook/id_doc.groovy"/>
            <where>id='375ba56a-2509-11e7-93ae-92361f002671'</where>
        </update>
    </changeSet>

    <changeSet id="2.1-rnurgaleev-85" author="rnurgaleev">
        <update tableName="BLOB_DATA">
            <column name="data" valueBlobFile="templates/refbook/person.groovy"/>
            <where>id='884b9f2e-1678-4d69-9652-b036bba2f728'</where>
        </update>
    </changeSet>

    <!--SBRFNDFL-2142-->
    <changeSet id="2.1-rnurgaleev-86" author="rnurgaleev">
        <update
                tableName="ref_book">
            <column name="is_versioned" value="0"/>
            <where>table_name='REPORT_PERIOD_TYPE'</where>
        </update>
    </changeSet>

    <!--SBRFNDFL-2059-->
    <changeSet id="2.1-rnurgaleev-87" author="rnurgaleev">
        <delete
                tableName="role_event">
            <where>event_id in (4, 10, 11, 101, 102, 103, 104, 110, 111, 112, 203, 204, 205, 206, 207, 208, 209, 210,
                303, 302, 601)
            </where>
        </delete>
    </changeSet>

    <changeSet id="2.1-rnurgaleev-88" author="rnurgaleev">
        <delete
                tableName="event">
            <where>id in (4, 10, 11, 101, 102, 103, 104, 110, 111, 112, 203, 204, 205, 206, 207, 208, 209, 210, 303,
                302, 601)
            </where>
        </delete>
    </changeSet>

    <changeSet id="2.1-rnurgaleev-89" author="rnurgaleev">
        <createView
                replaceIfExists="true"
                viewName="DEPARTMENT_CHILD_VIEW">select cast(connect_by_root id as number(9,0)) id, parent_id,
            (connect_by_root id)||'|'||parent_id view_rowid from department connect by prior parent_id = id
            order by parent_id, id
        </createView>
    </changeSet>

    <!--SBRFNDFL-2077-->
    <changeSet id="2.1-rnurgaleev-90" author="rnurgaleev">
        <dropColumn columnName="is_balance_period"
                    tableName="department_report_period"/>
    </changeSet>

    <!--SBRFNDFL-2316-->
    <changeSet id="2.1-rnurgaleev-91" author="rnurgaleev">
        <createView
                replaceIfExists="true"
                viewName="DEPARTMENT_FULLPATH">WITH dep_with (id, parent_id, shortname) AS
            (
            SELECT
            dp.id,
            dp.parent_id,
            dp.shortname
            FROM department dp
            WHERE dp.parent_id IS NULL
            UNION ALL
            SELECT
            dp.id,
            dp.parent_id,
            dep_with.shortname ||'/'|| + nvl(dp.shortname,dp.name)
            FROM dep_with dep_with
            INNER JOIN department dp ON dp.parent_id = dep_with.id
            )
            select id, shortname from dep_with
            order by id
        </createView>
    </changeSet>

    <!--SBRFNDFL-2314-->
    <changeSet id="2.1-rnurgaleev-92" author="rnurgaleev">
        <delete
                tableName="async_task">
        </delete>
    </changeSet>

    <changeSet id="2.1-rnurgaleev-93" author="rnurgaleev">
        <renameColumn
                newColumnName="queue"
                oldColumnName="balancing_variant"
                tableName="async_task"/>
    </changeSet>

    <changeSet id="2.1-rnurgaleev-94" author="rnurgaleev">
        <addColumn tableName="async_task">
            <column name="user_id" type="number(9)" remarks="Идентификатор пользователя, запустившего задачу">
                <constraints nullable="false"/>
            </column>
        </addColumn>
    </changeSet>

    <changeSet id="2.1-rnurgaleev-95" author="rnurgaleev">
        <addColumn tableName="async_task">
            <column name="state" type="number(6)" remarks="Статус выполнения задачи" defaultValue="1">
                <constraints nullable="false"/>
            </column>
        </addColumn>
    </changeSet>

    <changeSet id="2.1-rnurgaleev-96" author="rnurgaleev">
        <addColumn tableName="async_task">
            <column name="state_date" type="timestamp" remarks="Дата последнего изменения статуса"
                    defaultValueComputed="CURRENT_TIMESTAMP"/>
        </addColumn>
    </changeSet>

    <changeSet id="2.1-rnurgaleev-97" author="rnurgaleev">
        <addColumn tableName="async_task">
            <column name="priority_node" type="varchar2(500)"
                    remarks="Узел, которому принудительно будет назначена задача"/>
        </addColumn>
    </changeSet>

    <changeSet id="2.1-rnurgaleev-98" author="rnurgaleev">
        <addColumn tableName="async_task">
            <column name="description" type="varchar2(400)" remarks="Описание задачи"/>
        </addColumn>
    </changeSet>

    <changeSet id="2.1-rnurgaleev-99" author="rnurgaleev">
        <delete
                tableName="lock_data_subscribers">
        </delete>
    </changeSet>

    <changeSet id="2.1-rnurgaleev-100" author="rnurgaleev">
        <dropForeignKeyConstraint baseTableName="lock_data_subscribers" constraintName="lock_data_subscr_fk_lock_data"/>
    </changeSet>

    <changeSet id="2.1-rnurgaleev-101" author="rnurgaleev">
        <dropPrimaryKey
                constraintName="lock_data_subscribers_pk"
                tableName="lock_data_subscribers"/>
    </changeSet>

    <changeSet id="2.1-rnurgaleev-102" author="rnurgaleev">
        <renameTable
                newTableName="async_task_subscribers"
                oldTableName="lock_data_subscribers"/>
    </changeSet>

    <changeSet id="2.1-rnurgaleev-103" author="rnurgaleev">
        <dropColumn
                columnName="lock_key"
                tableName="async_task_subscribers"/>
    </changeSet>

    <changeSet id="2.1-rnurgaleev-104" author="rnurgaleev">
        <addColumn tableName="async_task_subscribers">
            <column name="async_task_id" type="number(18)"
                    remarks="Идентификатор задачи, после завершения которой, будет выполнено оповещение">
                <constraints nullable="false"/>
            </column>
        </addColumn>
    </changeSet>

    <changeSet id="2.1-rnurgaleev-105" author="rnurgaleev">
        <createIndex
                indexName="idx_async_t_subscr"
                tableName="async_task_subscribers">
            <column name="async_task_id"/>
        </createIndex>
    </changeSet>

    <changeSet id="2.1-rnurgaleev-106" author="rnurgaleev">
        <addPrimaryKey
                columnNames="async_task_id, user_id"
                constraintName="async_task_subscribers_pk"
                tableName="async_task_subscribers"/>
    </changeSet>

    <changeSet id="2.1-rnurgaleev-107" author="rnurgaleev">
        <addForeignKeyConstraint baseColumnNames="async_task_id"
                                 baseTableName="async_task_subscribers"
                                 constraintName="async_t_subscr_fk_async_task"
                                 onDelete="CASCADE"
                                 referencedColumnNames="id"
                                 referencedTableName="async_task"/>
    </changeSet>

    <changeSet id="2.1-rnurgaleev-108" author="rnurgaleev">
        <dropIndex indexName="lock_data_subscr_fk_sec_user"
                   tableName="async_task_subscribers"/>
    </changeSet>

    <changeSet id="2.1-rnurgaleev-109" author="rnurgaleev">
        <dropForeignKeyConstraint baseTableName="async_task_subscribers" constraintName="lock_data_subscr_fk_sec_user"/>
    </changeSet>

    <changeSet id="2.1-rnurgaleev-110" author="rnurgaleev">
        <addForeignKeyConstraint baseColumnNames="user_id"
                                 baseTableName="async_task_subscribers"
                                 constraintName="async_t_subscr_fk_sec_user"
                                 onDelete="CASCADE"
                                 referencedColumnNames="id"
                                 referencedTableName="sec_user"/>
    </changeSet>

    <changeSet id="2.1-rnurgaleev-111" author="rnurgaleev">
        <delete
                tableName="lock_data">
        </delete>
    </changeSet>

    <changeSet id="2.1-rnurgaleev-112" author="rnurgaleev">
        <dropColumn
                columnName="state"
                tableName="lock_data"/>
    </changeSet>

    <changeSet id="2.1-rnurgaleev-113" author="rnurgaleev">
        <dropColumn
                columnName="state_date"
                tableName="lock_data"/>
    </changeSet>

    <changeSet id="2.1-rnurgaleev-114" author="rnurgaleev">
        <dropColumn
                columnName="queue"
                tableName="lock_data"/>
    </changeSet>

    <changeSet id="2.1-rnurgaleev-115" author="rnurgaleev">
        <dropColumn
                columnName="server_node"
                tableName="lock_data"/>
    </changeSet>

    <changeSet id="2.1-rnurgaleev-116" author="rnurgaleev">
        <dropPrimaryKey
                constraintName="lock_data_pk"
                tableName="lock_data"/>
    </changeSet>

    <changeSet id="2.1-rnurgaleev-117" author="rnurgaleev">
        <addColumn tableName="lock_data">
            <column name="task_id" type="number(18)" remarks="Ссылка на асинхронную задачу, связанную с блокировкой"/>
        </addColumn>
    </changeSet>

    <changeSet id="2.1-rnurgaleev-118" author="rnurgaleev">
        <addColumn tableName="lock_data">
            <column name="id" type="number(18)" remarks="Идентификатор блокировки">
                <constraints nullable="false" primaryKey="true" primaryKeyName="lock_data_pk"/>
            </column>
        </addColumn>
    </changeSet>

    <changeSet id="2.1-rnurgaleev-119" author="rnurgaleev">
        <createSequence
                incrementBy="1"
                sequenceName=" seq_lock_data"
                startValue="1"/>
    </changeSet>

    <changeSet id="2.1-rnurgaleev-120" author="rnurgaleev">
        <addUniqueConstraint tableName="lock_data"
                             columnNames="key"
                             constraintName="lock_data_uniq_key"/>
    </changeSet>

    <changeSet id="2.1-ytrofimov-1" author="ytrofimov">
        <update tableName="BLOB_DATA">
            <column name="data" valueBlobFile="templates/refbook/fias.groovy"/>
            <where>id='39327388-9684-4fd5-a522-c40a21680156'</where>
        </update>
    </changeSet>

    <changeSet id="2.1-rnurgaleev-121" author="rnurgaleev">
        <sqlFile dbms="oracle"
                 encoding="utf8"
                 endDelimiter=""
                 path="/scripts/fias_pkg_body.sql"
                 relativeToChangelogFile="true"
                 splitStatements="false"/>
    </changeSet>

    <changeSet id="2.1-rnurgaleev-122" author="rnurgaleev">
        <sqlFile dbms="oracle"
                 encoding="utf8"
                 endDelimiter=""
                 path="/scripts/fias_pkg_body2.sql"
                 relativeToChangelogFile="true"
                 splitStatements="false"/>
    </changeSet>

    <changeSet id="2.1-rnurgaleev-123" author="rnurgaleev">
        <update tableName="DECLARATION_TEMPLATE">
            <column name="create_script" valueClobFile="templates/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl.groovy"/>
            <where>id=100</where>
        </update>
    </changeSet>

    <changeSet id="2.1-rnurgaleev-124" author="rnurgaleev">
        <update tableName="DECLARATION_TEMPLATE">
            <column name="create_script"
                    valueClobFile="templates/ndfl/consolidated_rnu_ndfl/v2016/consolidated_rnu_ndfl.groovy"/>
            <where>id=101</where>
        </update>
    </changeSet>

    <changeSet id="2.1-dloshkarev-1" author="dloshkarev">
        <update tableName="DECLARATION_TEMPLATE">
            <column name="CREATE_SCRIPT" valueClobFile="templates/ndfl/report_2ndfl_1/v2016/report_2ndfl.groovy"/>
            <where>id=102</where>
        </update>
    </changeSet>

    <changeSet id="2.1-dloshkarev-2" author="dloshkarev">
        <update tableName="DECLARATION_TEMPLATE">
            <column name="CREATE_SCRIPT" valueClobFile="templates/ndfl/report_6ndfl/v2016/report_6ndfl.groovy"/>
            <where>id=103</where>
        </update>
    </changeSet>

    <changeSet id="2.1-dloshkarev-3" author="dloshkarev">
        <update tableName="DECLARATION_TEMPLATE">
            <column name="CREATE_SCRIPT" valueClobFile="templates/ndfl/report_2ndfl_2/v2016/report_2ndfl_2.groovy"/>
            <where>id=104</where>
        </update>
    </changeSet>

    <!-- SBRFNDFL-2364 Локальный запуск скриптов справочников -->
    <changeSet id="2.1-ytrofimov-2" author="ytrofimov">
        <update tableName="BLOB_DATA">
            <column name="data" valueBlobFile="templates/refbook/classificator_country.groovy"/>
            <where>id='ce397da5-cf59-457f-9e91-2a31a478b510'</where>
        </update>
    </changeSet>

    <changeSet id="2.1-ytrofimov-3" author="ytrofimov">
        <update tableName="BLOB_DATA">
            <column name="data" valueBlobFile="templates/refbook/classificator_oktmo.groovy"/>
            <where>id='3ec53b66-624d-45cd-aa17-f046e3a1f1fc'</where>
        </update>
    </changeSet>

    <changeSet id="2.1-ytrofimov-4" author="ytrofimov">
        <update tableName="BLOB_DATA">
            <column name="data" valueBlobFile="templates/refbook/classificator_okved.groovy"/>
            <where>id='99034f20-18c3-11e5-b60b-1697f925ec7b'</where>
        </update>
    </changeSet>

    <changeSet id="2.1-ytrofimov-5" author="ytrofimov">
        <update tableName="BLOB_DATA">
            <column name="data" valueBlobFile="templates/refbook/declaration_type.groovy"/>
            <where>id='352adf59-372b-4020-98fe-8960dd5bc972'</where>
        </update>
    </changeSet>

    <changeSet id="2.1-ytrofimov-6" author="ytrofimov">
        <update tableName="BLOB_DATA">
            <column name="data" valueBlobFile="templates/refbook/department.groovy"/>
            <where>id='4e387483-0330-4e05-ad46-e9b03a3b025d'</where>
        </update>
    </changeSet>

    <changeSet id="2.1-ytrofimov-7" author="ytrofimov">
        <update tableName="BLOB_DATA">
            <column name="data" valueBlobFile="templates/refbook/fias.groovy"/>
            <where>id='39327388-9684-4fd5-a522-c40a21680156'</where>
        </update>
    </changeSet>

    <changeSet id="2.1-ytrofimov-8" author="ytrofimov">
        <update tableName="BLOB_DATA">
            <column name="data" valueBlobFile="templates/refbook/id_doc.groovy"/>
            <where>id='375ba56a-2509-11e7-93ae-92361f002671'</where>
        </update>
    </changeSet>

    <changeSet id="2.1-ytrofimov-9" author="ytrofimov">
        <update tableName="BLOB_DATA">
            <column name="data" valueBlobFile="templates/refbook/person.groovy"/>
            <where>id='884b9f2e-1678-4d69-9652-b036bba2f728'</where>
        </update>
    </changeSet>

    <!-- SBRFNDFL-2080 НДФЛ. Реализовать выгрузку отчетных форм, выбранных пользователем, в состоянии "Принята"  -->
    <changeSet id="2.1-ytrofimov-10" author="ytrofimov">
        <update tableName="DECLARATION_TEMPLATE">
            <column name="CREATE_SCRIPT" valueClobFile="templates/ndfl/report_2ndfl_1/v2016/report_2ndfl.groovy"/>
            <where>id=102</where>
        </update>
    </changeSet>

    <changeSet id="2.1-ytrofimov-11" author="ytrofimov">
        <update tableName="DECLARATION_TEMPLATE">
            <column name="CREATE_SCRIPT" valueClobFile="templates/ndfl/report_6ndfl/v2016/report_6ndfl.groovy"/>
            <where>id=103</where>
        </update>
    </changeSet>

    <changeSet id="2.1-ytrofimov-12" author="ytrofimov">
        <update tableName="DECLARATION_TEMPLATE">
            <column name="CREATE_SCRIPT" valueClobFile="templates/ndfl/report_2ndfl_1/v2016/report_2ndfl.groovy"/>
            <where>id=104</where>
        </update>
    </changeSet>

    <changeSet id="2.1-aokunev-1" author="aokunev">
        <update tableName="DECLARATION_TEMPLATE">
            <column name="CREATE_SCRIPT" valueClobFile="templates/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl.groovy"/>
            <where>id=100</where>
        </update>
    </changeSet>

	<!--SBRFNDFL-2371-->
	<changeSet id="2.1-rnurgaleev-125" author="rnurgaleev">
        <dropTable cascadeConstraints="true"
                   tableName="COLOR"/>
    </changeSet>

	<changeSet id="2.1-rnurgaleev-126" author="rnurgaleev">
        <dropTable cascadeConstraints="true"
                   tableName="DEPARTMENT_FORM_TYPE_PERFORMER"/>
    </changeSet>

	<changeSet id="2.1-rnurgaleev-127" author="rnurgaleev">
        <dropForeignKeyConstraint baseTableName="declaration_source" constraintName="DECL_SOURCE_FK_DEPT_FORMTYPE"/>
    </changeSet>

	<changeSet id="2.1-rnurgaleev-128" author="rnurgaleev">
        <dropTable cascadeConstraints="true"
                   tableName="DEPARTMENT_FORM_TYPE"/>
    </changeSet>

	<changeSet id="2.1-rnurgaleev-129" author="rnurgaleev">
        <dropTable cascadeConstraints="true"
                   tableName="LOG_CLOB_QUERY"/>
    </changeSet>

	<changeSet id="2.1-rnurgaleev-130" author="rnurgaleev">
        <dropTable cascadeConstraints="true"
                   tableName="ROLE_EVENT"/>
    </changeSet>

	<changeSet id="2.1-rnurgaleev-131" author="rnurgaleev">
        <dropTable cascadeConstraints="true"
                   tableName="STATE_CHANGE"/>
    </changeSet>

	<changeSet id="2.1-rnurgaleev-132" author="rnurgaleev">
        <dropTable cascadeConstraints="true"
                   tableName="TASK_CONTEXT"/>
    </changeSet>

    <!-- SBRFNDFL-1205 НДФЛ. Формирование отчета "РНУ НДФЛ по всем ФЛ". Ошибка при открытии xls, если в отчете нет ФЛ  -->
    <changeSet id="2.1-ytrofimov-13" author="ytrofimov">
        <update tableName="DECLARATION_TEMPLATE">
            <column name="CREATE_SCRIPT" valueClobFile="templates/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl.groovy"/>
            <where>id=100</where>
        </update>
    </changeSet>

    <changeSet id="2.1-ytrofimov-14" author="ytrofimov">
        <update tableName="DECLARATION_TEMPLATE">
            <column name="CREATE_SCRIPT" valueClobFile="templates/ndfl/consolidated_rnu_ndfl/v2016/consolidated_rnu_ndfl.groovy"/>
            <where>id=101</where>
        </update>
    </changeSet>

    <changeSet id="2.1-ytrofimov-15" author="ytrofimov">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script" valueClobFile="templates/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl_check.groovy"/>
            <where>id=2</where>
        </update>
    </changeSet>

    <changeSet id="2.1-ytrofimov-16" author="ytrofimov">
        <update tableName="BLOB_DATA">
            <column name="data" valueBlobFile="templates/refbook/fias.groovy"/>
            <where>id='39327388-9684-4fd5-a522-c40a21680156'</where>
        </update>
    </changeSet>

    <changeSet id="2.1-ytrofimov-17" author="ytrofimov">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script"
                    valueClobFile="templates/ndfl/consolidated_rnu_ndfl/v2016/consolidated_rnu_ndfl_check.groovy"/>
            <where>id=6</where>
        </update>
    </changeSet>

    <changeSet id="2.1-dloshkarev-4" author="dloshkarev">
        <update tableName="DECLARATION_TEMPLATE">
            <column name="create_script" valueClobFile="templates/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl.groovy"/>
            <where>id=100</where>
        </update>
    </changeSet>

    <!-- https://jira.aplana.com/browse/SBRFNDFL-2404 -->
    <changeSet id="2.1-ytrofimov-18" author="ytrofimov">
        <update tableName="DECLARATION_TEMPLATE">
            <column name="create_script" valueClobFile="templates/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl.groovy"/>
            <where>id=100</where>
        </update>
    </changeSet>

    <changeSet id="2.1-ytrofimov-19" author="ytrofimov">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script"
                    valueClobFile="templates/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl_calculate.groovy"/>
            <where>id=1</where>
        </update>
    </changeSet>

    <changeSet id="2.1-ytrofimov-20" author="ytrofimov">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script" valueClobFile="templates/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl_check.groovy"/>
            <where>id=2</where>
        </update>
    </changeSet>

    <changeSet id="2.1-ytrofimov-21" author="ytrofimov">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script"
                    valueClobFile="templates/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl_move_accepted_to_created.groovy"/>
            <where>id=3</where>
        </update>
    </changeSet>

    <changeSet id="2.1-ytrofimov-22" author="ytrofimov">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script"
                    valueClobFile="templates/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl_move_created_to_accepted.groovy"/>
            <where>id=4</where>
        </update>
    </changeSet>

    <changeSet id="2.1-ytrofimov-23" author="ytrofimov">
        <update tableName="DECLARATION_TEMPLATE">
            <column name="create_script"
                    valueClobFile="templates/ndfl/consolidated_rnu_ndfl/v2016/consolidated_rnu_ndfl.groovy"/>
            <where>id=101</where>
        </update>
    </changeSet>

    <changeSet id="2.1-ytrofimov-24" author="ytrofimov">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script"
                    valueClobFile="templates/ndfl/consolidated_rnu_ndfl/v2016/consolidated_rnu_ndfl_calculate.groovy"/>
            <where>id=5</where>
        </update>
    </changeSet>

    <changeSet id="2.1-ytrofimov-25" author="ytrofimov">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script"
                    valueClobFile="templates/ndfl/consolidated_rnu_ndfl/v2016/consolidated_rnu_ndfl_check.groovy"/>
            <where>id=6</where>
        </update>
    </changeSet>

    <changeSet id="2.1-ytrofimov-26" author="ytrofimov">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script"
                    valueClobFile="templates/ndfl/consolidated_rnu_ndfl/v2016/consolidated_rnu_ndfl_move_created_to_accepted.groovy"/>
            <where>id=7</where>
        </update>
    </changeSet>

    <changeSet id="2.1-ytrofimov-27" author="ytrofimov">
        <update tableName="DECLARATION_TEMPLATE">
            <column name="create_script" valueClobFile="templates/ndfl/report_2ndfl_1/v2016/report_2ndfl.groovy"/>
            <where>id=102</where>
        </update>
    </changeSet>

    <changeSet id="2.1-ytrofimov-28" author="ytrofimov">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script"
                    valueClobFile="templates/ndfl/report_2ndfl_1/v2016/report_2ndfl_move_created_to_accepted.groovy"/>
            <where>id=9</where>
        </update>
    </changeSet>

    <changeSet id="2.1-ytrofimov-29" author="ytrofimov">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script" valueClobFile="templates/ndfl/report_6ndfl/v2016/report_6ndfl_check.groovy"/>
            <where>id=10</where>
        </update>
    </changeSet>

    <changeSet id="2.1-ytrofimov-30" author="ytrofimov">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script"
                    valueClobFile="templates/ndfl/report_6ndfl/v2016/report_6ndfl_move_created_to_accepted.groovy"/>
            <where>id=11</where>
        </update>
    </changeSet>
    <!-- https://jira.aplana.com/browse/SBRFNDFL-2405 -->
    <changeSet id="2.1-vlednev-1" author="vlednev">
        <update tableName="BLOB_DATA">
            <column name="data" valueBlobFile="templates/refbook/declaration_type.groovy"/>
            <where>id='352adf59-372b-4020-98fe-8960dd5bc972'</where>
        </update>
    </changeSet>

    <!-- https://jira.aplana.com/browse/SBRFNDFL-2189 (удаление модуля script-support) -->
    <changeSet id="2.1-ytrofimov-31" author="ytrofimov">
        <update tableName="DECLARATION_TEMPLATE">
            <column name="create_script" valueClobFile="templates/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl.groovy"/>
            <where>id=100</where>
        </update>
    </changeSet>

    <changeSet id="2.1-ytrofimov-32" author="ytrofimov">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script"
                    valueClobFile="templates/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl_calculate.groovy"/>
            <where>id=1</where>
        </update>
    </changeSet>

    <changeSet id="2.1-ytrofimov-33" author="ytrofimov">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script" valueClobFile="templates/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl_check.groovy"/>
            <where>id=2</where>
        </update>
    </changeSet>

    <changeSet id="2.1-ytrofimov-34" author="ytrofimov">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script"
                    valueClobFile="templates/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl_move_accepted_to_created.groovy"/>
            <where>id=3</where>
        </update>
    </changeSet>

    <changeSet id="2.1-ytrofimov-35" author="ytrofimov">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script"
                    valueClobFile="templates/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl_move_created_to_accepted.groovy"/>
            <where>id=4</where>
        </update>
    </changeSet>

    <changeSet id="2.1-ytrofimov-36" author="ytrofimov">
        <update tableName="DECLARATION_TEMPLATE">
            <column name="create_script"
                    valueClobFile="templates/ndfl/consolidated_rnu_ndfl/v2016/consolidated_rnu_ndfl.groovy"/>
            <where>id=101</where>
        </update>
    </changeSet>

    <changeSet id="2.1-ytrofimov-37" author="ytrofimov">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script"
                    valueClobFile="templates/ndfl/consolidated_rnu_ndfl/v2016/consolidated_rnu_ndfl_calculate.groovy"/>
            <where>id=5</where>
        </update>
    </changeSet>

    <changeSet id="2.1-ytrofimov-38" author="ytrofimov">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script"
                    valueClobFile="templates/ndfl/consolidated_rnu_ndfl/v2016/consolidated_rnu_ndfl_check.groovy"/>
            <where>id=6</where>
        </update>
    </changeSet>

    <changeSet id="2.1-ytrofimov-39" author="ytrofimov">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script"
                    valueClobFile="templates/ndfl/consolidated_rnu_ndfl/v2016/consolidated_rnu_ndfl_move_created_to_accepted.groovy"/>
            <where>id=7</where>
        </update>
    </changeSet>

    <changeSet id="2.1-ytrofimov-40" author="ytrofimov">
        <update tableName="DECLARATION_TEMPLATE">
            <column name="create_script" valueClobFile="templates/ndfl/report_2ndfl_1/v2016/report_2ndfl.groovy"/>
            <where>id=102</where>
        </update>
    </changeSet>

    <changeSet id="2.1-ytrofimov-41" author="ytrofimov">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script"
                    valueClobFile="templates/ndfl/report_2ndfl_1/v2016/report_2ndfll_check.groovy"/>
            <where>id=8</where>
        </update>
    </changeSet>

    <changeSet id="2.1-ytrofimov-42" author="ytrofimov">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script"
                    valueClobFile="templates/ndfl/report_2ndfl_1/v2016/report_2ndfl_move_created_to_accepted.groovy"/>
            <where>id=9</where>
        </update>
    </changeSet>

    <changeSet id="2.1-ytrofimov-43" author="ytrofimov">
        <update tableName="DECLARATION_TEMPLATE">
            <column name="create_script" valueClobFile="templates/ndfl/report_2ndfl_1/v2016/report_2ndfl.groovy"/>
            <where>id=104</where>
        </update>
    </changeSet>

    <changeSet id="2.1-ytrofimov-44" author="ytrofimov">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script"
                    valueClobFile="templates/ndfl/report_2ndfl_1/v2016/report_2ndfll_check.groovy"/>
            <where>id=12</where>
        </update>
    </changeSet>

    <changeSet id="2.1-ytrofimov-45" author="ytrofimov">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script"
                    valueClobFile="templates/ndfl/report_2ndfl_1/v2016/report_2ndfl_move_created_to_accepted.groovy"/>
            <where>id=13</where>
        </update>
    </changeSet>

    <changeSet id="2.1-ytrofimov-46" author="ytrofimov">
        <update tableName="DECLARATION_TEMPLATE">
            <column name="CREATE_SCRIPT" valueClobFile="templates/ndfl/report_6ndfl/v2016/report_6ndfl.groovy"/>
            <where>id=103</where>
        </update>
    </changeSet>

    <changeSet id="2.1-ytrofimov-47" author="ytrofimov">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script" valueClobFile="templates/ndfl/report_6ndfl/v2016/report_6ndfl_check.groovy"/>
            <where>id=10</where>
        </update>
    </changeSet>

    <changeSet id="2.1-ytrofimov-48" author="ytrofimov">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script"
                    valueClobFile="templates/ndfl/report_6ndfl/v2016/report_6ndfl_move_created_to_accepted.groovy"/>
            <where>id=11</where>
        </update>
    </changeSet>

    <changeSet id="2.1-ytrofimov-49" author="ytrofimov">
        <update tableName="BLOB_DATA">
            <column name="data" valueBlobFile="templates/refbook/declaration_type.groovy"/>
            <where>id='352adf59-372b-4020-98fe-8960dd5bc972'</where>
        </update>
    </changeSet>

    <changeSet id="2.1-ytrofimov-50" author="ytrofimov">
        <update tableName="BLOB_DATA">
            <column name="data" valueBlobFile="templates/refbook/department.groovy"/>
            <where>id='4e387483-0330-4e05-ad46-e9b03a3b025d'</where>
        </update>
    </changeSet>

    <changeSet id="2.1-ytrofimov-51" author="ytrofimov">
        <update tableName="BLOB_DATA">
            <column name="data" valueBlobFile="templates/refbook/fias.groovy"/>
            <where>id='39327388-9684-4fd5-a522-c40a21680156'</where>
        </update>
    </changeSet>

    <changeSet id="2.1-ytrofimov-52" author="ytrofimov">
        <update tableName="BLOB_DATA">
            <column name="data" valueBlobFile="templates/refbook/person.groovy"/>
            <where>id='884b9f2e-1678-4d69-9652-b036bba2f728'</where>
        </update>
    </changeSet>

    <!-- https://jira.aplana.com/browse/SBRFNDFL-2296 -->
    <changeSet id="2.1-AFateev-1" author="AFateev">
        <update tableName="BLOB_DATA">
            <column name="data" valueBlobFile="templates/refbook/declaration_type.groovy"/>
            <where>id='352adf59-372b-4020-98fe-8960dd5bc972'</where>
        </update>
    </changeSet>

    <!-- https://jira.aplana.com/browse/SBRFNDFL-2253 Проверка реквизитов. Ложное срабатывание проверки ИНП и даты рождения (Исправлено для КНФ) -->
    <changeSet id="2.1-ytrofimov-53" author="ytrofimov">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script"
                    valueClobFile="templates/ndfl/consolidated_rnu_ndfl/v2016/consolidated_rnu_ndfl_check.groovy"/>
            <where>id=6</where>
        </update>
    </changeSet>

    <!-- https://jira.aplana.com/browse/SBRFNDFL-2395 Сумма аванса не учитывается при проверке первичной формы -->
    <changeSet id="2.1-ytrofimov-54" author="ytrofimov">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script" valueClobFile="templates/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl_check.groovy"/>
            <where>id=2</where>
        </update>
    </changeSet>

    <changeSet id="2.1-ytrofimov-55" author="ytrofimov">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script"
                    valueClobFile="templates/ndfl/consolidated_rnu_ndfl/v2016/consolidated_rnu_ndfl_check.groovy"/>
            <where>id=6</where>
        </update>
    </changeSet>

    <!-- https://jira.aplana.com/browse/SBRFNDFL-2036 Не формируется сообщение об ошибке при проверке срока перечисления НДФЛ в бюджет -->
    <changeSet id="2.1-vlednev-2" author="vlednev">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script" valueClobFile="templates/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl_check.groovy"/>
            <where>id=2</where>
        </update>
    </changeSet>

	<!--https://jira.aplana.com/browse/SBRFNDFL-2495 Добавить изменения в БД для ASYNC_TASK_TYPE-->
	 <changeSet id="2.1-rnurgaleev-133" author="rnurgaleev">
        <update
                tableName="async_task_type">
            <column name="name" value="Обработка справочника из каталога загрузки"/>
            <where>id = 13</where>
        </update>
    </changeSet>

	<changeSet id="2.1-rnurgaleev-134" author="rnurgaleev">
        <insert tableName="async_task_type">
            <column name="id" value="12"/>
            <column name="name" value="Обработка ТФ налоговой формы"/>
            <column name="handler_bean" value="LoadTransportFileAsyncTask"/>
            <column name="short_queue_limit" value="10000"/>
            <column name="limit_kind" value="Размер файла (Кбайт)"/>
        </insert>
    </changeSet>

	<!--https://jira.aplana.com/browse/SBRFNDFL-2015 НДФЛ: Добавление текстового блока в печатное предстваление формы 2-НДФЛ-->
	<changeSet id="2.1-rnurgaleev-135" author="rnurgaleev">
        <update tableName="BLOB_DATA">
            <column name="data"
                    valueBlobFile="templates/ndfl/report_2ndfl_1/v2016/report_2ndfl.jrxml"/>
            <where>id in ('047f207c-113e-488d-8390-9afc248a3bc8','04d9b114-1782-4d09-ad88-729e5605c6ff')</where>
        </update>
    </changeSet>

	<!--https://jira.aplana.com/browse/SBRFNDFL-2414 НДФЛ: Добавление текстового блока в печатное предстваление формы 6-НДФЛ-->
	<changeSet id="2.1-rnurgaleev-136" author="rnurgaleev">
        <update tableName="BLOB_DATA">
            <column name="data"
                    valueBlobFile="templates/ndfl/report_6ndfl/v2016/report.jrxml"/>
            <where>id in ('41303bf7-9765-463f-a34b-f0a280bfa7bf')</where>
        </update>
    </changeSet>

	<!--https://jira.aplana.com/browse/SBRFNDFL-1892 Добавить дату подписи в печ форму 6-НДФЛ-->
	<changeSet id="2.1-rnurgaleev-137" author="rnurgaleev">
        <update tableName="BLOB_DATA">
            <column name="data"
                    valueBlobFile="templates/ndfl/report_6ndfl/v2016/report.jrxml"/>
            <where>id in ('41303bf7-9765-463f-a34b-f0a280bfa7bf')</where>
        </update>
    </changeSet>

    <!-- https://jira.aplana.com/browse/SBRFNDFL-2054 Статическая компиляция скрипта groovy для ФИАС-->
    <changeSet id="2.1-ytrofimov-56" author="ytrofimov">
        <update tableName="BLOB_DATA">
            <column name="data" valueBlobFile="templates/refbook/fias.groovy"/>
            <where>id='39327388-9684-4fd5-a522-c40a21680156'</where>
        </update>
    </changeSet>

	<changeSet id="2.1-rnurgaleev-138" author="rnurgaleev">
        <sqlFile dbms="oracle"
                 encoding="utf8"
                 endDelimiter=""
                 path="/scripts/fias_pkg_body3.sql"
                 relativeToChangelogFile="true"
                 splitStatements="false"/>
    </changeSet>

	<changeSet id="2.1-rnurgaleev-139" author="rnurgaleev">
        <sqlFile dbms="oracle"
                 encoding="utf8"
                 endDelimiter=""
                 path="/scripts/fias_pkg3.sql"
                 relativeToChangelogFile="true"
                 splitStatements="false"/>
    </changeSet>

	<changeSet id="2.1-rnurgaleev-140" author="rnurgaleev">
        <sqlFile dbms="oracle"
                 encoding="utf8"
                 endDelimiter=""
                 path="/scripts/fias_pkg_body4.sql"
                 relativeToChangelogFile="true"
                 splitStatements="false"/>
    </changeSet>

	<changeSet id="2.1-rnurgaleev-141" author="rnurgaleev">
        <sql splitStatements="false">
            BEGIN
				DBMS_SCHEDULER.SET_ATTRIBUTE (
				name         =>  'REFRESH_FIAS_VIEWS',
				attribute    =>  'job_action',
				value        =>
'BEGIN
  DBMS_MVIEW.REFRESH(list=>''MV_FIAS_CITY_ACT'',method => ''C'', atomic_refresh => FALSE);
  DBMS_MVIEW.REFRESH(list=>''MV_FIAS_AREA_ACT'',method => ''C'', atomic_refresh => FALSE);
  DBMS_MVIEW.REFRESH(list=>''MV_FIAS_LOCALITY_ACT'',method => ''C'', atomic_refresh => FALSE);
  DBMS_MVIEW.REFRESH(list=>''MV_FIAS_STREET_ACT'',method => ''C'', atomic_refresh => FALSE);
END;'
				);
			END;
        </sql>
    </changeSet>

	<!--https://jira.aplana.com/browse/SBRFNDFL-2502 Разобраться с реализованным алгоритмом проверки адреса на соответствие его ФИАС-у-->
	<changeSet id="2.1-rnurgaleev-142" author="rnurgaleev">
        <sql splitStatements="false">
            declare
				v_count number;
			begin
				select count(1) into v_count from user_mviews where mview_name='MV_FIAS_AREA_ACT';
				if v_count>0 then
					execute immediate 'DROP MATERIALIZED VIEW MV_FIAS_AREA_ACT';
				end if;

				select count(1) into v_count from user_mviews where mview_name='MV_FIAS_AREA_ACT';
				if v_count=0 then
					execute immediate 'CREATE MATERIALIZED VIEW MV_FIAS_AREA_ACT (ID, AOID, FORMALNAME, SHORTNAME, REGIONCODE, LIVESTATUS, CURRSTATUS, AOLEVEL, POSTALCODE, PARENTGUID, FNAME, FTYPE, HAS_CHILD)
    NOLOGGING
    BUILD IMMEDIATE
    USING INDEX
    REFRESH COMPLETE ON DEMAND
    USING DEFAULT LOCAL ROLLBACK SEGMENT
    USING ENFORCED CONSTRAINTS DISABLE QUERY REWRITE
    AS select distinct f.*,
       replace(lower(f.formalname),'' '','''') fname,
       trim(lower(f.shortname)) ftype,
       nvl2(c.id,1,0) has_child
  from fias_addrobj f left join fias_addrobj c on (c.parentguid=f.aoid and c.currstatus=0)
  where f.currstatus=0
   and (f.aolevel=3 or
        f.aolevel=1 /*and replace(lower(f.formalname),'' '','''') not in (''москва'',''санкт-петербург'',''севастополь'',''байконур'')*/
        )';
					execute immediate 'CREATE INDEX IDX_MV_FIAS_AREA_AOID ON MV_FIAS_AREA_ACT (AOID)';
					execute immediate 'CREATE INDEX IDX_MV_FIAS_AREA_FNAME ON MV_FIAS_AREA_ACT (FNAME)';
					execute immediate 'CREATE INDEX IDX_MV_FIAS_AREA_PGUID ON MV_FIAS_AREA_ACT (PARENTGUID)';
					execute immediate 'CREATE INDEX SRCH_MV_FIAS_AREA_REG_FN_TP ON MV_FIAS_AREA_ACT (REGIONCODE, FNAME, FTYPE, HAS_CHILD)';
					execute immediate 'CREATE UNIQUE INDEX PK_MV_FIAS_AREA_ACT ON MV_FIAS_AREA_ACT (ID)';

					execute immediate 'COMMENT ON COLUMN MV_FIAS_AREA_ACT.ID IS ''Уникальный идентификатор''';
					execute immediate 'COMMENT ON COLUMN MV_FIAS_AREA_ACT.AOID IS ''Идентификатор объекта''';
					execute immediate 'COMMENT ON COLUMN MV_FIAS_AREA_ACT.FORMALNAME IS ''Формализованное наименование''';
					execute immediate 'COMMENT ON COLUMN MV_FIAS_AREA_ACT.SHORTNAME IS ''Тип адресного объекта''';
					execute immediate 'COMMENT ON COLUMN MV_FIAS_AREA_ACT.REGIONCODE IS ''Код региона''';
					execute immediate 'COMMENT ON COLUMN MV_FIAS_AREA_ACT.LIVESTATUS IS ''Статус актуальности ФИАС: 1 - актуальная, 0 - устаревшая''';
					execute immediate 'COMMENT ON COLUMN MV_FIAS_AREA_ACT.CURRSTATUS IS ''Статус актуальности КЛАДР: 0 - актуальная, ..''';
					execute immediate 'COMMENT ON COLUMN MV_FIAS_AREA_ACT.AOLEVEL IS ''Уровень объекта''';
					execute immediate 'COMMENT ON COLUMN MV_FIAS_AREA_ACT.POSTALCODE IS ''Почтовый индекс''';
					execute immediate 'COMMENT ON COLUMN MV_FIAS_AREA_ACT.PARENTGUID IS ''Идентификатор родительского объекта''';
					execute immediate 'COMMENT ON COLUMN MV_FIAS_AREA_ACT.FNAME IS ''Наименование, адаптированное для проверки адреса (строчными буквами, без пробелов)''';
					execute immediate 'COMMENT ON COLUMN MV_FIAS_AREA_ACT.FTYPE IS ''Тип, адаптированный для проверки адреса (строчными буквами, без пробелов)''';
					execute immediate 'COMMENT ON COLUMN MV_FIAS_AREA_ACT.HAS_CHILD IS ''Наличие дочерних элементов''';
					execute immediate 'COMMENT ON MATERIALIZED VIEW MV_FIAS_AREA_ACT  IS ''Актуальные районы из справочника ФИАС''';
				end if;

				select count(1) into v_count from user_mviews where mview_name='MV_FIAS_CITY_ACT';
				if v_count>0 then
					execute immediate 'DROP MATERIALIZED VIEW MV_FIAS_CITY_ACT';
				end if;

				select count(1) into v_count from user_mviews where mview_name='MV_FIAS_CITY_ACT';
				if v_count=0 then
					execute immediate 'CREATE MATERIALIZED VIEW MV_FIAS_CITY_ACT (ID, AOID, FORMALNAME, SHORTNAME, REGIONCODE, LIVESTATUS, CURRSTATUS, AOLEVEL, POSTALCODE, PARENTGUID, FNAME, FTYPE, HAS_CHILD)
    NOLOGGING
    BUILD IMMEDIATE
    USING INDEX
    REFRESH COMPLETE ON DEMAND
    USING DEFAULT LOCAL ROLLBACK SEGMENT
    USING ENFORCED CONSTRAINTS DISABLE QUERY REWRITE
    AS select distinct f.*,
       replace(lower(f.formalname),'' '','''') fname,
       trim(lower(f.shortname)) ftype,
        nvl2(c.id,1,0) has_child
  from fias_addrobj f left join fias_addrobj c on (c.parentguid=f.aoid and c.currstatus=0)
  where f.currstatus=0
   and (f.aolevel=4 /*or
        f.aolevel=1 and replace(lower(f.formalname),'' '','''') in (''москва'',''санкт-петербург'',''севастополь'',''байконур'')*/
       )';

					execute immediate 'CREATE UNIQUE INDEX PK_MV_FIAS_CITY_ACT ON MV_FIAS_CITY_ACT (ID)';
					execute immediate 'CREATE INDEX IDX_MV_FIAS_CITY_AOID ON MV_FIAS_CITY_ACT (AOID)';
					execute immediate 'CREATE INDEX IDX_MV_FIAS_CITY_FNAME ON MV_FIAS_CITY_ACT (FNAME) ';
					execute immediate 'CREATE INDEX IDX_MV_FIAS_CITY_PGUID ON MV_FIAS_CITY_ACT (PARENTGUID) ';
					execute immediate 'CREATE INDEX SRCH_MV_FIAS_CITY_REG_FN_TP ON MV_FIAS_CITY_ACT (REGIONCODE, FNAME, FTYPE, HAS_CHILD)';

					execute immediate 'COMMENT ON COLUMN MV_FIAS_CITY_ACT.ID IS ''Уникальный идентификатор''';
					execute immediate 'COMMENT ON COLUMN MV_FIAS_CITY_ACT.AOID IS ''Идентификатор объекта''';
					execute immediate 'COMMENT ON COLUMN MV_FIAS_CITY_ACT.FORMALNAME IS ''Формализованное наименование''';
					execute immediate 'COMMENT ON COLUMN MV_FIAS_CITY_ACT.SHORTNAME IS ''Тип адресного объекта''';
					execute immediate 'COMMENT ON COLUMN MV_FIAS_CITY_ACT.REGIONCODE IS ''Код региона''';
					execute immediate 'COMMENT ON COLUMN MV_FIAS_CITY_ACT.LIVESTATUS IS ''Статус актуальности ФИАС: 1 - актуальная, 0 - устаревшая''';
					execute immediate 'COMMENT ON COLUMN MV_FIAS_CITY_ACT.CURRSTATUS IS ''Статус актуальности КЛАДР: 0 - актуальная, ..''';
					execute immediate 'COMMENT ON COLUMN MV_FIAS_CITY_ACT.AOLEVEL IS ''Уровень объекта''';
					execute immediate 'COMMENT ON COLUMN MV_FIAS_CITY_ACT.POSTALCODE IS ''Почтовый индекс''';
					execute immediate 'COMMENT ON COLUMN MV_FIAS_CITY_ACT.PARENTGUID IS ''Идентификатор родительского объекта''';
					execute immediate 'COMMENT ON COLUMN MV_FIAS_CITY_ACT.FNAME IS ''Наименование, адаптированное для проверки адреса (строчными буквами, без пробелов)''';
					execute immediate 'COMMENT ON COLUMN MV_FIAS_CITY_ACT.FTYPE IS ''Тип, адаптированный для проверки адреса (строчными буквами, без пробелов)''';
					execute immediate 'COMMENT ON COLUMN MV_FIAS_CITY_ACT.HAS_CHILD IS ''Наличие дочерних элементов''';
					execute immediate 'COMMENT ON MATERIALIZED VIEW MV_FIAS_CITY_ACT  IS ''Актуальные города из справочника ФИАС''';
				end if;
			end;
        </sql>
    </changeSet>

	<changeSet id="2.1-rnurgaleev-143" author="rnurgaleev">
        <sqlFile dbms="oracle"
                 encoding="utf8"
                 endDelimiter=""
                 path="/scripts/fias_pkg_body5.sql"
                 relativeToChangelogFile="true"
                 splitStatements="false"/>
    </changeSet>

	<changeSet id="2.1-rnurgaleev-144" author="rnurgaleev">
        <sqlFile dbms="oracle"
                 encoding="utf8"
                 endDelimiter=""
                 path="/scripts/fias_pkg_body6.sql"
                 relativeToChangelogFile="true"
                 splitStatements="false"/>
    </changeSet>

	<!--https://jira.aplana.com/browse/SBRFNDFL-2570  Отображать "Идентификатор ФЛ" в справочнике "Идентификаторы налогоплательщиков" вместо Фамилии-->
	<changeSet id="2.1-rnurgaleev-145" author="rnurgaleev">
        <sql>
            update ref_book_attribute set attribute_id = (select id from ref_book_attribute where ref_book_id = 904 and alias = 'RECORD_ID') where ref_book_id = 905 and alias = 'PERSON_ID';
        </sql>
    </changeSet>


    <!-- https://jira.aplana.com/browse/SBRFNDFL-2541 Ошибка исполнения [23]: Format specifier 's' при расчете консолидированной формы в корректирующем периоде-->
    <changeSet id="2.1-ytrofimov-57" author="ytrofimov">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script"
                    valueClobFile="templates/ndfl/consolidated_rnu_ndfl/v2016/consolidated_rnu_ndfl_calculate.groovy"/>
            <where>id=5</where>
        </update>
    </changeSet>

    <!-- https://jira.aplana.com/browse/SBRFNDFL-2579 Неправильный идентификатор физического лица при создании записи в справочнике-->
    <changeSet id="2.1-ytrofimov-58" author="ytrofimov">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script"
                    valueClobFile="templates/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl_calculate.groovy"/>
            <where>id=1</where>
        </update>
    </changeSet>

	<!--https://jira.aplana.com/browse/SBRFNDFL-2634 Добавить поле manually_created в declaration_data-->
	<changeSet id="2.1-rnurgaleev-146" author="rnurgaleev">
        <addColumn tableName="declaration_data">
            <column name="manually_created" type="number(1)" defaultValue="0" remarks="Создана вручную (0-нет, 1-да)">
                <constraints nullable="false"/>
            </column>
        </addColumn>
    </changeSet>

	<changeSet id="2.1-rnurgaleev-147" author="rnurgaleev">
        <sql>
            alter table declaration_data add constraint decl_data_chk_man_created check(manually_created in (0, 1));
        </sql>
    </changeSet>

    <!-- https://jira.aplana.com/browse/SBRFNDFL-2545 Убрать хардкод типа файла -->
    <changeSet id="2.1-vlednev-3" author="vlednev">
        <update tableName="DECLARATION_TEMPLATE">
            <column name="CREATE_SCRIPT" valueClobFile="templates/ndfl/report_2ndfl_2/v2016/report_2ndfl_2.groovy"/>
            <where>id=104</where>
        </update>
    </changeSet>

    <changeSet id="2.1-vlednev-4" author="vlednev">
        <update tableName="DECLARATION_TEMPLATE">
            <column name="create_script" valueClobFile="templates/ndfl/report_2ndfl_1/v2016/report_2ndfl.groovy"/>
            <where>id=102</where>
        </update>
    </changeSet>

    <changeSet id="2.1-vlednev-5" author="vlednev">
        <update tableName="DECLARATION_TEMPLATE">
            <column name="CREATE_SCRIPT" valueClobFile="templates/ndfl/report_6ndfl/v2016/report_6ndfl.groovy"/>
            <where>id=103</where>
        </update>
    </changeSet>

    <changeSet id="2.1-vlednev-6" author="vlednev">
        <update tableName="BLOB_DATA">
            <column name="data" valueBlobFile="templates/refbook/declaration_type.groovy"/>
            <where>id='352adf59-372b-4020-98fe-8960dd5bc972'</where>
        </update>
    </changeSet>

	<!--https://jira.aplana.com/browse/SBRFNDFL-2671 Создать синоним на таблицу subsystem_role из УН и вьюшки на пользователей и роли ФП НДФЛ-->
	<changeSet id="2.1-rnurgaleev-148" author="rnurgaleev">
        <sql>
            CREATE SYNONYM SUBSYSTEM_ROLE FOR TAX_1_5.SUBSYSTEM_ROLE;
        </sql>
    </changeSet>

	<changeSet id="2.1-rnurgaleev-149" author="rnurgaleev">
        <createView
                replaceIfExists="true"
                viewName="SEC_USER_NDFL">select distinct a.* from sec_user a join sec_user_role b on a.id=b.user_id join subsystem_role c on b.role_id=c.role_id where c.subsystem_id=11 order by name, login
        </createView>
    </changeSet>

	<changeSet id="2.1-rnurgaleev-150" author="rnurgaleev">
        <createView
                replaceIfExists="true"
                viewName="SEC_ROLE_NDFL">select distinct a.* from sec_role a join subsystem_role c on a.id=c.role_id where c.subsystem_id=11 order by id
        </createView>
    </changeSet>

    <!--https://jira.aplana.com/browse/SBRFNDFL-1900 Добавить ID операции в уведомления с ошибками по проверкам-->
    <changeSet id="2.1-vlednev-7" author="vlednev">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script"
                    valueClobFile="templates/ndfl/consolidated_rnu_ndfl/v2016/consolidated_rnu_ndfl_check.groovy"/>
            <where>id=6</where>
        </update>
    </changeSet>

    <changeSet id="2.1-vlednev-8" author="vlednev">
        <update tableName="DECLARATION_TEMPLATE">
            <column name="create_script" valueClobFile="templates/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl.groovy"/>
            <where>id=100</where>
        </update>
    </changeSet>

    <changeSet id="2.1-vlednev-9" author="vlednev">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script" valueClobFile="templates/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl_check.groovy"/>
            <where>id=2</where>
        </update>
    </changeSet>

    <changeSet id="2.1-dnovikov-1" author="dnovikov">
        <update tableName="ref_book">
            <column name="table_name" value="SEC_ROLE_NDFL"/>
            <where>id=95</where>
        </update>
    </changeSet>

	<!--https://jira.aplana.com/browse/SBRFNDFL-2571 Некорректная идентификация ПНФ после назначения дублей в справочнике "ФЛ"-->
	<changeSet id="2.1-rnurgaleev-151" author="rnurgaleev">
        <sqlFile dbms="oracle"
                 encoding="utf8"
                 endDelimiter=""
                 path="/scripts/person_pkg_body2.sql"
                 relativeToChangelogFile="true"
                 splitStatements="false"/>
    </changeSet>

	<changeSet id="2.1-rnurgaleev-152" author="rnurgaleev">
        <sqlFile dbms="oracle"
                 encoding="utf8"
                 endDelimiter=""
                 path="/scripts/person_pkg_body3.sql"
                 relativeToChangelogFile="true"
                 splitStatements="false"/>
    </changeSet>

	<!--https://jira.aplana.com/browse/SBRFNDFL-2677 Код дохода "2791" указан без даты ограничения актуальности в справочнике-->
	<changeSet id="2.1-rnurgaleev-153" author="rnurgaleev">
        <update
                tableName="ref_book_income_type">
            <column name="record_id" value="298957"/>
            <where>code='2791' and status=2</where>
        </update>
    </changeSet>

	<changeSet id="2.1-rnurgaleev-154" author="rnurgaleev">
        <sql>
            update ref_book_income_type set version=version+1 where status=2;
        </sql>
    </changeSet>

    <!-- https://jira.aplana.com/browse/SBRFNDFL-2547 Некорректное сообщение при расчете КНФ по одной ПНФ-->
    <changeSet id="2.1-ytrofimov-59" author="ytrofimov">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script"
                    valueClobFile="templates/ndfl/consolidated_rnu_ndfl/v2016/consolidated_rnu_ndfl_calculate.groovy"/>
            <where>id=5</where>
        </update>
    </changeSet>

	<!--https://jira.aplana.com/browse/SBRFNDFL-2658 Ошибка: "Город" ("Самара г") отсутствует в справочнике "ФИАС" в случае указания адреса без улицы: -->
	<changeSet id="2.1-rnurgaleev-155" author="rnurgaleev">
        <sqlFile dbms="oracle"
                 encoding="utf8"
                 endDelimiter=""
                 path="/scripts/fias_pkg_body7.sql"
                 relativeToChangelogFile="true"
                 splitStatements="false"/>
    </changeSet>

    <!-- https://jira.aplana.com/browse/SBRFNDFL-2690 При проверке суммы излишне удержанного налога система не учитывает значение атрибута ДолгНА в xml-->
    <changeSet id="2.1-ytrofimov-60" author="ytrofimov">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script"
                    valueClobFile="templates/ndfl/consolidated_rnu_ndfl/v2016/consolidated_rnu_ndfl_check.groovy"/>
            <where>id=6</where>
        </update>
    </changeSet>

    <changeSet id="2.1-ytrofimov-61" author="ytrofimov">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script" valueClobFile="templates/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl_check.groovy"/>
            <where>id=2</where>
        </update>
    </changeSet>

    <!-- https://jira.aplana.com/browse/SBRFNDFL-2442 Ошибка исполнения [-1]: startup failed: Script8.groovy: 185: [Static type checking] при создании 2НДФЛ (2)-->
    <changeSet id="2.1-ytrofimov-62" author="ytrofimov">
        <update tableName="DECLARATION_TEMPLATE">
            <column name="CREATE_SCRIPT" valueClobFile="templates/ndfl/report_2ndfl_1/v2016/report_2ndfl.groovy"/>
            <where>id=104</where>
        </update>
    </changeSet>

	<!-- https://jira.aplana.com/browse/SBRFNDFL-2712 Добавить в справочник Календарь данные на 2018 год-->
	<changeSet id="2.1-rnurgaleev-156" author="rnurgaleev">
        <sqlFile dbms="oracle"
                 encoding="utf8"
                 endDelimiter=""
                 path="/scripts/ref_book_calendar.sql"
                 relativeToChangelogFile="true"
                 splitStatements="false"/>
    </changeSet>

    <!--https://jira.aplana.com/browse/SBRFNDFL-969 НДФЛ: Реализовать вывод сообщения о результатах обработки записей физических лиц при идентификации -->
    <changeSet id="2.1-vlednev-10" author="vlednev">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script"
                    valueClobFile="templates/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl_calculate.groovy"/>
            <where>id=1</where>
        </update>
    </changeSet>

	<!--https://jira.aplana.com/browse/SBRFNDFL-2731 6-НДФЛ. В печатной форме не заполняется дата подписи-->
	<changeSet id="2.1-rnurgaleev-157" author="rnurgaleev">
        <update tableName="BLOB_DATA">
            <column name="data"
                    valueBlobFile="templates/ndfl/report_6ndfl/v2016/report.jrxml"/>
            <where>id in ('41303bf7-9765-463f-a34b-f0a280bfa7bf')</where>
        </update>
    </changeSet>

	<changeSet id="2.1-rnurgaleev-158" author="rnurgaleev">
        <update tableName="BLOB_DATA">
            <column name="data"
                    valueBlobFile="templates/ndfl/report_6ndfl/v2016/report.jrxml"/>
            <where>id in ('41303bf7-9765-463f-a34b-f0a280bfa7bf')</where>
        </update>
    </changeSet>

	<!--https://jira.aplana.com/browse/SBRFNDFL-2445 Реализовать изменения в xsd-схеме количества ИнфБлоков-->
	<changeSet id="2.1-rnurgaleev-159" author="rnurgaleev">
        <update tableName="BLOB_DATA">
            <column name="data"
                    valueBlobFile="templates/ndfl/primary_rnu_ndfl/v2016/rnu_ndfl_light.xsd"/>
            <where>id in ('58adc3c2-66a0-4f11-98a2-defe682a092f')</where>
        </update>
    </changeSet>

	<!--https://jira.aplana.com/browse/SBRFNDFL-2764 Добавить в патч создание и заполнение таблицы с настройками фатальности проверок-->
	<changeSet id="2.1-rnurgaleev-160" author="rnurgaleev">
        <createTable
                remarks="Настройки фатальности проверок форм"
                tableName="declaration_template_checks">
            <column name="id" type="number(9)" remarks="Идентификатор">
                <constraints nullable="false"/>
            </column>
            <column name="declaration_type_id" type="number(9)" remarks="Идентификатор типа формы, к которому привязана проверка по-умолчанию">
                <constraints nullable="false" foreignKeyName="fk_decl_type_checks"
                             references="declaration_type(id)"/>
            </column>
            <column name="template_id" type="number(9)" remarks="Идентификатор макета, к которому привязана проверка">
            </column>
            <column name="check_code" type="varchar2(50)" remarks="Код проверки">
				<constraints nullable="false"/>
            </column>
            <column name="check_type" type="varchar2(400)" remarks="Тип проверки">
            </column>
            <column name="description" type="varchar2(300)" remarks="Тип Описание">
            </column>
			<column name="is_fatal" type="number(1)" defaultValue="0" remarks="Проверка фатальна?">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>

	<changeSet id="2.1-rnurgaleev-161" author="rnurgaleev">
        <createSequence
                incrementBy="1"
                sequenceName="seq_dt_checks"
                startValue="1"/>
    </changeSet>

	<changeSet id="2.1-rnurgaleev-162" author="rnurgaleev">
        <addForeignKeyConstraint baseColumnNames="template_id"
                                 baseTableName="declaration_template_checks"
                                 constraintName="fk_decl_template_checks"
                                 onDelete="CASCADE"
                                 referencedColumnNames="id"
                                 referencedTableName="declaration_template"/>
    </changeSet>

	<changeSet id="2.1-rnurgaleev-163" author="rnurgaleev">
        <createIndex
                indexName="idx_decl_type_checks"
                tableName="declaration_template_checks">
            <column name="declaration_type_id"/>
        </createIndex>
    </changeSet>

	<changeSet id="2.1-rnurgaleev-164" author="rnurgaleev">
        <createIndex
                indexName="idx_decl_template_checks"
                tableName="declaration_template_checks">
            <column name="template_id"/>
        </createIndex>
    </changeSet>

	<changeSet id="2.1-rnurgaleev-165" author="rnurgaleev">
        <createIndex
                indexName="unq_dt_checks"
                tableName="declaration_template_checks"
				unique="true">
            <column name="declaration_type_id"/>
			<column name="template_id"/>
			<column name="check_code"/>
        </createIndex>
    </changeSet>

	<changeSet id="2.1-rnurgaleev-166" author="rnurgaleev">
        <sql splitStatements="false">
            BEGIN
				insert into declaration_template_checks (id, declaration_type_id, check_code, check_type, description, is_fatal) values (seq_dt_checks.nextval, 100, '000-0007-00001', 'Наличие (отсутствие) значения в графе не соответствует алгоритму заполнения РНУ НДФЛ', 'Проверка наличия или отсутствия значения в графе в зависимости от условий', 1);
				insert into declaration_template_checks (id, declaration_type_id, check_code, check_type, description, is_fatal) values (seq_dt_checks.nextval, 100, '001-0001-00002', 'Значение не соответствует данным справочника', 'Соответствие кода гражданства справочнику', 0);
				insert into declaration_template_checks (id, declaration_type_id, check_code, check_type, description, is_fatal) values (seq_dt_checks.nextval, 100, '003-0001-00002', '"Дата начисленного дохода" указана некорректно', 'Заполнение Раздела 3 Графы 10.', 0);
				insert into declaration_template_checks (id, declaration_type_id, check_code, check_type, description, is_fatal) values (seq_dt_checks.nextval, 100, '003-0001-00003', '"Дата применения вычета в текущем периоде" не соответствует "Дате начисления дохода"', 'Заполнение Раздела 3 Графы 10.', 0);
				insert into declaration_template_checks (id, declaration_type_id, check_code, check_type, description, is_fatal) values (seq_dt_checks.nextval, 100, '001-0001-00006', '"Сумма применения вычета" указана некорректно', 'Заполнение Раздела 3 Графы 16.', 0);
				insert into declaration_template_checks (id, declaration_type_id, check_code, check_type, description, is_fatal) values (seq_dt_checks.nextval, 100, '004-0001-00004', '«Дата исчисленного/удержанного/излишне удержанного/возвращенного налогоплательщику  налога»  рассчитана неверно.', 'Заполнение Раздела 2 Графы 15.', 1);
				insert into declaration_template_checks (id, declaration_type_id, check_code, check_type, description, is_fatal) values (seq_dt_checks.nextval, 100, '004-0001-00005', '"НДФЛ исчисленный" рассчитан некорректно.', 'Заполнение Раздела 2 Графы 16.', 0);
				insert into declaration_template_checks (id, declaration_type_id, check_code, check_type, description, is_fatal) values (seq_dt_checks.nextval, 100, '004-0001-00006', '"НДФЛ удержанный" рассчитан некорректно.', 'Заполнение Раздела 2 Графы 17.', 0);
				insert into declaration_template_checks (id, declaration_type_id, check_code, check_type, description, is_fatal) values (seq_dt_checks.nextval, 100, '004-0001-00010', '"Срок перечисления в бюджет" рассчитан некорректно.', 'Заполнение Раздела 2 Графы 21.', 0);

				insert into declaration_template_checks (id, declaration_type_id, check_code, check_type, description, is_fatal) values (seq_dt_checks.nextval, 101, '000-0007-00001', 'Наличие (отсутствие) значения в графе не соответствует алгоритму заполнения РНУ НДФЛ', 'Проверка наличия или отсутствия значения в графе в зависимости от условий', 1);
				insert into declaration_template_checks (id, declaration_type_id, check_code, check_type, description, is_fatal) values (seq_dt_checks.nextval, 101, '001-0001-00002', 'Значение не соответствует данным справочника', 'Соответствие кода гражданства справочнику', 0);
				insert into declaration_template_checks (id, declaration_type_id, check_code, check_type, description, is_fatal) values (seq_dt_checks.nextval, 101, '003-0001-00002', '"Дата начисленного дохода" указана некорректно', 'Заполнение Раздела 3 Графы 10.', 0);
				insert into declaration_template_checks (id, declaration_type_id, check_code, check_type, description, is_fatal) values (seq_dt_checks.nextval, 101, '003-0001-00003', '"Дата применения вычета в текущем периоде" не соответствует "Дате начисления дохода"', 'Заполнение Раздела 3 Графы 10.', 0);
				insert into declaration_template_checks (id, declaration_type_id, check_code, check_type, description, is_fatal) values (seq_dt_checks.nextval, 101, '001-0001-00006', '"Сумма применения вычета" указана некорректно', 'Заполнение Раздела 3 Графы 16.', 0);
				insert into declaration_template_checks (id, declaration_type_id, check_code, check_type, description, is_fatal) values (seq_dt_checks.nextval, 101, '004-0001-00004', '«Дата исчисленного/удержанного/излишне удержанного/возвращенного налогоплательщику  налога»  рассчитана неверно.', 'Заполнение Раздела 2 Графы 15.', 1);
				insert into declaration_template_checks (id, declaration_type_id, check_code, check_type, description, is_fatal) values (seq_dt_checks.nextval, 101, '004-0001-00005', '"НДФЛ исчисленный" рассчитан некорректно.', 'Заполнение Раздела 2 Графы 16.', 0);
				insert into declaration_template_checks (id, declaration_type_id, check_code, check_type, description, is_fatal) values (seq_dt_checks.nextval, 101, '004-0001-00006', '"НДФЛ удержанный" рассчитан некорректно.', 'Заполнение Раздела 2 Графы 17.', 0);
				insert into declaration_template_checks (id, declaration_type_id, check_code, check_type, description, is_fatal) values (seq_dt_checks.nextval, 101, '004-0001-00010', '"Срок перечисления в бюджет" рассчитан некорректно.', 'Заполнение Раздела 2 Графы 21.', 0);

				insert into declaration_template_checks (id, declaration_type_id, template_id, check_code, check_type, description, is_fatal)
				select seq_dt_checks.nextval, ch.declaration_type_id, dt.id, ch.check_code, ch.check_type, ch.description, ch.is_fatal
				from declaration_template_checks ch
				join declaration_template dt on dt.declaration_type_id = ch.declaration_type_id;
			END;
        </sql>
    </changeSet>

    <!-- https://jira.aplana.com/browse/SBRFNDFL-2722 -->
    <changeSet id="2.1-ytrofimov-63" author="ytrofimov">
        <update tableName="DECLARATION_TEMPLATE">
            <column name="CREATE_SCRIPT" valueClobFile="templates/ndfl/report_2ndfl_1/v2016/report_2ndfl.groovy"/>
            <where>id=104</where>
        </update>
    </changeSet>

    <changeSet id="2.1-ytrofimov-64" author="ytrofimov">
        <update tableName="DECLARATION_TEMPLATE">
            <column name="create_script" valueClobFile="templates/ndfl/report_2ndfl_1/v2016/report_2ndfl.groovy"/>
            <where>id=102</where>
        </update>
    </changeSet>

    <!-- https://jira.aplana.com/browse/SBRFNDFL-2435 -->
    <changeSet id="2.1-dloshkarev-5" author="dloshkarev">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script"
                    valueClobFile="templates/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl_check.groovy"/>
            <where>id=2</where>
        </update>
    </changeSet>
    <changeSet id="2.1-dloshkarev-8" author="dloshkarev">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script"
                    valueClobFile="templates/ndfl/consolidated_rnu_ndfl/v2016/consolidated_rnu_ndfl_check.groovy"/>
            <where>id=6</where>
        </update>
    </changeSet>

	<!--https://jira.aplana.com/browse/SBRFNDFL-2781 Улица города федерального значения не проходит проверку-->
	<changeSet id="2.1-rnurgaleev-167" author="rnurgaleev">
        <sqlFile dbms="oracle"
                 encoding="utf8"
                 endDelimiter=""
                 path="/scripts/fias_pkg_body8.sql"
                 relativeToChangelogFile="true"
                 splitStatements="false"/>
    </changeSet>
	<changeSet id="2.1-rnurgaleev-168" author="rnurgaleev">
        <sqlFile dbms="oracle"
                 encoding="utf8"
                 endDelimiter=""
                 path="/scripts/fias_pkg_body9.sql"
                 relativeToChangelogFile="true"
                 splitStatements="false"/>
    </changeSet>

	<!--https://jira.aplana.com/browse/SBRFNDFL-2766 Отслеживание изменений таблиц user и department в БД УН-->
	<changeSet id="2.1-rnurgaleev-169" author="rnurgaleev">
        <createTable
                remarks="Изменения в таблицах department и sec_user в УН"
                tableName="log_un_changes">
            <column name="table_name" type="varchar2(30 char)" remarks="Название таблицы">
                <constraints nullable="false"/>
            </column>
            <column name="oper_name" type="varchar2(30 char)" remarks="Название операции">
                <constraints nullable="false"/>
            </column>
			<column name="id" type="number(18)" remarks="Идентификатор строки таблицы">
                <constraints nullable="false"/>
            </column>
            <column name="datetime" type="timestamp" remarks="Дата и время изменения"
                    defaultValueComputed="CURRENT_TIMESTAMP">
            </column>
        </createTable>
    </changeSet>

	<changeSet id="2.1-rnurgaleev-170" author="rnurgaleev">
        <sqlFile dbms="oracle"
                 encoding="utf8"
                 endDelimiter=""
                 path="/scripts/DEP_AFTER_INS_UPD_DEL.sql"
                 relativeToChangelogFile="true"
                 splitStatements="false"/>
    </changeSet>

	<changeSet id="2.1-rnurgaleev-171" author="rnurgaleev">
        <sqlFile dbms="oracle"
                 encoding="utf8"
                 endDelimiter=""
                 path="/scripts/SEC_USER_AFTER_INS_UPD_DEL.sql"
                 relativeToChangelogFile="true"
                 splitStatements="false"/>
    </changeSet>

	<!--https://jira.aplana.com/browse/SBRFNDFL-2435 Реализовать настройки фатальности проверок данных ПНФ нужно переименовать сиквенс, таблицу и названия полей-->
	<changeSet id="2.1-rnurgaleev-172" author="rnurgaleev">
        <dropSequence sequenceName="seq_dt_checks"/>
    </changeSet>

	<changeSet id="2.1-rnurgaleev-173" author="rnurgaleev">
        <dropTable cascadeConstraints="true"
                   tableName="declaration_template_checks"/>
    </changeSet>

	<changeSet id="2.1-rnurgaleev-174" author="rnurgaleev">
        <createSequence
                incrementBy="1"
                sequenceName="seq_decl_template_checks"
                startValue="1"/>
    </changeSet>

	<changeSet id="2.1-rnurgaleev-175" author="rnurgaleev">
        <createTable
                remarks="Настройки фатальности проверок форм"
                tableName="decl_template_checks">
            <column name="id" type="number(9)" remarks="Идентификатор">
                <constraints nullable="false"/>
            </column>
            <column name="declaration_type_id" type="number(9)" remarks="Идентификатор типа формы, к которому привязана проверка по-умолчанию">
                <constraints nullable="false" foreignKeyName="fk_decl_type_checks"
                             references="declaration_type(id)"/>
            </column>
            <column name="declaration_template_id" type="number(9)" remarks="Идентификатор макета, к которому привязана проверка">
            </column>
            <column name="check_code" type="varchar2(50)" remarks="Код проверки">
				<constraints nullable="false"/>
            </column>
            <column name="check_type" type="varchar2(400)" remarks="Тип проверки">
            </column>
            <column name="description" type="varchar2(300)" remarks="Тип Описание">
            </column>
			<column name="is_fatal" type="number(1)" defaultValue="0" remarks="Проверка фатальна?">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>

	<changeSet id="2.1-rnurgaleev-176" author="rnurgaleev">
        <addForeignKeyConstraint baseColumnNames="declaration_template_id"
                                 baseTableName="decl_template_checks"
                                 constraintName="fk_decl_template_checks"
                                 onDelete="CASCADE"
                                 referencedColumnNames="id"
                                 referencedTableName="declaration_template"/>
    </changeSet>

	<changeSet id="2.1-rnurgaleev-177" author="rnurgaleev">
        <createIndex
                indexName="idx_decl_type_checks"
                tableName="decl_template_checks">
            <column name="declaration_type_id"/>
        </createIndex>
    </changeSet>

	<changeSet id="2.1-rnurgaleev-178" author="rnurgaleev">
        <createIndex
                indexName="idx_decl_template_checks"
                tableName="decl_template_checks">
            <column name="declaration_template_id"/>
        </createIndex>
    </changeSet>

	<changeSet id="2.1-rnurgaleev-179" author="rnurgaleev">
        <createIndex
                indexName="unq_dt_checks"
                tableName="decl_template_checks"
				unique="true">
            <column name="declaration_type_id"/>
			<column name="declaration_template_id"/>
			<column name="check_code"/>
        </createIndex>
    </changeSet>

	<changeSet id="2.1-rnurgaleev-180" author="rnurgaleev">
        <sql splitStatements="false">
            BEGIN
				insert into decl_template_checks (id, declaration_type_id, check_code, check_type, description, is_fatal) values (seq_decl_template_checks.nextval, 100, '000-0007-00001', 'Наличие (отсутствие) значения в графе не соответствует алгоритму заполнения РНУ НДФЛ', 'Проверка наличия или отсутствия значения в графе в зависимости от условий', 1);
				insert into decl_template_checks (id, declaration_type_id, check_code, check_type, description, is_fatal) values (seq_decl_template_checks.nextval, 100, '001-0001-00002', 'Значение не соответствует данным справочника', 'Соответствие кода гражданства справочнику', 0);
				insert into decl_template_checks (id, declaration_type_id, check_code, check_type, description, is_fatal) values (seq_decl_template_checks.nextval, 100, '003-0001-00002', '"Дата начисленного дохода" указана некорректно', 'Заполнение Раздела 3 Графы 10.', 0);
				insert into decl_template_checks (id, declaration_type_id, check_code, check_type, description, is_fatal) values (seq_decl_template_checks.nextval, 100, '003-0001-00003', '"Дата применения вычета в текущем периоде" не соответствует "Дате начисления дохода"', 'Заполнение Раздела 3 Графы 10.', 0);
				insert into decl_template_checks (id, declaration_type_id, check_code, check_type, description, is_fatal) values (seq_decl_template_checks.nextval, 100, '001-0001-00006', '"Сумма применения вычета" указана некорректно', 'Заполнение Раздела 3 Графы 16.', 0);
				insert into decl_template_checks (id, declaration_type_id, check_code, check_type, description, is_fatal) values (seq_decl_template_checks.nextval, 100, '004-0001-00004', '«Дата исчисленного/удержанного/излишне удержанного/возвращенного налогоплательщику  налога»  рассчитана неверно.', 'Заполнение Раздела 2 Графы 15.', 1);
				insert into decl_template_checks (id, declaration_type_id, check_code, check_type, description, is_fatal) values (seq_decl_template_checks.nextval, 100, '004-0001-00005', '"НДФЛ исчисленный" рассчитан некорректно.', 'Заполнение Раздела 2 Графы 16.', 0);
				insert into decl_template_checks (id, declaration_type_id, check_code, check_type, description, is_fatal) values (seq_decl_template_checks.nextval, 100, '004-0001-00006', '"НДФЛ удержанный" рассчитан некорректно.', 'Заполнение Раздела 2 Графы 17.', 0);
				insert into decl_template_checks (id, declaration_type_id, check_code, check_type, description, is_fatal) values (seq_decl_template_checks.nextval, 100, '004-0001-00010', '"Срок перечисления в бюджет" рассчитан некорректно.', 'Заполнение Раздела 2 Графы 21.', 0);

				insert into decl_template_checks (id, declaration_type_id, check_code, check_type, description, is_fatal) values (seq_decl_template_checks.nextval, 101, '000-0007-00001', 'Наличие (отсутствие) значения в графе не соответствует алгоритму заполнения РНУ НДФЛ', 'Проверка наличия или отсутствия значения в графе в зависимости от условий', 1);
				insert into decl_template_checks (id, declaration_type_id, check_code, check_type, description, is_fatal) values (seq_decl_template_checks.nextval, 101, '001-0001-00002', 'Значение не соответствует данным справочника', 'Соответствие кода гражданства справочнику', 0);
				insert into decl_template_checks (id, declaration_type_id, check_code, check_type, description, is_fatal) values (seq_decl_template_checks.nextval, 101, '003-0001-00002', '"Дата начисленного дохода" указана некорректно', 'Заполнение Раздела 3 Графы 10.', 0);
				insert into decl_template_checks (id, declaration_type_id, check_code, check_type, description, is_fatal) values (seq_decl_template_checks.nextval, 101, '003-0001-00003', '"Дата применения вычета в текущем периоде" не соответствует "Дате начисления дохода"', 'Заполнение Раздела 3 Графы 10.', 0);
				insert into decl_template_checks (id, declaration_type_id, check_code, check_type, description, is_fatal) values (seq_decl_template_checks.nextval, 101, '001-0001-00006', '"Сумма применения вычета" указана некорректно', 'Заполнение Раздела 3 Графы 16.', 0);
				insert into decl_template_checks (id, declaration_type_id, check_code, check_type, description, is_fatal) values (seq_decl_template_checks.nextval, 101, '004-0001-00004', '«Дата исчисленного/удержанного/излишне удержанного/возвращенного налогоплательщику  налога»  рассчитана неверно.', 'Заполнение Раздела 2 Графы 15.', 1);
				insert into decl_template_checks (id, declaration_type_id, check_code, check_type, description, is_fatal) values (seq_decl_template_checks.nextval, 101, '004-0001-00005', '"НДФЛ исчисленный" рассчитан некорректно.', 'Заполнение Раздела 2 Графы 16.', 0);
				insert into decl_template_checks (id, declaration_type_id, check_code, check_type, description, is_fatal) values (seq_decl_template_checks.nextval, 101, '004-0001-00006', '"НДФЛ удержанный" рассчитан некорректно.', 'Заполнение Раздела 2 Графы 17.', 0);
				insert into decl_template_checks (id, declaration_type_id, check_code, check_type, description, is_fatal) values (seq_decl_template_checks.nextval, 101, '004-0001-00010', '"Срок перечисления в бюджет" рассчитан некорректно.', 'Заполнение Раздела 2 Графы 21.', 0);

				insert into decl_template_checks (id, declaration_type_id, declaration_template_id, check_code, check_type, description, is_fatal)
				select seq_decl_template_checks.nextval, ch.declaration_type_id, dt.id, ch.check_code, ch.check_type, ch.description, ch.is_fatal
				from decl_template_checks ch
				join declaration_template dt on dt.declaration_type_id = ch.declaration_type_id;
			END;
        </sql>
    </changeSet>

    <!-- https://jira.aplana.com/browse/SBRFNDFL-2435 -->
    <changeSet id="2.1-dloshkarev-9" author="dloshkarev">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script"
                    valueClobFile="templates/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl_check.groovy"/>
            <where>id=2</where>
        </update>
    </changeSet>
    <changeSet id="2.1-dloshkarev-10" author="dloshkarev">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script"
                    valueClobFile="templates/ndfl/consolidated_rnu_ndfl/v2016/consolidated_rnu_ndfl_check.groovy"/>
            <where>id=6</where>
        </update>
    </changeSet>

	<!--https://jira.aplana.com/browse/SBRFNDFL-2787 XSD. Не изменено ограничение "ИнфЧасть" на 100 тыс. maxOccurs="1000000"-->
	<changeSet id="2.1-rnurgaleev-181" author="rnurgaleev">
        <update tableName="BLOB_DATA">
            <column name="data"
                    valueBlobFile="templates/ndfl/primary_rnu_ndfl/v2016/rnu_ndfl_light.xsd"/>
            <where>id in (SELECT xsd FROM declaration_template WHERE id=100)</where>
        </update>
    </changeSet>

	<!--https://jira.aplana.com/browse/SBRFNDFL-2821 Добавить поле приоритет АСНУ в справочник АСНУ-->
	<changeSet id="2.1-rnurgaleev-182" author="rnurgaleev">
        <addColumn
                tableName="ref_book_asnu">
            <column name="priority" type="number(3)"/>
        </addColumn>
    </changeSet>

	<changeSet id="2.1-rnurgaleev-183" author="rnurgaleev">
        <sql>
            update ref_book_asnu set priority=case when code='1000' then 900
												   when code='2000' then 800
												   when code='3000' then 600
												   when code='4000' then 500
												   when code='5000' then 700
												   when code='6000' then 400
												   when code='6001' then 400
												   when code='7000' then 300
												   when code='6002' then 400
												   when code='6003' then 400
												   when code='6004' then 400
												   when code='6005' then 400
												   when code='1001' then 900
												   when code='8000' then 200
												   when code='9000' then 100
												   else 999 end;
        </sql>
    </changeSet>

	<changeSet id="2.1-rnurgaleev-184" author="rnurgaleev">
        <sql>
            alter table ref_book_asnu add constraint ref_book_asnu_chk_priority check(priority between 1 and 999);
        </sql>
    </changeSet>

	<!--https://jira.aplana.com/browse/SBRFNDFL-2821 Добавить поле приоритет АСНУ в справочник АСНУ-->
	<changeSet id="2.1-rnurgaleev-185" author="rnurgaleev">
        <sql splitStatements="false">
			begin
				execute immediate 'COMMENT ON COLUMN REF_BOOK_ASNU.ROLE_ALIAS IS ''Значение поля "Код роли" справочника "Системные роли" АСУН''';
				execute immediate 'COMMENT ON COLUMN REF_BOOK_ASNU.ROLE_NAME IS ''Значение поля "Наименование" справочника "Системные роли" АСУН''';
				execute immediate 'COMMENT ON COLUMN REF_BOOK_ASNU.PRIORITY IS ''Приоритет АСНУ. Определяет, нужно ли обновлять запись справочника "ФЛ" при идентификации''';

				insert into ref_book_attribute (id, ref_book_id, name, alias, type, ord,visible, width, required, is_unique, read_only, precision, max_length)
				values (9007, 900, 'Приоритет АСНУ', 'PRIORITY', 2, 5, 1, 20, 1, 0, 0, 0, 4);
			end;
		</sql>
    </changeSet>

    <!-- https://jira.aplana.com/browse/SBRFNDFL-2586 Внести изменения в механизм идентификации ФЛ: учитывать приоритет АСНУ; не учитывать разделители ДУЛ; выбирать записи с максимальным "Идентификатором ФЛ"-->
    <changeSet id="2.1-ytrofimov-65" author="ytrofimov">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script"
                    valueClobFile="templates/ndfl/consolidated_rnu_ndfl/v2016/consolidated_rnu_ndfl_check.groovy"/>
            <where>id=6</where>
        </update>
    </changeSet>

    <changeSet id="2.1-ytrofimov-66" author="ytrofimov">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script"
                    valueClobFile="templates/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl_calculate.groovy"/>
            <where>id=1</where>
        </update>
    </changeSet>

    <changeSet id="2.1-ytrofimov-67" author="ytrofimov">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script" valueClobFile="templates/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl_check.groovy"/>
            <where>id=2</where>
        </update>
    </changeSet>

    <!-- https://jira.aplana.com/browse/SBRFNDFL-2429 -->
    <changeSet id="2.1-aokunev-2" author="aokunev">
        <update tableName="BLOB_DATA">
            <column name="data" valueBlobFile="templates/refbook/declaration_type.groovy"/>
            <where>id='352adf59-372b-4020-98fe-8960dd5bc972'</where>
        </update>
    </changeSet>

	<!--https://jira.aplana.com/browse/SBRFNDFL-2766 Отслеживание изменений таблиц user и department в БД УН-->
	<changeSet id="2.1-rnurgaleev-186" author="rnurgaleev">
        <sql splitStatements="false">
			begin
				execute immediate 'drop trigger SEC_USER_AFTER_INS_UPD_DEL';
				execute immediate 'drop trigger DEP_AFTER_INS_UPD_DEL';
				execute immediate 'drop table log_un_changes';
			end;
        </sql>
    </changeSet>

	<changeSet id="2.1-rnurgaleev-187" author="rnurgaleev">
        <sql>
			CREATE SYNONYM vw_log_table_change FOR TAX_1_5_1.vw_log_table_change;
        </sql>
    </changeSet>

	<changeSet id="2.1-rnurgaleev-188" author="rnurgaleev">
        <createTable
                remarks="Отслеживание изменений в таблицах УН"
                tableName="LOG_TABLE_CHANGE_PROCESSED">
            <column name="id" type="number(18)" remarks="Идентификатор">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>

	<changeSet id="2.1-rnurgaleev-189" author="rnurgaleev">
		<addPrimaryKey
				columnNames="id"
				constraintName="pk_log_table_change_processed"
				tableName="LOG_TABLE_CHANGE_PROCESSED"/>
	</changeSet>

	<!--https://jira.aplana.com/browse/SBRFNDFL-2851 Изменение разделителей при сравнении ДУЛ-->
	<changeSet id="2.1-rnurgaleev-190" author="rnurgaleev">
        <sqlFile dbms="oracle"
                 encoding="utf8"
                 endDelimiter=""
                 path="/scripts/person_pkg4.sql"
                 relativeToChangelogFile="true"
                 splitStatements="false"/>
    </changeSet>

    <changeSet id="2.1-rnurgaleev-191" author="rnurgaleev">
        <sqlFile dbms="oracle"
                 encoding="utf8"
                 endDelimiter=""
                 path="/scripts/person_pkg_body4.sql"
                 relativeToChangelogFile="true"
                 splitStatements="false"/>
    </changeSet>

    <!--https://jira.aplana.com/browse/SBRFNDFL-2780-->
    <changeSet id="2.1-dloshkarev-11" author="dloshkarev">
        <insert tableName="CONFIGURATION_SCHEDULER">
            <column name="id" value="5"/>
            <column name="task_name" value="Мониторинг появление новых событий в УН, которые требуют обработки на стороне НДФЛ"/>
            <column name="schedule" value="0/30 * * * * ?"/>
            <column name="active" value="1"/>
            <column name="modification_date" valueDate="sysdate"/>
            <column name="last_fire_date" valueDate="sysdate"/>
        </insert>
    </changeSet>

    <!-- https://jira.aplana.com/browse/SBRFNDFL-2582 2.1 Реализовать выгрузку в Excel с использованием POI-->
    <changeSet id="2.1-ytrofimov-68" author="ytrofimov">
        <update tableName="DECLARATION_TEMPLATE">
            <column name="create_script" valueClobFile="templates/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl.groovy"/>
            <where>id=100</where>
        </update>
    </changeSet>

    <changeSet id="2.1-ytrofimov-69" author="ytrofimov">
        <update tableName="DECLARATION_TEMPLATE">
            <column name="create_script"
                    valueClobFile="templates/ndfl/consolidated_rnu_ndfl/v2016/consolidated_rnu_ndfl.groovy"/>
            <where>id=101</where>
        </update>
    </changeSet>

    <changeSet id="2.1-ytrofimov-70" author="ytrofimov">
        <update tableName="BLOB_DATA">
            <column name="data"
                    valueBlobFile="templates/ndfl/primary_rnu_ndfl/v2016/rnu_ndfl_person_all_db.xlsx"/>
            <where>id = '4b84692c-7f70-4d11-844d-e61e81655336'</where>
        </update>
    </changeSet>

    <changeSet id="2.1-ytrofimov-71" author="ytrofimov">
        <update tableName="BLOB_DATA">
            <column name="data"
                    valueBlobFile="templates/ndfl/consolidated_rnu_ndfl/v2016/rnu_ndfl_person_all_db.xlsx"/>
            <where>id = '64536272-05bc-42e8-82c5-347faf22da20'</where>
        </update>
    </changeSet>

    <!-- https://jira.aplana.com/browse/SBRFNDFL-2892 Реализовать выгрузку в Excel спецотчета РНУ НДФЛ по ФизЛицу через Apache POI -->
    <changeSet id="2.1-ytrofimov-72" author="ytrofimov">
        <update tableName="DECLARATION_TEMPLATE">
            <column name="create_script" valueClobFile="templates/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl.groovy"/>
            <where>id=100</where>
        </update>
    </changeSet>

    <changeSet id="2.1-ytrofimov-73" author="ytrofimov">
        <update tableName="DECLARATION_TEMPLATE">
            <column name="create_script"
                    valueClobFile="templates/ndfl/consolidated_rnu_ndfl/v2016/consolidated_rnu_ndfl.groovy"/>
            <where>id=101</where>
        </update>
    </changeSet>

    <changeSet id="2.1-dnovikov-2" author="dnovikov">
        <insert tableName="async_task_type">
            <column name="id" value="30"/>
            <column name="name" value="Загрузка данных РНУ НДФЛ из Excel-файла в ПНФ"/>
            <column name="handler_bean" value="ImportExcelFileAsyncTask"/>
            <column name="short_queue_limit" value="10000"/>
            <column name="limit_kind" value="Размер файла (Кбайт)"/>
        </insert>
    </changeSet>

    <changeSet id="2.1-dnovikov-3" author="dnovikov">
        <insert tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="id" value="14"/>
            <column name="declaration_template_id" value="100"/>
            <column name="event_id" value="7"/>
            <column name="script"
                    valueClobFile="templates/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl_import.groovy"/>
        </insert>
    </changeSet>

    <changeSet id="2.1-dnovikov-4" author="dnovikov">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script" valueClobFile="templates/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl_calculate.groovy"/>
            <where>id=1</where>
        </update>
    </changeSet>

    <changeSet id="2.1-apronin-1" author="apronin">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script"
                    valueClobFile="templates/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl_calculate.groovy"/>
            <where>id=1</where>
        </update>
    </changeSet>

    <!-- https://jira.aplana.com/browse/SBRFNDFL-2582 2.1 Реализовать выгрузку в Excel с использованием POI-->
    <changeSet id="2.1-ytrofimov-74" author="ytrofimov">
        <insert tableName="declaration_template_file">
            <column name="DECLARATION_TEMPLATE_ID" value="100"/>
            <column name="BLOB_DATA_ID" value="4b84692c-7f70-4d11-844d-e61e81655336"/>
        </insert>
    </changeSet>

    <changeSet id="2.1-ytrofimov-75" author="ytrofimov">
        <insert tableName="declaration_template_file">
            <column name="DECLARATION_TEMPLATE_ID" value="101"/>
            <column name="BLOB_DATA_ID" value="64536272-05bc-42e8-82c5-347faf22da20"/>
        </insert>
    </changeSet>

    <changeSet id="2.1-dnovikov-5" author="dnovikov">
        <insert tableName="async_task_type">
            <column name="id" value="31"/>
            <column name="name" value="Выгрузка данных налоговой формы в виде шаблона ТФ (Excel)"/>
            <column name="handler_bean" value="CreateExcelTemplateAsyncTask"/>
            <column name="limit_kind" value="Количество ФЛ в НФ"/>
        </insert>
    </changeSet>

    <!--https://jira.aplana.com/browse/SBRFNDFL-2910-->
    <changeSet id="2.1-dloshkarev-12" author="dloshkarev">
        <update tableName="DECL_TEMPLATE_CHECKS">
            <column name="CHECK_CODE" value="003-0001-00006"/>
            <where>CHECK_CODE='001-0001-00006'</where>
        </update>
    </changeSet>

    <changeSet id="2.1-dnovikov-6" author="dnovikov">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script"
                    valueClobFile="templates/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl_import.groovy"/>
            <where>id=14</where>
        </update>
    </changeSet>

    <changeSet id="2.1-ytrofimov-76" author="ytrofimov">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script"
                    valueClobFile="templates/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl_calculate.groovy"/>
            <where>id=1</where>
        </update>
    </changeSet>

    <!-- https://jira.aplana.com/browse/SBRFNDFL-2858 -->
    <changeSet id="2.1-dloshkarev-13" author="dloshkarev">
        <update tableName="DECLARATION_TEMPLATE">
            <column name="create_script" valueClobFile="templates/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl.groovy"/>
            <where>id=100</where>
        </update>
    </changeSet>

    <!-- https://jira.aplana.com/browse/SBRFNDFL-2582 2.1 Реализовать выгрузку в Excel с использованием POI-->
    <changeSet id="2.1-ytrofimov-77" author="ytrofimov">
        <delete tableName="declaration_template_file">
            <where>BLOB_DATA_ID='4b84692c-7f70-4d11-844d-e61e81655336'</where>
        </delete>
    </changeSet>

    <changeSet id="2.1-ytrofimov-78" author="ytrofimov">
        <delete tableName="declaration_template_file">
            <where>BLOB_DATA_ID='64536272-05bc-42e8-82c5-347faf22da20'</where>
        </delete>
    </changeSet>

    <changeSet id="2.1-ytrofimov-79" author="ytrofimov">
        <delete tableName="blob_data">
            <where>ID='4b84692c-7f70-4d11-844d-e61e81655336'</where>
        </delete>
    </changeSet>

    <changeSet id="2.1-ytrofimov-80" author="ytrofimov">
        <delete tableName="blob_data">
            <where>ID='64536272-05bc-42e8-82c5-347faf22da20'</where>
        </delete>
    </changeSet>

    <changeSet id="2.1-ytrofimov-81" author="ytrofimov">
        <insert tableName="blob_data">
            <column name="id" value="4b84692c-7f70-4d11-844d-e61e81655336"/>
            <column name="name" value="rnu_ndfl_person_all_db.xlsx"/>
            <column name="data" valueBlobFile="templates/ndfl/primary_rnu_ndfl/v2016/rnu_ndfl_person_all_db.xlsx"/>
            <column name="creation_date" valueDate="2017-12-04"/>
        </insert>
    </changeSet>

    <changeSet id="2.1-ytrofimov-82" author="ytrofimov">
        <insert tableName="blob_data">
            <column name="id" value="64536272-05bc-42e8-82c5-347faf22da20"/>
            <column name="name" value="rnu_ndfl_person_all_db.xlsx"/>
            <column name="data" valueBlobFile="templates/ndfl/consolidated_rnu_ndfl/v2016/rnu_ndfl_person_all_db.xlsx"/>
            <column name="creation_date" valueDate="2017-12-05"/>
        </insert>
    </changeSet>

    <changeSet id="2.1-ytrofimov-83" author="ytrofimov">
        <insert tableName="declaration_template_file">
            <column name="DECLARATION_TEMPLATE_ID" value="100"/>
            <column name="BLOB_DATA_ID" value="4b84692c-7f70-4d11-844d-e61e81655336"/>
        </insert>
    </changeSet>

    <changeSet id="2.1-ytrofimov-84" author="ytrofimov">
        <insert tableName="declaration_template_file">
            <column name="DECLARATION_TEMPLATE_ID" value="101"/>
            <column name="BLOB_DATA_ID" value="64536272-05bc-42e8-82c5-347faf22da20"/>
        </insert>
    </changeSet>

    <!-- https://jira.aplana.com/browse/SBRFNDFL-2848 -->
    <changeSet id="2.1-dloshkarev-15" author="dloshkarev">
        <insert tableName="async_task_type">
            <column name="id" value="32"/>
            <column name="name" value="Удаление налоговой формы"/>
            <column name="handler_bean" value="DeleteDeclarationAsyncTask"/>
            <column name="short_queue_limit" value="10000"/>
            <column name="limit_kind" value="Размер файла (Кбайт)"/>
        </insert>
    </changeSet>

    <changeSet id="2.1-dnovikov-7" author="dnovikov">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script"
                    valueClobFile="templates/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl_import.groovy"/>
            <where>id=14</where>
        </update>
    </changeSet>

    <!--https://jira.aplana.com/browse/SBRFNDFL-2782-->
    <changeSet id="2.1-ytrofimov-85" author="ytrofimov">
        <update tableName="DECLARATION_TEMPLATE">
            <column name="CREATE_SCRIPT" valueClobFile="templates/ndfl/report_2ndfl_1/v2016/report_2ndfl.groovy"/>
            <where>id=104</where>
        </update>
    </changeSet>

    <changeSet id="2.1-ytrofimov-86" author="ytrofimov">
        <update tableName="DECLARATION_TEMPLATE">
            <column name="create_script" valueClobFile="templates/ndfl/report_2ndfl_1/v2016/report_2ndfl.groovy"/>
            <where>id=102</where>
        </update>
    </changeSet>

    <changeSet id="2.1-dnovikov-8" author="dnovikov">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script"
                    valueClobFile="templates/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl_check.groovy"/>
            <where>id=2</where>
        </update>
    </changeSet>

    <!-- https://jira.aplana.com/browse/SBRFNDFL-2953 -->
    <changeSet id="2.1-ytrofimov-87" author="ytrofimov">
        <update tableName="DECLARATION_TEMPLATE">
            <column name="CREATE_SCRIPT" valueClobFile="templates/ndfl/report_2ndfl_1/v2016/report_2ndfl.groovy"/>
            <where>id=104</where>
        </update>
    </changeSet>

    <changeSet id="2.1-ytrofimov-88" author="ytrofimov">
        <update tableName="DECLARATION_TEMPLATE">
            <column name="create_script" valueClobFile="templates/ndfl/report_2ndfl_1/v2016/report_2ndfl.groovy"/>
            <where>id=102</where>
        </update>
    </changeSet>

    <!-- https://jira.aplana.com/browse/SBRFNDFL-2850 -->
    <changeSet id="2.1-aokunev-3" author="aokunev">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script"
                    valueClobFile="templates/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl_calculate.groovy"/>
            <where>id=1</where>
        </update>
    </changeSet>

    <changeSet id="2.1-dnovikov-9" author="dnovikov">
        <update tableName="DECLARATION_TEMPLATE">
            <column name="create_script" valueClobFile="templates/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl.groovy"/>
            <where>id=100</where>
        </update>
    </changeSet>

    <changeSet id="2.1-dnovikov-10" author="dnovikov">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script"
                    valueClobFile="templates/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl_import.groovy"/>
            <where>id=14</where>
        </update>
    </changeSet>

    <changeSet id="2.1-dnovikov-11" author="dnovikov">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script"
                    valueClobFile="templates/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl_import.groovy"/>
            <where>id=14</where>
        </update>
    </changeSet>

    <!-- https://jira.aplana.com/browse/SBRFNDFL-2956 -->
    <changeSet id="2.1-dloshkarev-16" author="dloshkarev">
        <update tableName="DECLARATION_TEMPLATE">
            <column name="create_script" valueClobFile="templates/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl.groovy"/>
            <where>id=100</where>
        </update>
    </changeSet>

    <!-- https://jira.aplana.com/browse/SBRFNDFL-2990 -->
    <changeSet id="2.1-ytrofimov-89" author="ytrofimov">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script"
                    valueClobFile="templates/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl_calculate.groovy"/>
            <where>id=1</where>
        </update>
    </changeSet>

    <!-- https://jira.aplana.com/browse/SBRFNDFL-2969 -->
    <changeSet id="2.1-dloshkarev-17" author="dloshkarev">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script"
                    valueClobFile="templates/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl_import.groovy"/>
            <where>id=14</where>
        </update>
    </changeSet>

    <!-- https://jira.aplana.com/browse/SBRFNDFL-2956 -->
    <changeSet id="2.1-dloshkarev-118" author="dloshkarev">
        <update tableName="DECLARATION_TEMPLATE">
            <column name="create_script" valueClobFile="templates/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl.groovy"/>
            <where>id=100</where>
        </update>
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script"
                    valueClobFile="templates/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl_import.groovy"/>
            <where>id=14</where>
        </update>
    </changeSet>

    <!-- https://jira.aplana.com/browse/SBRFNDFL-2969 -->
    <changeSet id="2.1-dloshkarev-19" author="dloshkarev">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script"
                    valueClobFile="templates/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl_import.groovy"/>
            <where>id=14</where>
        </update>
    </changeSet>

    <!-- https://jira.aplana.com/browse/SBRFNDFL-2850 -->
    <changeSet id="2.1-ytrofimov-90" author="ytrofimov">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script"
                    valueClobFile="templates/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl_calculate.groovy"/>
            <where>id=1</where>
        </update>
    </changeSet>

    <!-- https://jira.aplana.com/browse/SBRFNDFL-3004 Ошибка исполнения [-1]: startup failed: Script16.groovy: 566 при расчете первичной формы -->
    <changeSet id="2.1-ytrofimov-91" author="ytrofimov">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script"
                    valueClobFile="templates/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl_calculate.groovy"/>
            <where>id=1</where>
        </update>
    </changeSet>

    <changeSet id="2.1-ytrofimov-92" author="ytrofimov">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script"
                    valueClobFile="templates/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl_calculate.groovy"/>
            <where>id=1</where>
        </update>
    </changeSet>

    <changeSet id="2.1-dnovikov-12" author="dnovikov">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script"
                    valueClobFile="templates/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl_import.groovy"/>
            <where>id=14</where>
        </update>
    </changeSet>

    <!-- https://jira.aplana.com/browse/SBRFNDFL-2981 -->
    <changeSet id="2.1-ytrofimov-93" author="ytrofimov">
        <update tableName="DECLARATION_TEMPLATE">
            <column name="create_script" valueClobFile="templates/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl.groovy"/>
            <where>id=100</where>
        </update>
    </changeSet>

    <changeSet id="2.1-ytrofimov-94" author="ytrofimov">
        <update tableName="DECLARATION_TEMPLATE">
            <column name="create_script"
                    valueClobFile="templates/ndfl/consolidated_rnu_ndfl/v2016/consolidated_rnu_ndfl.groovy"/>
            <where>id=101</where>
        </update>
    </changeSet>

    <changeSet id="2.1-ytrofimov-95" author="ytrofimov">
        <update tableName="BLOB_DATA">
            <column name="data"
                    valueBlobFile="templates/ndfl/primary_rnu_ndfl/v2016/rnu_ndfl_person_all_db.xlsx"/>
            <where>id = '4b84692c-7f70-4d11-844d-e61e81655336'</where>
        </update>
    </changeSet>

    <changeSet id="2.1-ytrofimov-96" author="ytrofimov">
        <update tableName="BLOB_DATA">
            <column name="data"
                    valueBlobFile="templates/ndfl/consolidated_rnu_ndfl/v2016/rnu_ndfl_person_all_db.xlsx"/>
            <where>id = '64536272-05bc-42e8-82c5-347faf22da20'</where>
        </update>
    </changeSet>

    <!-- https://jira.aplana.com/browse/SBRFNDFL-3001 -->
    <changeSet id="2.1-ytrofimov-97" author="ytrofimov">
        <update tableName="DECLARATION_TEMPLATE">
            <column name="create_script" valueClobFile="templates/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl.groovy"/>
            <where>id=100</where>
        </update>
    </changeSet>
</databaseChangeLog>