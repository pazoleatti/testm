<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
                                       http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd">

    <changeSet id="3.9-adudenko-1" author="adudenko" runAlways="true">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script" valueClobFile="templates-3.9/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl_import.groovy"/>
            <where>DECLARATION_TEMPLATE_ID = 100 and EVENT_ID = 7</where>
        </update>
    </changeSet>

    <changeSet id="3.9-avoynov-1" author="avoynov" >
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script" valueClobFile="templates-3.9\ndfl\primary_rnu_ndfl\v2016\primary_rnu_ndfl_update_persons_data.groovy"/>
            <where>DECLARATION_TEMPLATE_ID = 100 and EVENT_ID = 11</where>
        </update>
    </changeSet>

    <changeSet id="3.9-avoynov-2" author="avoynov">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script" valueClobFile="templates-3.9\ndfl\consolidated_rnu_ndfl\v2016\consolidated_rnu_ndfl_update_persons_data.groovy"/>
            <where>DECLARATION_TEMPLATE_ID = 101 and EVENT_ID = 11</where>
        </update>
    </changeSet>

    <changeSet id="3.9-adudenko-2" author="adudenko">
        <sql>
            insert into ref_book_doc_state(id, name) values(9, 'Отправлено в ЭДО');
        </sql>
    </changeSet>

    <changeSet id="3.9-skononova-1" author="skononova">
        <sql>
            update ref_book_doc_state set name='Отправлен в ЭДО' where id=9;
        </sql>
    </changeSet>

    <changeSet id="3.9-skononova-2" author="skononova" runAlways="true">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script" valueClobFile="templates-3.9/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl_update_persons_data.groovy"/>
            <where>DECLARATION_TEMPLATE_ID = 100 and EVENT_ID = 11</where>
        </update>
    </changeSet>

    <changeSet id="3.9-skononova-3" author="skononova" runAlways="true">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script" valueClobFile="templates-3.9/ndfl/consolidated_rnu_ndfl/v2016/consolidated_rnu_ndfl_update_persons_data.groovy"/>
            <where>DECLARATION_TEMPLATE_ID = 101 and EVENT_ID = 11</where>
        </update>
    </changeSet>

    <changeSet id="3.9-skononova-4" author="skononova">
        <sql>
		create or replace view vw_declaration_data_file as 
		select declaration_data_id, blob_data_id, user_name, user_department_name, note, file_type_id 
		from declaration_data_file;

		grant select on vw_declaration_data_file to TAXREC_UNSTABLE ;
		grant references on declaration_data_file to TAXREC_UNSTABLE ;

		comment on table vw_declaration_data_file is 'Файлы налоговой формы';
		comment on column vw_declaration_data_file.declaration_data_id is 'Идентификатор экземпляра налоговой формы';
		comment on column vw_declaration_data_file.blob_data_id is 'Файл налоговой формы';
		comment on column vw_declaration_data_file.user_name is 'Пользователь, прикрепивший файл';
		comment on column vw_declaration_data_file.user_department_name is 'Подразделение пользователя, прикрепившего файл';
		comment on column vw_declaration_data_file.note is 'Комментарий к файлу';
		comment on column vw_declaration_data_file.file_type_id is 'Категория файла';
        </sql>
    </changeSet>

    <changeSet id="3.9-skononova-5" author="skononova">
        <sql>
		create or replace view vw_ref_book_attach_file_type as 
		select id, code, name from ref_book_attach_file_type;

		grant select on vw_ref_book_attach_file_type to TAXREC_UNSTABLE ;
		grant references on ref_book_attach_file_type to TAXREC_UNSTABLE ;

		comment on table vw_ref_book_attach_file_type is 'Категории прикрепленных файлов';
		comment on column vw_ref_book_attach_file_type.id is 'Идентификатор';
		comment on column vw_ref_book_attach_file_type.code is 'Код';
		comment on column vw_ref_book_attach_file_type.name is 'Наименование';
        </sql>
    </changeSet>


</databaseChangeLog>
