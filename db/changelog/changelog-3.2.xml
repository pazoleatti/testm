<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
                                       http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd">

    <!--https://jira.aplana.com/browse/SBRFNDFL-5492 удалил справочник "Настройки асинхронных задач"-->
    <changeSet id="3.2-dnovikov-1" author="dnovikov">
        <delete tableName="ref_book_attribute">
            <where>ref_book_id = 401</where>
        </delete>
        <delete tableName="ref_book">
            <where>id = 401</where>
        </delete>
    </changeSet>

    <!--https://jira.aplana.com/browse/SBRFNDFL-5492 удалил справочник "Настройки почты"-->
    <changeSet id="3.2-dnovikov-2" author="dnovikov">
        <delete tableName="ref_book_attribute">
            <where>ref_book_id = 400</where>
        </delete>
        <delete tableName="ref_book">
            <where>id = 400</where>
        </delete>
    </changeSet>

    <!--https://jira.aplana.com/browse/SBRFNDFL-5491 Удалить провайдер вертикальных справочников RefBookUniversal-->
    <changeSet id="3.2-dnovikov-3" author="dnovikov">
        <sql>
            drop table ref_book_value;
        </sql>
        <sql>
            drop table ref_book_record;
        </sql>
    </changeSet>

    <!--https://jira.aplana.com/browse/SBRFNDFL-5717 удалил справочник "Конфигурационные параметры"-->
    <changeSet id="3.2-dnovikov-4" author="dnovikov">
        <delete tableName="ref_book_attribute">
            <where>ref_book_id = 105</where>
        </delete>
        <delete tableName="ref_book">
            <where>id = 105</where>
        </delete>
    </changeSet>

    <!--https://jira.aplana.com/browse/SBRFNDFL-5494 удалил скрипт у справочника подразделений-->
    <changeSet id="3.2-dnovikov-5" author="dnovikov">
        <sql>
            update ref_book set script_id = null where id = 30
        </sql>
    </changeSet>

    <changeSet id="3.2-dnovikov-6" author="dnovikov">
        <update tableName="DECLARATION_TEMPLATE">
            <column name="CREATE_SCRIPT" valueClobFile="templates-3.2/ndfl/report_2ndfl_1/v2016/report_2ndfl.groovy"/>
            <where>declaration_type_id = 102</where>
        </update>
    </changeSet>
    <changeSet id="3.2-dnovikov-7" author="dnovikov">
        <update tableName="DECLARATION_TEMPLATE">
            <column name="CREATE_SCRIPT" valueClobFile="templates-3.2/ndfl/report_2ndfl_1/v2016/report_2ndfl.groovy"/>
            <where>declaration_type_id = 104</where>
        </update>
    </changeSet>

    <changeSet id="3.2-dnovikov-8" author="dnovikov">
        <update tableName="DECLARATION_TEMPLATE">
            <column name="CREATE_SCRIPT" valueClobFile="templates-3.2/ndfl/report_2ndfl_1/v2016/report_2ndfl.groovy"/>
            <where>declaration_type_id = 102</where>
        </update>
        <update tableName="DECLARATION_TEMPLATE">
            <column name="CREATE_SCRIPT" valueClobFile="templates-3.2/ndfl/report_2ndfl_1/v2016/report_2ndfl.groovy"/>
            <where>declaration_type_id = 104</where>
        </update>
    </changeSet>

    <!--https://jira.aplana.com/browse/SBRFNDFL-5662 Рефакторинг и оптимизация хранимых процедур идентификации физлиц-->
    <changeSet id="3.2-amandzyak-1" author="amandzyak">
        <sqlFile dbms="oracle"
                 encoding="utf8"
                 endDelimiter=""
                 path="/scripts/person_pkg_body11.sql"
                 relativeToChangelogFile="true"
                 splitStatements="false"/>
    </changeSet>

    <changeSet id="3.2-dnovikov-9" author="dnovikov">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script" valueClobFile="templates-3.2/ndfl/consolidated_rnu_ndfl/v2016/consolidated_rnu_ndfl_calculate.groovy"/>
            <where>DECLARATION_TEMPLATE_ID = 101 and EVENT_ID = 3</where>
        </update>
    </changeSet>

    <changeSet id="3.2-dnovikov-10" author="dnovikov">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script" valueClobFile="templates-3.2/ndfl/consolidated_rnu_ndfl/v2016/consolidated_rnu_ndfl_check.groovy"/>
            <where>DECLARATION_TEMPLATE_ID = 101 and EVENT_ID = 5</where>
        </update>
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script" valueClobFile="templates-3.2/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl_check.groovy"/>
            <where>DECLARATION_TEMPLATE_ID = 100 and EVENT_ID = 5</where>
        </update>
    </changeSet>

    <changeSet id="3.2-dnovikov-11" author="dnovikov">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script" valueClobFile="templates-3.2/ndfl/consolidated_rnu_ndfl/v2016/consolidated_rnu_ndfl_check.groovy"/>
            <where>DECLARATION_TEMPLATE_ID = 101 and EVENT_ID = 5</where>
        </update>
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script" valueClobFile="templates-3.2/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl_check.groovy"/>
            <where>DECLARATION_TEMPLATE_ID = 100 and EVENT_ID = 5</where>
        </update>
    </changeSet>

    <changeSet id="3.2-dnovikov-12" author="dnovikov">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script" valueClobFile="templates-3.2/ndfl/consolidated_rnu_ndfl/v2016/consolidated_rnu_ndfl_update_persons_data.groovy"/>
            <where>DECLARATION_TEMPLATE_ID = 101 and EVENT_ID = 11</where>
        </update>
    </changeSet>

    <!--https://jira.aplana.com/browse/SBRFNDFL-5080 новые виды КНФ-->
    <changeSet id="3.2-dnovikov-13" author="dnovikov">
        <sql>
            CREATE TABLE declaration_data_kpp (
                declaration_data_id NUMBER(18) NOT NULL,
                kpp                 VARCHAR2(9 CHAR) NOT NULL,
                CONSTRAINT declaration_data_kpp_pk PRIMARY KEY (declaration_data_id, kpp)
            ) organization INDEX;
            COMMENT ON TABLE declaration_data_kpp IS 'Включаемые в КНФ КПП';
            COMMENT ON column declaration_data_kpp.declaration_data_id IS 'Ид КНФ';
            COMMENT ON column declaration_data_kpp.kpp IS 'Включаемые в КНФ КПП';
        </sql>
    </changeSet>
    <!--https://jira.aplana.com/browse/SBRFNDFL-5080 новые виды КНФ-->
    <changeSet id="3.2-dnovikov-14" author="dnovikov">
        <sql>
            CREATE TABLE declaration_data_person (
                declaration_data_id NUMBER(18) NOT NULL,
                person_id           NUMBER(18) NOT NULL,
                CONSTRAINT ref_book_knf_type PRIMARY KEY (declaration_data_id, person_id)
            ) organization INDEX;
            COMMENT ON TABLE declaration_data_person IS 'Включаемые в КНФ КПП';
            COMMENT ON column declaration_data_person.declaration_data_id IS 'Ид КНФ';
            COMMENT ON column declaration_data_person.person_id IS 'Включаемые в КНФ КПП';
        </sql>
    </changeSet>
    <!--https://jira.aplana.com/browse/SBRFNDFL-5080 новые виды КНФ-->
    <changeSet id="3.2-dnovikov-15" author="dnovikov">
        <sql>
            CREATE TABLE ref_book_knf_type (
                id   NUMBER(9) NOT NULL,
                name VARCHAR2(2000 CHAR) NOT NULL,
                status NUMBER(1,0) default 0,
                CONSTRAINT ref_book_knf_type_pk PRIMARY KEY (id)
            );
            COMMENT ON TABLE ref_book_knf_type IS 'Типы КНФ';
            COMMENT ON column ref_book_knf_type.id IS 'Код вычета';
            COMMENT ON column ref_book_knf_type.name IS 'Наименование типа КНФ';
        </sql>
    </changeSet>
    <!--https://jira.aplana.com/browse/SBRFNDFL-5080 новые виды КНФ-->
    <changeSet id="3.2-dnovikov-16" author="dnovikov">
        <sql>
            insert into ref_book(id, name, table_name, read_only, IS_VERSIONED) values (909, 'Типы КНФ', 'REF_BOOK_KNF_TYPE', 1, 0);
            insert into ref_book_attribute(id, ref_book_id, name, alias, type, ord, precision, width, required, is_unique, max_length)
            values(9091, 909, 'Код', 'ID', 2, 1, 0, 9, 1, 1, 9);
            insert into ref_book_attribute(id, ref_book_id, name, alias, type, ord, width, required, is_unique, max_length)
            values(9092, 909, 'Наименование', 'NAME', 1, 2, 9, 1, 0, 2000);
        </sql>
    </changeSet>
    <!--https://jira.aplana.com/browse/SBRFNDFL-5080 новые виды КНФ-->
    <changeSet id="3.2-dnovikov-17" author="dnovikov">
        <sql>
            INSERT INTO ref_book_knf_type (id, name) VALUES (1, 'КНФ по всем данным');
            INSERT INTO ref_book_knf_type (id, name) VALUES (2, 'КНФ по неудержанному налогу');
            INSERT INTO ref_book_knf_type (id, name) VALUES (3, 'КНФ по обособленному подразделению');
            INSERT INTO ref_book_knf_type (id, name) VALUES (4, 'КНФ по ФЛ');
            INSERT INTO ref_book_knf_type (id, name) VALUES (5, 'КНФ для Приложения 2');
        </sql>
    </changeSet>
    <!--https://jira.aplana.com/browse/SBRFNDFL-5080 новые виды КНФ-->
    <changeSet id="3.2-dnovikov-18" author="dnovikov">
        <sql>
            ALTER TABLE declaration_data ADD knf_type_id NUMBER(9);
            COMMENT ON column declaration_data.knf_type_id IS 'Тип КНФ';
            ALTER TABLE declaration_data ADD CONSTRAINT declaration_data_knf_type FOREIGN KEY(knf_type_id) REFERENCES ref_book_knf_type(id);
            UPDATE declaration_data SET knf_type_id = 1 WHERE declaration_template_id = 101;
            ALTER TABLE declaration_data ADD CONSTRAINT declaration_data_knf_type_ck CHECK (declaration_template_id = 101 AND knf_type_id IS NOT NULL OR declaration_template_id != 101 AND knf_type_id is null);
        </sql>
    </changeSet>
    <!--https://jira.aplana.com/browse/SBRFNDFL-5080 новые виды КНФ-->
    <changeSet id="3.2-dnovikov-19" author="dnovikov">
        <sql>
            ALTER TABLE ref_book_income_type ADD app2_include NUMBER(1);
            update ref_book_income_type set app2_include = 1;
            ALTER TABLE ref_book_income_type MODIFY app2_include NOT NULL;
            COMMENT ON column ref_book_income_type.app2_include IS 'Включается в Приложение 2';
            insert into ref_book_attribute(id, ref_book_id, name, alias, type, ord, precision, width, required, is_unique, max_length)
                values(9223, 922, 'Включается в Приложение 2', 'APP2_INCLUDE', 2, 3, 0, 9, 1, 0, 1);
        </sql>
    </changeSet>

    <!-- https://jira.aplana.com/browse/SBRFNDFL-5657 Реализовать изменение расчета количества ФЛ для отражения в 6-НДФЛ -->
    <changeSet id="3.2-snazin-0" author="snazin">
        <update tableName="DECLARATION_TEMPLATE">
            <column name="CREATE_SCRIPT" valueClobFile="templates-3.2/ndfl/report_6ndfl/v2016/report_6ndfl.groovy"/>
            <where>declaration_type_id = 103</where>
        </update>
    </changeSet>

    <!-- https://jira.aplana.com/browse/SBRFNDFL-5623 Заменить «налогоплательщицу» на «налогоплательщика» в типе сообщения в протоколе проверки -->
    <changeSet id="3.2-snazin-1" author="snazin">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script" valueClobFile="templates-3.2/ndfl/consolidated_rnu_ndfl/v2016/consolidated_rnu_ndfl_check.groovy"/>
            <where>DECLARATION_TEMPLATE_ID = 101 and EVENT_ID = 5</where>
        </update>
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script" valueClobFile="templates-3.2/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl_check.groovy"/>
            <where>DECLARATION_TEMPLATE_ID = 100 and EVENT_ID = 5</where>
        </update>
    </changeSet>

    <changeSet id="3.2-dnovikov-20" author="dnovikov">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script" valueClobFile="templates-3.2/ndfl/consolidated_rnu_ndfl/v2016/consolidated_rnu_ndfl_calculate.groovy"/>
            <where>DECLARATION_TEMPLATE_ID = 101 and EVENT_ID = 3</where>
        </update>
    </changeSet>

    <!-- https://jira.aplana.com/browse/SBRFNDFL-5657 Поправил тип поля xml в 6-НДФЛ -->
    <changeSet id="3.2-snazin-2" author="snazin">
        <update tableName="DECLARATION_TEMPLATE">
            <column name="CREATE_SCRIPT" valueClobFile="templates-3.2/ndfl/report_6ndfl/v2016/report_6ndfl.groovy"/>
            <where>declaration_type_id = 103</where>
        </update>
    </changeSet>

    <!--https://jira.aplana.com/browse/SBRFNDFL-5080 новые виды КНФ-->
    <changeSet id="3.2-dnovikov-21" author="dnovikov">
        <sql>
            update ref_book_income_type set app2_include = case when
                code in ('1010','1011','1110','1120','1530','1531','1532','1533','1535','1536','1537','1538','1539','1540','1541','1542','1544','1545','1546','1547','1548','1549','1550','1551','1552','1553','1554','2640','2641','3023')
                then 1
                else 0 end;
        </sql>
    </changeSet>

    <changeSet id="3.2-dnovikov-22" author="dnovikov">
        <update tableName="blob_data">
            <column name="data"
                    valueBlobFile="templates-3.2/refbook/department_configs.groovy"/>
            <where>id = (select script_id from ref_book r where r.id = 951)</where>
        </update>
    </changeSet>

    <!-- https://jira.aplana.com/browse/SBRFNDFL-5618 Реализовать удаление из проверки "Наличие обязательных реквизитов для формирования отчетности" реквизитов, связанных с адресом -->
    <changeSet id="3.2-snazin-3" author="snazin">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script" valueClobFile="templates-3.2/ndfl/consolidated_rnu_ndfl/v2016/consolidated_rnu_ndfl_check.groovy"/>
            <where>DECLARATION_TEMPLATE_ID = 101 and EVENT_ID = 5</where>
        </update>
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script" valueClobFile="templates-3.2/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl_check.groovy"/>
            <where>DECLARATION_TEMPLATE_ID = 100 and EVENT_ID = 5</where>
        </update>
    </changeSet>

    <!--https://jira.aplana.com/browse/SBRFNDFL-5080 новые виды КНФ-->
    <changeSet id="3.2-dnovikov-23" author="dnovikov">
        <sql>
            alter table declaration_data_kpp add constraint dd_kpp_dd_fk foreign key (declaration_data_id) references declaration_data (id) on delete cascade;
        </sql>
    </changeSet>
    <!--https://jira.aplana.com/browse/SBRFNDFL-5080 новые виды КНФ-->
    <changeSet id="3.2-dnovikov-24" author="dnovikov">
        <sql>
            alter table declaration_data_person add constraint dd_person_dd_fk foreign key (declaration_data_id) references declaration_data (id) on delete cascade;
        </sql>
    </changeSet>
    <!--https://jira.aplana.com/browse/SBRFNDFL-5080 новые виды КНФ-->
    <changeSet id="3.2-dnovikov-25" author="dnovikov">
        <sql>
            alter table declaration_data_person add constraint dd_person_person_fk foreign key (person_id) references ref_book_person (id) on delete cascade;
        </sql>
    </changeSet>

    <changeSet id="3.2-dnovikov-26" author="dnovikov">
        <update tableName="DECLARATION_TEMPLATE">
            <column name="CREATE_SCRIPT" valueClobFile="templates-3.2/ndfl/report_2ndfl_1/v2016/report_2ndfl.groovy"/>
            <where>declaration_type_id = 102</where>
        </update>
        <update tableName="DECLARATION_TEMPLATE">
            <column name="CREATE_SCRIPT" valueClobFile="templates-3.2/ndfl/report_2ndfl_1/v2016/report_2ndfl.groovy"/>
            <where>declaration_type_id = 104</where>
        </update>
        <update tableName="BLOB_DATA">
            <column name="data"
                    valueBlobFile="templates-3.2/refbook/declaration_type.groovy"/>
            <where>id in (select script_id from ref_book r where r.id = 207)</where>
        </update>
        <update tableName="DECLARATION_TEMPLATE">
            <column name="CREATE_SCRIPT" valueClobFile="templates-3.2/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl.groovy"/>
            <where>declaration_type_id = 100</where>
        </update>
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script" valueClobFile="templates-3.2/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl_import.groovy"/>
            <where>DECLARATION_TEMPLATE_ID = 100 and EVENT_ID = 7</where>
        </update>
        <update tableName="DECLARATION_TEMPLATE">
            <column name="CREATE_SCRIPT" valueClobFile="templates-3.2/ndfl/report_6ndfl/v2016/report_6ndfl.groovy"/>
            <where>declaration_type_id = 103</where>
        </update>
    </changeSet>

    <changeSet id="3.2-dnovikov-27" author="dnovikov">
        <update tableName="DECLARATION_TEMPLATE">
            <column name="CREATE_SCRIPT" valueClobFile="templates-3.2/ndfl/report_2ndfl_1/v2016/report_2ndfl.groovy"/>
            <where>declaration_type_id = 102</where>
        </update>
        <update tableName="DECLARATION_TEMPLATE">
            <column name="CREATE_SCRIPT" valueClobFile="templates-3.2/ndfl/report_2ndfl_1/v2016/report_2ndfl.groovy"/>
            <where>declaration_type_id = 104</where>
        </update>
        <update tableName="DECLARATION_TEMPLATE">
            <column name="CREATE_SCRIPT" valueClobFile="templates-3.2/ndfl/report_6ndfl/v2016/report_6ndfl.groovy"/>
            <where>declaration_type_id = 103</where>
        </update>
    </changeSet>

    <changeSet id="3.2-dnovikov-28" author="dnovikov">
        <update tableName="DECLARATION_TEMPLATE">
            <column name="CREATE_SCRIPT" valueClobFile="templates-3.2/ndfl/report_6ndfl/v2016/report_6ndfl.groovy"/>
            <where>declaration_type_id = 103</where>
        </update>
    </changeSet>

    <changeSet id="3.2-dnovikov-29" author="dnovikov">
        <update tableName="DECLARATION_TEMPLATE">
            <column name="CREATE_SCRIPT" valueClobFile="templates-3.2/ndfl/report_2ndfl_1/v2016/report_2ndfl.groovy"/>
            <where>declaration_type_id = 102</where>
        </update>
        <update tableName="DECLARATION_TEMPLATE">
            <column name="CREATE_SCRIPT" valueClobFile="templates-3.2/ndfl/report_2ndfl_1/v2016/report_2ndfl.groovy"/>
            <where>declaration_type_id = 104</where>
        </update>
        <update tableName="DECLARATION_TEMPLATE">
            <column name="CREATE_SCRIPT" valueClobFile="templates-3.2/ndfl/report_6ndfl/v2016/report_6ndfl.groovy"/>
            <where>declaration_type_id = 103</where>
        </update>
    </changeSet>

    <!--правка на 3.2-dnovikov-13 и 3.2-dnovikov-14 и 3.2-dnovikov-15-->
    <changeSet id="3.2-dnovikov-30" author="dnovikov">
        <sql>
            COMMENT ON column declaration_data_kpp.kpp IS 'КПП';
            COMMENT ON TABLE declaration_data_person IS 'Включаемые в КНФ ФЛ';
            COMMENT ON column declaration_data_person.person_id IS 'Ид ФЛ';
            COMMENT ON column ref_book_knf_type.id IS 'Код';
        </sql>
    </changeSet>

    <changeSet id="3.2-dnovikov-31" author="dnovikov">
        <update tableName="DECLARATION_TEMPLATE">
            <column name="CREATE_SCRIPT" valueClobFile="templates-3.2/ndfl/consolidated_rnu_ndfl/v2016/consolidated_rnu_ndfl.groovy"/>
            <where>declaration_type_id = 101</where>
        </update>
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script" valueClobFile="templates-3.2/ndfl/consolidated_rnu_ndfl/v2016/consolidated_rnu_ndfl_check.groovy"/>
            <where>DECLARATION_TEMPLATE_ID = 101 and EVENT_ID = 5</where>
        </update>
        <update tableName="DECLARATION_TEMPLATE">
            <column name="CREATE_SCRIPT" valueClobFile="templates-3.2/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl.groovy"/>
            <where>declaration_type_id = 100</where>
        </update>
        <update tableName="DECLARATION_TEMPLATE">
            <column name="CREATE_SCRIPT" valueClobFile="templates-3.2/ndfl/report_2ndfl_1/v2016/report_2ndfl.groovy"/>
            <where>declaration_type_id = 102</where>
        </update>
        <update tableName="DECLARATION_TEMPLATE">
            <column name="CREATE_SCRIPT" valueClobFile="templates-3.2/ndfl/report_2ndfl_1/v2016/report_2ndfl.groovy"/>
            <where>declaration_type_id = 104</where>
        </update>
        <update tableName="DECLARATION_TEMPLATE">
            <column name="CREATE_SCRIPT" valueClobFile="templates-3.2/ndfl/report_6ndfl/v2016/report_6ndfl.groovy"/>
            <where>declaration_type_id = 103</where>
        </update>
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script" valueClobFile="templates-3.2/ndfl/report_6ndfl/v2016/report_6ndfl_check.groovy"/>
            <where>DECLARATION_TEMPLATE_ID = 103 and EVENT_ID = 5</where>
        </update>
    </changeSet>

    <changeSet id="3.2-ishevchuk-1" author="ishevchuk">
        <update tableName="DECLARATION_TEMPLATE">
            <column name="CREATE_SCRIPT" valueClobFile="templates-3.2/ndfl/consolidated_rnu_ndfl/v2016/consolidated_rnu_ndfl.groovy"/>
            <where>declaration_type_id = 101</where>
        </update>
        <update tableName="DECLARATION_TEMPLATE">
            <column name="CREATE_SCRIPT" valueClobFile="templates-3.2/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl.groovy"/>
            <where>declaration_type_id = 100</where>
        </update>
        <update tableName="DECLARATION_TEMPLATE">
            <column name="CREATE_SCRIPT" valueClobFile="templates-3.2/ndfl/report_2ndfl_1/v2016/report_2ndfl.groovy"/>
            <where>declaration_type_id = 102</where>
        </update>
        <update tableName="DECLARATION_TEMPLATE">
            <column name="CREATE_SCRIPT" valueClobFile="templates-3.2/ndfl/report_2ndfl_1/v2016/report_2ndfl.groovy"/>
            <where>declaration_type_id = 104</where>
        </update>
    </changeSet>
    <!--https://jira.aplana.com/browse/SBRFNDFL-5692 -->
    <changeSet id="3.2-ytrofimov-4" author="ytrofimov">
        <update tableName="BLOB_DATA">
            <column name="data"
                    valueBlobFile="templates-3.2/refbook/person.groovy"/>
            <where>id in (select script_id from ref_book r where r.id = 904)</where>
        </update>
    </changeSet>

    <!--https://jira.aplana.com/browse/SBRFNDFL-5692 -->
    <changeSet id="3.2-ytrofimov-5" author="ytrofimov">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script" valueClobFile="templates-3.2/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl_calculate.groovy"/>
            <where>DECLARATION_TEMPLATE_ID = 100 and EVENT_ID = 3</where>
        </update>
    </changeSet>

    <!--https://jira.aplana.com/browse/SBRFNDFL-5692 -->
    <changeSet id="3.2-ytrofimov-6" author="ytrofimov">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script" valueClobFile="templates-3.2/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl_check.groovy"/>
            <where>DECLARATION_TEMPLATE_ID = 100 and EVENT_ID = 5</where>
        </update>
    </changeSet>

    <!--https://jira.aplana.com/browse/SBRFNDFL-5692 -->
    <changeSet id="3.2-ytrofimov-7" author="ytrofimov">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script" valueClobFile="templates-3.2/ndfl/consolidated_rnu_ndfl/consolidated_rnu_ndfl_calculate.groovy"/>
            <where>DECLARATION_TEMPLATE_ID = 101 and EVENT_ID = 3</where>
        </update>
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script" valueClobFile="templates-3.2/ndfl/consolidated_rnu_ndfl/consolidated_rnu_ndfl_check.groovy"/>
            <where>DECLARATION_TEMPLATE_ID = 101 and EVENT_ID = 5</where>
        </update>
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script" valueClobFile="templates-3.2/ndfl/consolidated_rnu_ndfl/consolidated_rnu_ndfl_update_persons_data.groovy"/>
            <where>DECLARATION_TEMPLATE_ID = 101 and EVENT_ID = 11</where>
        </update>
    </changeSet>

    <!--https://jira.aplana.com/browse/SBRFNDFL-5792 Изменение процедур по идентификации для новой структуры хранения реестра ФЛ-->
    <changeSet id="3.2-amandzyak-0" author="amandzyak">
        <sqlFile dbms="oracle"
                 encoding="utf8"
                 endDelimiter=""
                 path="/scripts/person_pkg_body12.sql"
                 relativeToChangelogFile="true"
                 splitStatements="false"/>
    </changeSet>

    <!--https://jira.aplana.com/browse/SBRFNDFL-5792 Изменение процедур по идентификации для новой структуры хранения реестра ФЛ-->
    <changeSet id="3.2-amandzyak-2" author="amandzyak">
        <sqlFile dbms="oracle"
                 encoding="utf8"
                 endDelimiter=""
                 path="/scripts/person_pkg7.sql"
                 relativeToChangelogFile="true"
                 splitStatements="false"/>
    </changeSet>

    <!--https://jira.aplana.com/browse/SBRFNDFL-5792 Изменение процедур по идентификации для новой структуры хранения реестра ФЛ-->
    <changeSet id="3.2-amandzyak-3" author="amandzyak">
        <sqlFile dbms="oracle"
                 encoding="utf8"
                 endDelimiter=""
                 path="/scripts/person_pkg_body13.sql"
                 relativeToChangelogFile="true"
                 splitStatements="false"/>
    </changeSet>

</databaseChangeLog>