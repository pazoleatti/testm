<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
                                       http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd">

    <!--https://jira.aplana.com/browse/SBRFNDFL-7132 - Добавление нового Справочника Подсистем-->
    <changeSet id="3.6-amandzyak-1" author="amandzyak">
        <sqlFile dbms="oracle"
                 encoding="utf8"
                 endDelimiter=""
                 path="/scripts/create_synonyms_subsystem.sql"
                 relativeToChangelogFile="true"
                 splitStatements="false"/>
    </changeSet>

    <!--https://jira.aplana.com/browse/SBRFNDFL-7159 Реализовать перенос пустых значений из Реестра ФЛ в Раздел 1 РНУ при обновлении данных ФЛ-->
    <changeSet id="3.6-ytrofimov-1" author="ytrofimov" runAlways="true">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script" valueClobFile="templates-3.6/ndfl/consolidated_rnu_ndfl/v2016/consolidated_rnu_ndfl_update_persons_data.groovy"/>
            <where>DECLARATION_TEMPLATE_ID = 101 and EVENT_ID = 11</where>
        </update>
    </changeSet>

    <!--https://jira.aplana.com/browse/SBRFNDFL-7159 Реализовать перенос пустых значений из Реестра ФЛ в Раздел 1 РНУ при обновлении данных ФЛ-->
    <changeSet id="3.6-ytrofimov-2" author="ytrofimov" runAlways="true">
        <update tableName="DECL_TEMPLATE_EVENT_SCRIPT">
            <column name="script" valueClobFile="templates-3.6/ndfl/primary_rnu_ndfl/v2016/primary_rnu_ndfl_update_persons_data.groovy"/>
            <where>DECLARATION_TEMPLATE_ID = 100 and EVENT_ID = 11</where>
        </update>
    </changeSet>

    <!--https://jira.aplana.com/browse/SBRFNDFL-7175 Реализовать запись в историю изменений ОНФ информацию о замене "состояние ЭД" и прикладывании файла-->
    <changeSet id="3.6-ytrofimov-3" author="ytrofimov">
        <sql>
            insert into event(id, name) values(10002, 'Прикрепление файла ответа от ФНС');
        </sql>
    </changeSet>

    <!--https://jira.aplana.com/browse/SBRFNDFL-7175 Реализовать запись в историю изменений ОНФ информацию о замене "состояние ЭД" и прикладывании файла-->
    <changeSet id="3.6-ytrofimov-4" author="ytrofimov" runAlways="true">
        <update tableName="BLOB_DATA">
            <column name="data"
                    valueBlobFile="templates-3.6/refbook/declaration_type.groovy"/>
            <where>id in (select script_id from ref_book r where r.id = 207)</where>
        </update>
    </changeSet>

</databaseChangeLog>