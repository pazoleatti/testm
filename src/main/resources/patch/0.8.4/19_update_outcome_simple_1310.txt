import com.aplana.sbrf.taxaccounting.model.Column
import com.aplana.sbrf.taxaccounting.model.ColumnType
import com.aplana.sbrf.taxaccounting.model.FormStyle
import com.aplana.sbrf.taxaccounting.model.FormTemplate
import com.aplana.sbrf.taxaccounting.model.FormType
import org.apache.commons.io.IOUtils

/**
 * Обновляет макет НФ и столбцы макета.
 * # Инструкция:
 * Вставить текст данного скрипта на странице, соответствующей ссылке с окончанием:
 * .../gwtapp/#!scriptExecution
 * Нажать "Выполнить".
 */

def form_template_id = 1310
try {
    def sql = "UPDATE FORM_TEMPLATE SET name = 'Расходы, учитываемые в простых РНУ (расходы простые)', header = '787/Р/1' where id = $form_template_id"
    namedParameterJdbcTemplate.update(sql, [:])
    logger.info("Макет НФ с id = $form_template_id обновлен!")

    def sqls = [
            "UPDATE FORM_COLUMN SET max_length = 50 where form_template_id = $form_template_id and alias = 'consumptionTypeId'",
            "UPDATE FORM_COLUMN SET max_length = 2000 where form_template_id = $form_template_id and alias = 'consumptionGroup'",
            "UPDATE FORM_COLUMN SET max_length = 2000 where form_template_id = $form_template_id and alias = 'consumptionTypeByOperation'",
            "UPDATE FORM_COLUMN SET max_length = 20 where form_template_id = $form_template_id and alias = 'consumptionAccountNumber'",
            "UPDATE FORM_COLUMN SET name = 'РНУ-7 (графа 12) сумма. Сумма' where form_template_id = $form_template_id and alias = 'rnu7Field12Accepted'",
            "UPDATE FORM_COLUMN SET name = 'РНУ-7 (графа 12) сумма. В т.ч. учтено в предыдущих налоговых периодах по графе 10' where form_template_id = $form_template_id and alias = 'rnu7Field12PrevTaxPeriod'",
            "UPDATE FORM_COLUMN SET name = 'РНУ-5 (графа 5) сумма' where form_template_id = $form_template_id and alias = 'rnu5Field5Accepted'",
            "UPDATE FORM_COLUMN SET max_length = 20 where form_template_id = $form_template_id and alias = 'accountingRecords'",
            "UPDATE FORM_COLUMN SET name = 'Сумма по бухгалтерскому учёту. В Приложении №6' where form_template_id = $form_template_id and alias = 'opuSumByEnclosure2'",
            "UPDATE FORM_COLUMN SET name = 'Сумма по бухгалтерскому учёту. В Таблице \"Р\"' where form_template_id = $form_template_id and alias = 'opuSumByTableP'",
            "UPDATE FORM_COLUMN SET name = 'Сумма по бухгалтерскому учёту. В бухгалтерской отчётности' where form_template_id = $form_template_id and alias = 'opuSumTotal'",
            "UPDATE FORM_COLUMN SET ord = 15 where form_template_id = $form_template_id and alias = 'difference'",
    ]

    sqls.each { tmpSql ->
        namedParameterJdbcTemplate.update(tmpSql, [:])
    }
    logger.info("Столбцы макета НФ с id = $form_template_id обновлены!")
} catch (Exception ex) {
    logger.error("Error: ${ex.getLocalizedMessage()}. Все изменения откатаны")
}