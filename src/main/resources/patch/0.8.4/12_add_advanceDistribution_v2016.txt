import com.aplana.sbrf.taxaccounting.model.Column
import com.aplana.sbrf.taxaccounting.model.ColumnType
import com.aplana.sbrf.taxaccounting.model.FormStyle
import com.aplana.sbrf.taxaccounting.model.FormTemplate
import com.aplana.sbrf.taxaccounting.model.FormType
import org.apache.commons.io.IOUtils

/**
 Создает макет НФ, кроме таблицы для хранения данных
 # Инструкция:
 Вставить текст данного скрипта на странице, соответствующей ссылке с окончанием:
 .../gwtapp/#!scriptExecution
 Нажать "Выполнить".

 */

boolean createType = false
boolean createTemplate = true
boolean addColumns = true
boolean addStyles = true
boolean addDataRows = true
boolean addDataHeaders = true
boolean addScript = true

try {
    // id типа формы, имя типа формы, вид налога(I, T, V, D, P, E), включать в ИФРС(флаг), имя ИФРС
    FormType formType = new FormType()
    formType.setId(500)
    formType.setName('Расчет распределения авансовых платежей и налога на прибыль по обособленным подразделениям организации')
    formType.setTaxType(TaxType.INCOME)
    formType.setIsIfrs(false)
    formType.setIfrsName('')
    formType.setCode('')
    // id шаблона формы, имя шаблона короткое, имя шаблона полное, год версии, ежемесячность(флаг), код
    FormTemplate formTemplate = new FormTemplate()
    formTemplate.setId(2500)
    formTemplate.setFixedRows(false)
    formTemplate.setName('Расчет распределения авансовых платежей и налога на прибыль по обособленным подразделениям организации')
    formTemplate.setFullName('Расчет распределения авансовых платежей и налога на прибыль по обособленным подразделениям организации ')
    formTemplate.setVersion(Date.parse('dd.MM.yyyy', '01.01.2016'))
    formTemplate.setMonthly(false)
    formTemplate.setHeader('787/1/1')
    formTemplate.setComparative(false)
    formTemplate.setAccruing(false)
    formTemplate.setUpdating(false)

    def form_type_id = formType.id
    def form_template_id = formTemplate.id

    def rs = namedParameterJdbcTemplate.queryForObject("SELECT count(id) from FORM_TYPE where id = $form_type_id", [:], Integer.class)
    if (rs == 1) {
        logger.info("Макет НФ с данным id = $form_type_id уже существует в системе!")
        if (createType) {
            return
        }
    }

    rs = namedParameterJdbcTemplate.queryForObject("SELECT count(id) from FORM_TEMPLATE where id = $form_template_id", [:], Integer.class)
    if (rs == 1) {
        logger.info("Версия макета НФ с данным id = $form_template_id уже существует в системе!")
        if (createTemplate) {
            return
        }
    }

    addTypeTemplate(formType, formTemplate, createType, createTemplate)

    List<Column> formColumns = new ArrayList<>()
	def referenceColumnMap = [:]

    //Добавление колонок
    // NAME, ALIAS, TYPE, WIDTH, PRECISION, MAX_LENGTH, CHECKING, ATTRIBUTE_ID, FORMAT, FILTER, PARENT_COLUMN_ID, ATTRIBUTE_ID2, NUMERATION_ROW
    if (addColumns) {
        def Column formColumn = new AutoNumerationColumn()
        formColumn.setOrder(1)
        formColumn.setName('№ пп')
        formColumn.setAlias('number')
        formColumn.setColumnType(ColumnType.find{ it.title.equals('Автонумеруемая графа')})
        formColumn.setWidth(5)
        formColumn.setChecking(false)
        formColumn.setNumerationType(NumerationType.getById(0))
        formColumns.add(formColumn)

        formColumn = new StringColumn()
        formColumn.setOrder(2)
        formColumn.setName('fix')
        formColumn.setAlias('fix')
        formColumn.setColumnType(ColumnType.find{ it.title.equals('Строка')})
        formColumn.setWidth(0)
        formColumn.setChecking(false)
        formColumn.setMaxLength(1000)
        formColumn.setPrevLength(0)
        formColumns.add(formColumn)

        formColumn = new RefBookColumn()
        formColumn.setOrder(3)
        formColumn.setName('Территориальный банк')
        formColumn.setAlias('regionBank')
        formColumn.setColumnType(ColumnType.find{ it.title.equals('Справочник')})
        formColumn.setWidth(12)
        formColumn.setChecking(false)
        formColumn.setRefBookAttributeId(161)
        formColumn.setRefBookAttributeId2(null)
        formColumn.setNameAttributeId(161)
        formColumn.setFilter('' ?: null)
        formColumns.add(formColumn)

        formColumn = new RefBookColumn()
        formColumn.setOrder(4)
        formColumn.setName('Подразделение территориального банка')
        formColumn.setAlias('regionBankDivision')
        formColumn.setColumnType(ColumnType.find{ it.title.equals('Справочник')})
        formColumn.setWidth(9)
        formColumn.setChecking(false)
        formColumn.setRefBookAttributeId(161)
        formColumn.setRefBookAttributeId2(null)
        formColumn.setNameAttributeId(161)
        formColumn.setFilter('' ?: null)
        formColumns.add(formColumn)

        formColumn = new StringColumn()
        formColumn.setOrder(5)
        formColumn.setName('Наименование подразделения в декларации')
        formColumn.setAlias('divisionName')
        formColumn.setColumnType(ColumnType.find{ it.title.equals('Строка')})
        formColumn.setWidth(10)
        formColumn.setChecking(false)
        formColumn.setMaxLength(1000)
        formColumn.setPrevLength(0)
        formColumns.add(formColumn)

        formColumn = new StringColumn()
        formColumn.setOrder(6)
        formColumn.setName('КПП')
        formColumn.setAlias('kpp')
        formColumn.setColumnType(ColumnType.find{ it.title.equals('Строка')})
        formColumn.setWidth(5)
        formColumn.setChecking(false)
        formColumn.setMaxLength(9)
        formColumn.setPrevLength(0)
        formColumns.add(formColumn)

        formColumn = new NumericColumn()
        formColumn.setOrder(7)
        formColumn.setName('Средняя остаточная стоимость амортизируемого имущества (руб.)')
        formColumn.setAlias('propertyPrice')
        formColumn.setColumnType(ColumnType.find{ it.title.equals('Число')})
        formColumn.setWidth(10)
        formColumn.setChecking(false)
        formColumn.setPrecision(0)
        formColumn.setMaxLength(15)
        formColumns.add(formColumn)

        formColumn = new NumericColumn()
        formColumn.setOrder(8)
        formColumn.setName('Сумма расходов на оплату труда работников, руб.')
        formColumn.setAlias('workersCount')
        formColumn.setColumnType(ColumnType.find{ it.title.equals('Число')})
        formColumn.setWidth(10)
        formColumn.setChecking(false)
        formColumn.setPrecision(0)
        formColumn.setMaxLength(15)
        formColumns.add(formColumn)

        formColumn = new NumericColumn()
        formColumn.setOrder(9)
        formColumn.setName('Начислено налога в бюджет субъекта (руб.)')
        formColumn.setAlias('subjectTaxCredit')
        formColumn.setColumnType(ColumnType.find{ it.title.equals('Число')})
        formColumn.setWidth(10)
        formColumn.setChecking(false)
        formColumn.setPrecision(0)
        formColumn.setMaxLength(15)
        formColumns.add(formColumn)

        formColumn = new RefBookColumn()
        formColumn.setOrder(10)
        formColumn.setName('Признак расчёта')
        formColumn.setAlias('calcFlag')
        formColumn.setColumnType(ColumnType.find{ it.title.equals('Справочник')})
        formColumn.setWidth(5)
        formColumn.setChecking(false)
        formColumn.setRefBookAttributeId(120)
        formColumn.setRefBookAttributeId2(null)
        formColumn.setNameAttributeId(121)
        formColumn.setFilter('' ?: null)
        formColumns.add(formColumn)

        formColumn = new RefBookColumn()
        formColumn.setOrder(11)
        formColumn.setName('Обязанность по уплате налога')
        formColumn.setAlias('obligationPayTax')
        formColumn.setColumnType(ColumnType.find{ it.title.equals('Справочник')})
        formColumn.setWidth(6)
        formColumn.setChecking(false)
        formColumn.setRefBookAttributeId(110)
        formColumn.setRefBookAttributeId2(null)
        formColumn.setNameAttributeId(111)
        formColumn.setFilter('' ?: null)
        formColumns.add(formColumn)

        formColumn = new StringColumn()
        formColumn.setOrder(12)
        formColumn.setName('Доля налоговой базы (%)')
        formColumn.setAlias('baseTaxOf')
        formColumn.setColumnType(ColumnType.find{ it.title.equals('Строка')})
        formColumn.setWidth(9)
        formColumn.setChecking(false)
        formColumn.setMaxLength(19)
        formColumn.setPrevLength(0)
        formColumns.add(formColumn)

        formColumn = new NumericColumn()
        formColumn.setOrder(13)
        formColumn.setName('Налоговая база, исходя из доли')
        formColumn.setAlias('baseTaxOfRub')
        formColumn.setColumnType(ColumnType.find{ it.title.equals('Число')})
        formColumn.setWidth(10)
        formColumn.setChecking(false)
        formColumn.setPrecision(0)
        formColumn.setMaxLength(15)
        formColumns.add(formColumn)

        formColumn = new NumericColumn()
        formColumn.setOrder(14)
        formColumn.setName('Ставка налога в бюджет субъекта (%)')
        formColumn.setAlias('subjectTaxStavka')
        formColumn.setColumnType(ColumnType.find{ it.title.equals('Число')})
        formColumn.setWidth(5)
        formColumn.setChecking(false)
        formColumn.setPrecision(2)
        formColumn.setMaxLength(5)
        formColumns.add(formColumn)

        formColumn = new NumericColumn()
        formColumn.setOrder(15)
        formColumn.setName('Сумма налога')
        formColumn.setAlias('taxSum')
        formColumn.setColumnType(ColumnType.find{ it.title.equals('Число')})
        formColumn.setWidth(10)
        formColumn.setChecking(false)
        formColumn.setPrecision(0)
        formColumn.setMaxLength(15)
        formColumns.add(formColumn)

        formColumn = new NumericColumn()
        formColumn.setOrder(16)
        formColumn.setName('Сумма налога, выплаченная за пределами России и засчитываемая в уплату налога')
        formColumn.setAlias('taxSumOutside')
        formColumn.setColumnType(ColumnType.find{ it.title.equals('Число')})
        formColumn.setWidth(10)
        formColumn.setChecking(false)
        formColumn.setPrecision(0)
        formColumn.setMaxLength(15)
        formColumns.add(formColumn)

        formColumn = new NumericColumn()
        formColumn.setOrder(17)
        formColumn.setName('Сумма налога к доплате')
        formColumn.setAlias('taxSumToPay')
        formColumn.setColumnType(ColumnType.find{ it.title.equals('Число')})
        formColumn.setWidth(10)
        formColumn.setChecking(false)
        formColumn.setPrecision(0)
        formColumn.setMaxLength(15)
        formColumns.add(formColumn)

        formColumn = new NumericColumn()
        formColumn.setOrder(18)
        formColumn.setName('Сумма налога к уменьшению')
        formColumn.setAlias('taxSumToReduction')
        formColumn.setColumnType(ColumnType.find{ it.title.equals('Число')})
        formColumn.setWidth(10)
        formColumn.setChecking(false)
        formColumn.setPrecision(0)
        formColumn.setMaxLength(15)
        formColumns.add(formColumn)

        formColumn = new NumericColumn()
        formColumn.setOrder(19)
        formColumn.setName('Ежемесячные авансовые платежи в квартале, следующем за отчётным периодом (текущий отчёт)')
        formColumn.setAlias('everyMontherPaymentAfterPeriod')
        formColumn.setColumnType(ColumnType.find{ it.title.equals('Число')})
        formColumn.setWidth(10)
        formColumn.setChecking(false)
        formColumn.setPrecision(0)
        formColumn.setMaxLength(15)
        formColumns.add(formColumn)

        formColumn = new NumericColumn()
        formColumn.setOrder(20)
        formColumn.setName('Ежемесячные авансовые платежи на I квартал следующего налогового периода')
        formColumn.setAlias('everyMonthForKvartalNextPeriod')
        formColumn.setColumnType(ColumnType.find{ it.title.equals('Число')})
        formColumn.setWidth(10)
        formColumn.setChecking(false)
        formColumn.setPrecision(0)
        formColumn.setMaxLength(15)
        formColumns.add(formColumn)

        formColumn = new NumericColumn()
        formColumn.setOrder(21)
        formColumn.setName('Ежемесячные авансовые платежи на II квартал текущего налогового периода (отчёт за I квартал)')
        formColumn.setAlias('everyMonthForSecondKvartalNextPeriod')
        formColumn.setColumnType(ColumnType.find{ it.title.equals('Число')})
        formColumn.setWidth(10)
        formColumn.setChecking(false)
        formColumn.setPrecision(0)
        formColumn.setMaxLength(15)
        formColumns.add(formColumn)

        formColumn = new NumericColumn()
        formColumn.setOrder(22)
        formColumn.setName('Ежемесячные авансовые платежи на III квартал текущего налогового периода (отчёт за 6 месяцев)')
        formColumn.setAlias('everyMonthForThirdKvartalNextPeriod')
        formColumn.setColumnType(ColumnType.find{ it.title.equals('Число')})
        formColumn.setWidth(10)
        formColumn.setChecking(false)
        formColumn.setPrecision(0)
        formColumn.setMaxLength(15)
        formColumns.add(formColumn)

        formColumn = new NumericColumn()
        formColumn.setOrder(23)
        formColumn.setName('Ежемесячные авансовые платежи на IV квартал текущего налогового периода (отчёт за 9 месяцев)')
        formColumn.setAlias('everyMonthForFourthKvartalNextPeriod')
        formColumn.setColumnType(ColumnType.find{ it.title.equals('Число')})
        formColumn.setWidth(10)
        formColumn.setChecking(false)
        formColumn.setPrecision(0)
        formColumn.setMaxLength(15)
        formColumns.add(formColumn)

        formColumn = new NumericColumn()
        formColumn.setOrder(24)
        formColumn.setName('Льготы по налогу в бюджет субъекта (руб.). Уменьшение суммы налога (руб.)')
        formColumn.setAlias('minimizeTaxSum')
        formColumn.setColumnType(ColumnType.find{ it.title.equals('Число')})
        formColumn.setWidth(10)
        formColumn.setChecking(false)
        formColumn.setPrecision(0)
        formColumn.setMaxLength(15)
        formColumns.add(formColumn)

        formColumn = new NumericColumn()
        formColumn.setOrder(25)
        formColumn.setName('Льготы по налогу в бюджет субъекта (руб.). Ставка налога (%)')
        formColumn.setAlias('amountTax')
        formColumn.setColumnType(ColumnType.find{ it.title.equals('Число')})
        formColumn.setWidth(6)
        formColumn.setChecking(false)
        formColumn.setPrecision(2)
        formColumn.setMaxLength(5)
        formColumns.add(formColumn)


        formTemplate.getColumns().addAll(formColumns)
        columnDaoImpl.createFormColumns(formColumns, formTemplate)

	  	referenceColumnMap.each { alias, parentAlias ->
			def column = formColumns.find{ it.alias == alias }
			if (column != null) {
				column.setParentAlias(parentAlias)
			} else {
				logger.error("Родительская колонка с псевдонимом $parentAlias не обнаружена!")
			}
		}

        if (!referenceColumnMap.isEmpty()) {
            columnDaoImpl.updateFormColumns(formColumns, formTemplate)
        }

        logger.info("К версии макета добавлены колонки")
    }

    List<FormStyle> formStyles = new ArrayList<>()

    if (addStyles) {
        def FormStyle formStyle = new FormStyle()
        formStyle.setAlias('Итоговая')
        formStyle.setBackColor(Color.getById(2))
        formStyle.setBold(true)
        formStyle.setFontColor(Color.getById(0))
        formStyle.setItalic(false)
        formStyles.add(formStyle)

        formStyle = new FormStyle()
        formStyle.setAlias('Редактируемая')
        formStyle.setBackColor(Color.getById(3))
        formStyle.setBold(false)
        formStyle.setFontColor(Color.getById(0))
        formStyle.setItalic(false)
        formStyles.add(formStyle)

        formStyle = new FormStyle()
        formStyle.setAlias('Автозаполняемая')
        formStyle.setBackColor(Color.getById(4))
        formStyle.setBold(true)
        formStyle.setFontColor(Color.getById(13))
        formStyle.setItalic(false)
        formStyles.add(formStyle)

        formStyle = new FormStyle()
        formStyle.setAlias('Корректировка-добавлено')
        formStyle.setBackColor(Color.getById(12))
        formStyle.setBold(false)
        formStyle.setFontColor(Color.getById(0))
        formStyle.setItalic(false)
        formStyles.add(formStyle)

        formStyle = new FormStyle()
        formStyle.setAlias('Корректировка-удалено')
        formStyle.setBackColor(Color.getById(8))
        formStyle.setBold(false)
        formStyle.setFontColor(Color.getById(0))
        formStyle.setItalic(false)
        formStyles.add(formStyle)

        formStyle = new FormStyle()
        formStyle.setAlias('Корректировка-без изменений')
        formStyle.setBackColor(Color.getById(6))
        formStyle.setBold(false)
        formStyle.setFontColor(Color.getById(0))
        formStyle.setItalic(false)
        formStyles.add(formStyle)

        formStyle = new FormStyle()
        formStyle.setAlias('Корректировка-изменено')
        formStyle.setBackColor(Color.getById(4))
        formStyle.setBold(true)
        formStyle.setFontColor(Color.getById(10))
        formStyle.setItalic(false)
        formStyles.add(formStyle)


        formTemplate.getStyles().addAll(formStyles)
        formStyleDaoImpl.saveFormStyles(formTemplate)
        logger.info("К версии макета добавлены стили")
    }

    String longString = ''

    if (addDataRows) {
        longString += 'PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4NCjxyb3dzPg0KICAgIDxyb3cgYWxpYXM9ImNhIj4NCiAgICAgICAgPGNlbGwgYWxpYXM9Im51bWJlciIgY29sU3Bhbj0iMSIgcm93U3Bhbj0iMSIgc3R5bGVBbGlhcz0i0JjRgtC+0LPQvtCy0LDRjyIvPg0KICAgICAgICA8Y2VsbCBhbGlhcz0iZml4IiBjb2xTcGFuPSIyIiByb3dTcGFuPSIxIiBzdHJpbmdWYWx1ZT0i0KbQtdC90YLRgNCw0LvRjNC90YvQuSDQsNC/0L/QsNGA0LDRgiAo0YHQutC+0YDRgNC10LrRgtC40YDQvtCy0LDQvdC90YvQuSkiDQogICAgICAgICAgICAgIHN0eWxlQWxpYXM9ItCY0YLQvtCz0L7QstCw0Y8iLz4NCiAgICAgICAgPGNlbGwgYWxpYXM9InJlZ2lvbkJhbmsiIGNvbFNwYW49IjEiIHJvd1NwYW49IjEiIHN0eWxlQWxpYXM9ItCY0YLQvtCz0L7QstCw0Y8iLz4NCiAgICAgICAgPGNlbGwgYWxpYXM9InJlZ2lvbkJhbmtEaXZpc2lvbiIgY29sU3Bhbj0iMSIgcm93U3Bhbj0iMSIgc3R5bGVBbGlhcz0i0JjRgtC+0LPQvtCy0LDRjyIvPg0KICAgICAgICA8Y2VsbCBhbGlhcz0iZGl2aXNpb25OYW1lIiBjb2xTcGFuPSIxIiByb3dTcGFuPSIxIiBzdHlsZUFsaWFzPSLQmNGC0L7Qs9C+0LLQsNGPIi8+DQogICAgICAgIDxjZWxsIGFsaWFzPSJrcHAiIGNvbFNwYW49IjEiIHJvd1NwYW49IjEiIHN0eWxlQWxpYXM9ItCY0YLQvtCz0L7QstCw0Y8iLz4NCiAgICAgICAgPGNlbGwgYWxpYXM9InByb3BlcnR5UHJpY2UiIGNvbFNwYW49IjEiIHJvd1NwYW49IjEiIHN0eWxlQWxpYXM9ItCY0YLQvtCz0L7QstCw0Y8iLz4NCiAgICAgICAgPGNlbGwgYWxpYXM9IndvcmtlcnNDb3VudCIgY29sU3Bhbj0iMSIgcm93U3Bhbj0iMSIgc3R5bGVBbGlhcz0i0JjRgtC+0LPQvtCy0LDRjyIvPg0KICAgICAgICA8Y2VsbCBhbGlhcz0ic3ViamVjdFRheENyZWRpdCIgY29sU3Bhbj0iMSIgcm93U3Bhbj0iMSIgc3R5bGVBbGlhcz0i0JjRgtC+0LPQvtCy0LDRjyIvPg0KICAgICAgICA8Y2VsbCBhbGlhcz0iY2FsY0ZsYWciIGNvbFNwYW49IjEiIHJvd1NwYW49IjEiIHN0eWxlQWxpYXM9ItCY0YLQvtCz0L7QstCw0Y8iLz4NCiAgICAgICAgPGNlbGwgYWxpYXM9Im9ibGlnYXRpb25QYXlUYXgiIGNvbFNwYW49IjEiIHJvd1NwYW49IjEiIHN0eWxlQWxpYXM9ItCY0YLQvtCz0L7QstCw0Y8iLz4NCiAgICAgICAgPGNlbGwgYWxpYXM9ImJhc2VUYXhPZiIgY29sU3Bhbj0iMSIgcm93U3Bhbj0iMSIgc3R5bGVBbGlhcz0i0JjRgtC+0LPQvtCy0LDRjyIvPg0KICAgICAgICA8Y2VsbCBhbGlhcz0iYmFzZVRheE9mUnViIiBjb2xTcGFuPSIxIiByb3dTcGFuPSIxIiBzdHlsZUFsaWFzPSLQmNGC0L7Qs9C+0LLQsNGPIi8+DQogICAgICAgIDxjZWxsIGFsaWFzPSJzdWJqZWN0VGF4U3RhdmthIiBjb2xTcGFuPSIxIiByb3dTcGFuPSIxIiBzdHlsZUFsaWFzPSLQmNGC0L7Qs9C+0LLQsNGPIi8+DQogICAgICAgIDxjZWxsIGFsaWFzPSJ0YXhTdW0iIGNvbFNwYW49IjEiIHJvd1NwYW49IjEiIHN0eWxlQWxpYXM9ItCY0YLQvtCz0L7QstCw0Y8iLz4NCiAgICAgICAgPGNlbGwgYWxpYXM9InRheFN1bU91dHNpZGUiIGNvbFNwYW49IjEiIHJvd1NwYW49IjEiIHN0eWxlQWxpYXM9ItCY0YLQvtCz0L7QstCw0Y8iLz4NCiAgICAgICAgPGNlbGwgYWxpYXM9InRheFN1bVRvUGF5IiBjb2xTcGFuPSIxIiByb3dTcGFuPSIxIiBzdHlsZUFsaWFzPSLQmNGC0L7Qs9C+0LLQsNGPIi8+DQogICAgICAgIDxjZWxsIGFsaWFzPSJ0YXhTdW1Ub1JlZHVjdGlvbiIgY29sU3Bhbj0iMSIgcm93U3Bhbj0iMSIgc3R5bGVBbGlhcz0i0JjRgtC+0LPQvtCy0LDRjyIvPg0KICAgICAgICA8Y2VsbCBhbGlhcz0iZXZlcnlNb250aGVyUGF5bWVudEFmdGVyUGVyaW9kIiBjb2xTcGFuPSIxIiByb3dTcGFuPSIxIiBzdHlsZUFsaWFzPSLQmNGC0L7Qs9C+0LLQsNGPIi8+DQogICAgICAgIDxjZWxsIGFsaWFzPSJldmVyeU1vbnRoRm9yS3ZhcnRhbE5leHRQZXJpb2QiIGNvbFNwYW49IjEiIHJvd1NwYW49IjEiIHN0eWxlQWxpYXM9ItCY0YLQvtCz0L7QstCw0Y8iLz4NCiAgICAgICAgPGNlbGwgYWxpYXM9ImV2ZXJ5TW9udGhGb3JTZWNvbmRLdmFydGFsTmV4dFBlcmlvZCIgY29sU3Bhbj0iMSIgcm93U3Bhbj0iMSIgc3R5bGVBbGlhcz0i0JjRgtC+0LPQvtCy0LDRjyIvPg0KICAgICAgICA8Y2VsbCBhbGlhcz0iZXZlcnlNb250aEZvclRoaXJkS3ZhcnRhbE5leHRQZXJpb2QiIGNvbFNwYW49IjEiIHJvd1NwYW49IjEiIHN0eWxlQWxpYXM9ItCY0YLQvtCz0L7QstCw0Y8iLz4NCiAgICAgICAgPGNlbGwgYWxpYXM9ImV2ZXJ5TW9udGhGb3JGb3VydGhLdmFydGFsTmV4dFBlcmlvZCIgY29sU3Bhbj0iMSIgcm93U3Bhbj0iMSIgc3R5bGVBbGlhcz0i0JjRgtC+0LPQvtCy0LDRjyIvPg0KICAgICAgICA8Y2VsbCBhbGlhcz0ibWluaW1pemVUYXhTdW0iIGNvbFNwYW49IjEiIHJvd1NwYW49IjEiIHN0eWxlQWxpYXM9ItCY0YLQvtCz0L7QstCw0Y8iLz4NCiAgICAgICAgPGNlbGwgYWxpYXM9ImFtb3VudFRheCIgY29sU3Bhbj0iMSIgcm93U3Bhbj0iMSIgc3R5bGVBbGlhcz0i0JjRgtC+0LPQvtCy0LDRjyIvPg0KICAgIDwvcm93Pg0KICAgIDxyb3cgYWxpYXM9InRvdGFsIj4NCiAgICAgICAgPGNlbGwgYWxpYXM9Im51bWJlciIgY29sU3Bhbj0iMSIgcm93U3Bhbj0iMSIgc3R5bGVBbGlhcz0i0JjRgtC+0LPQvtCy0LDRjyIvPg0KICAgICAgICA8Y2VsbCBhbGlhcz0iZml4IiBjb2xTcGFuPSIyIiByb3dTcGFuPSIxIiBzdHJpbmdWYWx1ZT0i0KHQsdC10YDQsdCw0L3QuiDQoNC+0YHRgdC40LgiIHN0eWxlQWxpYXM9ItCY0YLQvtCz0L7QstCw0Y8iLz4NCiAgICAgICAgPGNlbGwgYWxpYXM9InJlZ2lvbkJhbmsiIGNvbFNwYW49IjEiIHJvd1NwYW49IjEiIHN0eWxlQWxpYXM9ItCY0YLQvtCz0L7QstCw0Y8iLz4NCiAgICAgICAgPGNlbGwgYWxpYXM9InJlZ2lvbkJhbmtEaXZpc2lvbiIgY29sU3Bhbj0iMSIgcm93U3Bhbj0iMSIgc3R5bGVBbGlhcz0i0JjRgtC+0LPQvtCy0LDRjyIvPg0KICAgICAgICA8Y2VsbCBhbGlhcz0iZGl2aXNpb25OYW1lIiBjb2xTcGFuPSIxIiByb3dTcGFuPSIxIiBzdHlsZUFsaWFzPSLQmNGC0L7Qs9C+0LLQsNGPIi8+DQogICAgICAgIDxjZWxsIGFsaWFzPSJrcHAiIGNvbFNwYW49IjEiIHJvd1NwYW49IjEiIHN0eWxlQWxpYXM9ItCY0YLQvtCz0L7QstCw0Y8iLz4NCiAgICAgICAgPGNlbGwgYWxpYXM9InByb3BlcnR5UHJpY2UiIGNvbFNwYW49IjEiIHJvd1NwYW49IjEiIHN0eWxlQWxpYXM9ItCY0YLQvtCz0L7QstCw0Y8iLz4NCiAgICAgICAgPGNlbGwgYWxpYXM9IndvcmtlcnNDb3VudCIgY29sU3Bhbj0iMSIgcm93U3Bhbj0iMSIgc3R5bGVBbGlhcz0i0JjRgtC+0LPQvtCy0LDRjyIvPg0KICAgICAgICA8Y2VsbCBhbGlhcz0ic3ViamVjdFRheENyZWRpdCIgY29sU3Bhbj0iMSIgcm93U3Bhbj0iMSIgc3R5bGVBbGlhcz0i0JjRgtC+0LPQvtCy0LDRjyIvPg0KICAgICAgICA8Y2VsbCBhbGlhcz0iY2FsY0ZsYWciIGNvbFNwYW49IjEiIHJvd1NwYW49IjEiIHN0eWxlQWxpYXM9ItCY0YLQvtCz0L7QstCw0Y8iLz4NCiAgICAgICAgPGNlbGwgYWxpYXM9Im9ibGlnYXRpb25QYXlUYXgiIGNvbFNwYW49IjEiIHJvd1NwYW49IjEiIHN0eWxlQWxpYXM9ItCY0YLQvtCz0L7QstCw0Y8iLz4NCiAgICAgICAgPGNlbGwgYWxpYXM9ImJhc2VUYXhPZiIgY29sU3Bhbj0iMSIgcm93U3Bhbj0iMSIgc3R5bGVBbGlhcz0i0JjRgtC+0LPQvtCy0LDRjyIvPg0KICAgICAgICA8Y2VsbCBhbGlhcz0iYmFzZVRheE9mUnViIiBjb2xTcGFuPSIxIiByb3dTcGFuPSIxIiBzdHlsZUFsaWFzPSLQmNGC0L7Qs9C+0LLQsNGPIi8+DQogICAgICAgIDxjZWxsIGFsaWFzPSJzdWJqZWN0VGF4U3RhdmthIiBjb2xTcGFuPSIxIiByb3dTcGFuPSIxIiBzdHlsZUFsaWFzPSLQmNGC0L7Qs9C+0LLQsNGPIi8+DQogICAgICAgIDxjZWxsIGFsaWFzPSJ0YXhTdW0iIGNvbFNwYW49IjEiIHJvd1NwYW49IjEiIHN0eWxlQWxpYXM9ItCY0YLQvtCz0L7QstCw0Y8iLz4NCiAgICAgICAgPGNlbGwgYWxpYXM9InRheFN1bU91dHNpZGUiIGNvbFNwYW49IjEiIHJvd1NwYW49IjEiIHN0eWxlQWxpYXM9ItCY0YLQvtCz0L7QstCw0Y8iLz4NCiAgICAgICAgPGNlbGwgYWxpYXM9InRheFN1bVRvUGF5IiBjb2xTcGFuPSIxIiByb3dTcGFuPSIxIiBzdHlsZUFsaWFzPSLQmNGC0L7Qs9C+0LLQsNGPIi8+DQogICAgICAgIDxjZWxsIGFsaWFzPSJ0YXhTdW1Ub1JlZHVjdGlvbiIgY29sU3Bhbj0iMSIgcm93U3Bhbj0iMSIgc3R5bGVBbGlhcz0i0JjRgtC+0LPQvtCy0LDRjyIvPg0KICAgICAgICA8Y2VsbCBhbGlhcz0iZXZlcnlNb250aGVyUGF5bWVudEFmdGVyUGVyaW9kIiBjb2xTcGFuPSIxIiByb3dTcGFuPSIxIiBzdHlsZUFsaWFzPSLQmNGC0L7Qs9C+0LLQsNGPIi8+DQogICAgICAgIDxjZWxsIGFsaWFzPSJldmVyeU1vbnRoRm9yS3ZhcnRhbE5leHRQZXJpb2QiIGNvbFNwYW49IjEiIHJvd1NwYW49IjEiIHN0eWxlQWxpYXM9ItCY0YLQvtCz0L7QstCw0Y8iLz4NCiAgICAgICAgPGNlbGwgYWxpYXM9ImV2ZXJ5TW9udGhGb3JTZWNvbmRLdmFydGFsTmV4dFBlcmlvZCIgY29sU3Bhbj0iMSIgcm93U3Bhbj0iMSIgc3R5bGVBbGlhcz0i0JjRgtC+0LPQvtCy0LDRjyIvPg0KICAgICAgICA8Y2VsbCBhbGlhcz0iZXZlcnlNb250aEZvclRoaXJkS3ZhcnRhbE5leHRQZXJpb2QiIGNvbFNwYW49IjEiIHJvd1NwYW49IjEiIHN0eWxlQWxpYXM9ItCY0YLQvtCz0L7QstCw0Y8iLz4NCiAgICAgICAgPGNlbGwgYWxpYXM9ImV2ZXJ5TW9udGhGb3JGb3VydGhLdmFydGFsTmV4dFBlcmlvZCIgY29sU3Bhbj0iMSIgcm93U3Bhbj0iMSIgc3R5bGVBbGlhcz0i0JjRgtC+0LPQvtCy0LDRjyIvPg0KICAgICAgICA8Y2VsbCBhbGlhcz0ibWluaW1pemVUYXhTdW0iIGNvbFNwYW49IjEiIHJvd1NwYW49IjEiIHN0eWxlQWxpYXM9ItCY0YLQvtCz0L7QstCw0Y8iLz4NCiAgICAgICAgPGNlbGwgYWxpYXM9ImFtb3VudFRheCIgY29sU3Bhbj0iMSIgcm93U3Bhbj0iMSIgc3R5bGVBbGlhcz0i0JjRgtC+0LPQvtCy0LDRjyIvPg0KICAgIDwvcm93Pg0KPC9yb3dzPg=='

        addLongText(form_template_id, longString, 'DATA_ROWS')
        logger.info("К версии макета добавлены фиксированные строки")
    }

    longString = ''
    if (addDataHeaders) {
        longString += 'PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4NCjxyb3dzPg0KICAgIDxyb3cgYWxpYXM9IiI+DQogICAgICAgIDxjZWxsIGFsaWFzPSJudW1iZXIiIGNvbFNwYW49IjEiIHJvd1NwYW49IjEiIHZhbHVlPSLihJYg0L/QvyIvPg0KICAgICAgICA8Y2VsbCBhbGlhcz0iZml4IiBjb2xTcGFuPSIxIiByb3dTcGFuPSIxIiB2YWx1ZT0iIi8+DQogICAgICAgIDxjZWxsIGFsaWFzPSJyZWdpb25CYW5rIiBjb2xTcGFuPSIxIiByb3dTcGFuPSIxIiB2YWx1ZT0i0KLQtdGA0YDQuNGC0L7RgNC40LDQu9GM0L3Ri9C5INCx0LDQvdC6Ii8+DQogICAgICAgIDxjZWxsIGFsaWFzPSJyZWdpb25CYW5rRGl2aXNpb24iIGNvbFNwYW49IjEiIHJvd1NwYW49IjEiIHZhbHVlPSLQn9C+0LTRgNCw0LfQtNC10LvQtdC90LjQtSDRgtC10YDRgNC40YLQvtGA0LjQsNC70YzQvdC+0LPQviDQsdCw0L3QutCwIi8+DQogICAgICAgIDxjZWxsIGFsaWFzPSJkaXZpc2lvbk5hbWUiIGNvbFNwYW49IjEiIHJvd1NwYW49IjEiIHZhbHVlPSLQndCw0LjQvNC10L3QvtCy0LDQvdC40LUg0L/QvtC00YDQsNC30LTQtdC70LXQvdC40Y8g0LIg0LTQtdC60LvQsNGA0LDRhtC40LgiLz4NCiAgICAgICAgPGNlbGwgYWxpYXM9ImtwcCIgY29sU3Bhbj0iMSIgcm93U3Bhbj0iMSIgdmFsdWU9ItCa0J/QnyIvPg0KICAgICAgICA8Y2VsbCBhbGlhcz0icHJvcGVydHlQcmljZSIgY29sU3Bhbj0iMSIgcm93U3Bhbj0iMSINCiAgICAgICAgICAgICAgdmFsdWU9ItCh0YDQtdC00L3Rj9GPINC+0YHRgtCw0YLQvtGH0L3QsNGPINGB0YLQvtC40LzQvtGB0YLRjCDQsNC80L7RgNGC0LjQt9C40YDRg9C10LzQvtCz0L4g0LjQvNGD0YnQtdGB0YLQstCwICjRgNGD0LEuKSIvPg0KICAgICAgICA8Y2VsbCBhbGlhcz0id29ya2Vyc0NvdW50IiBjb2xTcGFuPSIxIiByb3dTcGFuPSIxIiB2YWx1ZT0i0KHRg9C80LzQsCDRgNCw0YHRhdC+0LTQvtCyINC90LAg0L7Qv9C70LDRgtGDINGC0YDRg9C00LAg0YDQsNCx0L7RgtC90LjQutC+0LIsINGA0YPQsS4iLz4NCiAgICAgICAgPGNlbGwgYWxpYXM9InN1YmplY3RUYXhDcmVkaXQiIGNvbFNwYW49IjEiIHJvd1NwYW49IjEiIHZhbHVlPSLQndCw0YfQuNGB0LvQtdC90L4g0L3QsNC70L7Qs9CwINCyINCx0Y7QtNC20LXRgiDRgdGD0LHRitC10LrRgtCwICjRgNGD0LEuKSIvPg0KICAgICAgICA8Y2VsbCBhbGlhcz0iY2FsY0ZsYWciIGNvbFNwYW49IjEiIHJvd1NwYW49IjEiIHZhbHVlPSLQn9GA0LjQt9C90LDQuiDRgNCw0YHRh9GR0YLQsCIvPg0KICAgICAgICA8Y2VsbCBhbGlhcz0ib2JsaWdhdGlvblBheVRheCIgY29sU3Bhbj0iMSIgcm93U3Bhbj0iMSIgdmFsdWU9ItCe0LHRj9C30LDQvdC90L7RgdGC0Ywg0L/QviDRg9C/0LvQsNGC0LUg0L3QsNC70L7Qs9CwIi8+DQogICAgICAgIDxjZWxsIGFsaWFzPSJiYXNlVGF4T2YiIGNvbFNwYW49IjEiIHJvd1NwYW49IjEiIHZhbHVlPSLQlNC+0LvRjyDQvdCw0LvQvtCz0L7QstC+0Lkg0LHQsNC30YsgKCUpIi8+DQogICAgICAgIDxjZWxsIGFsaWFzPSJiYXNlVGF4T2ZSdWIiIGNvbFNwYW49IjEiIHJvd1NwYW49IjEiIHZhbHVlPSLQndCw0LvQvtCz0L7QstCw0Y8g0LHQsNC30LAsINC40YHRhdC+0LTRjyDQuNC3INC00L7Qu9C4Ii8+DQogICAgICAgIDxjZWxsIGFsaWFzPSJzdWJqZWN0VGF4U3RhdmthIiBjb2xTcGFuPSIxIiByb3dTcGFuPSIxIiB2YWx1ZT0i0KHRgtCw0LLQutCwINC90LDQu9C+0LPQsCDQsiDQsdGO0LTQttC10YIg0YHRg9Cx0YrQtdC60YLQsCAoJSkiLz4NCiAgICAgICAgPGNlbGwgYWxpYXM9InRheFN1bSIgY29sU3Bhbj0iMSIgcm93U3Bhbj0iMSIgdmFsdWU9ItCh0YPQvNC80LAg0L3QsNC70L7Qs9CwIi8+DQogICAgICAgIDxjZWxsIGFsaWFzPSJ0YXhTdW1PdXRzaWRlIiBjb2xTcGFuPSIxIiByb3dTcGFuPSIxIg0KICAgICAgICAgICAgICB2YWx1ZT0i0KHRg9C80LzQsCDQvdCw0LvQvtCz0LAsINCy0YvQv9C70LDRh9C10L3QvdCw0Y8g0LfQsCDQv9GA0LXQtNC10LvQsNC80Lgg0KDQvtGB0YHQuNC4INC4INC30LDRgdGH0LjRgtGL0LLQsNC10LzQsNGPINCyINGD0L/Qu9Cw0YLRgyDQvdCw0LvQvtCz0LAiLz4NCiAgICAgICAgPGNlbGwgYWxpYXM9InRheFN1bVRvUGF5IiBjb2xTcGFuPSIxIiByb3dTcGFuPSIxIiB2YWx1ZT0i0KHRg9C80LzQsCDQvdCw0LvQvtCz0LAg0Log0LTQvtC/0LvQsNGC0LUiLz4NCiAgICAgICAgPGNlbGwgYWxpYXM9InRheFN1bVRvUmVkdWN0aW9uIiBjb2xTcGFuPSIxIiByb3dTcGFuPSIxIiB2YWx1ZT0i0KHRg9C80LzQsCDQvdCw0LvQvtCz0LAg0Log0YPQvNC10L3RjNGI0LXQvdC40Y4iLz4NCiAgICAgICAgPGNlbGwgYWxpYXM9ImV2ZXJ5TW9udGhlclBheW1lbnRBZnRlclBlcmlvZCIgY29sU3Bhbj0iMSIgcm93U3Bhbj0iMSINCiAgICAgICAgICAgICAgdmFsdWU9ItCV0LbQtdC80LXRgdGP0YfQvdGL0LUg0LDQstCw0L3RgdC+0LLRi9C1INC/0LvQsNGC0LXQttC4INCyINC60LLQsNGA0YLQsNC70LUsINGB0LvQtdC00YPRjtGJ0LXQvCDQt9CwINC+0YLRh9GR0YLQvdGL0Lwg0L/QtdGA0LjQvtC00L7QvCAo0YLQtdC60YPRidC40Lkg0L7RgtGH0ZHRgikiLz4NCiAgICAgICAgPGNlbGwgYWxpYXM9ImV2ZXJ5TW9udGhGb3JLdmFydGFsTmV4dFBlcmlvZCIgY29sU3Bhbj0iMSIgcm93U3Bhbj0iMSINCiAgICAgICAgICAgICAgdmFsdWU9ItCV0LbQtdC80LXRgdGP0YfQvdGL0LUg0LDQstCw0L3RgdC+0LLRi9C1INC/0LvQsNGC0LXQttC4INC90LAgSSDQutCy0LDRgNGC0LDQuyDRgdC70LXQtNGD0Y7RidC10LPQviDQvdCw0LvQvtCz0L7QstC+0LPQviDQv9C10YDQuNC+0LTQsCIvPg0KICAgICAgICA8Y2VsbCBhbGlhcz0iZXZlcnlNb250aEZvclNlY29uZEt2YXJ0YWxOZXh0UGVyaW9kIiBjb2xTcGFuPSIxIiByb3dTcGFuPSIxIg0KICAgICAgICAgICAgICB2YWx1ZT0i0JXQttC10LzQtdGB0Y/Rh9C90YvQtSDQsNCy0LDQvdGB0L7QstGL0LUg0L/Qu9Cw0YLQtdC20Lgg0L3QsCBJSSDQutCy0LDRgNGC0LDQuyDRgtC10LrRg9GJ0LXQs9C+INC90LDQu9C+0LPQvtCy0L7Qs9C+INC/0LXRgNC40L7QtNCwICjQvtGC0YfRkdGCINC30LAgSSDQutCy0LDRgNGC0LDQuykiLz4NCiAgICAgICAgPGNlbGwgYWxpYXM9ImV2ZXJ5TW9udGhGb3JUaGlyZEt2YXJ0YWxOZXh0UGVyaW9kIiBjb2xTcGFuPSIxIiByb3dTcGFuPSIxIg0KICAgICAgICAgICAgICB2YWx1ZT0i0JXQttC10LzQtdGB0Y/Rh9C90YvQtSDQsNCy0LDQvdGB0L7QstGL0LUg0L/Qu9Cw0YLQtdC20Lgg0L3QsCBJSUkg0LrQstCw0YDRgtCw0Lsg0YLQtdC60YPRidC10LPQviDQvdCw0LvQvtCz0L7QstC+0LPQviDQv9C10YDQuNC+0LTQsCAo0L7RgtGH0ZHRgiDQt9CwIDYg0LzQtdGB0Y/RhtC10LIpICIvPg0KICAgICAgICA8Y2VsbCBhbGlhcz0iZXZlcnlNb250aEZvckZvdXJ0aEt2YXJ0YWxOZXh0UGVyaW9kIiBjb2xTcGFuPSIxIiByb3dTcGFuPSIxIg0KICAgICAgICAgICAgICB2YWx1ZT0i0JXQttC10LzQtdGB0Y/Rh9C90YvQtSDQsNCy0LDQvdGB0L7QstGL0LUg0L/Qu9Cw0YLQtdC20Lgg0L3QsCBJViDQutCy0LDRgNGC0LDQuyDRgtC10LrRg9GJ0LXQs9C+INC90LDQu9C+0LPQvtCy0L7Qs9C+INC/0LXRgNC40L7QtNCwICjQvtGC0YfRkdGCINC30LAgOSDQvNC10YHRj9GG0LXQsikiLz4NCiAgICAgICAgPGNlbGwgYWxpYXM9Im1pbmltaXplVGF4U3VtIiBjb2xTcGFuPSIxIiByb3dTcGFuPSIxIg0KICAgICAgICAgICAgICB2YWx1ZT0i0JvRjNCz0L7RgtGLINC/0L4g0L3QsNC70L7Qs9GDINCyINCx0Y7QtNC20LXRgiDRgdGD0LHRitC10LrRgtCwICjRgNGD0LEuKS4g0KPQvNC10L3RjNGI0LXQvdC40LUg0YHRg9C80LzRiyDQvdCw0LvQvtCz0LAgKNGA0YPQsS4pIi8+DQogICAgICAgIDxjZWxsIGFsaWFzPSJhbW91bnRUYXgiIGNvbFNwYW49IjEiIHJvd1NwYW49IjEiDQogICAgICAgICAgICAgIHZhbHVlPSLQm9GM0LPQvtGC0Ysg0L/QviDQvdCw0LvQvtCz0YMg0LIg0LHRjtC00LbQtdGCINGB0YPQsdGK0LXQutGC0LAgKNGA0YPQsS4pLiDQodGC0LDQstC60LAg0L3QsNC70L7Qs9CwICglKSIvPg0KICAgIDwvcm93Pg0KICAgIDxyb3cgYWxpYXM9IiI+DQogICAgICAgIDxjZWxsIGFsaWFzPSJudW1iZXIiIGNvbFNwYW49IjEiIHJvd1NwYW49IjEiIHZhbHVlPSIxIi8+DQogICAgICAgIDxjZWxsIGFsaWFzPSJmaXgiIGNvbFNwYW49IjEiIHJvd1NwYW49IjEiIHZhbHVlPSIiLz4NCiAgICAgICAgPGNlbGwgYWxpYXM9InJlZ2lvbkJhbmsiIGNvbFNwYW49IjEiIHJvd1NwYW49IjEiIHZhbHVlPSIyIi8+DQogICAgICAgIDxjZWxsIGFsaWFzPSJyZWdpb25CYW5rRGl2aXNpb24iIGNvbFNwYW49IjEiIHJvd1NwYW49IjEiIHZhbHVlPSIzIi8+DQogICAgICAgIDxjZWxsIGFsaWFzPSJkaXZpc2lvbk5hbWUiIGNvbFNwYW49IjEiIHJvd1NwYW49IjEiIHZhbHVlPSI0Ii8+DQogICAgICAgIDxjZWxsIGFsaWFzPSJrcHAiIGNvbFNwYW49IjEiIHJvd1NwYW49IjEiIHZhbHVlPSI1Ii8+DQogICAgICAgIDxjZWxsIGFsaWFzPSJwcm9wZXJ0eVByaWNlIiBjb2xTcGFuPSIxIiByb3dTcGFuPSIxIiB2YWx1ZT0iNiIvPg0KICAgICAgICA8Y2VsbCBhbGlhcz0id29ya2Vyc0NvdW50IiBjb2xTcGFuPSIxIiByb3dTcGFuPSIxIiB2YWx1ZT0iNyIvPg0KICAgICAgICA8Y2VsbCBhbGlhcz0ic3ViamVjdFRheENyZWRpdCIgY29sU3Bhbj0iMSIgcm93U3Bhbj0iMSIgdmFsdWU9IjgiLz4NCiAgICAgICAgPGNlbGwgYWxpYXM9ImNhbGNGbGFnIiBjb2xTcGFuPSIxIiByb3dTcGFuPSIxIiB2YWx1ZT0iOSIvPg0KICAgICAgICA8Y2VsbCBhbGlhcz0ib2JsaWdhdGlvblBheVRheCIgY29sU3Bhbj0iMSIgcm93U3Bhbj0iMSIgdmFsdWU9IjEwIi8+DQogICAgICAgIDxjZWxsIGFsaWFzPSJiYXNlVGF4T2YiIGNvbFNwYW49IjEiIHJvd1NwYW49IjEiIHZhbHVlPSIxMSIvPg0KICAgICAgICA8Y2VsbCBhbGlhcz0iYmFzZVRheE9mUnViIiBjb2xTcGFuPSIxIiByb3dTcGFuPSIxIiB2YWx1ZT0iMTIiLz4NCiAgICAgICAgPGNlbGwgYWxpYXM9InN1YmplY3RUYXhTdGF2a2EiIGNvbFNwYW49IjEiIHJvd1NwYW49IjEiIHZhbHVlPSIxMyIvPg0KICAgICAgICA8Y2VsbCBhbGlhcz0idGF4U3VtIiBjb2xTcGFuPSIxIiByb3dTcGFuPSIxIiB2YWx1ZT0iMTQiLz4NCiAgICAgICAgPGNlbGwgYWxpYXM9InRheFN1bU91dHNpZGUiIGNvbFNwYW49IjEiIHJvd1NwYW49IjEiIHZhbHVlPSIxNSIvPg0KICAgICAgICA8Y2VsbCBhbGlhcz0idGF4U3VtVG9QYXkiIGNvbFNwYW49IjEiIHJvd1NwYW49IjEiIHZhbHVlPSIxNiIvPg0KICAgICAgICA8Y2VsbCBhbGlhcz0idGF4U3VtVG9SZWR1Y3Rpb24iIGNvbFNwYW49IjEiIHJvd1NwYW49IjEiIHZhbHVlPSIxNyIvPg0KICAgICAgICA8Y2VsbCBhbGlhcz0iZXZlcnlNb250aGVyUGF5bWVudEFmdGVyUGVyaW9kIiBjb2xTcGFuPSIxIiByb3dTcGFuPSIxIiB2YWx1ZT0iMTgiLz4NCiAgICAgICAgPGNlbGwgYWxpYXM9ImV2ZXJ5TW9udGhGb3JLdmFydGFsTmV4dFBlcmlvZCIgY29sU3Bhbj0iMSIgcm93U3Bhbj0iMSIgdmFsdWU9IjE5Ii8+DQogICAgICAgIDxjZWxsIGFsaWFzPSJldmVyeU1vbnRoRm9yU2Vjb25kS3ZhcnRhbE5leHRQZXJpb2QiIGNvbFNwYW49IjEiIHJvd1NwYW49IjEiIHZhbHVlPSIyMCIvPg0KICAgICAgICA8Y2VsbCBhbGlhcz0iZXZlcnlNb250aEZvclRoaXJkS3ZhcnRhbE5leHRQZXJpb2QiIGNvbFNwYW49IjEiIHJvd1NwYW49IjEiIHZhbHVlPSIyMSIvPg0KICAgICAgICA8Y2VsbCBhbGlhcz0iZXZlcnlNb250aEZvckZvdXJ0aEt2YXJ0YWxOZXh0UGVyaW9kIiBjb2xTcGFuPSIxIiByb3dTcGFuPSIxIiB2YWx1ZT0iMjIiLz4NCiAgICAgICAgPGNlbGwgYWxpYXM9Im1pbmltaXplVGF4U3VtIiBjb2xTcGFuPSIxIiByb3dTcGFuPSIxIiB2YWx1ZT0iMjMiLz4NCiAgICAgICAgPGNlbGwgYWxpYXM9ImFtb3VudFRheCIgY29sU3Bhbj0iMSIgcm93U3Bhbj0iMSIgdmFsdWU9IjI0Ii8+DQogICAgPC9yb3c+DQo8L3Jvd3M+'

        addLongText(form_template_id, longString, 'DATA_HEADERS')
        logger.info("К версии макета добавлен заголовок")
    }

    longString = ''
    if (addScript) {
        longString += 'cGFja2FnZSBmb3JtX3RlbXBsYXRlLmluY29tZS5hZHZhbmNlRGlzdHJpYnV0aW9uLnYyMDE2DQoNCmltcG9ydCBjb20uYXBsYW5hLnNicmYudGF4YWNjb3VudGluZy5tb2RlbC5Gb3JtRGF0YUV2ZW50DQppbXBvcnQgY29tLmFwbGFuYS5zYnJmLnRheGFjY291bnRpbmcubW9kZWwuRm9ybURhdGFLaW5kDQppbXBvcnQgY29tLmFwbGFuYS5zYnJmLnRheGFjY291bnRpbmcubW9kZWwuV29ya2Zsb3dTdGF0ZQ0KaW1wb3J0IGNvbS5hcGxhbmEuc2JyZi50YXhhY2NvdW50aW5nLm1vZGVsLmV4Y2VwdGlvbi5TZXJ2aWNlRXhjZXB0aW9uDQppbXBvcnQgY29tLmFwbGFuYS5zYnJmLnRheGFjY291bnRpbmcubW9kZWwubG9nLkxvZ0xldmVsDQppbXBvcnQgY29tLmFwbGFuYS5zYnJmLnRheGFjY291bnRpbmcubW9kZWwucmVmYm9vay5SZWZCb29rDQppbXBvcnQgY29tLmFwbGFuYS5zYnJmLnRheGFjY291bnRpbmcubW9kZWwucmVmYm9vay5SZWZCb29rQXR0cmlidXRlVHlwZQ0KaW1wb3J0IGNvbS5hcGxhbmEuc2JyZi50YXhhY2NvdW50aW5nLm1vZGVsLnNjcmlwdC5yYW5nZS5Db2x1bW5SYW5nZQ0KaW1wb3J0IGdyb292eS50cmFuc2Zvcm0uRmllbGQNCg0KLyoqDQogKiDQoNCw0YHRh9GR0YIg0YDQsNGB0L/RgNC10LTQtdC70LXQvdC40Y8g0LDQstCw0L3RgdC+0LLRi9GFINC/0LvQsNGC0LXQttC10Lkg0Lgg0L3QsNC70L7Qs9CwINC90LAg0L/RgNC40LHRi9C70Ywg0L/QviDQvtCx0L7RgdC+0LHQu9C10L3QvdGL0Lwg0L/QvtC00YDQsNC30LTQtdC70LXQvdC40Y/QvCDQvtGA0LPQsNC90LjQt9Cw0YbQuNC4Lg0KICogZm9ybVRlbXBsYXRlSWQ9MjUwMA0KICoNCiAqIEBhdXRob3IgYWthZHlyZ3Vsb3YNCiAqLw0KLy8g0LPRgNCw0YTQsCAxICAtIG51bWJlcg0KLy8g0LPRgNCw0YTQsCAgICAtIGZpeA0KLy8g0LPRgNCw0YTQsCAyICAtIHJlZ2lvbkJhbmsNCi8vINCz0YDQsNGE0LAgMyAgLSByZWdpb25CYW5rRGl2aXNpb24NCi8vINCz0YDQsNGE0LAgNCAgLSBkaXZpc2lvbk5hbWUNCi8vINCz0YDQsNGE0LAgNSAgLSBrcHANCi8vINCz0YDQsNGE0LAgNiAgLSBwcm9wZXJ0eVByaWNlDQovLyDQs9GA0LDRhNCwIDcgIC0gd29ya2Vyc0NvdW50DQovLyDQs9GA0LDRhNCwIDggIC0gc3ViamVjdFRheENyZWRpdA0KLy8g0LPRgNCw0YTQsCA5ICAtIGNhbGNGbGFnDQovLyDQs9GA0LDRhNCwIDEwIC0gb2JsaWdhdGlvblBheVRheA0KLy8g0LPRgNCw0YTQsCAxMSAtIGJhc2VUYXhPZg0KLy8g0LPRgNCw0YTQsCAxMiAtIGJhc2VUYXhPZlJ1Yg0KLy8g0LPRgNCw0YTQsCAxMyAtIHN1YmplY3RUYXhTdGF2a2ENCi8vINCz0YDQsNGE0LAgMTQgLSB0YXhTdW0NCi8vINCz0YDQsNGE0LAgMTUgLSB0YXhTdW1PdXRzaWRlDQovLyDQs9GA0LDRhNCwIDE2IC0gdGF4U3VtVG9QYXkNCi8vINCz0YDQsNGE0LAgMTcgLSB0YXhTdW1Ub1JlZHVjdGlvbg0KLy8g0LPRgNCw0YTQsCAxOCAtIGV2ZXJ5TW9udGhlclBheW1lbnRBZnRlclBlcmlvZA0KLy8g0LPRgNCw0YTQsCAxOSAtIGV2ZXJ5TW9udGhGb3JLdmFydGFsTmV4dFBlcmlvZA0KLy8g0LPRgNCw0YTQsCAyMCAtIGV2ZXJ5TW9udGhGb3JTZWNvbmRLdmFydGFsTmV4dFBlcmlvZA0KLy8g0LPRgNCw0YTQsCAyMSAtIGV2ZXJ5TW9udGhGb3JUaGlyZEt2YXJ0YWxOZXh0UGVyaW9kDQovLyDQs9GA0LDRhNCwIDIyIC0gZXZlcnlNb250aEZvckZvdXJ0aEt2YXJ0YWxOZXh0UGVyaW9kDQovLyDQs9GA0LDRhNCwIDIzIC0gbWluaW1pemVUYXhTdW0NCi8vINCz0YDQsNGE0LAgMjQgLSBhbW91bnRUYXgNCg0Kc3dpdGNoIChmb3JtRGF0YUV2ZW50KSB7DQogICAgY2FzZSBGb3JtRGF0YUV2ZW50LkNSRUFURToNCiAgICAgICAgZm9ybURhdGFTZXJ2aWNlLmNoZWNrVW5pcXVlKGZvcm1EYXRhLCBsb2dnZXIpDQogICAgICAgIGJyZWFrDQogICAgY2FzZSBGb3JtRGF0YUV2ZW50LkNIRUNLOg0KICAgICAgICBsb2dpY2FsQ2hlY2soKQ0KICAgICAgICBicmVhaw0KICAgIGNhc2UgRm9ybURhdGFFdmVudC5DQUxDVUxBVEU6DQogICAgICAgIGNhbGMoKQ0KICAgICAgICBsb2dpY2FsQ2hlY2tBZnRlckNhbGMoKQ0KICAgICAgICBmb3JtRGF0YVNlcnZpY2Uuc2F2ZUNhY2hlZERhdGFSb3dzKGZvcm1EYXRhLCBsb2dnZXIpDQogICAgICAgIGJyZWFrDQogICAgY2FzZSBGb3JtRGF0YUV2ZW50LkFERF9ST1c6DQogICAgICAgIGZvcm1EYXRhU2VydmljZS5hZGRSb3coZm9ybURhdGEsIGN1cnJlbnREYXRhUm93LCBlZGl0YWJsZUNvbHVtbnMsIGF1dG9GaWxsQ29sdW1ucykNCiAgICAgICAgYnJlYWsNCiAgICBjYXNlIEZvcm1EYXRhRXZlbnQuREVMRVRFX1JPVzoNCiAgICAgICAgaWYgKGN1cnJlbnREYXRhUm93LmdldEFsaWFzKCkgPT0gbnVsbCkgZm9ybURhdGFTZXJ2aWNlLmdldERhdGFSb3dIZWxwZXIoZm9ybURhdGEpLmRlbGV0ZShjdXJyZW50RGF0YVJvdykNCiAgICAgICAgYnJlYWsNCiAgICBjYXNlIEZvcm1EYXRhRXZlbnQuTU9WRV9DUkVBVEVEX1RPX0FQUFJPVkVEOiAgLy8g0KPRgtCy0LXRgNC00LjRgtGMINC40LcgItCh0L7Qt9C00LDQvdCwIg0KICAgIGNhc2UgRm9ybURhdGFFdmVudC5NT1ZFX0FQUFJPVkVEX1RPX0FDQ0VQVEVEOiAvLyDQn9GA0LjQvdGP0YLRjCDQuNC3ICLQo9GC0LLQtdGA0LbQtNC10L3QsCINCiAgICBjYXNlIEZvcm1EYXRhRXZlbnQuTU9WRV9DUkVBVEVEX1RPX0FDQ0VQVEVEOiAgLy8g0J/RgNC40L3Rj9GC0Ywg0LjQtyAi0KHQvtC30LTQsNC90LAiDQogICAgY2FzZSBGb3JtRGF0YUV2ZW50Lk1PVkVfQ1JFQVRFRF9UT19QUkVQQVJFRDogIC8vINCf0L7QtNCz0L7RgtC+0LLQuNGC0Ywg0LjQtyAi0KHQvtC30LTQsNC90LAiDQogICAgY2FzZSBGb3JtRGF0YUV2ZW50Lk1PVkVfUFJFUEFSRURfVE9fQUNDRVBURUQ6IC8vINCf0YDQuNC90Y/RgtGMINC40LcgItCf0L7QtNCz0L7RgtC+0LLQu9C10L3QsCINCiAgICBjYXNlIEZvcm1EYXRhRXZlbnQuTU9WRV9QUkVQQVJFRF9UT19BUFBST1ZFRDogLy8g0KPRgtCy0LXRgNC00LjRgtGMINC40LcgItCf0L7QtNCz0L7RgtC+0LLQu9C10L3QsCINCiAgICAgICAgbG9naWNhbENoZWNrKCkNCiAgICAgICAgY2hlY2tEZWNsYXJhdGlvbigpDQogICAgICAgIGJyZWFrDQovLyDQv9C+0YHQu9C1INC/0YDQuNC90Y/RgtC40Y8g0LjQtyDQv9C+0LTQs9C+0YLQvtCy0LvQtdC90LANCiAgICBjYXNlIEZvcm1EYXRhRXZlbnQuQUZURVJfTU9WRV9QUkVQQVJFRF9UT19BQ0NFUFRFRDoNCiAgICAgICAgbG9naWNhbENoZWNrKCkNCiAgICAgICAgLy8g0L3QsCDRgdGC0L7RgNC+0L3QtSDRgdC10YDQstC10YDQsCDQsdGD0LTQtdGCINCy0YvQv9C+0LvQvdC10L0gY29tcG9zZQ0KICAgICAgICBicmVhaw0KLy8g0L7QsdC+0LHRidC40YLRjA0KICAgIGNhc2UgRm9ybURhdGFFdmVudC5DT01QT1NFOg0KICAgICAgICBjb25zb2xpZGF0aW9uKCkNCiAgICAgICAgY2FsYygpDQogICAgICAgIGZvcm1EYXRhU2VydmljZS5zYXZlQ2FjaGVkRGF0YVJvd3MoZm9ybURhdGEsIGxvZ2dlcikNCiAgICAgICAgYnJlYWsNCiAgICBjYXNlIEZvcm1EYXRhRXZlbnQuSU1QT1JUOg0KICAgICAgICBpbXBvcnREYXRhKCkNCiAgICAgICAgaWYgKCFsb2dnZXIuY29udGFpbnNMZXZlbChMb2dMZXZlbC5FUlJPUikpIHsNCiAgICAgICAgICAgIGZvcm1EYXRhU2VydmljZS5zYXZlQ2FjaGVkRGF0YVJvd3MoZm9ybURhdGEsIGxvZ2dlcikNCiAgICAgICAgfQ0KICAgICAgICBicmVhaw0KICAgIGNhc2UgRm9ybURhdGFFdmVudC5TT1JUX1JPV1M6DQogICAgICAgIHNvcnRGb3JtRGF0YVJvd3MoKQ0KICAgICAgICBicmVhaw0KfQ0KDQovLy8vINCa0Y3RiNC4INC4INC60L7QvdGB0YLQsNC90YLRiw0KQEZpZWxkDQpkZWYgcHJvdmlkZXJDYWNoZSA9IFs6XQ0KQEZpZWxkDQpkZWYgcmVjb3JkQ2FjaGUgPSBbOl0NCkBGaWVsZA0KZGVmIHJlZkJvb2tDYWNoZSA9IFs6XQ0KDQovLyDQktGB0LUg0LDRgtGA0LjQsdGD0YLRiw0KQEZpZWxkDQpkZWYgYWxsQ29sdW1ucyA9IFsnbnVtYmVyJywgJ3JlZ2lvbkJhbmsnLCAnZml4JywgJ3JlZ2lvbkJhbmtEaXZpc2lvbicsICdkaXZpc2lvbk5hbWUnLCAna3BwJywgJ3Byb3BlcnR5UHJpY2UnLA0KICAgICAgICAgICAgICAgICAgJ3dvcmtlcnNDb3VudCcsICdzdWJqZWN0VGF4Q3JlZGl0JywgJ2NhbGNGbGFnJywgJ29ibGlnYXRpb25QYXlUYXgnLA0KICAgICAgICAgICAgICAgICAgJ2Jhc2VUYXhPZicsICdiYXNlVGF4T2ZSdWInLCAnc3ViamVjdFRheFN0YXZrYScsICd0YXhTdW0nLA0KICAgICAgICAgICAgICAgICAgJ3RheFN1bU91dHNpZGUnLCAndGF4U3VtVG9QYXknLCAndGF4U3VtVG9SZWR1Y3Rpb24nLA0KICAgICAgICAgICAgICAgICAgJ2V2ZXJ5TW9udGhlclBheW1lbnRBZnRlclBlcmlvZCcsICdldmVyeU1vbnRoRm9yS3ZhcnRhbE5leHRQZXJpb2QnLA0KICAgICAgICAgICAgICAgICAgJ2V2ZXJ5TW9udGhGb3JTZWNvbmRLdmFydGFsTmV4dFBlcmlvZCcsICdldmVyeU1vbnRoRm9yVGhpcmRLdmFydGFsTmV4dFBlcmlvZCcsDQogICAgICAgICAgICAgICAgICAnZXZlcnlNb250aEZvckZvdXJ0aEt2YXJ0YWxOZXh0UGVyaW9kJywgJ21pbmltaXplVGF4U3VtJywgJ2Ftb3VudFRheCddDQoNCi8vINCg0LXQtNCw0LrRgtC40YDRg9C10LzRi9C1INCw0YLRgNC40LHRg9GC0YsNCkBGaWVsZA0KZGVmIGVkaXRhYmxlQ29sdW1ucyA9IFsncmVnaW9uQmFua0RpdmlzaW9uJywgJ2twcCcsICdwcm9wZXJ0eVByaWNlJywgJ3dvcmtlcnNDb3VudCcsICdzdWJqZWN0VGF4Q3JlZGl0JywgJ21pbmltaXplVGF4U3VtJywgJ2Ftb3VudFRheCddDQoNCi8vINCQ0LLRgtC+0LfQsNC/0L7Qu9C90Y/QtdC80YvQtSDQsNGC0YDQuNCx0YPRgtGLDQpARmllbGQNCmRlZiBhdXRvRmlsbENvbHVtbnMgPSBhbGxDb2x1bW5zIC0gZWRpdGFibGVDb2x1bW5zDQoNCi8vINCf0YDQvtCy0LXRgNGP0LXQvNGL0LUg0L3QsCDQv9GD0YHRgtGL0LUg0LfQvdCw0YfQtdC90LjRjyDQsNGC0YDQuNCx0YPRgtGLDQpARmllbGQNCmRlZiBub25FbXB0eUNvbHVtbnMgPSBbJ3JlZ2lvbkJhbmsnLCAncmVnaW9uQmFua0RpdmlzaW9uJywNCiAgICAgICAgICAgICAgICAgICAgICAgJ2RpdmlzaW9uTmFtZScsICdrcHAnLCAncHJvcGVydHlQcmljZScsICd3b3JrZXJzQ291bnQnLA0KICAgICAgICAgICAgICAgICAgICAgICAnc3ViamVjdFRheENyZWRpdCcsICdjYWxjRmxhZycsICdvYmxpZ2F0aW9uUGF5VGF4JywNCiAgICAgICAgICAgICAgICAgICAgICAgJ2Jhc2VUYXhPZicsICdiYXNlVGF4T2ZSdWInLCAnc3ViamVjdFRheFN0YXZrYScsDQogICAgICAgICAgICAgICAgICAgICAgICd0YXhTdW0nLCAndGF4U3VtT3V0c2lkZScsICd0YXhTdW1Ub1BheScsDQogICAgICAgICAgICAgICAgICAgICAgICd0YXhTdW1Ub1JlZHVjdGlvbicsICdldmVyeU1vbnRoRm9yS3ZhcnRhbE5leHRQZXJpb2QnLA0KICAgICAgICAgICAgICAgICAgICAgICAnZXZlcnlNb250aEZvclNlY29uZEt2YXJ0YWxOZXh0UGVyaW9kJywgJ2V2ZXJ5TW9udGhGb3JUaGlyZEt2YXJ0YWxOZXh0UGVyaW9kJywNCiAgICAgICAgICAgICAgICAgICAgICAgJ2V2ZXJ5TW9udGhGb3JGb3VydGhLdmFydGFsTmV4dFBlcmlvZCddDQoNCi8vINCT0YDRg9C/0L/QuNGA0YPQtdC80YvQtSDQsNGC0YDQuNCx0YPRgtGLDQpARmllbGQNCmRlZiBncm91cENvbHVtbnMgPSBbJ3JlZ2lvbkJhbmtEaXZpc2lvbicsICdyZWdpb25CYW5rJ10NCg0KLy8g0JDRgtGA0LjQsdGD0YLRiyDQtNC70Y8g0LjRgtC+0LPQvtCyDQpARmllbGQNCmRlZiB0b3RhbENvbHVtbnMgPSBbJ3Byb3BlcnR5UHJpY2UnLCAnd29ya2Vyc0NvdW50JywgJ3N1YmplY3RUYXhDcmVkaXQnLA0KICAgICAgICAgICAgICAgICAgICAnYmFzZVRheE9mUnViJywgJ3RheFN1bScsICd0YXhTdW1PdXRzaWRlJywgJ3RheFN1bVRvUGF5JywNCiAgICAgICAgICAgICAgICAgICAgJ3RheFN1bVRvUmVkdWN0aW9uJywgJ2V2ZXJ5TW9udGhlclBheW1lbnRBZnRlclBlcmlvZCcsDQogICAgICAgICAgICAgICAgICAgICdldmVyeU1vbnRoRm9yS3ZhcnRhbE5leHRQZXJpb2QnLCAnZXZlcnlNb250aEZvclNlY29uZEt2YXJ0YWxOZXh0UGVyaW9kJywNCiAgICAgICAgICAgICAgICAgICAgJ2V2ZXJ5TW9udGhGb3JUaGlyZEt2YXJ0YWxOZXh0UGVyaW9kJywNCiAgICAgICAgICAgICAgICAgICAgJ2V2ZXJ5TW9udGhGb3JGb3VydGhLdmFydGFsTmV4dFBlcmlvZCcsICdtaW5pbWl6ZVRheFN1bSddDQoNCi8vINGA0LDRgdGH0LjRgtGL0LLQsNC10LzRi9C1INC/0L7Qu9GPICjQs9GA0LDRhNCwIDEyLi4yMikNCkBGaWVsZA0KZGVmIGNhbGNDb2x1bW5zID0gWyAnYmFzZVRheE9mUnViJywgJ3N1YmplY3RUYXhTdGF2a2EnLCAndGF4U3VtJywgJ3RheFN1bU91dHNpZGUnLCAndGF4U3VtVG9QYXknLCAndGF4U3VtVG9SZWR1Y3Rpb24nLA0KICAgICAgICAnZXZlcnlNb250aGVyUGF5bWVudEFmdGVyUGVyaW9kJywgJ2V2ZXJ5TW9udGhGb3JLdmFydGFsTmV4dFBlcmlvZCcsICdldmVyeU1vbnRoRm9yU2Vjb25kS3ZhcnRhbE5leHRQZXJpb2QnLA0KICAgICAgICAnZXZlcnlNb250aEZvclRoaXJkS3ZhcnRhbE5leHRQZXJpb2QnLCAnZXZlcnlNb250aEZvckZvdXJ0aEt2YXJ0YWxOZXh0UGVyaW9kJ10NCg0KLy8g0YDQsNGB0YfQuNGC0YvQstCw0LXQvNGL0LUg0L/QvtC70Y8gKNCz0YDQsNGE0LAgMiwgNCwgOSwgMTAsIDExKQ0KQEZpZWxkDQpkZWYgbm90TnVtYmVyQ2FsY0NvbHVtbnMgPSBbJ3JlZ2lvbkJhbmsnLCAnZGl2aXNpb25OYW1lJywgJ2NhbGNGbGFnJywgJ29ibGlnYXRpb25QYXlUYXgnLCAnYmFzZVRheE9mJ10NCg0KQEZpZWxkDQpkZWYgZm9ybURhdGFDYWNoZSA9IFs6XQ0KQEZpZWxkDQpkZWYgaGVscGVyQ2FjaGUgPSBbOl0NCg0KQEZpZWxkDQpkZWYgc3VtbWFyeU1hcCA9IFtbMzAxLCAzMDVdIDogItCU0L7RhdC+0LTRiywg0YPRh9C40YLRi9Cy0LDQtdC80YvQtSDQsiDQv9GA0L7RgdGC0YvRhSDQoNCd0KMiLCBbMzAyXSA6ICLQodCy0L7QtNC90LDRjyDRhNC+0YDQvNCwINC90LDRh9C40YHQu9C10L3QvdGL0YUg0LTQvtGF0L7QtNC+0LIiLCAvL9C80LDQutGB0LjQvNGD0Lwg0LTQstCwINCy0LjQtNCwINC40YHRgtC+0YfQvdC40LrQvtCyINGBINC+0LTQvdC40Lwg0LjQvNC10L3QtdC8DQogICAgICAgICAgICAgICAgICBbMzAzXSA6ICLQodCy0L7QtNC90LDRjyDRhNC+0YDQvNCwINC90LDRh9C40YHQu9C10L3QvdGL0YUg0YDQsNGB0YXQvtC00L7QsiIsIFszMDQsIDMxMF0gOiAi0KDQsNGB0YXQvtC00YssINGD0YfQuNGC0YvQstCw0LXQvNGL0LUg0LIg0L/RgNC+0YHRgtGL0YUg0KDQndCjIl0NCg0KQEZpZWxkDQpsb25nIGNlbnRyYWxJZCA9IDExMyAvLyBJRCDQptC10L3RgtGA0LDQu9GM0L3QvtCz0L4g0LDQv9C/0LDRgNCw0YLQsA0KDQpARmllbGQNCmRlZiBzdGFydERhdGUgPSBudWxsDQoNCkBGaWVsZA0KZGVmIGVuZERhdGUgPSBudWxsDQoNCmRlZiBnZXRSZXBvcnRQZXJpb2RTdGFydERhdGUoKSB7DQogICAgaWYgKHN0YXJ0RGF0ZSA9PSBudWxsKSB7DQogICAgICAgIHN0YXJ0RGF0ZSA9IHJlcG9ydFBlcmlvZFNlcnZpY2UuZ2V0Q2FsZW5kYXJTdGFydERhdGUoZm9ybURhdGEucmVwb3J0UGVyaW9kSWQpLnRpbWUNCiAgICB9DQogICAgcmV0dXJuIHN0YXJ0RGF0ZQ0KfQ0KDQpkZWYgZ2V0UmVwb3J0UGVyaW9kRW5kRGF0ZSgpIHsNCiAgICBpZiAoZW5kRGF0ZSA9PSBudWxsKSB7DQogICAgICAgIGVuZERhdGUgPSByZXBvcnRQZXJpb2RTZXJ2aWNlLmdldEVuZERhdGUoZm9ybURhdGEucmVwb3J0UGVyaW9kSWQpLnRpbWUNCiAgICB9DQogICAgcmV0dXJuIGVuZERhdGUNCn0NCg0KLy8g0KDQsNC30YvQvNC10L3QvtCy0LDQvdC40LUg0LfQsNC/0LjRgdC4INGB0L/RgNCw0LLQvtGH0L3QuNC60LANCmRlZiBnZXRSZWZCb29rVmFsdWUoZGVmIGxvbmcgcmVmQm9va0lkLCBkZWYgTG9uZyByZWNvcmRJZCkgew0KICAgIHJldHVybiBmb3JtRGF0YVNlcnZpY2UuZ2V0UmVmQm9va1ZhbHVlKHJlZkJvb2tJZCwgcmVjb3JkSWQsIHJlZkJvb2tDYWNoZSkNCn0NCg0KLy8g0J/QvtC40YHQuiDQt9Cw0L/QuNGB0Lgg0LIg0YHQv9GA0LDQstC+0YfQvdC40LrQtSDQv9C+INC30L3QsNGH0LXQvdC40Y4gKNC00LvRjyDRgNCw0YHRh9C10YLQvtCyKSArINC/0L4g0LTQsNGC0LUNCmRlZiBnZXRSZWZCb29rUmVjb3JkKGRlZiBMb25nIHJlZkJvb2tJZCwgZGVmIFN0cmluZyBhbGlhcywgZGVmIFN0cmluZyB2YWx1ZSwgZGVmIERhdGUgZGF5LCBkZWYgaW50IHJvd0luZGV4LCBkZWYgU3RyaW5nIGNlbGxOYW1lLA0KICAgICAgICAgICAgICAgICAgICAgYm9vbGVhbiByZXF1aXJlZCkgew0KICAgIHJldHVybiBmb3JtRGF0YVNlcnZpY2UuZ2V0UmVmQm9va1JlY29yZChyZWZCb29rSWQsIHJlY29yZENhY2hlLCBwcm92aWRlckNhY2hlLCByZWZCb29rQ2FjaGUsIGFsaWFzLCB2YWx1ZSwNCiAgICAgICAgICAgIGRheSwgcm93SW5kZXgsIGNlbGxOYW1lLCBsb2dnZXIsIHJlcXVpcmVkKQ0KfQ0KDQovLyDQn9C+0LjRgdC6INC30LDQv9C40YHQuCDQsiDRgdC/0YDQsNCy0L7Rh9C90LjQutC1INC/0L4g0LfQvdCw0YfQtdC90LjRjiAo0LTQu9GPINC40LzQv9C+0YDRgtCwKQ0KZGVmIGdldFJlY29yZElkSW1wb3J0KGRlZiBMb25nIHJlZkJvb2tJZCwgZGVmIFN0cmluZyBhbGlhcywgZGVmIFN0cmluZyB2YWx1ZSwgZGVmIGludCByb3dJbmRleCwgZGVmIGludCBjb2xJbmRleCwNCiAgICAgICAgICAgICAgICAgICAgICBkZWYgYm9vbGVhbiByZXF1aXJlZCA9IHRydWUpIHsNCiAgICBpZiAodmFsdWUgPT0gbnVsbCB8fCB2YWx1ZS50cmltKCkuaXNFbXB0eSgpKSB7DQogICAgICAgIHJldHVybiBudWxsDQogICAgfQ0KICAgIHJldHVybiBmb3JtRGF0YVNlcnZpY2UuZ2V0UmVmQm9va1JlY29yZElkSW1wb3J0KHJlZkJvb2tJZCwgcmVjb3JkQ2FjaGUsIHByb3ZpZGVyQ2FjaGUsIGFsaWFzLCB2YWx1ZSwNCiAgICAgICAgICAgIGdldFJlcG9ydFBlcmlvZEVuZERhdGUoKSwgcm93SW5kZXgsIGNvbEluZGV4LCBsb2dnZXIsIHJlcXVpcmVkKQ0KfQ0KDQovKioNCiAqINCg0LDRgdGH0LXRgtGLLiDQkNC70LPQvtGA0LjRgtC80Ysg0LfQsNC/0L7Qu9C90LXQvdC40Y8g0L/QvtC70LXQuSDRhNC+0YDQvNGLLg0KICovDQp2b2lkIGNhbGMoKSB7DQogICAgZGVmIGRhdGFSb3dzID0gZm9ybURhdGFTZXJ2aWNlLmdldERhdGFSb3dIZWxwZXIoZm9ybURhdGEpLmFsbENhY2hlZA0KDQogICAgLy8g0YPQtNCw0LvQuNGC0Ywg0YTQuNC60YHQuNGA0L7QstCw0L3QvdGL0LUg0YHRgtGA0L7QutC4DQogICAgZGVsZXRlQWxsQWxpYXNlZChkYXRhUm93cykNCg0KICAgIGxvZ2ljYWxDaGVja0JlZm9yZUNhbGMoKQ0KICAgIGlmIChsb2dnZXIuY29udGFpbnNMZXZlbChMb2dMZXZlbC5FUlJPUikpIHsNCiAgICAgICAgcmV0dXJuDQogICAgfQ0KDQogICAgZGVmIHByb3BlcnR5UHJpY2VTdW1tID0gZ2V0U3VtQWxsKGRhdGFSb3dzLCAicHJvcGVydHlQcmljZSIpDQogICAgZGVmIHdvcmtlcnNDb3VudFN1bW0gPSBnZXRTdW1BbGwoZGF0YVJvd3MsICJ3b3JrZXJzQ291bnQiKQ0KDQogICAgLy8g0KDQsNGB0L/RgNC10LTQtdC70Y/QtdC80LDRjyDQvdCw0LvQvtCz0L7QstCw0Y8g0LHQsNC30LAg0LfQsCDQvtGC0YfQtdGC0L3Ri9C5INC/0LXRgNC40L7QtC4NCiAgICBkZWYgdGF4QmFzZQ0KICAgIGlmIChmb3JtRGF0YUV2ZW50ICE9IEZvcm1EYXRhRXZlbnQuQ09NUE9TRSkgew0KICAgICAgICB0YXhCYXNlID0gcm91bmRWYWx1ZShnZXRUYXhCYXNlQXNEZWNsYXJhdGlvbigpLCAwKQ0KICAgIH0NCiAgICAvLyDQntGC0YfRkdGC0L3Ri9C5INC/0LXRgNC40L7QtC4NCiAgICBkZWYgcmVwb3J0UGVyaW9kID0gZ2V0UmVwb3J0UGVyaW9kKCkNCiAgICBkZWYgZGVwYXJ0bWVudFBhcmFtc0RhdGUgPSBnZXRSZXBvcnRQZXJpb2RFbmREYXRlKCkgLSAxDQoNCiAgICAvLyDQn9C+0LvRg9GH0LXQvdC40LUg0YHRgtGA0L7QuiDRhNC+0YDQvNGLICLQodCy0LXQtNC10L3QuNGPINC+INGB0YPQvNC80LDRhSDQvdCw0LvQvtCz0LAg0L3QsCDQv9GA0LjQsdGL0LvRjCwg0YPQv9C70LDRh9C10L3QvdC+0LPQviDQkdCw0L3QutC+0Lwg0LfQsCDRgNGD0LHQtdC20L7QvCINCiAgICBkZWYgZGF0YVJvd3NTdW0gPSBnZXREYXRhUm93cyg0MjEsIEZvcm1EYXRhS2luZC5BRERJVElPTkFMKQ0KDQogICAgLy8g0KHRg9C80LzQsCDQvdCw0LvQvtCz0LAg0L3QsCDQv9GA0LjQsdGL0LvRjCwg0LLRi9C/0LvQsNGH0LXQvdC90LDRjyDQt9CwINC/0YDQtdC00LXQu9Cw0LzQuCDQoNC+0YHRgdC40LnRgdC60L7QuSDQpNC10LTQtdGA0LDRhtC40Lgg0LIg0L7RgtGH0ZHRgtC90L7QvCDQv9C10YDQuNC+0LTQtS4NCiAgICBkZWYgc3VtTmFsID0gMA0KICAgIGRlZiBzdW1UYXhSZWNvcmRzID0gZ2V0UmVmQm9va1JlY29yZCgzMywgIkRFUEFSVE1FTlRfSUQiLCAiMSIsIGRlcGFydG1lbnRQYXJhbXNEYXRlLCAtMSwgbnVsbCwgZmFsc2UpDQogICAgaWYgKHN1bVRheFJlY29yZHMgIT0gbnVsbCAmJiAhc3VtVGF4UmVjb3Jkcy5pc0VtcHR5KCkpIHsNCiAgICAgICAgc3VtTmFsID0gZ2V0QWxpYXNGcm9tRm9ybShkYXRhUm93c1N1bSwgJ3RheFN1bScsICdTVU1fVEFYJykNCiAgICB9DQoNCiAgICBkZWYgcHJldkRhdGFSb3dzID0gZ2V0UHJldkRhdGFSb3dzKCkNCg0KICAgIC8vINGA0LDRgdGH0LXRgiDQs9GA0LDRhNGLIDIuLjQsIDguLjIxDQogICAgZm9yIChyb3cgaW4gZGF0YVJvd3MpIHsNCiAgICAgICAgLy8g0LPRgNCw0YTQsCAyIC0g0L3QsNC30LLQsNC90LjQtSDQv9C+0LTRgNCw0LfQtNC10LvQtdC90LjRjw0KICAgICAgICByb3cucmVnaW9uQmFuayA9IGNhbGMyKHJvdykNCg0KICAgICAgICBkZWYgaW5jb21lUGFyYW0NCiAgICAgICAgaWYgKHJvdy5yZWdpb25CYW5rRGl2aXNpb24gIT0gbnVsbCkgew0KICAgICAgICAgICAgZGVmIGRlcGFydG1lbnRQYXJhbSA9IGdldFJlZkJvb2tWYWx1ZSgzMCwgcm93LnJlZ2lvbkJhbmtEaXZpc2lvbikNCg0KICAgICAgICAgICAgZGVmIGRlcFBhcmFtID0gZ2V0RGVwUGFyYW0oZGVwYXJ0bWVudFBhcmFtKQ0KICAgICAgICAgICAgZGVmIGRlcElkID0gZGVwUGFyYW0uZ2V0KFJlZkJvb2suUkVDT1JEX0lEX0FMSUFTKS5udW1iZXJWYWx1ZSBhcyBsb25nDQoNCiAgICAgICAgICAgIGluY29tZVBhcmFtID0gZ2V0UmVmQm9va1JlY29yZCgzMywgIkRFUEFSVE1FTlRfSUQiLCAiJGRlcElkIiwgZGVwYXJ0bWVudFBhcmFtc0RhdGUsIC0xLCBudWxsLCBmYWxzZSkNCiAgICAgICAgfQ0KICAgICAgICBpZiAoaW5jb21lUGFyYW0gPT0gbnVsbCB8fCBpbmNvbWVQYXJhbS5pc0VtcHR5KCkpIHsNCiAgICAgICAgICAgIGNvbnRpbnVlDQogICAgICAgIH0NCiAgICAgICAgLy8g0LPRgNCw0YTQsCA0IC0g0L3QsNC40LzQtdC90L7QstCw0L3QuNC1INC/0L7QtNGA0LDQt9C00LXQu9C10L3QuNGPINCyINC00LXQutC70LDRgNCw0YbQuNC4DQogICAgICAgIHJvdy5kaXZpc2lvbk5hbWUgPSBjYWxjNChyb3cpDQoNCiAgICAgICAgLy8g0LPRgNCw0YTQsCA5IC0g0J/RgNC40LfQvdCw0Log0YDQsNGB0YfRkdGC0LANCiAgICAgICAgcm93LmNhbGNGbGFnID0gY2FsYzkocm93KQ0KDQogICAgICAgIC8vINCz0YDQsNGE0LAgMTAgLSDQntCx0Y/Qt9Cw0L3QvdC+0YHRgtGMINC/0L4g0YPQv9C70LDRgtC1INC90LDQu9C+0LPQsA0KICAgICAgICByb3cub2JsaWdhdGlvblBheVRheCA9IGNhbGMxMChyb3cpDQoNCiAgICAgICAgLy8g0LPRgNCw0YTQsCAxMQ0KICAgICAgICByb3cuYmFzZVRheE9mID0gY2FsYzExKHJvdywgcHJvcGVydHlQcmljZVN1bW0sIHdvcmtlcnNDb3VudFN1bW0pDQoNCiAgICAgICAgaWYgKGZvcm1EYXRhRXZlbnQgIT0gRm9ybURhdGFFdmVudC5DT01QT1NFKSB7DQogICAgICAgICAgICAvLyDQs9GA0LDRhNCwIDEyDQogICAgICAgICAgICByb3cuYmFzZVRheE9mUnViID0gY2FsYzEyKHJvdywgdGF4QmFzZSkNCiAgICAgICAgfQ0KICAgICAgICAvLyDQs9GA0LDRhNCwIDEzDQogICAgICAgIHJvdy5zdWJqZWN0VGF4U3RhdmthID0gY2FsYzEzKHJvdykNCg0KICAgICAgICAvLyDQs9GA0LDRhNCwIDE0DQogICAgICAgIHJvdy50YXhTdW0gPSBjYWxjMTQocm93KQ0KDQogICAgICAgIC8vINCz0YDQsNGE0LAgMTQuLjIxDQogICAgICAgIGNhbGNDb2x1bW5Gcm9tMTRUbzIxKHByZXZEYXRhUm93cywgcm93LCByb3csIHN1bU5hbCwgcmVwb3J0UGVyaW9kKQ0KICAgIH0NCg0KICAgIC8vINC90YPQttC10L0g0L7RgtC00LXQu9GM0L3Ri9C5INGA0LDRgdGH0LXRgg0KICAgIGZvciAocm93IGluIGRhdGFSb3dzKSB7DQogICAgICAgIGNhbGMxOF8xOShwcmV2RGF0YVJvd3MsIGRhdGFSb3dzLCByb3csIHJlcG9ydFBlcmlvZCkNCiAgICB9DQoNCiAgICBkZWYgdGVtcGxhdGVSb3dzID0gZm9ybURhdGFTZXJ2aWNlLmdldEZvcm1UZW1wbGF0ZShmb3JtRGF0YS5mb3JtVHlwZS5pZCwgZm9ybURhdGEucmVwb3J0UGVyaW9kSWQpLmdldFJvd3MoKQ0KDQogICAgLy8g0LTQvtCx0LDQstC40YLRjCDRgdGC0YDQvtC60YMg0KbQkCAo0YHQutC+0YDRgNC10LrRgtGA0LjRgNC+0LLQsNC90L3Ri9C5KSAo0LPRgNCw0YTQsCAxLi4yMikNCiAgICBkZWYgY2FUb3RhbFJvdyA9IGdldERhdGFSb3codGVtcGxhdGVSb3dzLCAnY2EnKQ0KICAgIGRhdGFSb3dzLmFkZChjYVRvdGFsUm93KQ0KDQogICAgLy8g0LTQvtCx0LDQstC40YLRjCDQuNGC0L7Qs9C+ICjQs9GA0LDRhNCwIDUuLjcsIDEwLCAxMSwgMTMuLjIyKQ0KICAgIGRlZiB0b3RhbFJvdyA9IGdldERhdGFSb3codGVtcGxhdGVSb3dzLCAndG90YWwnKQ0KICAgIGNhbGNUb3RhbFJvdyhkYXRhUm93cywgdG90YWxSb3cpDQogICAgZGF0YVJvd3MuYWRkKHRvdGFsUm93KQ0KDQogICAgLy8g0LIg0YHRgtGA0L7QutCw0YUg0LTQvtC70LbQvdCwINCx0YvRgtGMINC40YLQvtCz0L7QstCw0Y8NCiAgICBjYWxjQ2FUb3RhbFJvdyhkYXRhUm93cywgcHJldkRhdGFSb3dzLCBjYVRvdGFsUm93LCB0b3RhbFJvdywgdGF4QmFzZSwgc3VtTmFsKQ0KDQogICAgLy8g0J/QvtGB0LvQtSDRgNCw0YHRh9C10YLQsCDRhNC40LrRgS4g0YHRgtGA0L7QutC4ICLQptCQKNGB0LrQvtGA0YDQtdC60YIpIiDQvdC10L7QsdGF0L7QtNC40LzQviDQv9C10YDQtdGB0YfQuNGC0LDRgtGMINC00LvRjyDQs9GA0LDRhCAxMiwgMTQsIDE1LCAxNywgMTgsIDE5DQogICAgLy8g0YTQuNC60YHQuNGA0L7QstCw0L3QvdGD0Y4g0YHRgtGA0L7QutGDINC40YLQvtCz0L7Qsjog0YHRg9C80LzQsCDQstGB0LXRhSDRgdGC0YDQvtC6LCDQutGA0L7QvNC1INGB0YLRgNC+0LrQuCAi0KbQkCIg0Lgg0YHRgtGA0L7QutC4INC40YLQvtCz0L7Qsg0KICAgIHJlQ2FsY1RvdGFsUm93KGRhdGFSb3dzLCB0b3RhbFJvdykNCg0KICAgIHVwZGF0ZUluZGV4ZXMoZGF0YVJvd3MpDQp9DQoNCnZvaWQgcmVDYWxjVG90YWxSb3coZGVmIGRhdGFSb3dzLCBkZWYgdG90YWxSb3cpIHsNCiAgICBkZWYgaXNUYXhQZXJpb2QgPSByZXBvcnRQZXJpb2RTZXJ2aWNlLmdldChmb3JtRGF0YS5yZXBvcnRQZXJpb2RJZCkub3JkZXIgPT0gNA0KDQogICAgdG90YWxSb3cuYmFzZVRheE9mUnViID0gMA0KICAgIHRvdGFsUm93LnRheFN1bSA9IDANCiAgICB0b3RhbFJvdy50YXhTdW1PdXRzaWRlID0gMA0KICAgIHRvdGFsUm93LnRheFN1bVRvUmVkdWN0aW9uID0gMA0KICAgIHRvdGFsUm93LmV2ZXJ5TW9udGhlclBheW1lbnRBZnRlclBlcmlvZCA9IChpc1RheFBlcmlvZCA/IG51bGwgOiAwKQ0KICAgIHRvdGFsUm93LmV2ZXJ5TW9udGhGb3JLdmFydGFsTmV4dFBlcmlvZCA9IDANCiAgICBmb3IgKHJvdyBpbiBkYXRhUm93cykgew0KICAgICAgICBpZiAocm93LmdldEFsaWFzKCkgPT0gJ3RvdGFsJyB8fCByb3cucmVnaW9uQmFuayA9PSBjZW50cmFsSWQpIHsNCiAgICAgICAgICAgIGNvbnRpbnVlDQogICAgICAgIH0NCiAgICAgICAgdG90YWxSb3cuYmFzZVRheE9mUnViICs9IHJvdy5iYXNlVGF4T2ZSdWIgPzogMA0KICAgICAgICB0b3RhbFJvdy50YXhTdW0gKz0gcm93LnRheFN1bSA/OiAwDQogICAgICAgIHRvdGFsUm93LnRheFN1bU91dHNpZGUgKz0gcm93LnRheFN1bU91dHNpZGUgPzogMA0KICAgICAgICB0b3RhbFJvdy50YXhTdW1Ub1JlZHVjdGlvbiArPSByb3cudGF4U3VtVG9SZWR1Y3Rpb24gPzogMA0KICAgICAgICBpZiAoIWlzVGF4UGVyaW9kKSB7DQogICAgICAgICAgICB0b3RhbFJvdy5ldmVyeU1vbnRoZXJQYXltZW50QWZ0ZXJQZXJpb2QgKz0gcm93LmV2ZXJ5TW9udGhlclBheW1lbnRBZnRlclBlcmlvZCA/OiAwDQogICAgICAgIH0NCiAgICAgICAgdG90YWxSb3cuZXZlcnlNb250aEZvckt2YXJ0YWxOZXh0UGVyaW9kICs9IHJvdy5ldmVyeU1vbnRoRm9yS3ZhcnRhbE5leHRQZXJpb2QgPzogMA0KICAgIH0NCn0NCg0Kdm9pZCBjYWxjVG90YWxSb3coZGVmIGRhdGFSb3dzLCBkZWYgdG90YWxSb3cpIHsNCiAgICBkZWYgaXNUYXhQZXJpb2QgPSByZXBvcnRQZXJpb2RTZXJ2aWNlLmdldChmb3JtRGF0YS5yZXBvcnRQZXJpb2RJZCkub3JkZXIgPT0gNA0KICAgIGNhbGNUb3RhbFN1bShkYXRhUm93cywgdG90YWxSb3csIGlzVGF4UGVyaW9kID8gKHRvdGFsQ29sdW1ucyAtICdldmVyeU1vbnRoZXJQYXltZW50QWZ0ZXJQZXJpb2QnKSA6IHRvdGFsQ29sdW1ucykNCiAgICAvLyDQs9GA0LDRhNCwIDExDQogICAgdG90YWxSb3cuYmFzZVRheE9mID0gcm91bmRWYWx1ZShkYXRhUm93cy5zdW17IHJvdyAtPg0KICAgICAgICBTdHJpbmcgdmFsdWUgPSByb3cuYmFzZVRheE9mDQogICAgICAgIChyb3cuZ2V0QWxpYXMoKSA9PSBudWxsICYmIHZhbHVlPy5pc0JpZ0RlY2ltYWwoKSkgPyBuZXcgQmlnRGVjaW1hbCh2YWx1ZSkgOiBCaWdEZWNpbWFsLlpFUk8NCiAgICB9ID86IEJpZ0RlY2ltYWwuWkVSTywgMTUpLnRvUGxhaW5TdHJpbmcoKQ0KfQ0KDQp2b2lkIGNhbGNDYVRvdGFsUm93KGRlZiBkYXRhUm93cywgZGVmIHByZXZEYXRhUm93cywgZGVmIGNhVG90YWxSb3csIGRlZiB0b3RhbFJvdywgZGVmIHRheEJhc2UsIGRlZiBzdW1OYWwpIHsNCiAgICBkZWYgcmVwb3J0UGVyaW9kID0gZ2V0UmVwb3J0UGVyaW9kKCkNCg0KICAgIGRlZiBpc09sZENhbGMgPSByZXBvcnRQZXJpb2QudGF4UGVyaW9kLnllYXIgPCAyMDE1IHx8IChyZXBvcnRQZXJpb2QudGF4UGVyaW9kLnllYXIgPT0gMjAxNSAmJiByZXBvcnRQZXJpb2Qub3JkZXIgPCAzKQ0KDQogICAgLy8g0L3QsNC50YLQuCDRgdGC0YDQvtC60YMg0KbQkA0KICAgIGRlZiBjYVJvdyA9IGZpbmRDQShkYXRhUm93cykNCiAgICBpZiAoY2FSb3cgIT0gbnVsbCkgew0KICAgICAgICAvLyDRgNCw0YHRh9C10YLRiyDQtNC70Y8g0YHRgtGA0L7QutC4INCm0JAgKNGB0LrQvtGA0YDQtdC60YLQuNGA0L7QstCw0L3QvdGL0LkpDQogICAgICAgIFsnbnVtYmVyJywgJ3JlZ2lvbkJhbmtEaXZpc2lvbicsICdkaXZpc2lvbk5hbWUnLCAna3BwJywgJ3Byb3BlcnR5UHJpY2UnLCAnd29ya2Vyc0NvdW50JywgJ3N1YmplY3RUYXhDcmVkaXQnLA0KICAgICAgICAgJ2NhbGNGbGFnJywgJ29ibGlnYXRpb25QYXlUYXgnLCAnYmFzZVRheE9mJywgJ3N1YmplY3RUYXhTdGF2a2EnLCAndGF4U3VtVG9QYXknLA0KICAgICAgICAgJ2V2ZXJ5TW9udGhGb3JTZWNvbmRLdmFydGFsTmV4dFBlcmlvZCcsICdldmVyeU1vbnRoRm9yVGhpcmRLdmFydGFsTmV4dFBlcmlvZCcsDQogICAgICAgICAnZXZlcnlNb250aEZvckZvdXJ0aEt2YXJ0YWxOZXh0UGVyaW9kJ10uZWFjaCB7IGFsaWFzIC0+DQogICAgICAgICAgICBjYVRvdGFsUm93W2FsaWFzXSA9IGNhUm93W2FsaWFzXQ0KICAgICAgICB9DQoNCiAgICAgICAgZGVmIHRlbXBWYWx1ZQ0KICAgICAgICBpZiAoaXNPbGRDYWxjKSB7DQogICAgICAgICAgICB0ZW1wVmFsdWUgPSBjYVJvdy5ldmVyeU1vbnRoZXJQYXltZW50QWZ0ZXJQZXJpb2QNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIHN3aXRjaCAocmVwb3J0UGVyaW9kLm9yZGVyKSB7DQogICAgICAgICAgICAgICAgY2FzZSAxOiAvLyDQn9C10YDQuNC+0LQg0YTQvtGA0LzRiyDCqzEg0LrQstCw0YDRgtCw0LvCuzoNCiAgICAgICAgICAgICAgICAgICAgLy8g0J/RgNC40L3QuNC80LDQtdGCINC30L3QsNGH0LXQvdC40LUgwqvQs9GA0LDRhNGLIDE4wrsg0L/QvtC00YDQsNC30LTQtdC70LXQvdC40Y8gwqvQptC10L3RgtGA0LDQu9GM0L3Ri9C5INCw0L/Qv9Cw0YDQsNGCwrsNCiAgICAgICAgICAgICAgICAgICAgdGVtcFZhbHVlID0gY2FSb3cuZXZlcnlNb250aGVyUGF5bWVudEFmdGVyUGVyaW9kDQogICAgICAgICAgICAgICAgICAgIGJyZWFrDQogICAgICAgICAgICAgICAgY2FzZSA0OiAvLyDQn9C10YDQuNC+0LQg0YTQvtGA0LzRiyAi0LPQvtC0Ig0KICAgICAgICAgICAgICAgICAgICB0ZW1wVmFsdWUgPSBudWxsDQogICAgICAgICAgICAgICAgICAgIGJyZWFrDQogICAgICAgICAgICAgICAgZGVmYXVsdDogLy8g0J/QtdGA0LjQvtC0INGE0L7RgNC80YsgwqvQv9C+0LvRg9Cz0L7QtNC40LUgLyA5INC80LXRgdGP0YbQtdCywrs6DQogICAgICAgICAgICAgICAgICAgIC8vIMKr0JPRgNCw0YTQsCAxOMK7ID0g0JfQvdCw0YfQtdC90LjQtSDCq9Cz0YDQsNGE0YsgMTjCuyDQv9C+0LTRgNCw0LfQtNC10LvQtdC90LjRjyDCq9Cm0LXQvdGC0YDQsNC70YzQvdGL0Lkg0LDQv9C/0LDRgNCw0YLCuyArICjQl9C90LDRh9C10L3QuNC1INC40YLQvtCz0L7QstC+0Lkg0YHRgtGA0L7QutC4INC/0L4gwqvQs9GA0LDRhNC1IDE4wrsgLSAo0JfQvdCw0YfQtdC90LjQtSDQuNGC0L7Qs9C+0LLQvtC5INGB0YLRgNC+0LrQuCDQv9C+IMKr0LPRgNCw0YTQtSAxNMK7IC0g0JfQvdCw0YfQtdC90LjQtSDQuNGC0L7Qs9C+0LLQvtC5INGB0YLRgNC+0LrQuCDQv9C+IMKr0LPRgNCw0YTQtSAxNMK7INGE0L7RgNC80Ysg0L/RgNC10LTRi9C00YPRidC10LPQviDQv9C10YDQuNC+0LTQsCkpDQogICAgICAgICAgICAgICAgICAgIGRlZiBwcmV2VGF4U3VtID0gcHJldkRhdGFSb3dzPy5maW5kIHtpdC5nZXRBbGlhcygpID09ICd0b3RhbCd9Py50YXhTdW0gPzogMA0KICAgICAgICAgICAgICAgICAgICB0ZW1wVmFsdWUgPSAoY2FSb3cuZXZlcnlNb250aGVyUGF5bWVudEFmdGVyUGVyaW9kID86IDApICsgKCh0b3RhbFJvdy5ldmVyeU1vbnRoZXJQYXltZW50QWZ0ZXJQZXJpb2QgPzogMCkgLSAoKHRvdGFsUm93LnRheFN1bSA/OiAwKSAtIHByZXZUYXhTdW0pKQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIGNhVG90YWxSb3cuZXZlcnlNb250aGVyUGF5bWVudEFmdGVyUGVyaW9kID0gdGVtcFZhbHVlDQoNCiAgICAgICAgaWYgKGZvcm1EYXRhRXZlbnQgIT0gRm9ybURhdGFFdmVudC5DT01QT1NFKSB7DQogICAgICAgICAgICAvLyDQs9GA0LDRhNCwIDEyDQogICAgICAgICAgICBjYVRvdGFsUm93LmJhc2VUYXhPZlJ1YiA9ICh0YXhCYXNlID86IDApIC0gKHRvdGFsUm93LmJhc2VUYXhPZlJ1YiA/OiAwKSArIChjYVJvdy5iYXNlVGF4T2ZSdWIgPzogMCkNCiAgICAgICAgfQ0KDQogICAgICAgIC8vINCz0YDQsNGE0LAgMTQNCiAgICAgICAgY2FUb3RhbFJvdy50YXhTdW0gPSByb3VuZFZhbHVlKChjYVRvdGFsUm93LmJhc2VUYXhPZlJ1YiA/OiAwKSAqIChjYVRvdGFsUm93LnN1YmplY3RUYXhTdGF2a2EgPzogMCkgLyAxMDAsIDApDQoNCiAgICAgICAgLy8g0LPRgNCw0YTQsCAxNQ0KICAgICAgICBjYVRvdGFsUm93LnRheFN1bU91dHNpZGUgPSAwLjkgKiBzdW1OYWwgLSB0b3RhbFJvdy50YXhTdW1PdXRzaWRlICsgY2FSb3cudGF4U3VtT3V0c2lkZQ0KDQogICAgICAgIC8vINCz0YDQsNGE0LAgMTcNCiAgICAgICAgaWYgKGNhVG90YWxSb3cudGF4U3VtIDwgKChjYVRvdGFsUm93LnN1YmplY3RUYXhDcmVkaXQgPzogMCkgKyBjYVRvdGFsUm93LnRheFN1bU91dHNpZGUpKSB7IC8vIMKr0LPRgNCw0YTQsCAxNMK7IDwgKMKr0LPRgNCw0YTQsCA4wrsgKyDCq9Cz0YDQsNGE0LAgMTXCuyApDQogICAgICAgICAgICAvLyAowqvQs9GA0LDRhNCwIDjCuyArIMKr0LPRgNCw0YTQsCAxNcK7KSAtIMKr0LPRgNCw0YTQsCAxNMK7DQogICAgICAgICAgICBjYVRvdGFsUm93LnRheFN1bVRvUmVkdWN0aW9uID0gKChjYVRvdGFsUm93LnN1YmplY3RUYXhDcmVkaXQgPzogMCkgKyBjYVRvdGFsUm93LnRheFN1bU91dHNpZGUpIC0gY2FUb3RhbFJvdy50YXhTdW0NCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIGNhVG90YWxSb3cudGF4U3VtVG9SZWR1Y3Rpb24gPSAwDQogICAgICAgIH0NCg0KICAgICAgICAvLyDQs9GA0LDRhNCwIDE5DQogICAgICAgIGlmIChyZXBvcnRQZXJpb2Qub3JkZXIgPT0gMykgew0KICAgICAgICAgICAgLy8gwqvQs9GA0LDRhNCwIDE5wrsgPSDCq9Cz0YDQsNGE0LAgMTjCuyDRgdGC0YDQvtC60LggItCm0JAgKNGB0LrQvtGA0YAuKSINCiAgICAgICAgICAgIGNhVG90YWxSb3cuZXZlcnlNb250aEZvckt2YXJ0YWxOZXh0UGVyaW9kID0gY2FUb3RhbFJvdy5ldmVyeU1vbnRoZXJQYXltZW50QWZ0ZXJQZXJpb2QNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIGNhVG90YWxSb3cuZXZlcnlNb250aEZvckt2YXJ0YWxOZXh0UGVyaW9kID0gMA0KICAgICAgICB9DQogICAgfQ0KfQ0KDQovLyDQvdCw0LfQstCw0L3QuNC1INC/0L7QtNGA0LDQt9C00LXQu9C10L3QuNGPDQpkZWYgY2FsYzIoZGVmIHJvdykgew0KICAgIGRlZiBkZXBhcnRtZW50UGFyYW0NCiAgICBpZiAocm93LnJlZ2lvbkJhbmtEaXZpc2lvbiAhPSBudWxsKSB7DQogICAgICAgIGRlcGFydG1lbnRQYXJhbSA9IGdldFJlZkJvb2tWYWx1ZSgzMEws'
        longString += 'IHJvdy5yZWdpb25CYW5rRGl2aXNpb24pDQogICAgfQ0KICAgIGlmIChkZXBhcnRtZW50UGFyYW0gPT0gbnVsbCB8fCBkZXBhcnRtZW50UGFyYW0uaXNFbXB0eSgpKSB7DQogICAgICAgIHJldHVybiBudWxsDQogICAgfQ0KDQogICAgLy8g0KMg0KbQtdC90YLRgNCw0LvRjNC90L7Qs9C+INCw0L/Qv9Cw0YDQsNGC0LAg0YDQvtC00LjRgtC10LvRjNGB0LrQuNC8INC/0L7QtNGA0LDQt9C00LXQu9C10L3QuNC10Lwg0LTQvtC70LbQtdC9INCx0YvRgtGMINC+0L0g0YHQsNC8DQogICAgaWYgKGNlbnRyYWxJZCA9PSByb3cucmVnaW9uQmFua0RpdmlzaW9uKSB7DQogICAgICAgIHJldHVybiBjZW50cmFsSWQNCiAgICB9IGVsc2Ugew0KICAgICAgICByZXR1cm4gZGVwYXJ0bWVudFBhcmFtLmdldCgnUEFSRU5UX0lEJykuZ2V0UmVmZXJlbmNlVmFsdWUoKQ0KICAgIH0NCn0NCg0KZGVmIGNhbGM0KGRlZiByb3cpIHsNCiAgICBkZWYgZGVwYXJ0bWVudFBhcmFtDQogICAgZGVmIGRpdmlzaW9uTmFtZQ0KICAgIGlmIChyb3cucmVnaW9uQmFua0RpdmlzaW9uICE9IG51bGwpIHsNCiAgICAgICAgZGVwYXJ0bWVudFBhcmFtID0gZ2V0UmVmQm9va1ZhbHVlKDMwLCByb3cucmVnaW9uQmFua0RpdmlzaW9uKQ0KICAgIH0NCiAgICBkZWYgZGVwUGFyYW0gPSBnZXREZXBQYXJhbShkZXBhcnRtZW50UGFyYW0pDQogICAgZGVmIGluY29tZVBhcmFtVGFibGUgPSBnZXRJbmNvbWVQYXJhbVRhYmxlKGRlcFBhcmFtKQ0KICAgIGZvciAoaW50IGkgPSAwOyBpIDwgaW5jb21lUGFyYW1UYWJsZS5zaXplKCk7IGkrKykgew0KICAgICAgICBpZiAocm93LmtwcCAhPSBudWxsICYmIHJvdy5rcHAgIT0gJycpIHsNCiAgICAgICAgICAgIGlmIChpbmNvbWVQYXJhbVRhYmxlPy5nZXQoaSk/LktQUD8uc3RyaW5nVmFsdWUgPT0gcm93LmtwcCkgew0KICAgICAgICAgICAgICAgIGRpdmlzaW9uTmFtZSA9IGluY29tZVBhcmFtVGFibGU/LmdldChpKT8uQURESVRJT05BTF9OQU1FPy5zdHJpbmdWYWx1ZQ0KICAgICAgICAgICAgICAgIGJyZWFrDQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICB9DQogICAgcmV0dXJuIGRpdmlzaW9uTmFtZQ0KfQ0KDQpkZWYgY2FsYzkoZGVmIHJvdykgew0KICAgIGRlZiBkZXBhcnRtZW50UGFyYW0NCiAgICBkZWYgY2FsY0ZsYWcNCiAgICBpZiAocm93LnJlZ2lvbkJhbmtEaXZpc2lvbiAhPSBudWxsKSB7DQogICAgICAgIGRlcGFydG1lbnRQYXJhbSA9IGdldFJlZkJvb2tWYWx1ZSgzMCwgcm93LnJlZ2lvbkJhbmtEaXZpc2lvbikNCiAgICB9DQogICAgZGVmIGRlcFBhcmFtID0gZ2V0RGVwUGFyYW0oZGVwYXJ0bWVudFBhcmFtKQ0KICAgIGRlZiBpbmNvbWVQYXJhbVRhYmxlID0gZ2V0SW5jb21lUGFyYW1UYWJsZShkZXBQYXJhbSkNCiAgICBmb3IgKGludCBpID0gMDsgaSA8IGluY29tZVBhcmFtVGFibGUuc2l6ZSgpOyBpKyspIHsNCiAgICAgICAgaWYgKHJvdy5rcHAgIT0gbnVsbCAmJiByb3cua3BwICE9ICcnKSB7DQogICAgICAgICAgICBpZiAoaW5jb21lUGFyYW1UYWJsZT8uZ2V0KGkpPy5LUFA/LnN0cmluZ1ZhbHVlID09IHJvdy5rcHApIHsNCiAgICAgICAgICAgICAgICBjYWxjRmxhZyA9IGluY29tZVBhcmFtVGFibGU/LmdldChpKT8uVFlQRT8ucmVmZXJlbmNlVmFsdWUNCiAgICAgICAgICAgICAgICBicmVhaw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgfQ0KICAgIHJldHVybiBjYWxjRmxhZw0KfQ0KDQpkZWYgY2FsYzEwKGRlZiByb3cpIHsNCiAgICBkZWYgZGVwYXJ0bWVudFBhcmFtDQogICAgZGVmIG9ibGlnYXRpb25QYXlUYXgNCiAgICBpZiAocm93LnJlZ2lvbkJhbmtEaXZpc2lvbiAhPSBudWxsKSB7DQogICAgICAgIGRlcGFydG1lbnRQYXJhbSA9IGdldFJlZkJvb2tWYWx1ZSgzMCwgcm93LnJlZ2lvbkJhbmtEaXZpc2lvbikNCiAgICB9DQogICAgZGVmIGRlcFBhcmFtID0gZ2V0RGVwUGFyYW0oZGVwYXJ0bWVudFBhcmFtKQ0KICAgIGRlZiBpbmNvbWVQYXJhbVRhYmxlID0gZ2V0SW5jb21lUGFyYW1UYWJsZShkZXBQYXJhbSkNCiAgICBmb3IgKGludCBpID0gMDsgaSA8IGluY29tZVBhcmFtVGFibGUuc2l6ZSgpOyBpKyspIHsNCiAgICAgICAgaWYgKHJvdy5rcHAgIT0gbnVsbCAmJiByb3cua3BwICE9ICcnKSB7DQogICAgICAgICAgICBpZiAoaW5jb21lUGFyYW1UYWJsZT8uZ2V0KGkpPy5LUFA/LnN0cmluZ1ZhbHVlID09IHJvdy5rcHApIHsNCiAgICAgICAgICAgICAgICBvYmxpZ2F0aW9uUGF5VGF4ID0gaW5jb21lUGFyYW1UYWJsZT8uZ2V0KGkpPy5PQkxJR0FUSU9OPy5yZWZlcmVuY2VWYWx1ZQ0KICAgICAgICAgICAgICAgIGJyZWFrDQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICB9DQogICAgcmV0dXJuIG9ibGlnYXRpb25QYXlUYXgNCn0NCg0KZGVmIGNhbGMxMShkZWYgcm93LCBkZWYgcHJvcGVydHlQcmljZVN1bW0sIGRlZiB3b3JrZXJzQ291bnRTdW1tKSB7DQogICAgQmlnRGVjaW1hbCB0ZW1wID0gMA0KICAgIGlmIChyb3cucHJvcGVydHlQcmljZSAhPSBudWxsICYmIHJvdy53b3JrZXJzQ291bnQgIT0gbnVsbCAmJiBwcm9wZXJ0eVByaWNlU3VtbSA+IDAgJiYgd29ya2Vyc0NvdW50U3VtbSA+IDApIHsNCiAgICAgICAgdGVtcCA9IChyb3cucHJvcGVydHlQcmljZSAqIDEwMCAvIHByb3BlcnR5UHJpY2VTdW1tICsgcm93LndvcmtlcnNDb3VudCAqIDEwMCAvIHdvcmtlcnNDb3VudFN1bW0pIC8gMg0KICAgIH0NCiAgICByZXR1cm4gcm91bmRWYWx1ZSh0ZW1wLCAxNSkudG9QbGFpblN0cmluZygpDQp9DQoNCmRlZiBjYWxjMTIoZGVmIHJvdywgZGVmIHRheEJhc2UpIHsNCiAgICBpZiAocm93LmJhc2VUYXhPZiAhPSBudWxsICYmIGNoZWNrQ29sdW1uMTEocm93LmJhc2VUYXhPZikgJiYgdGF4QmFzZSAhPSBudWxsKSB7DQogICAgICAgIHJldHVybiByb3VuZFZhbHVlKHRheEJhc2UgKiBuZXcgQmlnRGVjaW1hbChyb3cuYmFzZVRheE9mKSAvIDEwMCwgMCkgLy8g0YPQvNC90L7QttC10L3QuNC1INC90LAgMTgvMjAg0Lgg0LTQtdC70LXQvdC40LUg0L3QsCAxMDANCiAgICB9DQogICAgcmV0dXJuIDANCn0NCg0KZGVmIGNhbGMxMyhkZWYgcm93KSB7DQogICAgZGVmIHRlbXAgPSAwDQogICAgZGVmIG1pbmltaXplVGF4U3VtID0gcm93Lm1pbmltaXplVGF4U3VtID86IDANCiAgICBpZiAocm93LmFtb3VudFRheCA9PSBudWxsKSB7DQogICAgICAgIGlmIChyb3cuYmFzZVRheE9mUnViID4gMCkgew0KICAgICAgICAgICAgaWYgKG1pbmltaXplVGF4U3VtID4gMCkgew0KICAgICAgICAgICAgICAgIHRlbXAgPSByb3VuZFZhbHVlKChyb3cuYmFzZVRheE9mUnViICogMC4xOCAtIG1pbmltaXplVGF4U3VtKSAqIDEwMCAvIHJvdy5iYXNlVGF4T2ZSdWIsIDIpDQogICAgICAgICAgICAgICAgaWYgKHRlbXAgPCAxMy41KSB7DQogICAgICAgICAgICAgICAgICAgIHRlbXAgPSAxMy41DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICB0ZW1wID0gMTgNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIHRlbXAgPSAwDQogICAgICAgIH0NCiAgICB9IGVsc2Ugew0KICAgICAgICB0ZW1wID0gcm93LmFtb3VudFRheA0KICAgIH0NCiAgICByZXR1cm4gdGVtcA0KfQ0KDQpkZWYgY2FsYzE0KGRlZiByb3cpIHsNCiAgICBkZWYgdGVtcCA9IDANCiAgICBkZWYgbWluaW1pemVUYXhTdW0gPSByb3cubWluaW1pemVUYXhTdW0gPzogMA0KICAgIGlmIChyb3cuYmFzZVRheE9mUnViID4gMCkgew0KICAgICAgICBpZiAobWluaW1pemVUYXhTdW0gPT0gMCkgew0KICAgICAgICAgICAgdGVtcCA9IHJvdW5kVmFsdWUocm93LmJhc2VUYXhPZlJ1YiAqIHJvdy5zdWJqZWN0VGF4U3RhdmthIC8gMTAwLCAwKQ0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgaWYgKHJvdy5iYXNlVGF4T2ZSdWIgKiAwLjEzNSAtIG1pbmltaXplVGF4U3VtIDwgMCkgew0KICAgICAgICAgICAgICAgIHRlbXAgPSByb3VuZFZhbHVlKHJvdy5iYXNlVGF4T2ZSdWIgKiAwLjEzNSwgMCkNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgdGVtcCA9IHJvdW5kVmFsdWUocm93LmJhc2VUYXhPZlJ1YiAqIDAuMTgsIDApIC0gbWluaW1pemVUYXhTdW0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH0gZWxzZSB7DQogICAgICAgIHRlbXAgPSAwDQogICAgfQ0KICAgIHJldHVybiB0ZW1wDQp9DQoNCmRlZiBjYWxjMThfMTkgKGRlZiBwcmV2RGF0YVJvd3MsIGRlZiBkYXRhUm93cywgZGVmIHJvdywgZGVmIHJlcG9ydFBlcmlvZCkgew0KICAgIGRlZiB0bXANCiAgICAvLyDQs9GA0LDRhNCwIDE4DQogICAgc3dpdGNoIChyZXBvcnRQZXJpb2Qub3JkZXIpIHsNCiAgICAgICAgY2FzZSAxOiAvL8Kr0LPRgNCw0YTQsCAxOMK7ID0gwqvQs9GA0LDRhNCwIDE0wrsNCiAgICAgICAgICAgIHRtcCA9IHJvdy50YXhTdW0NCiAgICAgICAgICAgIGJyZWFrDQogICAgICAgIGNhc2UgNDoNCiAgICAgICAgICAgIHRtcCA9IG51bGwNCiAgICAgICAgICAgIGJyZWFrDQogICAgICAgIGRlZmF1bHQ6DQogICAgICAgICAgICAvLyAo0KHRg9C80LzQsCDQstGB0LXRhSDQvdC10YTQuNC60YHQuNGA0L7QstCw0L3QvdGL0YUg0YHRgtGA0L7QuiDQv9C+IMKr0LPRgNCw0YTQtSAxNMK7IC0g0KHRg9C80LzQsCDQstGB0LXRhSDQvdC10YTQuNC60YHQuNGA0L7QstCw0L3QvdGL0YUg0YHRgtGA0L7QuiDQv9C+IMKr0LPRgNCw0YTQtSAxNMK7INC40Lcg0L/RgNC10LTRi9C00YPRidC10LPQviDQv9C10YDQuNC+0LTQsCkgKiAowqvQs9GA0LDRhNCwIDE0wrsgLyDQodGD0LzQvNCwINCy0YHQtdGFINC90LXRhNC40LrRgdC40YDQvtCy0LDQvdC90YvRhSDRgdGC0YDQvtC6INC/0L4gwqvQs9GA0LDRhNC1IDE0wrspDQogICAgICAgICAgICBkZWYgY3VycmVudFN1bSA9IGRhdGFSb3dzPy5zdW0geyAoaXQuZ2V0QWxpYXMoKSA9PSBudWxsKSA/IChpdC50YXhTdW0gPzogMCkgOiAwIH0gPzogMA0KICAgICAgICAgICAgZGVmIHByZXZpb3VzU3VtID0gcHJldkRhdGFSb3dzPy5zdW0geyAoaXQuZ2V0QWxpYXMoKSA9PSBudWxsKSA/IChpdC50YXhTdW0gPzogMCkgOiAwIH0gPzogMA0KICAgICAgICAgICAgLy8g0L7RgdGC0LDQu9GM0L3Ri9C1DQogICAgICAgICAgICBpZiAoY3VycmVudFN1bSkgew0KICAgICAgICAgICAgICAgIHRtcCA9IChjdXJyZW50U3VtIC0gcHJldmlvdXNTdW0pICogcm93LnRheFN1bSAvIGN1cnJlbnRTdW0NCiAgICAgICAgICAgIH0NCiAgICB9DQogICAgcm93LmV2ZXJ5TW9udGhlclBheW1lbnRBZnRlclBlcmlvZCA9IHRtcA0KDQogICAgLy8g0LPRgNCw0YTQsCAxOQ0KICAgIHJvdy5ldmVyeU1vbnRoRm9yS3ZhcnRhbE5leHRQZXJpb2QgPSAoKHJlcG9ydFBlcmlvZC5vcmRlciA9PSAzKSA/IHJvdy5ldmVyeU1vbnRoZXJQYXltZW50QWZ0ZXJQZXJpb2QgOiAwKQ0KfQ0KDQovKioNCiAqINCb0L7Qs9C40YfQtdGB0LrQuNC1INC/0YDQvtCy0LXRgNC60LguDQogKg0KICogQHBhcmFtIHVzZUxvZyDQvdGD0LbQvdC+INC70Lgg0LfQsNC/0LjRgdGL0LLQsNGC0Ywg0LIg0LvQvtCzINGB0L7QvtCx0YnQtdC90LjRjyDQviDQvdC10LfQsNC/0L7Qu9C90LXQvdC90L7RgdGC0Lgg0L7QsdGP0LfQsNGC0LXQu9GM0L3Ri9GFINC/0L7Qu9C10LkNCiAqLw0KZGVmIGxvZ2ljYWxDaGVjaygpIHsNCiAgICBsb2dpY2FsQ2hlY2tCZWZvcmVDYWxjKCkNCiAgICBsb2dpY2FsQ2hlY2tBZnRlckNhbGMoKQ0KfQ0KDQp2b2lkIGxvZ2ljYWxDaGVja0JlZm9yZUNhbGMoKSB7DQogICAgZGVmIGRhdGFSb3dzID0gZm9ybURhdGFTZXJ2aWNlLmdldERhdGFSb3dIZWxwZXIoZm9ybURhdGEpLmFsbENhY2hlZA0KICAgIGRlZiBmaWVsZE51bWJlciA9IDANCg0KICAgIGRhdGFSb3dzLmVhY2hXaXRoSW5kZXggeyByb3csIGkgLT4NCiAgICAgICAgaWYgKGlzRml4ZWRSb3cocm93KSkgew0KICAgICAgICAgICAgcmV0dXJuDQogICAgICAgIH0NCiAgICAgICAgZmllbGROdW1iZXIrKw0KICAgICAgICBkZWYgaW5kZXggPSByb3cuZ2V0SW5kZXgoKQ0KICAgICAgICBkZWYgZXJyb3JNc2cgPSAi0KHRgtGA0L7QutCwICR7aW5kZXh9OiAiDQogICAgICAgIGRlZiBkZXBhcnRtZW50UGFyYW0gPSBudWxsDQogICAgICAgIGlmIChyb3cucmVnaW9uQmFua0RpdmlzaW9uICE9IG51bGwpIHsNCiAgICAgICAgICAgIGRlcGFydG1lbnRQYXJhbSA9IGdldFJlZkJvb2tWYWx1ZSgzMCwgcm93LnJlZ2lvbkJhbmtEaXZpc2lvbikNCiAgICAgICAgfQ0KICAgICAgICBpZiAoZGVwYXJ0bWVudFBhcmFtID09IG51bGwgfHwgZGVwYXJ0bWVudFBhcmFtLmlzRW1wdHkoKSkgew0KICAgICAgICAgICAgcmV0dXJuDQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAvLyDQoyDQptC10L3RgtGA0LDQu9GM0L3QvtCz0L4g0LDQv9C/0LDRgNCw0YLQsCDRgNC+0LTQuNGC0LXQu9GM0YHQutC40Lwg0L/QvtC00YDQsNC30LTQtdC70LXQvdC40LXQvCDQtNC+0LvQttC10L0g0LHRi9GC0Ywg0L7QvSDRgdCw0LwNCiAgICAgICAgICAgIGlmIChjZW50cmFsSWQgIT0gcm93LnJlZ2lvbkJhbmtEaXZpc2lvbikgew0KICAgICAgICAgICAgICAgIC8vINCz0YDQsNGE0LAgMiAtINC90LDQt9Cy0LDQvdC40LUg0L/QvtC00YDQsNC30LTQtdC70LXQvdC40Y8NCiAgICAgICAgICAgICAgICBpZiAoZGVwYXJ0bWVudFBhcmFtLmdldCgnUEFSRU5UX0lEJyk/LmdldFJlZmVyZW5jZVZhbHVlKCkgPT0gbnVsbCkgew0KICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoZXJyb3JNc2cgKyAi0JTQu9GPINC/0L7QtNGA0LDQt9C00LXQu9C10L3QuNGPINGC0LXRgNGA0LjRgtC+0YDQuNCw0LvRjNC90L7Qs9C+INCx0LDQvdC60LAgwqske2RlcGFydG1lbnRQYXJhbS5OQU1FLnN0cmluZ1ZhbHVlfcK7INCyINGB0L/RgNCw0LLQvtGH0L3QuNC60LUgwqvQn9C+0LTRgNCw0LfQtNC10LvQtdC90LjRj8K7INC+0YLRgdGD0YLRgdGC0LLRg9C10YIg0LfQvdCw0YfQtdC90LjQtSDQvdCw0LjQvNC10L3QvtCy0LDQvdC40Y8g0YDQvtC00LjRgtC10LvRjNGB0LrQvtCz0L4g0L/QvtC00YDQsNC30LTQtdC70LXQvdC40Y8hIikNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICAvLyDQntC/0YDQtdC00LXQu9C10L3QuNC1INGD0YHQu9C+0LLQuNC5INC00LvRjyDQv9GA0L7QstC10YDQvtC6IDIsIDMsIDQNCiAgICAgICAgZGVmIGRlcFBhcmFtID0gZ2V0RGVwUGFyYW0oZGVwYXJ0bWVudFBhcmFtKQ0KICAgICAgICBkZWYgZGVwSWQgPSAoZGVwUGFyYW0/LmdldChSZWZCb29rLlJFQ09SRF9JRF9BTElBUyk/Lm51bWJlclZhbHVlID86IC0xKSBhcyBsb25nDQogICAgICAgIGRlZiBkZXBhcnRtZW50TmFtZSA9IGRlcFBhcmFtPy5OQU1FPy5zdHJpbmdWYWx1ZSA/OiAi0J3QtSDQt9Cw0LTQsNC90L4iDQogICAgICAgIGRlZiBpbmNvbWVQYXJhbQ0KICAgICAgICBpZiAoZGVwSWQgIT0gLTEpIHsNCiAgICAgICAgICAgIGluY29tZVBhcmFtID0gZ2V0UHJvdmlkZXIoMzMpLmdldFJlY29yZHMoZ2V0UmVwb3J0UGVyaW9kRW5kRGF0ZSgpIC0gMSwgbnVsbCwgIkRFUEFSVE1FTlRfSUQgPSAkZGVwSWQiLCBudWxsKQ0KICAgICAgICB9DQogICAgICAgIGRlZiBpbmNvbWVQYXJhbVRhYmxlID0gZ2V0SW5jb21lUGFyYW1UYWJsZShkZXBQYXJhbSkNCg0KICAgICAgICAvLyAyLiDQn9GA0L7QstC10YDQutCwINC90LDQu9C40YfQuNGPINGE0L7RgNC80Ysg0L3QsNGB0YLRgNC+0LXQuiDQv9C+0LTRgNCw0LfQtNC10LvQtdC90LjRjw0KICAgICAgICBpZiAoaW5jb21lUGFyYW0gPT0gbnVsbCB8fCBpbmNvbWVQYXJhbS5pc0VtcHR5KCkpIHsNCiAgICAgICAgICAgIHJvd0Vycm9yKGxvZ2dlciwgcm93LCBlcnJvck1zZyArICLQlNC70Y8g0L/QvtC00YDQsNC30LTQtdC70LXQvdC40Y8gwqske2RlcGFydG1lbnROYW1lfcK7INC90LUg0YHQvtC30LTQsNC90LAg0YTQvtGA0LzQsCDQvdCw0YHRgtGA0L7QtdC6INC/0L7QtNGA0LDQt9C00LXQu9C10L3QuNC5ISIpDQogICAgICAgIH0NCg0KICAgICAgICAvLyAzLiDQn9GA0L7QstC10YDQutCwINC90LDQu9C40YfQuNGPINGB0YLRgNC+0LrQuCDRgSDCq9Ca0J/Qn8K7INCyINGC0LDQsdC70LjRh9C90L7QuSDRh9Cw0YHRgtC4INGE0L7RgNC80Ysg0L3QsNGB0YLRgNC+0LXQuiDQv9C+0LTRgNCw0LfQtNC10LvQtdC90LjRjw0KICAgICAgICAvLyA0LiDQn9GA0L7QstC10YDQutCwINC90LDQu9C40YfQuNGPINC30L3QsNGH0LXQvdC40Y8gwqvQndCw0LjQvNC10L3QvtCy0LDQvdC40LUg0LTQu9GPINCf0YDQuNC70L7QttC10L3QuNGPIOKEljXCuyDQsiDRhNC+0YDQvNC1INC90LDRgdGC0YDQvtC10Log0L/QvtC00YDQsNC30LTQtdC70LXQvdC40Y8NCiAgICAgICAgZm9yIChpbnQgayA9IDA7IGsgPCBpbmNvbWVQYXJhbVRhYmxlPy5zaXplKCk7IGsrKykgew0KICAgICAgICAgICAgaWYgKHJvdy5rcHAgIT0gbnVsbCAmJiByb3cua3BwICE9ICcnKSB7DQogICAgICAgICAgICAgICAgaWYgKGluY29tZVBhcmFtVGFibGU/LmdldChrKT8uS1BQPy5zdHJpbmdWYWx1ZSA9PSByb3cua3BwKSB7DQogICAgICAgICAgICAgICAgICAgIGlmIChpbmNvbWVQYXJhbVRhYmxlPy5nZXQoayk/LkFERElUSU9OQUxfTkFNRT8uc3RyaW5nVmFsdWUgPT0gbnVsbCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgcm93RXJyb3IobG9nZ2VyLCByb3csIGVycm9yTXNnICsgItCU0LvRjyDQv9C+0LTRgNCw0LfQtNC10LvQtdC90LjRjyDCqyR7ZGVwYXJ0bWVudE5hbWV9wrsg0L3QsCDRhNC+0YDQvNC1INC90LDRgdGC0YDQvtC10Log0L/QvtC00YDQsNC30LTQtdC70LXQvdC40Lkg0L/QviDQmtCf0J8gwqske3Jvdy5rcHB9wrsg0L7RgtGB0YPRgtGB0YLQstGD0LXRgiDQt9C90LDRh9C10L3QuNC1INCw0YLRgNC40LHRg9GC0LAgwqvQndCw0LjQvNC10L3QvtCy0LDQvdC40LUg0LTQu9GPIMKr0J/RgNC40LvQvtC20LXQvdC40Y8g4oSWNcK7ISIpDQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgaWYgKGluY29tZVBhcmFtVGFibGU/LmdldChrKT8uVFlQRT8ucmVmZXJlbmNlVmFsdWUgPT0gbnVsbCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgcm93RXJyb3IobG9nZ2VyLCByb3csIGVycm9yTXNnICsgItCU0LvRjyDQv9C+0LTRgNCw0LfQtNC10LvQtdC90LjRjyDCqyR7ZGVwYXJ0bWVudE5hbWV9wrsg0L3QsCDRhNC+0YDQvNC1INC90LDRgdGC0YDQvtC10Log0L/QvtC00YDQsNC30LTQtdC70LXQvdC40Lkg0L/QviDQmtCf0J8gwqske3Jvdy5rcHB9wrsg0L7RgtGB0YPRgtGB0YLQstGD0LXRgiDQt9C90LDRh9C10L3QuNC1INCw0YLRgNC40LHRg9GC0LAgwqvQn9GA0LjQt9C90LDQuiDRgNCw0YHRh9C10YLQsMK7ISIpDQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgaWYgKGluY29tZVBhcmFtVGFibGU/LmdldChrKT8uT0JMSUdBVElPTj8ucmVmZXJlbmNlVmFsdWUgPT0gbnVsbCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgcm93RXJyb3IobG9nZ2VyLCByb3csIGVycm9yTXNnICsgItCU0LvRjyDQv9C+0LTRgNCw0LfQtNC10LvQtdC90LjRjyDCqyR7ZGVwYXJ0bWVudE5hbWV9wrsg0L3QsCDRhNC+0YDQvNC1INC90LDRgdGC0YDQvtC10Log0L/QvtC00YDQsNC30LTQtdC70LXQvdC40Lkg0L/QviDQmtCf0J8gwqske3Jvdy5rcHB9wrsg0L7RgtGB0YPRgtGB0YLQstGD0LXRgiDQt9C90LDRh9C10L3QuNC1INCw0YLRgNC40LHRg9GC0LAgwqvQntCx0Y/Qt9Cw0L3QvdC+0YHRgtGMINC/0L4g0YPQv9C70LDRgtC1INC90LDQu9C+0LPQsMK7ISIpDQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgYnJlYWsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgaWYgKGsgPT0gaW5jb21lUGFyYW1UYWJsZS5zaXplKCkgLSAxKSB7DQogICAgICAgICAgICAgICAgICAgIHJvd0Vycm9yKGxvZ2dlciwgcm93LCBlcnJvck1zZyArICLQlNC70Y8g0L/QvtC00YDQsNC30LTQtdC70LXQvdC40Y8gwqske2RlcGFydG1lbnROYW1lfcK7INC90LAg0YTQvtGA0LzQtSDQvdCw0YHRgtGA0L7QtdC6INC/0L7QtNGA0LDQt9C00LXQu9C10L3QuNC5INC+0YLRgdGD0YLRgdGC0LLRg9C10YIg0YHRgtGA0L7QutCwINGBINCa0J/QnyDCqyR7cm93LmtwcH3CuyEiKQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH0NCiAgICBpZiAoZm9ybURhdGFFdmVudCAhPSBGb3JtRGF0YUV2ZW50LkNPTVBPU0UpIHsNCiAgICAgICAgc3VtbWFyeU1hcC5lYWNoIHsga2V5cywgdmFsdWUgLT4NCiAgICAgICAgICAgIGRlZiBmb3VuZEZvcm1zTWFwID0gZ2V0Rm9ybURhdGFTdW1tYXJ5TWFwKGtleXMpDQogICAgICAgICAgICAvLyDQmNGJ0LXQvCDQv9GA0LjQvdGP0YLRi9C1INGE0L7RgNC80YsNCiAgICAgICAgICAgIGRlZiBhY2NlcHRlZEZvcm1zTWFwID0gWzpdDQogICAgICAgICAgICBrZXlzLmVhY2ggeyBrZXkgLT4NCiAgICAgICAgICAgICAgICBpZiAoZm91bmRGb3Jtc01hcFtrZXldICE9IG51bGwgJiYgZ2V0RGF0YShmb3VuZEZvcm1zTWFwW2tleV0pICE9IG51bGwpIHsNCiAgICAgICAgICAgICAgICAgICAgYWNjZXB0ZWRGb3Jtc01hcFtrZXldID0gZm91bmRGb3Jtc01hcFtrZXldDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZiAoYWNjZXB0ZWRGb3Jtc01hcC5zaXplKCkgPiAxKSB7DQogICAgICAgICAgICAgICAgbG9nZ2VyLndhcm4oItCd0LXQstC10YDQvdC+INC90LDRgdGC0YDQvtC10L3RiyDQuNGB0YLQvtGH0L3QuNC60Lgg0YHQstC+0LTQvdC+0LkhINCe0LTQvdC+0LLRgNC10LzQtdC90L3QviDRgdC+0LfQtNCw0L3RiyDQsiDQutCw0YfQtdGB0YLQstC1INC40YHRgtC+0YfQvdC40LrQvtCyINC90LDQu9C+0LPQvtCy0YvQtSDRhNC+0YDQvNGLOiDCqyVzwrssIMKrJXPCuy4g0KDQsNGB0YfQtdGCINC/0YDQvtC40LfQstC10LTQtdC9INC40Lcgwqslc8K7LiIsDQogICAgICAgICAgICAgICAgICAgICAgICBmb3JtVHlwZVNlcnZpY2UuZ2V0KGtleXNbMV0pLm5hbWUsIGZvcm1UeXBlU2VydmljZS5nZXQoa2V5c1swXSk/Lm5hbWUsIGZvcm1UeXBlU2VydmljZS5nZXQoa2V5c1sxXSk/Lm5hbWUpDQogICAgICAgICAgICB9ZWxzZSBpZiAoYWNjZXB0ZWRGb3Jtc01hcC5zaXplKCkgPT0gMCkgew0KICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcigi0KHQstC+0LTQvdCw0Y8g0L3QsNC70L7Qs9C+0LLQsNGPINGE0L7RgNC80LAgwqskdmFsdWXCuyDQsiDQv9C+0LTRgNCw0LfQtNC10LvQtdC90LjQuCDCqyR7Zm9ybURhdGFEZXBhcnRtZW50Lm5hbWV9wrsg0L3QtSDQvdCw0YXQvtC00LjRgtGB0Y8g0LIg0YHRgtCw0YLRg9GB0LUgwqvQn9GA0LjQvdGP0YLQsMK7ISIpDQogICAgICAgICAgICB9IGVsc2UgaWYgKGZvdW5kRm9ybXNNYXAuc2l6ZSgpID09IDApIHsNCiAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoItCh0LLQvtC00L3QsNGPINC90LDQu9C+0LPQvtCy0LDRjyDRhNC+0YDQvNCwIMKrJHZhbHVlwrsg0LIg0L/QvtC00YDQsNC30LTQtdC70LXQvdC40Lggwqske2Zvcm1EYXRhRGVwYXJ0bWVudC5uYW1lfcK7INC90LUg0YHQvtC30LTQsNC90LAhIikNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH0NCn0NCg0Kdm9pZCBsb2dpY2FsQ2hlY2tBZnRlckNhbGMoKSB7DQogICAgZGVmIGRhdGFSb3dzID0gZm9ybURhdGFTZXJ2aWNlLmdldERhdGFSb3dIZWxwZXIoZm9ybURhdGEpLmFsbENhY2hlZA0KDQogICAgYm9vbGVhbiB3YXNFcnJvciA9IGZhbHNlDQoNCiAgICBkZWYgdG1wUm93cyA9IGRhdGFSb3dzLmZpbmRBbGwgeyAhaXQuZ2V0QWxpYXMoKSB9DQogICAgZGVmIHByb3BlcnR5UHJpY2VTdW1tID0gZ2V0U3VtQWxsKHRtcFJvd3MsICJwcm9wZXJ0eVByaWNlIikNCiAgICBkZWYgd29ya2Vyc0NvdW50U3VtbSA9IGdldFN1bUFsbCh0bXBSb3dzLCAid29ya2Vyc0NvdW50IikNCg0KICAgIC8vINCg0LDRgdC/0YDQtdC00LXQu9GP0LXQvNCw0Y8g0L3QsNC70L7Qs9C+0LLQsNGPINCx0LDQt9CwINC30LAg0L7RgtGH0LXRgtC90YvQuSDQv9C10YDQuNC+0LQuDQogICAgZGVmIHRheEJhc2UNCiAgICBpZiAoZm9ybURhdGFFdmVudCAhPSBGb3JtRGF0YUV2ZW50LkNPTVBPU0UpIHsNCiAgICAgICAgdGF4QmFzZSA9IHJvdW5kVmFsdWUoZ2V0VGF4QmFzZUFzRGVjbGFyYXRpb24oKSwgMCkNCiAgICB9DQogICAgLy8g0J7RgtGH0ZHRgtC90YvQuSDQv9C10YDQuNC+0LQuDQogICAgZGVmIHJlcG9ydFBlcmlvZCA9IGdldFJlcG9ydFBlcmlvZCgpDQogICAgZGVmIGRlcGFydG1lbnRQYXJhbXNEYXRlID0gZ2V0UmVwb3J0UGVyaW9kRW5kRGF0ZSgpIC0gMQ0KDQogICAgLy8g0J/QvtC70YPRh9C10L3QuNC1INGB0YLRgNC+0Log0YTQvtGA0LzRiyAi0KHQstC10LTQtdC90LjRjyDQviDRgdGD0LzQvNCw0YUg0L3QsNC70L7Qs9CwINC90LAg0L/RgNC40LHRi9C70YwsINGD0L/Qu9Cw0YfQtdC90L3QvtCz0L4g0JHQsNC90LrQvtC8INC30LAg0YDRg9Cx0LXQttC+0LwiDQogICAgZGVmIGRhdGFSb3dzU3VtID0gZ2V0RGF0YVJvd3MoNDIxLCBGb3JtRGF0YUtpbmQuQURESVRJT05BTCkNCg0KICAgIC8vINCh0YPQvNC80LAg0L3QsNC70L7Qs9CwINC90LAg0L/RgNC40LHRi9C70YwsINCy0YvQv9C70LDRh9C10L3QvdCw0Y8g0LfQsCDQv9GA0LXQtNC10LvQsNC80Lgg0KDQvtGB0YHQuNC50YHQutC+0Lkg0KTQtdC00LXRgNCw0YbQuNC4INCyINC+0YLRh9GR0YLQvdC+0Lwg0L/QtdGA0LjQvtC00LUuDQogICAgZGVmIHN1bU5hbCA9IDANCiAgICBkZWYgc3VtVGF4UmVjb3JkcyA9IGdldFJlZkJvb2tSZWNvcmQoMzMsICJERVBBUlRNRU5UX0lEIiwgIjEiLCBkZXBhcnRtZW50UGFyYW1zRGF0ZSwgLTEsIG51bGwsIGZhbHNlKQ0KICAgIGlmIChzdW1UYXhSZWNvcmRzICE9IG51bGwgJiYgIXN1bVRheFJlY29yZHMuaXNFbXB0eSgpKSB7DQogICAgICAgIHN1bU5hbCA9IGdldEFsaWFzRnJvbUZvcm0oZGF0YVJvd3NTdW0sICd0YXhTdW0nLCAnU1VNX1RBWCcpDQogICAgfQ0KDQogICAgZGVmIHByZXZEYXRhUm93cyA9IGdldFByZXZEYXRhUm93cygpDQoNCiAgICBkZWYgY2FUb3RhbFJvdw0KICAgIGRlZiB0b3RhbFJvdw0KICAgIGZvciAoZGVmIHJvdyA6IGRhdGFSb3dzKSB7DQogICAgICAgIGlmIChpc0ZpeGVkUm93KHJvdykpIHsNCiAgICAgICAgICAgIGlmICgiY2EiLmVxdWFscyhyb3cuZ2V0QWxpYXMoKSkpew0KICAgICAgICAgICAgICAgIGNhVG90YWxSb3cgPSByb3cNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmICgidG90YWwiLmVxdWFscyhyb3cuZ2V0QWxpYXMoKSkpew0KICAgICAgICAgICAgICAgIHRvdGFsUm93ID0gcm93DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjb250aW51ZQ0KICAgICAgICB9DQogICAgICAgIGRlZiBpbmRleCA9IHJvdy5nZXRJbmRleCgpDQoNCiAgICAgICAgLy8gMS4g0J7QsdGP0LfQsNGC0LXQu9GM0L3QvtGB0YLRjCDQt9Cw0L/QvtC70L3QtdC90LjRjyDQv9C+0LvRjyDQs9GA0LDRhNGLIDEuLjIxDQogICAgICAgIGNoZWNrTm9uRW1wdHlDb2x1bW5zKHJvdywgaW5kZXgsIG5vbkVtcHR5Q29sdW1ucywgbG9nZ2VyLCB0cnVlKQ0KDQogICAgICAgIC8vIDIuINCf0YDQvtCy0LXRgNC60LAg0LfQvdCw0YfQtdC90LjRjyDQsiDQs9GA0LDRhNC1IMKr0JTQvtC70Y8g0L3QsNC70L7Qs9C+0LLQvtC5INCx0LDQt9GLICjihJYpwrsNCiAgICAgICAgaWYgKHJvdy5iYXNlVGF4T2YgIT0gbnVsbCAmJiAhY2hlY2tDb2x1bW4xMShyb3cuYmFzZVRheE9mKSkgew0KICAgICAgICAgICAgbG9nZ2VyLmVycm9yKCLQodGC0YDQvtC60LAgJGluZGV4OiDQk9GA0LDRhNCwIMKrJXPCuyDQt9Cw0L/QvtC70L3QtdC90LAg0L3QtdCy0LXRgNC90L4hINCe0LbQuNC00LDQtdC80YvQuSDRgtC40L8g0L/QvtC70Y86INCn0LjRgdC70L4vMTguMTUvICjQvNCw0LrRgdC40LzQsNC70YzQvdC+0LUg0L7QsdGJ0LXQtSDQutC+0LvQuNGH0LXRgdGC0LLQviDRhtC40YTRgCAxOCAtINC00L4g0Lgg0L/QvtGB0LvQtSDRgtC+0YfQutC4OyDQv9C+0YHQu9C1INGC0L7Rh9C60Lgg0LzQsNC60YHQuNC80LDQu9GM0L3QvtC1INC60L7Qu9C40YfQtdGB0YLQstC+INGG0LjRhNGAIDE1KS4iLCBnZXRDb2x1bW5OYW1lKHJvdywnYmFzZVRheE9mJykpDQogICAgICAgIH0NCiAgICAgICAgLy8gMy4g0J/RgNC+0LLQtdGA0LrQsCDQvdCwINGB0L7QvtGC0LLQtdGC0YHRgtCy0LjQtSDQv9Cw0YLRgtC10YDQvdGDDQogICAgICAgIGlmIChyb3cua3BwICYmICFjaGVja1BhdHRlcm4obG9nZ2VyLCByb3csICdrcHAnLCByb3cua3BwLCBLUFBfUEFUVEVSTiwgd2FzRXJyb3IgPyBudWxsIDogS1BQX01FQU5JTkcsIHRydWUpKSB7DQogICAgICAgICAgICB3YXNFcnJvciA9IHRydWUNCiAgICAgICAgfQ0KDQogICAgICAgIC8vIDUuINCf0YDQvtCy0LXRgNC60LAg0LfQvdCw0YfQtdC90LjQuSDQsNCy0YLQvtC80LDRgtC40YfQtdGB0LrQuCDQt9Cw0L/QvtC70L3Rj9C10LzRi9GFINCz0YDQsNGEICjQsNGA0LjRhNC80LXRgtC40YfQtdGB0LrQuNC1INC/0YDQvtCy0LXRgNC60LgpDQogICAgICAgIGRlZiBuZWVkVmFsdWUgPSBmb3JtRGF0YS5jcmVhdGVEYXRhUm93KCkNCiAgICAgICAgZGVmIGluY29tZVBhcmFtDQogICAgICAgIGlmIChyb3cucmVnaW9uQmFua0RpdmlzaW9uICE9IG51bGwpIHsNCiAgICAgICAgICAgIGRlZiBkZXBhcnRtZW50UGFyYW0gPSBnZXRSZWZCb29rVmFsdWUoMzAsIHJvdy5yZWdpb25CYW5rRGl2aXNpb24pDQogICAgICAgICAgICBkZWYgZGVwUGFyYW0gPSBnZXREZXBQYXJhbShkZXBhcnRtZW50UGFyYW0pDQogICAgICAgICAgICBkZWYgZGVwSWQgPSBkZXBQYXJhbS5nZXQoUmVmQm9vay5SRUNPUkRfSURfQUxJQVMpLm51bWJlclZhbHVlIGFzIGxvbmcNCiAgICAgICAgICAgIGluY29tZVBhcmFtID0gZ2V0UmVmQm9va1JlY29yZCgzMywgIkRFUEFSVE1FTlRfSUQiLCAiJGRlcElkIiwgZGVwYXJ0bWVudFBhcmFtc0RhdGUsIC0xLCBudWxsLCBmYWxzZSkNCiAgICAgICAgfQ0KICAgICAgICBpZiAoaW5jb21lUGFyYW0gPT0gbnVsbCB8fCBpbmNvbWVQYXJhbS5pc0VtcHR5KCkpIHsNCiAgICAgICAgICAgIGNvbnRpbnVlDQogICAgICAgIH0NCiAgICAgICAgbmVlZFZhbHVlLnJlZ2lvbkJhbmsgPSBjYWxjMihyb3cpDQogICAgICAgIG5lZWRWYWx1ZS5kaXZpc2lvbk5hbWUgPSBjYWxjNChyb3cpDQogICAgICAgIG5lZWRWYWx1ZS5jYWxjRmxhZyA9IGNhbGM5KHJvdykNCiAgICAgICAgbmVlZFZhbHVlLm9ibGlnYXRpb25QYXlUYXggPSBjYWxjMTAocm93KQ0KICAgICAgICBuZWVkVmFsdWUuYmFzZVRheE9mID0gY2FsYzExKHJvdywgcHJvcGVydHlQcmljZVN1bW0sIHdvcmtlcnNDb3VudFN1bW0pDQogICAgICAgIGlmIChmb3JtRGF0YUV2ZW50ICE9IEZvcm1EYXRhRXZlbnQuQ09NUE9TRSkgew0KICAgICAgICAgICAgbmVlZFZhbHVlLmJhc2VUYXhPZlJ1YiA9IGNhbGMxMihyb3csIHRheEJhc2UpDQogICAgICAgIH0NCiAgICAgICAgbmVlZFZhbHVlLnN1YmplY3RUYXhTdGF2a2EgPSBjYWxjMTMocm93KQ0KICAgICAgICBuZWVkVmFsdWUudGF4U3VtID0gY2FsYzE0KHJvdykNCiAgICAgICAgbmVlZFZhbHVlLnN1YmplY3RUYXhDcmVkaXQgPSByb3cuc3ViamVjdFRheENyZWRpdA0KICAgICAgICBjYWxjQ29sdW1uRnJvbTE0VG8yMShwcmV2RGF0YVJvd3MsIG5lZWRWYWx1ZSwgcm93LCBzdW1OYWwsIHJlcG9ydFBlcmlvZCkNCiAgICAgICAgY2FsYzE4XzE5KHByZXZEYXRhUm93cywgZGF0YVJvd3MsIG5lZWRWYWx1ZSwgcmVwb3J0UGVyaW9kKQ0KICAgICAgICBjaGVja0NhbGMocm93LCBjYWxjQ29sdW1ucywgbmVlZFZhbHVlLCBsb2dnZXIsIGZhbHNlKQ0KICAgICAgICAvLyDQvdC10YfQuNGB0LvQvtCy0YvQtSDQt9C90LDRh9C10L3QuNGPDQogICAgICAgIGRlZiBuYW1lcyA9IFtdDQogICAgICAgIG5vdE51bWJlckNhbGNDb2x1bW5zLmVhY2ggeyBhbGlhcyAtPg0KICAgICAgICAgICAgaWYgKG5lZWRWYWx1ZVthbGlhc10gIT0gcm93W2FsaWFzXSkgew0KICAgICAgICAgICAgICAgIG5hbWVzLmFkZChnZXRDb2x1bW5OYW1lKHJvdywgYWxpYXMpKQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIGlmIChuYW1lcykgew0KICAgICAgICAgICAgZGVmIHRtcE5hbWVzID0gJ8KrJyArIG5hbWVzLmpvaW4oJ8K7LCDCqycpICsgJ8K7Jw0KICAgICAgICAgICAgbG9nZ2VyLndhcm4oV1JPTkdfQ0FMQywgcm93LmdldEluZGV4KCksIHRtcE5hbWVzKQ0KICAgICAgICB9DQogICAgfQ0KICAgIGlmIChjYVRvdGFsUm93ID09IG51bGwgfHwgdG90YWxSb3cgPT0gbnVsbCkgeyAvLyDRgdGC0YDQvtC6INC90LXRgiwg0LIg0YDQsNGB0YfQtdGC0Ysg0L3QtSDQt9Cw0YjQtdC7LCDQv9GA0L7QstC10YDRj9GC0Ywg0L3QtdGH0LXQs9C+DQogICAgICAgIHJldHVybg0KICAgIH0NCg0KICAgIGRlZiB0ZW1wbGF0ZVJvd3MgPSBmb3JtRGF0YVNlcnZpY2UuZ2V0Rm9ybVRlbXBsYXRlKGZvcm1EYXRhLmZvcm1UeXBlLmlkLCBmb3JtRGF0YS5yZXBvcnRQZXJpb2RJZCkuZ2V0Um93cygpDQogICAgZGVmIGNhVG90YWxSb3dUZW1wID0gZ2V0RGF0YVJvdyh0ZW1wbGF0ZVJvd3MsICdjYScpDQogICAgZGVmIHRvdGFsUm93VGVtcCA9IGdldERhdGFSb3codGVtcGxhdGVSb3dzLCAndG90YWwnKQ0KDQogICAgY2FsY1RvdGFsUm93KGRhdGFSb3dzLCB0b3RhbFJvd1RlbXApDQogICAgY2FsY0NhVG90YWxSb3coZGF0YVJvd3MsIHByZXZEYXRhUm93cywgY2FUb3RhbFJvd1RlbXAsIHRvdGFsUm93VGVtcCwgdGF4QmFzZSwgc3VtTmFsKQ0KICAgIHJlQ2FsY1RvdGFsUm93KGRhdGFSb3dzLCB0b3RhbFJvd1RlbXApDQoNCiAgICBkZWYgZXJyb3JDb2x1bW5zID0gKGFsbENvbHVtbnMgLSAnbnVtYmVyJykuZmluZEFsbCB7IGFsaWFzIC0+DQogICAgICAgIGNhVG90YWxSb3dUZW1wW2FsaWFzXSAhPSBjYVRvdGFsUm93W2FsaWFzXQ0KICAgIH0NCiAgICBlcnJvckNvbHVtbnMuZWFjaCB7IGFsaWFzIC0+DQogICAgICAgIHJvd1dhcm5pbmcobG9nZ2VyLCBjYVRvdGFsUm93LCBTdHJpbmcuZm9ybWF0KCLQodGC0YDQvtC60LAgJXM6INCY0YLQvtCz0L7QstGL0LUg0LfQvdCw0YfQtdC90LjRjyDRgNCw0YHRgdGH0LjRgtCw0L3RiyDQvdC10LLQtdGA0L3QviDQsiDQs9GA0LDRhNC1IMKrJXPCuyEiLCBjYVRvdGFsUm93LmdldEluZGV4KCksIGdldENvbHVtbk5hbWUoY2FUb3RhbFJvdywgYWxpYXMpKSkNCiAgICB9DQoNCiAgICBkZWYgaXNUYXhQZXJpb2QgPSByZXBvcnRQZXJpb2RTZXJ2aWNlLmdldChmb3JtRGF0YS5yZXBvcnRQZXJpb2RJZCkub3JkZXIgPT0gNA0KICAgIGVycm9yQ29sdW1ucyA9ICgoaXNUYXhQZXJpb2QgPyAodG90YWxDb2x1bW5zIC0gJ2V2ZXJ5TW9udGhlclBheW1lbnRBZnRlclBlcmlvZCcpIDogdG90YWxDb2x1bW5zKSArICdiYXNlVGF4T2YnKS5maW5kQWxsIHsgYWxpYXMgLT4NCiAgICAgICAgdG90YWxSb3dUZW1wW2FsaWFzXSAhPSB0b3RhbFJvd1thbGlhc10NCiAgICB9DQogICAgZXJyb3JDb2x1bW5zLmVhY2ggeyBhbGlhcyAtPg0KICAgICAgICByb3dXYXJuaW5nKGxvZ2dlciwgdG90YWxSb3csIFN0cmluZy5mb3JtYXQoItCh0YLRgNC+0LrQsCAlczog0JjRgtC+0LPQvtCy0YvQtSDQt9C90LDRh9C10L3QuNGPINGA0LDRgdGB0YfQuNGC0LDQvdGLINC90LXQstC10YDQvdC+INCyINCz0YDQsNGE0LUgwqslc8K7ISIsIHRvdGFsUm93LmdldEluZGV4KCksIGdldENvbHVtbk5hbWUodG90YWxSb3csIGFsaWFzKSkpDQogICAgfQ0KfQ0KDQovLyDQv9GA0L7QstC10YDQutCwINCz0YDQsNGE0YsgMTE6INC80LDQutGB0LjQvNCw0LvRjNC90L7QtSDQvtCx0YnQtdC1INC60L7Qu9C40YfQtdGB0YLQstC+INGG0LjRhNGAIDE4IC0g0LTQviDQuCDQv9C+0YHQu9C1INGC0L7Rh9C60Lg7INC/0L7RgdC70LUg0YLQvtGH0LrQuCDQvNCw0LrRgdC40LzQsNC70YzQvdC+0LUg0LrQvtC70LjRh9C10YHRgtCy0L4g0YbQuNGE0YAgMTUNCmRlZiBjaGVja0NvbHVtbjExKGRlZiB2YWx1ZSkgew0KICAgIGlmICh2YWx1ZSA9PSBudWxsKSB7DQogICAgICAgIHJldHVybiBmYWxzZQ0KICAgIH0NCiAgICBkZWYgaSA9IHZhbHVlLmluZGV4T2YoJy4nKQ0KICAgIGlmIChpICE9IC0xKSB7DQogICAgICAgIGRlZiBoZWFkID0gdmFsdWUuc3Vic3RyaW5nKDAsIGkpDQogICAgICAgIGRlZiB0YWlsID0gdmFsdWUuc3Vic3RyaW5nKGkgKyAxKQ0KICAgICAgICBkZWYgaGVhZFNpemUgPSAxOCAtIHRhaWwuc2l6ZSgpDQogICAgICAgIC8vINC/0L7RgdC70LUg0YLQvtGH0LrQuCDQvNCw0LrRgdC40LzRg9C8IDE1INC30L3QsNC60L7Qsiwg0LLRgdC10LPQviDQvdC1INCx0L7Qu9GM0YjQtSAxOCDQt9C90LDQutC+0LINCiAgICAgICAgcmV0dXJuIGhlYWQubWF0Y2hlcygiWzAtOV17MSwkaGVhZFNpemV9IikgJiYgdGFpbC5tYXRjaGVzKCJbMC05XXsxLDE1fSIpDQogICAgfSBlbHNlIHsNCiAgICAgICAgLy8g0LXRgdC70Lgg0L3QtdGCINGC0L7Rh9C60LgsINGC0L4g0YDQsNC30LzQtdGAINC90LUg0LHQvtC70YzRiNC1IDE4DQogICAgICAgIHJldHVybiB2YWx1ZS5tYXRjaGVzKCJbMC05XXsxLDE4fSIpDQogICAgfQ0KfQ0KDQovKioNCiAqINCa0L7QvdGB0L7Qu9C40LTQsNGG0LjRjy4NCiAqLw0Kdm9pZCBjb25zb2xpZGF0aW9uKCkgew0KICAgIGRlZiBkYXRhUm93cyA9IFtdDQoN'
        longString += 'CiAgICAvLyDQmNC00LXQvdGC0LjRhNC40LrQsNGC0L7RgCDRiNCw0LHQu9C+0L3QsCDQuNGB0YLQvtGH0L3QuNC60L7QsiAo0J/RgNC40LvQvtC20LXQvdC40LUgNSkuDQogICAgZGVmIGlkID0gMzcyDQogICAgZGVmIG5ld1Jvdw0KDQogICAgZGVwYXJ0bWVudEZvcm1UeXBlU2VydmljZS5nZXRGb3JtU291cmNlcyhmb3JtRGF0YS5kZXBhcnRtZW50SWQsIGZvcm1EYXRhLmZvcm1UeXBlLmlkLCBmb3JtRGF0YS5raW5kLA0KICAgICAgICAgICAgZ2V0UmVwb3J0UGVyaW9kU3RhcnREYXRlKCksIGdldFJlcG9ydFBlcmlvZEVuZERhdGUoKSkuZWFjaCB7DQogICAgICAgIGlmIChpdC5mb3JtVHlwZUlkID09IGlkKSB7DQogICAgICAgICAgICBkZWYgc291cmNlID0gZm9ybURhdGFTZXJ2aWNlLmdldExhc3QoaXQuZm9ybVR5cGVJZCwgaXQua2luZCwgaXQuZGVwYXJ0bWVudElkLCBmb3JtRGF0YS5yZXBvcnRQZXJpb2RJZCwgZm9ybURhdGEucGVyaW9kT3JkZXIsIGZvcm1EYXRhLmNvbXBhcmF0aXZlUGVyaW9kSWQsIGZvcm1EYXRhLmFjY3J1aW5nKQ0KICAgICAgICAgICAgaWYgKHNvdXJjZSAhPSBudWxsICYmIHNvdXJjZS5zdGF0ZSA9PSBXb3JrZmxvd1N0YXRlLkFDQ0VQVEVEKSB7DQogICAgICAgICAgICAgICAgZGVmIHNvdXJjZURhdGFSb3dzID0gZm9ybURhdGFTZXJ2aWNlLmdldERhdGFSb3dIZWxwZXIoc291cmNlKS5hbGxTYXZlZA0KICAgICAgICAgICAgICAgIHNvdXJjZURhdGFSb3dzLmVhY2ggeyByb3cgLT4NCiAgICAgICAgICAgICAgICAgICAgaWYgKChyb3cuZ2V0QWxpYXMoKSA9PSBudWxsIHx8IHJvdy5nZXRBbGlhcygpID09ICcnKSAmJiByb3cucmVnaW9uQmFua0RpdmlzaW9uICE9IG51bGwpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIG5ld1JvdyA9IGRhdGFSb3dzLmZpbmQgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl0LnJlZ2lvbkJhbmtEaXZpc2lvbiA9PSByb3cucmVnaW9uQmFua0RpdmlzaW9uDQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICBkZWYgaXNOZXcgPSAobmV3Um93ID09IG51bGwpDQogICAgICAgICAgICAgICAgICAgICAgICBuZXdSb3cgPSBuZXdSb3cgPzogZm9ybURhdGEuY3JlYXRlRGF0YVJvdygpDQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNOZXcpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlZGl0YWJsZUNvbHVtbnMuZWFjaCB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ld1Jvdy5nZXRDZWxsKGl0KS5lZGl0YWJsZSA9IHRydWUNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3Um93LmdldENlbGwoaXQpLnNldFN0eWxlQWxpYXMoJ9Cg0LXQtNCw0LrRgtC40YDRg9C10LzQsNGPJykNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXV0b0ZpbGxDb2x1bW5zLmVhY2ggew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXdSb3cuZ2V0Q2VsbChpdCkuc2V0U3R5bGVBbGlhcygn0JDQstGC0L7Qt9Cw0L/QvtC70L3Rj9C10LzQsNGPJykNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICAgICAgICAgIG5ld1Jvdy5yZWdpb25CYW5rID0gcm93LnJlZ2lvbkJhbmsNCiAgICAgICAgICAgICAgICAgICAgICAgIG5ld1Jvdy5yZWdpb25CYW5rRGl2aXNpb24gPSByb3cucmVnaW9uQmFua0RpdmlzaW9uDQogICAgICAgICAgICAgICAgICAgICAgICBuZXdSb3cua3BwID0gcm93LmtwcA0KICAgICAgICAgICAgICAgICAgICAgICAgbmV3Um93LnByb3BlcnR5UHJpY2UgPSBuZXdSb3cucHJvcGVydHlQcmljZSA/IChuZXdSb3cucHJvcGVydHlQcmljZSArIHJvdy5hdmVwcm9wZXJ0eVByaWNlcmFnZUNvc3QpIDogcm93LmF2ZXByb3BlcnR5UHJpY2VyYWdlQ29zdA0KICAgICAgICAgICAgICAgICAgICAgICAgbmV3Um93LndvcmtlcnNDb3VudCA9IG5ld1Jvdy53b3JrZXJzQ291bnQgPyAobmV3Um93LndvcmtlcnNDb3VudCArIHJvdy53b3JrZXJzQ291bnQpIDogcm93LndvcmtlcnNDb3VudA0KICAgICAgICAgICAgICAgICAgICAgICAgbmV3Um93LnN1YmplY3RUYXhDcmVkaXQgPSBuZXdSb3cuc3ViamVjdFRheENyZWRpdCA/IChuZXdSb3cuc3ViamVjdFRheENyZWRpdCArIHJvdy5zdWJqZWN0VGF4Q3JlZGl0KSA6IHJvdy5zdWJqZWN0VGF4Q3JlZGl0DQogICAgICAgICAgICAgICAgICAgICAgICAvLyDQtdGB0LvQuCDQv9C+0LvQtSDQsiDQn9GA0LjQu9C+0LbQtdC90LjQuCA1INC90LUg0LfQsNC/0L7Qu9C90LXQvdC+LCDRgtC+INC4INCyINC/0YDQuNC10LzQvdC40LrQtSDQvtC90L4g0LTQvtC70LbQvdC+INCx0YvRgtGMINC90LXQt9Cw0L/QvtC70L3QtdC90L4o0L/QvtGF0L7QttC1INC/0L7QtNGA0LDQt9GD0LzQtdCy0LDQtdGC0YHRjyDRh9GC0L4g0LjRgdGC0L7Rh9C90LjQuiDQvtC00LjQvSkNCiAgICAgICAgICAgICAgICAgICAgICAgIC8vINGD0YHQu9C+0LLQuNC1INGB0YDQsNCx0LDRgtGL0LLQsNC10YIg0YLQvtC70YzQutC+INC00LvRjyDQuNGB0YLQvtGH0L3QuNC60LAg0YHQviDQt9C90LDRh9C10L3QuNC10Lwg0LIg0L/QvtC70LUg0LjQu9C4INC10YHQu9C4INC+0L3QviDRg9C20LUg0LfQsNC/0L7Qu9C90LXQvdC+DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAobmV3Um93Lm1pbmltaXplVGF4U3VtICE9IG51bGwgfHwgcm93LmRlY3JlYXNlVGF4U3VtICE9IG51bGwpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXdSb3cubWluaW1pemVUYXhTdW0gPSAobmV3Um93Lm1pbmltaXplVGF4U3VtID86IDApICsgKHJvdy5kZWNyZWFzZVRheFN1bSA/OiAwKQ0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG5ld1Jvdy5hbW91bnRUYXggIT0gbnVsbCB8fCByb3cudGF4UmF0ZSAhPSBudWxsKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3Um93LmFtb3VudFRheCA9IChuZXdSb3cuYW1vdW50VGF4ID86IDApICsgKHJvdy50YXhSYXRlID86IDApDQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNOZXcpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhUm93cy5hZGQobmV3Um93KQ0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgfQ0KDQogICAgdXBkYXRlSW5kZXhlcyhkYXRhUm93cykNCiAgICBmb3JtRGF0YVNlcnZpY2UuZ2V0RGF0YVJvd0hlbHBlcihmb3JtRGF0YSkuYWxsQ2FjaGVkID0gZGF0YVJvd3MNCn0NCg0Kdm9pZCBpbXBvcnREYXRhKCkgew0KICAgIGRlZiB0bXBSb3cgPSBmb3JtRGF0YS5jcmVhdGVEYXRhUm93KCkNCiAgICBpbnQgQ09MVU1OX0NPVU5UID0gMjQNCiAgICBpbnQgSEVBREVSX1JPV19DT1VOVCA9IDINCiAgICBTdHJpbmcgVEFCTEVfU1RBUlRfVkFMVUUgPSBnZXRDb2x1bW5OYW1lKHRtcFJvdywgJ251bWJlcicpDQogICAgU3RyaW5nIFRBQkxFX0VORF9WQUxVRSA9IG51bGwNCiAgICBpbnQgSU5ERVhfRk9SX1NLSVAgPSAxDQoNCiAgICBkZWYgYWxsVmFsdWVzID0gW10gICAgICAvLyDQt9C90LDRh9C10L3QuNGPINGE0L7RgNC80YsNCiAgICBkZWYgaGVhZGVyVmFsdWVzID0gW10gICAvLyDQt9C90LDRh9C10L3QuNGPINGI0LDQv9C60LgNCiAgICBkZWYgcGFyYW1zTWFwID0gWydyb3dPZmZzZXQnIDogMCwgJ2NvbE9mZnNldCcgOiAwXSAgLy8g0LzQsNC/0LAg0YEg0L/QsNGA0LDQvNC10YLRgNCw0LzQuCAo0L7RgtGB0YLRg9C/0Ysg0YHQstC10YDRhdGDINC4INGB0LvQtdCy0LApDQoNCiAgICBjaGVja0FuZFJlYWRGaWxlKEltcG9ydElucHV0U3RyZWFtLCBVcGxvYWRGaWxlTmFtZSwgYWxsVmFsdWVzLCBoZWFkZXJWYWx1ZXMsIFRBQkxFX1NUQVJUX1ZBTFVFLCBUQUJMRV9FTkRfVkFMVUUsIEhFQURFUl9ST1dfQ09VTlQsIHBhcmFtc01hcCkNCg0KICAgIC8vINC/0YDQvtCy0LXRgNC60LAg0YjQsNC/0LrQuA0KICAgIGNoZWNrSGVhZGVyWGxzKGhlYWRlclZhbHVlcywgQ09MVU1OX0NPVU5ULCBIRUFERVJfUk9XX0NPVU5ULCB0bXBSb3cpDQogICAgaWYgKGxvZ2dlci5jb250YWluc0xldmVsKExvZ0xldmVsLkVSUk9SKSkgew0KICAgICAgICByZXR1cm47DQogICAgfQ0KICAgIC8vINC+0YHQstC+0LHQvtC20LTQtdC90LjQtSDRgNC10YHRg9GA0YHQvtCyINC00LvRjyDRjdC60L7QvdC+0LzQuNC4INC/0LDQvNGP0YLQuA0KICAgIGhlYWRlclZhbHVlcy5jbGVhcigpDQogICAgaGVhZGVyVmFsdWVzID0gbnVsbA0KDQogICAgZGVmIGZpbGVSb3dJbmRleCA9IHBhcmFtc01hcC5yb3dPZmZzZXQNCiAgICBkZWYgY29sT2Zmc2V0ID0gcGFyYW1zTWFwLmNvbE9mZnNldA0KICAgIHBhcmFtc01hcC5jbGVhcigpDQogICAgcGFyYW1zTWFwID0gbnVsbA0KDQogICAgZGVmIHJvd0luZGV4ID0gMA0KICAgIGRlZiByb3dzID0gW10NCiAgICBkZWYgYWxsVmFsdWVzQ291bnQgPSBhbGxWYWx1ZXMuc2l6ZSgpDQoNCiAgICBkZWYgY2FUb3RhbFJvdw0KICAgIGRlZiB0b3RhbFJvdw0KDQogICAgLy8g0YTQvtGA0LzQuNGA0L7QstCw0L3QuNC1INGB0YLRgNC+0Log0L3RhA0KICAgIGZvciAoZGVmIGkgPSAwOyBpIDwgYWxsVmFsdWVzQ291bnQ7IGkrKykgew0KICAgICAgICByb3dWYWx1ZXMgPSBhbGxWYWx1ZXNbMF0NCiAgICAgICAgZmlsZVJvd0luZGV4KysNCiAgICAgICAgLy8g0LLRgdC1INGB0YLRgNC+0LrQuCDQv9GD0YHRgtGL0LUgLSDQstGL0YXQvtC0DQogICAgICAgIGlmICghcm93VmFsdWVzKSB7DQogICAgICAgICAgICBhbGxWYWx1ZXMucmVtb3ZlKHJvd1ZhbHVlcykNCiAgICAgICAgICAgIHJvd1ZhbHVlcy5jbGVhcigpDQogICAgICAgICAgICBicmVhaw0KICAgICAgICB9DQogICAgICAgIC8vINCf0YDQvtC/0YPRgdC6INC40YLQvtCz0L7QstGL0YUg0YHRgtGA0L7Qug0KICAgICAgICBpZiAocm93VmFsdWVzW0lOREVYX0ZPUl9TS0lQXSAmJiAocm93VmFsdWVzW0lOREVYX0ZPUl9TS0lQXSA9PSAi0KbQtdC90YLRgNCw0LvRjNC90YvQuSDQsNC/0L/QsNGA0LDRgiAo0YHQutC+0YDRgNC10LrRgtC40YDQvtCy0LDQvdC90YvQuSkiIHx8IHJvd1ZhbHVlc1tJTkRFWF9GT1JfU0tJUF0gPT0i0KHQsdC10YDQsdCw0L3QuiDQoNC+0YHRgdC40LgiKSkgew0KICAgICAgICAgICAgc3dpdGNoIChyb3dWYWx1ZXNbSU5ERVhfRk9SX1NLSVBdKSB7DQogICAgICAgICAgICAgICAgY2FzZSAn0KbQtdC90YLRgNCw0LvRjNC90YvQuSDQsNC/0L/QsNGA0LDRgiAo0YHQutC+0YDRgNC10LrRgtC40YDQvtCy0LDQvdC90YvQuSknIDoNCiAgICAgICAgICAgICAgICAgICAgY2FUb3RhbFJvdyA9IGdldFRvdGFsUm93RnJvbVhscygnY2EnLCByb3dWYWx1ZXNbSU5ERVhfRk9SX1NLSVBdLCAyLCByb3dWYWx1ZXMsIGNvbE9mZnNldCwgZmlsZVJvd0luZGV4LCByb3dJbmRleCwgdHJ1ZSkNCiAgICAgICAgICAgICAgICAgICAgYnJlYWsNCiAgICAgICAgICAgICAgICBjYXNlICfQodCx0LXRgNCx0LDQvdC6INCg0L7RgdGB0LjQuCcgOg0KICAgICAgICAgICAgICAgICAgICB0b3RhbFJvdyA9IGdldFRvdGFsUm93RnJvbVhscygndG90YWwnLCByb3dWYWx1ZXNbSU5ERVhfRk9SX1NLSVBdLCA1LCByb3dWYWx1ZXMsIGNvbE9mZnNldCwgZmlsZVJvd0luZGV4LCByb3dJbmRleCwgZmFsc2UpDQogICAgICAgICAgICB9DQogICAgICAgICAgICBhbGxWYWx1ZXMucmVtb3ZlKHJvd1ZhbHVlcykNCiAgICAgICAgICAgIHJvd1ZhbHVlcy5jbGVhcigpDQogICAgICAgICAgICBjb250aW51ZQ0KICAgICAgICB9DQogICAgICAgIC8vINC/0YDQvtGB0YLQsNGPINGB0YLRgNC+0LrQsA0KICAgICAgICByb3dJbmRleCsrDQogICAgICAgIGRlZiBuZXdSb3cgPSBnZXROZXdSb3dGcm9tWGxzKHJvd1ZhbHVlcywgY29sT2Zmc2V0LCBmaWxlUm93SW5kZXgsIHJvd0luZGV4KQ0KICAgICAgICByb3dzLmFkZChuZXdSb3cpDQogICAgICAgIC8vINC+0YHQstC+0LHQvtC00LjRgtGMINC90LXQvdGD0LbQvdGL0LUg0LTQsNC90L3Ri9C1IC0g0LjQvdCw0YfQtSDQvdC1INGF0LLQsNGC0LjRgiDQv9Cw0LzRj9GC0LgNCiAgICAgICAgYWxsVmFsdWVzLnJlbW92ZShyb3dWYWx1ZXMpDQogICAgICAgIHJvd1ZhbHVlcy5jbGVhcigpDQogICAgfQ0KDQogICAgc2hvd01lc3NhZ2VzKHJvd3MsIGxvZ2dlcikNCiAgICBpZiAoIWxvZ2dlci5jb250YWluc0xldmVsKExvZ0xldmVsLkVSUk9SKSkgew0KICAgICAgICB1cGRhdGVJbmRleGVzKHJvd3MpOw0KICAgICAgICAvLyDQtNC+0LHQsNCy0LjRgtGMINGB0YLRgNC+0LrRgyDQptCQICjRgdC60L7RgNGA0LXQutGC0YDQuNGA0L7QstCw0L3QvdGL0LkpDQogICAgICAgIGlmIChjYVRvdGFsUm93ID09IG51bGwpIHsgLy8g0LXRgdC70Lgg0LjRgtC+0LPQvtCy0YvRhSDRgdGC0YDQvtC6INC90LXRgiwg0YLQviDRgdC+0LfQtNCw0YLRjA0KICAgICAgICAgICAgY2FUb3RhbFJvdyA9IGZvcm1EYXRhLmNyZWF0ZURhdGFSb3coKQ0KICAgICAgICAgICAgY2FUb3RhbFJvdy5zZXRBbGlhcygnY2EnKQ0KICAgICAgICAgICAgY2FUb3RhbFJvdy5maXggPSAn0KbQtdC90YLRgNCw0LvRjNC90YvQuSDQsNC/0L/QsNGA0LDRgiAo0YHQutC+0YDRgNC10LrRgtC40YDQvtCy0LDQvdC90YvQuSknDQogICAgICAgICAgICBjYVRvdGFsUm93LmdldENlbGwoJ2ZpeCcpLmNvbFNwYW4gPSAyDQogICAgICAgICAgICBzZXRUb3RhbFN0eWxlKGNhVG90YWxSb3cpDQogICAgICAgIH0NCiAgICAgICAgcm93cy5hZGQoY2FUb3RhbFJvdykNCg0KICAgICAgICAvLyDQtNC+0LHQsNCy0LjRgtGMINC40YLQvtCz0L4NCiAgICAgICAgaWYgKHRvdGFsUm93ID09IG51bGwpIHsgLy8g0LXRgdC70Lgg0LjRgtC+0LPQvtCy0YvRhSDRgdGC0YDQvtC6INC90LXRgiwg0YLQviDRgdC+0LfQtNCw0YLRjA0KICAgICAgICAgICAgdG90YWxSb3cgPSBmb3JtRGF0YS5jcmVhdGVEYXRhUm93KCkNCiAgICAgICAgICAgIHRvdGFsUm93LnNldEFsaWFzKCd0b3RhbCcpDQogICAgICAgICAgICB0b3RhbFJvdy5maXggPSAn0KHQsdC10YDQsdCw0L3QuiDQoNC+0YHRgdC40LgnDQogICAgICAgICAgICB0b3RhbFJvdy5nZXRDZWxsKCdmaXgnKS5jb2xTcGFuID0gNQ0KICAgICAgICAgICAgc2V0VG90YWxTdHlsZSh0b3RhbFJvdykNCiAgICAgICAgICAgIGRlZiBpc1RheFBlcmlvZCA9IHJlcG9ydFBlcmlvZFNlcnZpY2UuZ2V0KGZvcm1EYXRhLnJlcG9ydFBlcmlvZElkKS5vcmRlciA9PSA0DQogICAgICAgICAgICBjYWxjVG90YWxTdW0ocm93cywgdG90YWxSb3csIGlzVGF4UGVyaW9kID8gKHRvdGFsQ29sdW1ucyAtICdldmVyeU1vbnRoZXJQYXltZW50QWZ0ZXJQZXJpb2QnKSA6IHRvdGFsQ29sdW1ucykNCiAgICAgICAgICAgIHRvdGFsUm93LmJhc2VUYXhPZiA9IHJvdW5kVmFsdWUocm93cy5zdW0geyByb3cgLT4NCiAgICAgICAgICAgICAgICBTdHJpbmcgdmFsdWUgPSByb3cuYmFzZVRheE9mDQogICAgICAgICAgICAgICAgKHJvdy5nZXRBbGlhcygpID09IG51bGwgJiYgdmFsdWU/LmlzQmlnRGVjaW1hbCgpKSA/IG5ldyBCaWdEZWNpbWFsKHZhbHVlKSA6IEJpZ0RlY2ltYWwuWkVSTw0KICAgICAgICAgICAgfSA/OiBCaWdEZWNpbWFsLlpFUk8sIDE1KS50b1BsYWluU3RyaW5nKCkNCiAgICAgICAgfQ0KICAgICAgICByb3dzLmFkZCh0b3RhbFJvdykNCiAgICAgICAgZm9ybURhdGFTZXJ2aWNlLmdldERhdGFSb3dIZWxwZXIoZm9ybURhdGEpLmFsbENhY2hlZCA9IHJvd3MNCiAgICB9DQp9DQoNCi8qKg0KICog0J/RgNC+0LLQtdGA0LjRgtGMINGI0LDQv9C60YMg0YLQsNCx0LvQuNGG0YsNCiAqDQogKiBAcGFyYW0gaGVhZGVyUm93cyDRgdGC0YDQvtC60Lgg0YjQsNC/0LrQuA0KICogQHBhcmFtIGNvbENvdW50INC60L7Qu9C40YfQtdGB0YLQstC+INC60L7Qu9C+0L3QvtC6INCyINGC0LDQsdC70LjRhtC1DQogKiBAcGFyYW0gcm93Q291bnQg0LrQvtC70LjRh9C10YHRgtCy0L4g0YHRgtGA0L7QuiDQsiDRgtCw0LHQu9C40YbQtQ0KICogQHBhcmFtIHRtcFJvdyDQstGB0L/QvtC80L7Qs9Cw0YLQtdC70YzQvdCw0Y8g0YHRgtGA0L7QutCwINC00LvRjyDQv9C+0LvRg9GH0LXQvdC40Y8g0L3QsNC30LLQsNC90LjQuCDQs9GA0LDRhNC+0LINCiAqLw0Kdm9pZCBjaGVja0hlYWRlclhscyhkZWYgaGVhZGVyUm93cywgZGVmIGNvbENvdW50LCByb3dDb3VudCwgZGVmIHRtcFJvdykgew0KICAgIGlmIChoZWFkZXJSb3dzLmlzRW1wdHkoKSkgew0KICAgICAgICB0aHJvdyBuZXcgU2VydmljZUV4Y2VwdGlvbihXUk9OR19IRUFERVJfUk9XX1NJWkUpDQogICAgfQ0KICAgIGNoZWNrSGVhZGVyU2l6ZShoZWFkZXJSb3dzWzBdLnNpemUoKSwgaGVhZGVyUm93cy5zaXplKCksIGNvbENvdW50LCByb3dDb3VudCkNCg0KICAgIGRlZiBoZWFkZXJNYXBwaW5nID0gW1s6XV0NCiAgICBkZWYgaW5kZXggPSAwDQogICAgZm9yIChhbGlhcyBpbiBhbGxDb2x1bW5zKSB7DQogICAgICAgIGlmIChhbGlhcyA9PSAnZml4Jykgew0KICAgICAgICAgICAgY29udGludWUNCiAgICAgICAgfQ0KICAgICAgICBoZWFkZXJNYXBwaW5nLmFkZCgoWyhoZWFkZXJSb3dzWzBdW2luZGV4ID8gKGluZGV4ICsgMSkgOiAwXSk6IGdldENvbHVtbk5hbWUodG1wUm93LCBhbGlhcyldKSkNCiAgICAgICAgaGVhZGVyTWFwcGluZy5hZGQoKFsoaGVhZGVyUm93c1sxXVtpbmRleCA9PSAwID8gMCA6IChpbmRleCArIDEpXSk6IChpbmRleCArIDEpLnRvU3RyaW5nKCldKSkNCiAgICAgICAgaW5kZXgrKw0KICAgIH0NCiAgICBjaGVja0hlYWRlckVxdWFscyhoZWFkZXJNYXBwaW5nLCBsb2dnZXIpDQp9DQoNCi8qKg0KICog0J/QvtC70YPRh9C40YLRjCDQvdC+0LLRg9GOINGB0YLRgNC+0LrRgyDQvdGEINC/0L4g0LfQvdCw0YfQtdC90LjRj9C8INC40Lcg0Y3QutGB0LXQu9GPLg0KICoNCiAqIEBwYXJhbSB2YWx1ZXMg0YHQv9C40YHQvtC6INGB0YLRgNC+0Log0YHQviDQt9C90LDRh9C10L3QuNGP0LzQuA0KICogQHBhcmFtIGNvbE9mZnNldCDQvtGC0YHRgtGD0L8g0LIg0LrQvtC70L7QvdC60LDRhQ0KICogQHBhcmFtIGZpbGVSb3dJbmRleCDQvdC+0LzQtdGAINGB0YLRgNC+0LrQuCDQsiDRgtGEDQogKiBAcGFyYW0gcm93SW5kZXgg0YHRgtGA0L7QutCwINCyINC90YQNCiAqLw0KZGVmIGdldE5ld1Jvd0Zyb21YbHMoZGVmIHZhbHVlcywgZGVmIGNvbE9mZnNldCwgZGVmIGZpbGVSb3dJbmRleCwgZGVmIHJvd0luZGV4KSB7DQogICAgZGVmIG5ld1JvdyA9IGdldE5ld1JvdygpDQogICAgbmV3Um93LnNldEluZGV4KHJvd0luZGV4KQ0KICAgIG5ld1Jvdy5zZXRJbXBvcnRJbmRleChmaWxlUm93SW5kZXgpDQoNCiAgICBkZWYgcmVxdWlyZWQgPSB0cnVlDQoNCiAgICAvLyDQs9GA0LDRhNCwIDENCiAgICBkZWYgY29sSW5kZXggPSAwDQogICAgLy8gZml4DQogICAgY29sSW5kZXgrKw0KICAgIC8vINCz0YDQsNGE0LAgMg0KICAgIGNvbEluZGV4KysNCiAgICBuZXdSb3cucmVnaW9uQmFuayA9IGdldFJlY29yZElkSW1wb3J0KDMwTCwgJ05BTUUnLCB2YWx1ZXNbY29sSW5kZXhdLCBmaWxlUm93SW5kZXgsIGNvbEluZGV4ICsgY29sT2Zmc2V0LCBmYWxzZSkNCiAgICAvLyDQs9GA0LDRhNCwIDMNCiAgICBjb2xJbmRleCsrDQogICAgbmV3Um93LnJlZ2lvbkJhbmtEaXZpc2lvbiA9IGdldFJlY29yZElkSW1wb3J0KDMwTCwgJ05BTUUnLCB2YWx1ZXNbY29sSW5kZXhdLCBmaWxlUm93SW5kZXgsIGNvbEluZGV4ICsgY29sT2Zmc2V0LCBmYWxzZSkNCiAgICAvLyDQs9GA0LDRhNCwIDQNCiAgICBjb2xJbmRleCsrDQogICAgbmV3Um93LmRpdmlzaW9uTmFtZSA9IHZhbHVlc1tjb2xJbmRleF0NCiAgICAvLyDQs9GA0LDRhNCwIDUNCiAgICBjb2xJbmRleCsrDQogICAgbmV3Um93LmtwcCA9IHZhbHVlc1tjb2xJbmRleF0NCiAgICAvLyDQs9GA0LDRhNCwIDYNCiAgICBjb2xJbmRleCsrDQogICAgbmV3Um93LnByb3BlcnR5UHJpY2UgPSBwYXJzZU51bWJlcih2YWx1ZXNbY29sSW5kZXhdLCBmaWxlUm93SW5kZXgsIGNvbEluZGV4ICsgY29sT2Zmc2V0LCBsb2dnZXIsIHJlcXVpcmVkKQ0KICAgIC8vINCz0YDQsNGE0LAgNw0KICAgIGNvbEluZGV4KysNCiAgICBuZXdSb3cud29ya2Vyc0NvdW50ID0gcGFyc2VOdW1iZXIodmFsdWVzW2NvbEluZGV4XSwgZmlsZVJvd0luZGV4LCBjb2xJbmRleCArIGNvbE9mZnNldCwgbG9nZ2VyLCByZXF1aXJlZCkNCiAgICAvLyDQs9GA0LDRhNCwIDgNCiAgICBjb2xJbmRleCsrDQogICAgbmV3Um93LnN1YmplY3RUYXhDcmVkaXQgPSBwYXJzZU51bWJlcih2YWx1ZXNbY29sSW5kZXhdLCBmaWxlUm93SW5kZXgsIGNvbEluZGV4ICsgY29sT2Zmc2V0LCBsb2dnZXIsIHJlcXVpcmVkKQ0KICAgIC8vINCz0YDQsNGE0LAgOQ0KICAgIGNvbEluZGV4KysNCiAgICBuZXdSb3cuY2FsY0ZsYWcgPSBnZXRSZWNvcmRJZEltcG9ydCgyNkwsICdDT0RFJywgdmFsdWVzW2NvbEluZGV4XSwgZmlsZVJvd0luZGV4LCBjb2xJbmRleCArIGNvbE9mZnNldCwgZmFsc2UpDQogICAgLy8g0LPRgNCw0YTQsCAxMA0KICAgIGNvbEluZGV4KysNCiAgICBuZXdSb3cub2JsaWdhdGlvblBheVRheCA9IGdldFJlY29yZElkSW1wb3J0KDI1TCwgJ0NPREUnLCB2YWx1ZXNbY29sSW5kZXhdLCBmaWxlUm93SW5kZXgsIGNvbEluZGV4ICsgY29sT2Zmc2V0LCBmYWxzZSkNCiAgICAvLyDQs9GA0LDRhNCwIDExDQogICAgY29sSW5kZXgrKw0KICAgIG5ld1Jvdy5iYXNlVGF4T2YgPSB2YWx1ZXNbY29sSW5kZXhdDQogICAgLy8g0LPRgNCw0YTQsCAxMg0KICAgIGNvbEluZGV4KysNCiAgICBuZXdSb3cuYmFzZVRheE9mUnViID0gcGFyc2VOdW1iZXIodmFsdWVzW2NvbEluZGV4XSwgZmlsZVJvd0luZGV4LCBjb2xJbmRleCArIGNvbE9mZnNldCwgbG9nZ2VyLCByZXF1aXJlZCkNCiAgICAvLyDQs9GA0LDRhNCwIDEzDQogICAgY29sSW5kZXgrKw0KICAgIG5ld1Jvdy5zdWJqZWN0VGF4U3RhdmthID0gcGFyc2VOdW1iZXIodmFsdWVzW2NvbEluZGV4XSwgZmlsZVJvd0luZGV4LCBjb2xJbmRleCArIGNvbE9mZnNldCwgbG9nZ2VyLCByZXF1aXJlZCkNCiAgICAvLyDQs9GA0LDRhNCwIDE0DQogICAgY29sSW5kZXgrKw0KICAgIG5ld1Jvdy50YXhTdW0gPSBwYXJzZU51bWJlcih2YWx1ZXNbY29sSW5kZXhdLCBmaWxlUm93SW5kZXgsIGNvbEluZGV4ICsgY29sT2Zmc2V0LCBsb2dnZXIsIHJlcXVpcmVkKQ0KICAgIC8vINCz0YDQsNGE0LAgMTUNCiAgICBjb2xJbmRleCsrDQogICAgbmV3Um93LnRheFN1bU91dHNpZGUgPSBwYXJzZU51bWJlcih2YWx1ZXNbY29sSW5kZXhdLCBmaWxlUm93SW5kZXgsIGNvbEluZGV4ICsgY29sT2Zmc2V0LCBsb2dnZXIsIHJlcXVpcmVkKQ0KICAgIC8vINCz0YDQsNGE0LAgMTYNCiAgICBjb2xJbmRleCsrDQogICAgbmV3Um93LnRheFN1bVRvUGF5ID0gcGFyc2VOdW1iZXIodmFsdWVzW2NvbEluZGV4XSwgZmlsZVJvd0luZGV4LCBjb2xJbmRleCArIGNvbE9mZnNldCwgbG9nZ2VyLCByZXF1aXJlZCkNCiAgICAvLyDQs9GA0LDRhNCwIDE3DQogICAgY29sSW5kZXgrKw0KICAgIG5ld1Jvdy50YXhTdW1Ub1JlZHVjdGlvbiA9IHBhcnNlTnVtYmVyKHZhbHVlc1tjb2xJbmRleF0sIGZpbGVSb3dJbmRleCwgY29sSW5kZXggKyBjb2xPZmZzZXQsIGxvZ2dlciwgcmVxdWlyZWQpDQogICAgLy8g0LPRgNCw0YTQsCAxOA0KICAgIGNvbEluZGV4KysNCiAgICBuZXdSb3cuZXZlcnlNb250aGVyUGF5bWVudEFmdGVyUGVyaW9kID0gcGFyc2VOdW1iZXIodmFsdWVzW2NvbEluZGV4XSwgZmlsZVJvd0luZGV4LCBjb2xJbmRleCArIGNvbE9mZnNldCwgbG9nZ2VyLCByZXF1aXJlZCkNCiAgICAvLyDQs9GA0LDRhNCwIDE5DQogICAgY29sSW5kZXgrKw0KICAgIG5ld1Jvdy5ldmVyeU1vbnRoRm9yS3ZhcnRhbE5leHRQZXJpb2QgPSBwYXJzZU51bWJlcih2YWx1ZXNbY29sSW5kZXhdLCBmaWxlUm93SW5kZXgsIGNvbEluZGV4ICsgY29sT2Zmc2V0LCBsb2dnZXIsIHJlcXVpcmVkKQ0KICAgIC8vINCz0YDQsNGE0LAgMjANCiAgICBjb2xJbmRleCsrDQogICAgbmV3Um93LmV2ZXJ5TW9udGhGb3JTZWNvbmRLdmFydGFsTmV4dFBlcmlvZCA9IHBhcnNlTnVtYmVyKHZhbHVlc1tjb2xJbmRleF0sIGZpbGVSb3dJbmRleCwgY29sSW5kZXggKyBjb2xPZmZzZXQsIGxvZ2dlciwgcmVxdWlyZWQpDQogICAgLy8g0LPRgNCw0YTQsCAyMQ0KICAgIGNvbEluZGV4KysNCiAgICBuZXdSb3cuZXZlcnlNb250aEZvclRoaXJkS3ZhcnRhbE5leHRQZXJpb2QgPSBwYXJzZU51bWJlcih2YWx1ZXNbY29sSW5kZXhdLCBmaWxlUm93SW5kZXgsIGNvbEluZGV4ICsgY29sT2Zmc2V0LCBsb2dnZXIsIHJlcXVpcmVkKQ0KICAgIC8vINCz0YDQsNGE0LAgMjINCiAgICBjb2xJbmRleCsrDQogICAgbmV3Um93LmV2ZXJ5TW9udGhGb3JGb3VydGhLdmFydGFsTmV4dFBlcmlvZCA9IHBhcnNlTnVtYmVyKHZhbHVlc1tjb2xJbmRleF0sIGZpbGVSb3dJbmRleCwgY29sSW5kZXggKyBjb2xPZmZzZXQsIGxvZ2dlciwgcmVxdWlyZWQpDQogICAgLy8g0LPRgNCw0YTQsCAyMw0KICAgIGNvbEluZGV4KysNCiAgICBuZXdSb3cubWluaW1pemVUYXhTdW0gPSBwYXJzZU51bWJlcih2YWx1ZXNbY29sSW5kZXhdLCBmaWxlUm93SW5kZXgsIGNvbEluZGV4ICsgY29sT2Zmc2V0LCBsb2dnZXIsIHJlcXVpcmVkKQ0KICAgIC8vINCz0YDQsNGE0LAgMjQNCiAgICBjb2xJbmRleCsrDQogICAgbmV3Um93LmFtb3VudFRheCA9IHBhcnNlTnVtYmVyKHZhbHVlc1tjb2xJbmRleF0sIGZpbGVSb3dJbmRleCwgY29sSW5kZXggKyBjb2xPZmZzZXQsIGxvZ2dlciwgcmVxdWlyZWQpDQoNCiAgICByZXR1cm4gbmV3Um93DQp9DQoNCmRlZiBnZXROZXdSb3coKSB7DQogICAgZGVmIG5ld1JvdyA9IChmb3JtRGF0YUV2ZW50IGluIFtGb3JtRGF0YUV2ZW50LklNUE9SVCwgRm9ybURhdGFFdmVudC5JTVBPUlRfVFJBTlNQT1JUX0ZJTEVdKSA/IGZvcm1EYXRhLmNyZWF0ZVN0b3JlTWVzc2FnaW5nRGF0YVJvdygpIDogZm9ybURhdGEuY3JlYXRlRGF0YVJvdygpDQoNCiAgICBlZGl0YWJsZUNvbHVtbnMuZWFjaCB7DQogICAgICAgIG5ld1Jvdy5nZXRDZWxsKGl0KS5lZGl0YWJsZSA9IHRydWUNCiAgICAgICAgbmV3Um93LmdldENlbGwoaXQpLnNldFN0eWxlQWxpYXMoJ9Cg0LXQtNCw0LrRgtC40YDRg9C10LzQsNGPJykNCiAgICB9DQogICAgYXV0b0ZpbGxDb2x1bW5zLmVhY2ggew0KICAgICAgICBuZXdSb3cuZ2V0Q2VsbChpdCkuc2V0U3R5bGVBbGlhcygn0JDQstGC0L7Qt9Cw0L/QvtC70L3Rj9C10LzQsNGPJykNCiAgICB9DQogICAgcmV0dXJuIG5ld1Jvdw0KfQ0KDQpkZWYgZ2V0VG90YWxSb3dGcm9tWGxzKGRlZiBhbGlhcywgZGVmIHRpdGxlLCBkZWYgY29sU3BhbiwgZGVmIHZhbHVlcywgZGVmIGNvbE9mZnNldCwgZGVmIGZpbGVSb3dJbmRleCwgZGVmIHJvd0luZGV4LCBib29sZWFuIGZpbGxDQSkgew0KICAgIGRlZiB0b3RhbFJvdyA9IGZvcm1EYXRhLmNyZWF0ZVN0b3JlTWVzc2FnaW5nRGF0YVJvdygpDQogICAgdG90YWxSb3cuc2V0SW5kZXgocm93SW5kZXgpDQogICAgdG90YWxSb3cuc2V0SW1wb3J0SW5kZXgoZmlsZVJvd0luZGV4KQ0KICAgIHRvdGFsUm93LnNldEFsaWFzKGFsaWFzKQ0KICAgIHRvdGFsUm93LmZpeCA9IHRpdGxlDQogICAgdG90YWxSb3cuZ2V0Q2VsbCgnZml4JykuY29sU3BhbiA9IGNvbFNwYW4NCiAgICBzZXRUb3RhbFN0eWxlKHRvdGFsUm93KQ0KDQogICAgZGVmIHJlcXVpcmVkID0gdHJ1ZQ0KDQogICAgLy8g0LPRgNCw0YTQsCAxDQogICAgZGVmIGNvbEluZGV4ID0gMA0KDQogICAgaWYgKGZpbGxDQSkgew0KICAgICAgICAvLyDQs9GA0LDRhNCwIDINCiAgICAgICAgY29sSW5kZXggPSAyDQogICAgICAgIHRvdGFsUm93LnJlZ2lvbkJhbmsgPSBnZXRSZWNvcmRJZEltcG9ydCgzMEwsICdOQU1FJywgdmFsdWVzW2NvbEluZGV4XSwgZmlsZVJvd0luZGV4LCBjb2xJbmRleCArIGNvbE9mZnNldCwgZmFsc2UpDQogICAgICAgIC8vINCz0YDQsNGE0LAgMw0KICAgICAgICBjb2xJbmRleCA9IDMNCiAgICAgICAgdG90YWxSb3cucmVnaW9uQmFua0RpdmlzaW9uID0gZ2V0UmVjb3JkSWRJbXBvcnQoMzBMLCAnTkFNRScsIHZhbHVlc1tjb2xJbmRleF0sIGZpbGVSb3dJbmRleCwgY29sSW5kZXggKyBjb2xPZmZzZXQsIGZhbHNlKQ0KICAgICAgICAvLyDQs9GA0LDRhNCwIDQNCiAgICAgICAgY29sSW5kZXggPSA0DQogICAgICAgIHRvdGFsUm93LmRpdmlzaW9uTmFtZSA9IHZhbHVlc1tjb2xJbmRleF0NCiAgICAgICAgLy8g0LPRgNCw0YTQsCA1DQogICAgICAgIGNvbEluZGV4ID0gNQ0KICAgICAgICB0b3RhbFJvdy5rcHAgPSB2YWx1ZXNbY29sSW5kZXhdDQogICAgICAgIC8vINCz0YDQsNGE0LAgOQ0KICAgICAgICBjb2xJbmRleCA9IDkNCiAgICAgICAgdG90YWxSb3cuY2FsY0ZsYWcgPSBnZXRSZWNvcmRJZEltcG9ydCgyNkwsICdDT0RFJywgdmFsdWVzW2NvbEluZGV4XSwgZmlsZVJvd0luZGV4LCBjb2xJbmRleCArIGNvbE9mZnNldCwgZmFsc2UpDQogICAgICAgIC8vINCz0YDQsNGE0LAgMTANCiAgICAgICAgY29sSW5kZXggPSAxMA0KICAgICAgICB0b3RhbFJvdy5vYmxpZ2F0aW9uUGF5VGF4ID0gZ2V0UmVjb3JkSWRJbXBvcnQoMjVMLCAnQ09ERScsIHZhbHVlc1tjb2xJbmRleF0sIGZpbGVSb3dJbmRleCwgY29sSW5kZXggKyBjb2xPZmZzZXQsIGZhbHNlKQ0KICAgICAgICAvLyDQs9GA0LDRhNCwIDExDQogICAgICAgIGNvbEluZGV4ID0gMTENCiAgICAgICAgdG90YWxSb3cuYmFzZVRheE9mID0gdmFsdWVzW2NvbEluZGV4XQ0KICAgICAgICAvLyDQs9GA0LDRhNCwIDI0DQogICAgICAgIGNvbEluZGV4ID0gMjQNCiAgICAgICAgdG90YWxSb3cuYW1vdW50VGF4ID0gcGFyc2VOdW1iZXIodmFsdWVzW2NvbEluZGV4XSwgZmlsZVJvd0luZGV4LCBjb2xJbmRleCArIGNvbE9mZnNldCwgbG9nZ2VyLCByZXF1aXJlZCkNCiAgICB9DQoNCiAgICAvLyDQs9GA0LDRhNCwIDYNCiAgICBjb2xJbmRleCA9IDYNCiAgICB0b3RhbFJvdy5wcm9wZXJ0eVByaWNlID0gcGFyc2VOdW1iZXIodmFsdWVzW2NvbEluZGV4XSwgZmlsZVJvd0luZGV4LCBjb2xJbmRleCArIGNvbE9mZnNldCwgbG9nZ2VyLCByZXF1aXJlZCkNCiAgICAvLyDQs9GA0LDRhNCwIDcNCiAgICBjb2xJbmRleCA9IDcNCiAgICB0b3RhbFJvdy53b3JrZXJzQ291bnQgPSBwYXJzZU51bWJlcih2YWx1ZXNbY29sSW5kZXhdLCBmaWxlUm93SW5kZXgsIGNvbEluZGV4ICsgY29sT2Zmc2V0LCBsb2dnZXIsIHJlcXVpcmVkKQ0KICAgIC8vINCz0YDQsNGE0LAgOA0KICAgIGNvbEluZGV4ID0gOA0KICAgIHRvdGFsUm93LnN1YmplY3RUYXhDcmVkaXQgPSBwYXJzZU51bWJlcih2YWx1ZXNbY29sSW5kZXhdLCBmaWxlUm93SW5kZXgsIGNvbEluZGV4ICsgY29sT2Zmc2V0LCBsb2dnZXIsIHJlcXVpcmVkKQ0KICAgIC8vINCz0YDQsNGE0LAgMTINCiAgICBjb2xJbmRleCA9IDEyDQogICAgdG90YWxSb3cuYmFzZVRheE9mUnViID0gcGFyc2VOdW1iZXIodmFsdWVzW2NvbEluZGV4XSwgZmlsZVJvd0luZGV4LCBjb2xJbmRleCArIGNvbE9mZnNldCwgbG9nZ2VyLCByZXF1aXJlZCkNCiAgICAvLyDQs9GA0LDRhNCwIDEzDQogICAgY29sSW5kZXggPSAxMw0KICAgIHRvdGFsUm93LnN1YmplY3RUYXhTdGF2a2EgPSBwYXJzZU51bWJlcih2YWx1ZXNbY29sSW5kZXhdLCBmaWxlUm93SW5kZXgsIGNvbEluZGV4ICsgY29sT2Zmc2V0LCBsb2dnZXIsIHJlcXVpcmVkKQ0KICAgIC8vINCz0YDQsNGE0LAgMTQNCiAgICBjb2xJbmRleCA9IDE0DQogICAgdG90YWxSb3cudGF4U3VtID0gcGFyc2VOdW1iZXIodmFsdWVzW2NvbEluZGV4XSwgZmlsZVJvd0luZGV4LCBjb2xJbmRleCArIGNvbE9mZnNldCwgbG9nZ2VyLCByZXF1aXJlZCkNCiAgICAvLyDQs9GA0LDRhNCwIDE1DQogICAgY29sSW5kZXggPSAxNQ0KICAgIHRvdGFsUm93LnRheFN1bU91dHNpZGUgPSBwYXJzZU51bWJlcih2YWx1ZXNbY29sSW5kZXhdLCBmaWxlUm93SW5kZXgsIGNvbEluZGV4ICsgY29sT2Zmc2V0LCBsb2dnZXIsIHJlcXVpcmVkKQ0KICAgIC8vINCz0YDQsNGE0LAgMTYNCiAgICBjb2xJbmRleCA9IDE2DQogICAgdG90YWxSb3cudGF4U3VtVG9QYXkgPSBwYXJzZU51bWJlcih2YWx1ZXNbY29sSW5kZXhdLCBmaWxlUm93SW5kZXgsIGNvbEluZGV4ICsgY29sT2Zmc2V0LCBsb2dnZXIsIHJlcXVpcmVkKQ0KICAgIC8vINCz0YDQsNGE0LAgMTcNCiAgICBjb2xJbmRleCA9IDE3DQogICAgdG90YWxSb3cudGF4U3VtVG9SZWR1Y3Rpb24gPSBwYXJzZU51bWJlcih2YWx1ZXNbY29sSW5kZXhdLCBmaWxlUm93SW5kZXgsIGNvbEluZGV4ICsgY29sT2Zmc2V0LCBsb2dnZXIsIHJlcXVpcmVkKQ0KICAgIC8vINCz0YDQsNGE0LAgMTgNCiAgICBjb2xJbmRleCA9IDE4DQogICAgdG90YWxSb3cuZXZlcnlNb250aGVyUGF5bWVudEFmdGVyUGVyaW9kID0gcGFyc2VOdW1iZXIodmFsdWVzW2NvbEluZGV4XSwgZmlsZVJvd0luZGV4LCBjb2xJbmRleCArIGNvbE9mZnNldCwgbG9nZ2VyLCByZXF1aXJlZCkNCiAgICAvLyDQs9GA0LDRhNCwIDE5DQogICAgY29sSW5kZXggPSAxOQ0KICAgIHRvdGFsUm93LmV2ZXJ5TW9udGhGb3JLdmFydGFsTmV4dFBlcmlvZCA9IHBhcnNlTnVtYmVyKHZhbHVlc1tjb2xJbmRleF0sIGZpbGVSb3dJbmRleCwgY29sSW5kZXggKyBjb2xPZmZzZXQsIGxvZ2dlciwgcmVxdWlyZWQpDQogICAgLy8g0LPRgNCw0YTQsCAyMA0KICAgIGNvbEluZGV4ID0gMjANCiAgICB0b3RhbFJvdy5ldmVyeU1vbnRoRm9yU2Vjb25kS3ZhcnRhbE5leHRQZXJpb2QgPSBwYXJzZU51bWJlcih2YWx1ZXNbY29sSW5kZXhdLCBmaWxlUm93SW5kZXgsIGNvbEluZGV4ICsgY29sT2Zmc2V0LCBsb2dnZXIsIHJlcXVpcmVkKQ0KICAgIC8vINCz0YDQsNGE0LAgMjENCiAgICBjb2xJbmRleCA9IDIxDQogICAgdG90YWxSb3cuZXZlcnlNb250aEZvclRoaXJkS3ZhcnRhbE5leHRQZXJpb2QgPSBwYXJzZU51bWJlcih2YWx1ZXNbY29sSW5kZXhdLCBmaWxlUm93SW5kZXgsIGNvbEluZGV4ICsgY29sT2Zmc2V0LCBsb2dnZXIsIHJlcXVpcmVkKQ0KICAgIC8vINCz0YDQsNGE0LAgMjINCiAgICBjb2xJbmRleCA9IDIyDQogICAgdG90YWxSb3cuZXZlcnlNb250aEZvckZvdXJ0aEt2YXJ0YWxOZXh0UGVyaW9kID0gcGFyc2VOdW1iZXIodmFsdWVzW2NvbEluZGV4XSwgZmlsZVJvd0luZGV4LCBjb2xJbmRleCArIGNvbE9mZnNldCwgbG9nZ2VyLCByZXF1aXJlZCkNCiAgICAvLyDQs9GA0LDRhNCwIDIzDQogICAgY29sSW5kZXggPSAyMw0KICAgIHRvdGFsUm93Lm1pbmltaXplVGF4U3VtID0gcGFyc2VOdW1iZXIodmFsdWVzW2NvbEluZGV4XSwgZmlsZVJvd0luZGV4LCBjb2xJbmRleCArIGNvbE9mZnNldCwgbG9nZ2VyLCByZXF1aXJlZCkNCg0KICAgIHJldHVybiB0b3RhbFJvdw0KfQ0KDQovKioNCiAqINCf0YDQvtCy0LXRgNC60LAg0L3QsNC70LjRh9C40Y8g0LTQtdC60LvQsNGA0LDRhtC40Lgg0LTQu9GPINGC0LXQutGD0YnQtdCz0L4gZGVwYXJ0bWVudA0KICovDQp2b2lkIGNoZWNrRGVjbGFyYXRpb24oKSB7DQogICAgZGVjbGFyYXRpb25UeXBlID0gMiAgICAvLyDQotC40L8g0LTQtdC60LvQsNGA0LDRhtC40Lgg0LrQvtGC0L7RgNGD0Y4g0L/RgNC+0LLQtdGA0Y/QtdC8ICjQndCw0LvQvtCzINC90LAg0L/RgNC40LHRi9C70YwpDQogICAgZGVjbGFyYXRpb24gPSBkZWNsYXJhdGlvblNlcnZpY2UuZ2V0TGFzdChkZWNsYXJhdGlvblR5cGUsIGZvcm1EYXRhLmdldERlcGFydG1lbnRJZCgpLCBmb3JtRGF0YS5nZXRSZXBvcnRQZXJpb2RJZCgpKQ0KICAgIGlmIChkZWNsYXJhdGlvbiAhPSBudWxsICYmIGRlY2xhcmF0aW9uLmlzQWNjZXB0ZWQoKSkgew0KICAgICAgICBsb2dnZXIuZXJyb3IoItCU0LXQutC70LDRgNCw0YbQuNGPINCx0LDQvdC60LAg0L3QsNGF0L7QtNC40YLRgdGPINCyINGB0YLQsNGC0YPRgdC1INC/0YDQuNC90Y/RgtCwIikNCiAgICB9DQp9DQoNCi8qDQogKiDQktGB0L/QvtC80L7Qs9Cw0YLQtdC70YzQvdGL0LUg0LzQtdGC0L7QtNGLLg0KICovDQoNCi8qKg0KICog0J/RgNC+0LLQtdGA0LrQsCDRj9Cy0LvRj9C10YLRgdGPINC70Lgg0YHRgtGA0L7QutCwINGE0LjQutGB0LjRgNC+0LLQsNC90L3QvtC5Lg0KICovDQpkZWYgaXNGaXhlZFJvdyhkZWYgcm93KSB7DQogICAgcmV0dXJuIHJvdyAhPSBudWxsICYmIHJvdy5nZXRBbGlhcygpICE9IG51bGwNCn0NCg0KLyoqDQogKiDQo9GB0YLQsNC90L7QstC40YLRjCDRgdGC0LjQu9GMINC00LvRjyDQuNGC0L7Qs9C+0LLRi9GFINGB0YLRgNC+0LouDQogKi8NCnZvaWQgc2V0VG90YWxTdHlsZShkZWYgcm93KSB7DQogICAgYWxsQ29sdW1ucy5lYWNoIHsNCiAgICAgICAgcm93LmdldENlbGwoaXQpLnNldFN0eWxlQWxpYXMoJ9CY0YLQvtCz0L7QstCw0Y8nKQ0KICAgIH0NCn0NCg0KLyoqDQogKiDQn9C+0LvRg9GH0LjRgtGMINGB0YPQvNC80YMg0YHRgtC+0LvQsdGG0LAgKNC30LAg0LjRgdC60LvRjtGH0LXQvdC40LXQvCDQt9C90LDRh9C10L3QuNC4INGE0LjQutGB0LjRgNC+0LLQsNC90L3Ri9GFINGB0YLRgNC+0LopLg0KICoNCiAqIEBwYXJhbSBkYXRhINC00LDQvdC90YvQtSDQvdGEIChoZWxwZXIpDQogKiBAcGFyYW0gY29sdW1uQWxpYXMg0LDQu9C40LvQsNGBINGB0YLQvtC70LHRhtCwINC/0L4g0LrQvtGC0L7RgNC+0LzRgyDRgdGH'
        longString += '0LjRgtCw0YLRjCDRgdGD0LzQvNGDDQogKiBAcmV0dXJuDQogKi8NCmRlZiBnZXRTdW0oZGVmIGRhdGFSb3dzLCBkZWYgY29sdW1uQWxpYXMpIHsNCiAgICBkZWYgZnJvbSA9IDANCiAgICBkZWYgdG8gPSBkYXRhUm93cy5zaXplKCkgLSAyDQogICAgaWYgKGZyb20gPiB0bykgew0KICAgICAgICByZXR1cm4gMA0KICAgIH0NCiAgICByZXR1cm4gc3VtbShmb3JtRGF0YSwgZGF0YVJvd3MsIG5ldyBDb2x1bW5SYW5nZShjb2x1bW5BbGlhcywgZnJvbSwgdG8pKQ0KfQ0KDQovKioNCiAqINCf0L7Qu9GD0YfQuNGC0Ywg0YHRg9C80LzRgyDRgdGC0L7Qu9Cx0YbQsCAo0YHRg9C80LzQsCDQt9C90LDRh9C10L3QuNC4INCy0YHQtdGFINGB0YLRgNC+0LopLg0KICovDQpkZWYgZ2V0U3VtQWxsKGRlZiBkYXRhUm93cywgZGVmIGNvbHVtbkFsaWFzKSB7DQogICAgZGVmIGZyb20gPSAwDQogICAgZGVmIHRvID0gZGF0YVJvd3Muc2l6ZSgpIC0gMQ0KICAgIGlmIChmcm9tID4gdG8pIHsNCiAgICAgICAgcmV0dXJuIDANCiAgICB9DQogICAgcmV0dXJuIHN1bW0oZm9ybURhdGEsIGRhdGFSb3dzLCBuZXcgQ29sdW1uUmFuZ2UoY29sdW1uQWxpYXMsIGZyb20sIHRvKSkNCn0NCg0KLy8g0J/QvtC70YPRh9C40YLRjCDQtNCw0L3QvdGL0LUg0YHQstC+0LTQvdC+0LkNCmRlZiBnZXRGb3JtRGF0YVN1bW1hcnlNYXAoZGVmIGlkcykgew0KICAgIGRlZiBtYXAgPSBbOl0NCiAgICBpZHMuZWFjaHsgaWQgLT4NCiAgICAgICAgaWYgKCFmb3JtRGF0YUNhY2hlW2lkXSkgew0KICAgICAgICAgICAgZm9ybURhdGFDYWNoZVtpZF0gPSBmb3JtRGF0YVNlcnZpY2UuZ2V0TGFzdChpZCwgY29tLmFwbGFuYS5zYnJmLnRheGFjY291bnRpbmcubW9kZWwuRm9ybURhdGFLaW5kLlNVTU1BUlksIGZvcm1EYXRhRGVwYXJ0bWVudC5pZCwgZm9ybURhdGEucmVwb3J0UGVyaW9kSWQsIGZvcm1EYXRhLnBlcmlvZE9yZGVyLCBmb3JtRGF0YS5jb21wYXJhdGl2ZVBlcmlvZElkLCBmb3JtRGF0YS5hY2NydWluZykNCiAgICAgICAgfQ0KICAgICAgICBpZiAoZm9ybURhdGFDYWNoZVtpZF0pIHsNCiAgICAgICAgICAgIG1hcFtpZF0gPSBmb3JtRGF0YUNhY2hlW2lkXQ0KICAgICAgICB9DQogICAgfQ0KICAgIHJldHVybiBtYXANCn0NCg0KZGVmIGdldERhdGEoZGVmIGZvcm1EYXRhKSB7DQogICAgaWYgKGZvcm1EYXRhID09IG51bGwpIHsNCiAgICAgICAgcmV0dXJuIG51bGwNCiAgICB9DQogICAgaWYgKGZvcm1EYXRhLmlkICE9IG51bGwgJiYgZm9ybURhdGEuc3RhdGUgPT0gV29ya2Zsb3dTdGF0ZS5BQ0NFUFRFRCAmJiAhaGVscGVyQ2FjaGVbZm9ybURhdGEuaWRdKSB7DQogICAgICAgIGhlbHBlckNhY2hlW2Zvcm1EYXRhLmlkXSA9IGZvcm1EYXRhU2VydmljZS5nZXREYXRhUm93SGVscGVyKGZvcm1EYXRhKQ0KICAgIH0NCiAgICByZXR1cm4gaGVscGVyQ2FjaGVbZm9ybURhdGEuaWRdDQp9DQoNCmRlZiBnZXREb2hJc2tsUHJpYihkZWYgZGF0YVJvd3NDb21wbGV4LCBkZWYgZGF0YVJvd3NTaW1wbGUpIHsNCiAgICBkZWYgcmVzdWx0ID0gMC4wDQoNCiAgICBpZiAoZGF0YVJvd3NDb21wbGV4ICE9IG51bGwpIHsNCiAgICAgICAgLy8g0JrQvtC0INCy0LjQtNCwINC00L7RhdC+0LTQvtCyID0gMTY0NDAsIDE2NDUwLCAxNjQ2MCwgMTY0ODAsIDE2NDkwLCAxNjUwMCwgMTY1MTAsIDE2NTIwLCAxNjU0MCwgMTY1NTAsIDE2NTcwLCAxNjU4MCwgMTY2NjAsIDE2NjcwDQogICAgICAgIHJlc3VsdCArPSBnZXRDb21wbGV4SW5jb21lU3VtUm93czkoZGF0YVJvd3NDb21wbGV4LA0KICAgICAgICAgICAgICAgIFsxNjQ0MCwgMTY0NTAsIDE2NDYwLCAxNjQ4MCwgMTY0OTAsIDE2NTAwLCAxNjUxMCwgMTY1MjAsIDE2NTQwLCAxNjU1MCwgMTY1NzAsIDE2NTgwLCAxNjY2MCwgMTY2NzBdKQ0KICAgIH0NCiAgICBpZiAoZGF0YVJvd3NTaW1wbGUgIT0gbnVsbCkgew0KICAgICAgICAvLyDQmtC+0LQg0LLQuNC00LAg0LTQvtGF0L7QtNCwID0gMTcxMzAsIDE3MTQwLCAxNzE1MA0KICAgICAgICByZXN1bHQgKz0gZ2V0U3VtUm93c0J5Q29sKGRhdGFSb3dzU2ltcGxlLCAnaW5jb21lVHlwZUlkJywgJ3JudTZGaWVsZDEwU3VtJywgWzE3MTMwLCAxNzE0MCwgMTcxNTBdKQ0KICAgIH0NCiAgICByZXR1cm4gZ2V0TG9uZyhyZXN1bHQpDQp9DQoNCkBGaWVsZA0KZGVmIHRheEJhc2VBc0RlY2xhcmF0aW9uID0gbnVsbA0KDQpkZWYgZ2V0VGF4QmFzZUFzRGVjbGFyYXRpb24oKSB7DQogICAgaWYgKHRheEJhc2VBc0RlY2xhcmF0aW9uICE9IG51bGwpIHsNCiAgICAgICAgcmV0dXJuIHRheEJhc2VBc0RlY2xhcmF0aW9uDQogICAgfQ0KICAgIGRlZiBlbXB0eSA9IDANCg0KICAgIC8vINCU0LDQvdC90YvQtSDQvdCw0LvQvtCz0L7QstGL0YUg0YTQvtGA0LwuDQoNCiAgICAvKiog0JTQvtGF0L7QtNGLINGB0LvQvtC20L3Ri9C1INGD0YDQvtCy0L3RjyDQkdCw0L3QutCwICLQodCy0L7QtNC90LDRjyDRhNC+0YDQvNCwINC90LDRh9C40YHQu9C10L3QvdGL0YUg0LTQvtGF0L7QtNC+0LIiLiAqLw0KICAgIGRlZiBkYXRhUm93c0NvbXBsZXhJbmNvbWUgPSBnZXREYXRhKGdldEZvcm1EYXRhU3VtbWFyeU1hcChbMzAyXSlbMzAyXSk/LmFsbFNhdmVkDQoNCiAgICAvKiog0JTQvtGF0L7QtNGLINC/0YDQvtGB0YLRi9C1INGD0YDQvtCy0L3RjyDQkdCw0L3QutCwICLQoNCw0YHRiNC40YTRgNC+0LLQutCwINCy0LjQtNC+0LIg0LTQvtGF0L7QtNC+0LIsINGD0YfQuNGC0YvQstCw0LXQvNGL0YUg0LIg0L/RgNC+0YHRgtGL0YUg0KDQndCjIi4gKi8NCiAgICBkZWYgZGF0YVJvd3NTaW1wbGVJbmNvbWUgPSBnZXREYXRhKGdldEZvcm1EYXRhU3VtbWFyeU1hcChbMzA1XSlbMzA1XSk/LmFsbFNhdmVkDQogICAgaWYgKGRhdGFSb3dzU2ltcGxlSW5jb21lID09IG51bGwpIHsNCiAgICAgICAgZGF0YVJvd3NTaW1wbGVJbmNvbWUgPSBnZXREYXRhKGdldEZvcm1EYXRhU3VtbWFyeU1hcChbMzAxXSlbMzAxXSk/LmFsbFNhdmVkDQogICAgfQ0KDQogICAgLyoqINCg0LDRgdGF0L7QtNGLINGB0LvQvtC20L3Ri9C1INGD0YDQvtCy0L3RjyDQkdCw0L3QutCwICLQodCy0L7QtNC90LDRjyDRhNC+0YDQvNCwINC90LDRh9C40YHQu9C10L3QvdGL0YUg0YDQsNGB0YXQvtC00L7QsiIuICovDQogICAgZGVmIGRhdGFSb3dzQ29tcGxleENvbnN1bXB0aW9uID0gZ2V0RGF0YShnZXRGb3JtRGF0YVN1bW1hcnlNYXAoWzMwM10pWzMwM10pPy5hbGxTYXZlZA0KDQogICAgLyoqINCg0LDRgdGF0L7QtNGLINC/0YDQvtGB0YLRi9C1INGD0YDQvtCy0L3RjyDQkdCw0L3QutCwICLQoNCw0YHRiNC40YTRgNC+0LLQutCwINCy0LjQtNC+0LIg0YDQsNGB0YXQvtC00L7Qsiwg0YPRh9C40YLRi9Cy0LDQtdC80YvRhSDQsiDQv9GA0L7RgdGC0YvRhSDQoNCd0KMiLiAqLw0KICAgIGRlZiBkYXRhUm93c1NpbXBsZUNvbnN1bXB0aW9uID0gZ2V0RGF0YShnZXRGb3JtRGF0YVN1bW1hcnlNYXAoMzA0KVszMDRdKT8uYWxsQ2FjaGVkDQogICAgaWYgKGRhdGFSb3dzU2ltcGxlQ29uc3VtcHRpb24gPT0gbnVsbCkgew0KICAgICAgICBkYXRhUm93c1NpbXBsZUNvbnN1bXB0aW9uID0gZ2V0RGF0YShnZXRGb3JtRGF0YVN1bW1hcnlNYXAoWzMxMF0pWzMxMF0pPy5hbGxDYWNoZWQNCiAgICB9DQoNCiAgICAvKiog0JLRi9GA0YPRh9Cg0LXQsNC70KLQvtCyLiDQmtC+0LQg0YHRgtGA0L7QutC4INC00LXQutC70LDRgNCw0YbQuNC4IDE4MC4gKi8NCiAgICBkZWYgdmlydWNoUmVhbFRvdiA9IGVtcHR5DQogICAgLyoqINCU0L7RhdCU0L7Qs9C+0LLQlNCj0JguINCa0L7QtCDRgdGC0YDQvtC60Lgg0LTQtdC60LvQsNGA0LDRhtC40LggMjEwLiAqLw0KICAgIGRlZiBkb2hEb2xnb3ZEVUkgPSBlbXB0eQ0KICAgIC8qKiDQlNC+0YXQlNC+0LPQvtCy0JTQo9CYX9CS0L3QoC4g0JrQvtC0INGB0YLRgNC+0LrQuCDQtNC10LrQu9Cw0YDQsNGG0LjQuCAyMTEuICovDQogICAgZGVmIGRvaERvbGdvdkRVSV9WblIgPSBlbXB0eQ0KICAgIC8qKiDQo9Cx0YvRgtCe0LHQntCx0YHQu9Cd0LXQvtCx0LsuINCa0L7QtCDRgdGC0YDQvtC60Lgg0LTQtdC60LvQsNGA0LDRhtC40LggMjAxLiAqLw0KICAgIGRlZiB1Yml0T2JPYnNsTmVvYmwgPSBlbXB0eQ0KICAgIC8qKiDQo9Cx0YvRgtCU0L7Qs9C+0LLQlNCj0JguINCa0L7QtCDRgdGC0YDQvtC60Lgg0LTQtdC60LvQsNGA0LDRhtC40LggMjMwLiAqLw0KICAgIGRlZiB1Yml0RG9nb3ZEVUkgPSBlbXB0eQ0KICAgIC8qKiDQo9Cx0YvRgtCf0YDQvtGI0J/QtdGALiDQmtC+0LQg0YHRgtGA0L7QutC4INC00LXQutC70LDRgNCw0YbQuNC4IDMwMS4gKi8NCiAgICBkZWYgdWJpdFByb3NoUGVyID0gZW1wdHkNCiAgICAvKiog0KHRg9C80JHQtdC30L3QsNC00JTQvtC70LMuINCa0L7QtCDRgdGC0YDQvtC60Lgg0LTQtdC60LvQsNGA0LDRhtC40LggMzAyLiAqLw0KICAgIGRlZiBzdW1CZXpuYWxEb2xnID0gZW1wdHkNCiAgICAvKiog0KPQsdGL0YLQn9GA0LjRgNCw0LLQvdCS0YEuINCa0L7QtCDRgdGC0YDQvtC60Lgg0LTQtdC60LvQsNGA0LDRhtC40LggMzAwLiAqLw0KICAgIGRlZiB1Yml0UHJpcmF2blZzID0gdWJpdFByb3NoUGVyICsgc3VtQmV6bmFsRG9sZw0KDQogICAgLyoqINCS0YvRgNGD0YfQoNC10LDQu9CQ0JguINCa0L7QtCDRgdGC0YDQvtC60Lgg0LTQtdC60LvQsNGA0LDRhtC40LggMDMwLiDQmtC+0LQg0LLQuNC00LAg0LTQvtGF0L7QtNCwID0gMTA5MTAuICovDQogICAgZGVmIHZpcnVjaFJlYWxBSSA9IGdldExvbmcoZ2V0Q29tcGxleEluY29tZVN1bVJvd3M5KGRhdGFSb3dzQ29tcGxleEluY29tZSwgWzEwOTEwXSkpDQogICAgLyoqINCj0LHRi9GC0KDQtdCw0LvQkNCYLiDQmtC+0LQg0YHRgtGA0L7QutC4INC00LXQutC70LDRgNCw0YbQuNC4IDA2MC4g0JrQvtC0INCy0LjQtNCwINGA0LDRgdGF0L7QtNCwID0gMjE0MjAuICovDQogICAgZGVmIHViaXRSZWFsQUkgPSBnZXRMb25nKGdldENvbXBsZXhDb25zdW1wdGlvblN1bVJvd3M5KGRhdGFSb3dzQ29tcGxleENvbnN1bXB0aW9uLCBbMjE0MjBdKSkNCiAgICAvKiog0KbQtdC90KDQtdCw0LvQn9GA0JfQoy4g0JrQvtC0INGB0YLRgNC+0LrQuCDQtNC10LrQu9Cw0YDQsNGG0LjQuCAyNDAuINCa0L7QtCDQstC40LTQsCDQtNC+0YXQvtC00LAgPSAxMDk1MC4gKi8NCiAgICBkZWYgY2VuUmVhbFByWlUgPSBnZXRMb25nKGdldENvbXBsZXhJbmNvbWVTdW1Sb3dzOShkYXRhUm93c0NvbXBsZXhJbmNvbWUsIFsxMDk1MF0pKQ0KICAgIC8qKiDQo9Cx0YvRgtCg0LXQsNC70J/RgNCX0KMuINCa0L7QtCDRgdGC0YDQvtC60Lgg0LTQtdC60LvQsNGA0LDRhtC40LggMjYwLiDQoSAxINC60LLQsNGA0YLQsNC70LAgMjAxNiDQs9C+0LTQsCDQvdC1INC30LDQv9C+0LvQvdGP0LXRgtGB0Y8uICovDQogICAgZGVmIHViaXRSZWFsUHJaVSA9IGVtcHR5DQogICAgLyoqINCS0YvRgNGD0YfQoNC10LDQu9Cf0KLQlNC+0KHRgC4g0JrQvtC0INGB0YLRgNC+0LrQuCDQtNC10LrQu9Cw0YDQsNGG0LjQuCAxMDAuINCa0L7QtCDQstC40LTQsCDQtNC+0YXQvtC00LAgPSAxMDk3MC4gKi8NCiAgICBkZWYgdmlydWNoUmVhbFBURG9TciA9IGdldExvbmcoZ2V0Q29tcGxleEluY29tZVN1bVJvd3M5KGRhdGFSb3dzQ29tcGxleEluY29tZSwgWzEwOTcwXSkpDQogICAgLyoqINCS0YvRgNGD0YfQoNC10LDQu9Cf0KLQn9C+0YHQodGALiDQmtC+0LQg0YHRgtGA0L7QutC4INC00LXQutC70LDRgNCw0YbQuNC4IDExMC4g0JrQvtC0INCy0LjQtNCwINC00L7RhdC+0LTQsCA9IDEwODcwLiDQndC1INC30LDQv9C+0LvQvdGP0LXRgtGB0Y8g0YEgMjAxNSDQs9C+0LTQsC4gKi8NCiAgICBkZWYgdmlydWNoUmVhbFBUUG9zU3IgPSBnZXRMb25nKDApDQogICAgLyoqINCj0LHRi9GCMdCf0YDQtdCyMjY5LiDQmtC+0LQg0YHRgtGA0L7QutC4INC00LXQutC70LDRgNCw0YbQuNC4IDE1MC4g0JrQvtC0INCy0LjQtNCwINGA0LDRgdGF0L7QtNCwID0gMjEwNzAuICovDQogICAgZGVmIHViaXQxUHJldjI2OSA9IGdldExvbmcoZ2V0Q29tcGxleENvbnN1bXB0aW9uU3VtUm93czkoZGF0YVJvd3NDb21wbGV4Q29uc3VtcHRpb24sIFsyMTA3MF0pKQ0KICAgIC8qKiDQo9Cx0YvRgjLQoNC10LDQu9Cf0KIuINCa0L7QtCDRgdGC0YDQvtC60Lgg0LTQtdC60LvQsNGA0LDRhtC40LggMTYwLiDQmtC+0LQg0LLQuNC00LAg0YDQsNGB0YXQvtC00LAgPSAyMTUxMC4gKi8NCiAgICBkZWYgdWJpdDJSZWFsUFQgPSBlbXB0eQ0KDQogICAgLyoqINCS0YvRgNCg0LXQsNC70KLQvtCy0KHQvtCxLiDQmtC+0LQg0YHRgtGA0L7QutC4INC00LXQutC70LDRgNCw0YbQuNC4IDAxMS4gKi8NCiAgICBkZWYgdmlyUmVhbFRvdlNvYiA9IGdldFZpclJlYWxUb3ZTb2IoZGF0YVJvd3NDb21wbGV4SW5jb21lLCBkYXRhUm93c1NpbXBsZUluY29tZSkNCiAgICAvKiog0JLRi9GA0KDQtdCw0LvQmNC80J/RgNCw0LIuINCh0YLRgNC+0LrQsCDQtNC10LrQu9Cw0YDQsNGG0LjQuCAwMTMuINCa0L7QtCDQstC40LTQsCDQtNC+0YXQvtC00LAgPSAxMDk0MCwgMTA5NjAsIDEwOTgwLiAqLw0KICAgIGRlZiB2aXJSZWFsSW1QcmF2ID0gZ2V0TG9uZyhnZXRDb21wbGV4SW5jb21lU3VtUm93czkoZGF0YVJvd3NDb21wbGV4SW5jb21lLCBbMTA5NDAsIDEwOTYwLCAxMDk4MF0pKQ0KICAgIC8qKiDQktGL0YDQoNC10LDQu9CY0LzQn9GA0L7Rhy4g0KHRgtGA0L7QutCwINC00LXQutC70LDRgNCw0YbQuNC4IDAxNC4g0JrQvtC0INCy0LjQtNCwINC00L7RhdC+0LTQsCA9IDEwOTMwLiAqLw0KICAgIGRlZiB2aXJSZWFsSW1Qcm9jaCA9IGdldExvbmcoZ2V0Q29tcGxleEluY29tZVN1bVJvd3M5KGRhdGFSb3dzQ29tcGxleEluY29tZSwgWzEwOTMwXSkpDQogICAgLyoqINCS0YvRgNCg0LXQsNC70JLRgS4g0JrQvtC0INGB0YLRgNC+0LrQuCDQtNC10LrQu9Cw0YDQsNGG0LjQuCAwMTAuICovDQogICAgZGVmIHZpclJlYWxWcyA9IHZpclJlYWxUb3ZTb2IgKyB2aXJSZWFsSW1QcmF2ICsgdmlyUmVhbEltUHJvY2gNCiAgICAvKiog0JLRi9GA0KDQtdCw0LvQptCR0JLRgS4g0JrQvtC0INGB0YLRgNC+0LrQuCDQtNC10LrQu9Cw0YDQsNGG0LjQuCAwMjAuINCa0L7QtCDQstC40LTQsCDQtNC+0YXQvtC00LAgPSAxMTA0MCwgMTEwNTAsIDExMDYwLCAxMTA3MCwgMTEwODAsIDExMDkwLCAxMTEwMCwgMTExMTAuICovDQogICAgZGVmIHZpclJlYWxDQlZzID0gZ2V0TG9uZyhnZXRDb21wbGV4SW5jb21lU3VtUm93czkoZGF0YVJvd3NDb21wbGV4SW5jb21lLCBbMTEwNDAsIDExMDUwLCAxMTA2MCwgMTEwNzAsIDExMDgwLCAxMTA5MCwgMTExMDAsIDExMTEwXSkpDQogICAgLyoqINCS0YvRgNCg0LXQsNC70J/RgNC10LQuINCa0L7QtCDRgdGC0YDQvtC60Lgg0LTQtdC60LvQsNGA0LDRhtC40LggMDIzLiAqLw0KICAgIGRlZiB2aXJSZWFsUHJlZCA9IGVtcHR5DQogICAgLyoqINCS0YvRgNGD0YfQntC/MzAy0JjRgi4g0JrQvtC0INGB0YLRgNC+0LrQuCDQtNC10LrQu9Cw0YDQsNGG0LjQuCAzNDAuINCh0YLRgNC+0LrQsCAwMzAgKyDRgdGC0YDQvtC60LAgMTAwICsg0YHRgtGA0L7QutCwIDExMCArINGB0YLRgNC+0LrQsCAxODAgKyAo0YHRgtGA0L7QutCwIDIxMCDigJMg0YHRgtGA0L7QutCwIDIxMSkgKyDRgdGC0YDQvtC60LAgMjQwLiAqLw0KICAgIGRlZiB2aXJ1Y2hPcDMwMkl0ID0gdmlydWNoUmVhbEFJICsgdmlydWNoUmVhbFBURG9TciArIHZpcnVjaFJlYWxQVFBvc1NyICsgdmlydWNoUmVhbFRvdiArIGRvaERvbGdvdkRVSSAtIGRvaERvbGdvdkRVSV9WblIgKyBjZW5SZWFsUHJaVQ0KDQogICAgLyoqINCU0L7RhdCg0LXQsNC7LCDQktGL0YDQoNC10LDQu9CY0YLQvtCzLiAqLw0KICAgIGRlZiBkb2hSZWFsID0gdmlyUmVhbFZzICsgdmlyUmVhbENCVnMgKyB2aXJSZWFsUHJlZCArIHZpcnVjaE9wMzAySXQNCiAgICAvKiog0JTQvtGF0JLQvdC10YDQtdCw0LsuINCa0L7QtCDRgdGC0YDQvtC60Lgg0LTQtdC60LvQsNGA0LDRhtC40LggMTAwLiAqLw0KICAgIGRlZiBkb2hWbmVyZWFsID0gZ2V0RG9oVm5lcmVhbChkYXRhUm93c0NvbXBsZXhJbmNvbWUsIGRhdGFSb3dzU2ltcGxlSW5jb21lKQ0KICAgIC8qKiDQn9GA0Y/QvNCg0LDRgdGF0KDQtdCw0LsuINCa0L7QtCDRgdGC0YDQvtC60Lgg0LTQtdC60LvQsNGA0LDRhtC40LggMDEwLiAqLw0KICAgIGRlZiBwcmFtUmFzaFJlYWwgPSBlbXB0eQ0KICAgIC8qKiDQn9GA0Y/QvNCg0LDRgdGF0KLQvtGA0LPQktGBLiDQmtC+0LQg0YHRgtGA0L7QutC4INC00LXQutC70LDRgNCw0YbQuNC4IDAyMC4gKi8NCiAgICBkZWYgcHJhbVJhc2hUb3JnVnMgPSBlbXB0eQ0KICAgIC8qKiDQmtC+0YHQstCg0LDRgdGF0JLRgS4g0JrQvtC0INGB0YLRgNC+0LrQuCDQtNC10LrQu9Cw0YDQsNGG0LjQuCAwNDAuICovDQogICAgZGVmIGNvc3ZSYXNoVnMgPSBnZXRDb3N2UmFzaFZzKGRhdGFSb3dzQ29tcGxleENvbnN1bXB0aW9uLCBkYXRhUm93c1NpbXBsZUNvbnN1bXB0aW9uKQ0KICAgIC8qKiDQoNCw0YHRhdCS0L3QtdGA0LXQsNC70JLQoS4g0KHRgtGA0L7QutCwIDIwMC4gKi8NCiAgICBkZWYgcmFzaFZuZXJlYWxWcyA9IGdldFJhc2hWbmVyZWFsVnMoZGF0YVJvd3NDb21wbGV4Q29uc3VtcHRpb24sIGRhdGFSb3dzU2ltcGxlQ29uc3VtcHRpb24pDQogICAgLyoqINCg0LDRgdGF0JLQvdC10YDQtdCw0LsuINCh0YLRgNC+0LrQsCAyMDAgKyDRgdGC0YDQvtC60LAgMzAwLiAqLw0KICAgIGRlZiByYXNoVm5lcmVhbCA9IHJhc2hWbmVyZWFsVnMgKyB1Yml0UHJpcmF2blZzDQogICAgLyoqINCe0YHRgtCh0YLQoNC10LDQu9CQ0JguINCa0L7QtCDRgdGC0YDQvtC60Lgg0LTQtdC60LvQsNGA0LDRhtC40LggMDQwLiDQmtC+0LQg0LLQuNC00LAg0YDQsNGB0YXQvtC00LAgPSAyMTQwMC4gKi8NCiAgICBkZWYgb3N0U3RSZWFsQUkgPSBnZXRMb25nKGdldENvbXBsZXhDb25zdW1wdGlvblN1bVJvd3M5KGRhdGFSb3dzQ29tcGxleENvbnN1bXB0aW9uLCBbMjE0MDBdKSkNCiAgICAvKiog0KDQtdCw0LvQmNC80YPRidCf0YDQsNCyLiDQmtC+0LQg0YHRgtGA0L7QutC4INC00LXQutC70LDRgNCw0YbQuNC4IDA1OS4g0JrQvtC0INCy0LjQtNCwINGA0LDRgdGF0L7QtNCwID0gMjEwODAsIDIxMTAwLCAyMTM5MC4gKi8NCiAgICBkZWYgcmVhbEltdXNoUHJhdiA9IGdldExvbmcoZ2V0Q29tcGxleENvbnN1bXB0aW9uU3VtUm93czkoZGF0YVJvd3NDb21wbGV4Q29uc3VtcHRpb24sIFsyMTA4MCwgMjExMDAsIDIxMzkwXSkpDQogICAgLyoqINCf0YDQuNC+0LHRgNCg0LXQsNC70JjQvNGD0YkuINCa0L7QtCDRgdGC0YDQvtC60Lgg0LTQtdC60LvQsNGA0LDRhtC40LggMDYwLiDQmtC+0LQg0LLQuNC00LAg0YDQsNGB0YXQvtC00LAgPSAyMTQxMC4gKi8NCiAgICBkZWYgcHJpb2JyUmVhbEltdXNoID0gZ2V0TG9uZyhnZXRDb21wbGV4Q29uc3VtcHRpb25TdW1Sb3dzOShkYXRhUm93c0NvbXBsZXhDb25zdW1wdGlvbiwgWzIxNDEwXSkpDQogICAgLyog0JDQutGC0LjQstCg0LXQsNC70J/RgNC10LQuINCa0L7QtCDRgdGC0YDQvtC60Lgg0LTQtdC60LvQsNGA0LDRhtC40LggMDYxLiAqLw0KICAgIGRlZiBhY3RpdlJlYWxQcmVkID0gZW1wdHkNCiAgICAvKiog0J/RgNC40L7QsdCg0LXQsNC70KbQkS4g0JrQvtC0INGB0YLRgNC+0LrQuCDQtNC10LrQu9Cw0YDQsNGG0LjQuCAwNzAuINCa0L7QtCDQstC40LTQsCDRgNCw0YHRhdC+0LTQsCA9IDIxMjMwLCAyMTI0MCwgMjEyNTAsIDIxMjYwLCAyMTI3MCwgMjEyODAsIDIxMjkwLCAyMTMwMCwgMjEzMTAuICovDQogICAgZGVmIHByaW9iclJlYWxDQiA9IGdldExvbmcoZ2V0Q29tcGxleENvbnN1bXB0aW9uU3VtUm93czkoZGF0YVJvd3NDb21wbGV4Q29uc3VtcHRpb24sIFsyMTIzMCwgMjEyNDAsIDIxMjUwLCAyMTI2MCwgMjEyNzAsIDIxMjgwLCAyMTI5MCwgMjEzMDAsIDIxMzEwXSkpDQoNCiAgICAvKiog0KPQsdGL0YLQn9GA0L7RiNCe0LHRgdC7LiDQmtC+0LQg0YHRgtGA0L7QutC4INC00LXQutC70LDRgNCw0YbQuNC4IDA5MC4gKi8NCiAgICBkZWYgdWJpdFByb3NoT2JzbCA9IGVtcHR5DQogICAgLyoqINCh0YLQvtC40LzQoNC10LDQu9Cf0KLQlNC+0KHRgC4g0JrQvtC0INGB0YLRgNC+0LrQuCDQtNC10LrQu9Cw0YDQsNGG0LjQuCAxMjAuINCa0L7QtCDQstC40LTQsCDRgNCw0YHRhdC+0LTQsCA9IDIxMDUwLiAqLw0KICAgIGRlZiBzdG9pbVJlYWxQVERvU3IgPSBnZXRMb25nKGdldENvbXBsZXhDb25zdW1wdGlvblN1bVJvd3M5KGRhdGFSb3dzQ29tcGxleENvbnN1bXB0aW9uLCBbMjEwNTBdKSkNCiAgICAvKiog0KHRgtC+0LjQvNCg0LXQsNC70J/QotCf0L7RgdCh0YAuINCa0L7QtCDRgdGC0YDQvtC60Lgg0LTQtdC60LvQsNGA0LDRhtC40LggMTMwLiDQmtC+0LQg0LLQuNC00LAg0YDQsNGB0YXQvtC00LAgPSAyMTQ3MC4g0J3QtSDQt9Cw0L/QvtC70L3Rj9C10YLRgdGPINGBIDIwMTUg0LPQvtC00LAuICovDQogICAgZGVmIHN0b2ltUmVhbFBUUG9zU3IgPSBnZXRMb25nKDApDQogICAgLyoqINCg0LDRgdGF0KDQtdCw0LvQotC+0LIuINCa0L7QtCDRgdGC0YDQvtC60Lgg0LTQtdC60LvQsNGA0LDRhtC40LggMTkwLiAqLw0KICAgIGRlZiByYXNoUmVhbFRvdiA9IGVtcHR5DQogICAgLyoqINCg0LDRgdGF0JTQvtCz0L7QstCU0KPQmC4g0JrQvtC0INGB0YLRgNC+0LrQuCDQtNC10LrQu9Cw0YDQsNGG0LjQuCAyMjAuICovDQogICAgZGVmIHJhc2hEb2xnb3ZEVUkgPSBlbXB0eQ0KICAgIC8qKiDQoNCw0YHRhdCU0L7Qs9C+0LLQlNCj0Jhf0JLQvdCgLiDQmtC+0LQg0YHRgtGA0L7QutC4INC00LXQutC70LDRgNCw0YbQuNC4IDIyMS4gKi8NCiAgICBkZWYgcmFzaERvbGdvdkRVSV9WblIgPSBlbXB0eQ0KICAgIC8qKiDQndC10JLQvtC30JfQsNGC0YDQn9GA0JfQoy4g0JrQvtC0INGB0YLRgNC+0LrQuCDQtNC10LrQu9Cw0YDQsNGG0LjQuCAyNTAuINChIDEg0LrQstCw0YDRgtCw0LvQsCAyMDE2INCz0L7QtNCwINC90LUg0LfQsNC/0L7Qu9C90Y/QtdGC0YHRjy4gKi8NCiAgICBkZWYgbmVWb3paYXRyUHJaVSA9IGVtcHR5DQogICAgLyoqINCg0LDRgdGF0J7Qv9C10YAzMiwg0KDQsNGB0YXQntC/MzAy0JjRgi4g0JrQvtC0INGB0YLRgNC+0LrQuCDQtNC10LrQu9Cw0YDQsNGG0LjQuCA9IDA4MCDQuNC70LggMzUwLiAqLw0KICAgIGRlZiByYXNoT3BlcjMyID0gb3N0U3RSZWFsQUkgKyBzdG9pbVJlYWxQVERvU3IgKyBzdG9pbVJlYWxQVFBvc1NyICsgcmFzaFJlYWxUb3YgKyAocmFzaERvbGdvdkRVSSAtIHJhc2hEb2xnb3ZEVUlfVm5SKSArIG5lVm96WmF0clByWlUNCiAgICAvKiog0KPQsdGL0YLQoNC10LDQu9CQ0LzQmNC8LiDQmtC+0LQg0YHRgtGA0L7QutC4INC00LXQutC70LDRgNCw0YbQuNC4IDEwMC4g0JrQvtC0INCy0LjQtNCwINGA0LDRgdGF0L7QtNCwID0gMjExMTAuICovDQogICAgZGVmIHViaXRSZWFsQW1JbSA9IGdldExvbmcoZ2V0Q29tcGxleENvbnN1bXB0aW9uU3VtUm93czkoZGF0YVJvd3NDb21wbGV4Q29uc3VtcHRpb24sIFsyMTExMF0pKQ0KICAgIC8qKiDQo9Cx0YvRgtCg0LXQsNC70JfQtdC80KPRhy4g0JrQvtC0INGB0YLRgNC+0LrQuCDQtNC10LrQu9Cw0YDQsNGG0LjQuCAxMTAuICovDQogICAgZGVmIHViaXRSZWFsWmVtVWNoID0gZW1wdHkNCiAgICAvKiog0J3QsNC00LHQn9C+0LrQn9GA0LXQtC4g0JrQvtC0INGB0YLRgNC+0LrQuCDQtNC10LrQu9Cw0YDQsNGG0LjQuCAxMjAuICovDQogICAgZGVmIG5hZGJQb2tQcmVkID0gZW1wdHkNCiAgICAvKiog0KDQsNGB0YXQo9C80KDQtdCw0LssINCg0LDRgdGF0J/RgNC40LfQvdCY0YLQvtCz0L4uINCa0L7QtCDRgdGC0YDQvtC60Lgg0LTQtdC60LvQsNGA0LDRhtC40LggMTMwLiAqLw0KICAgIGRlZiByYXNoVW1SZWFsID0gcHJhbVJhc2hSZWFsICsgcHJhbVJhc2hUb3JnVnMgKyBjb3N2UmFzaFZzICsgcmVhbEltdXNoUHJhdiArDQogICAgICAgICAgICBwcmlvYnJSZWFsSW11c2ggKyBhY3RpdlJlYWxQcmVkICsgcHJpb2JyUmVhbENCICsgcmFzaE9wZXIzMiArIHViaXRQcm9zaE9ic2wgKw0KICAgICAgICAgICAgdWJpdFJlYWxBbUltICsgdWJpdFJlYWxaZW1VY2ggKyBuYWRiUG9rUHJlZA0KICAgIC8qKiDQo9Cx0YvRgtC60LgsINCj0LHRi9GC0J7QvzMwMi4g0JrQvtC0INGB0YLRgNC+0LrQuCDQtNC10LrQu9Cw0YDQsNGG0LjQuCAzNjAuIEPRgtGA0L7QutCwIDA2MCArINGB0YLRgNC+0LrQsCAxNTAgKyDRgdGC0YDQvtC60LAgMTYwICsg0YHRgtGA0L7QutCwIDIwMSsg0YHRgtGA0L7QutCwIDIzMCArINGB0YLRgNC+0LrQsCAyNjAuICovDQogICAgZGVmIHViaXRraSA9IHViaXRSZWFsQUkgKyB1Yml0MVByZXYyNjkgKyB1Yml0MlJlYWxQVCArIHViaXRPYk9ic2xOZW9ibCArIHViaXREb2dvdkRVSSArIHViaXRSZWFsUHJaVQ0KICAgIC8qKiDQn9GA0LjQsdCj0LEuICovDQogICAgZGVmIHByaWJVYiA9IGRvaFJlYWwgKyBkb2hWbmVyZWFsIC0gcmFzaFVtUmVhbCAtIHJhc2hWbmVyZWFsICsgdWJpdGtpDQogICAgLyoqINCU0L7RhdCY0YHQutC70J/RgNC40LEuICovDQogICAgZGVmIGRvaElza2xQcmliID0gZ2V0RG9oSXNrbFByaWIoZGF0YVJvd3NDb21wbGV4SW5jb21lLCBkYXRhUm93c1NpbXBsZUluY29tZSkNCiAgICAvLyDQndCw0LvQkdCw0LfQsCDRgdGC0YDQvtC60LAgNjAgLSDRgdGC0YDQvtC60LAgNzAgLSDRgdGC0YDQvtC60LAgODAgLSDRgdGC0YDQvtC60LAgOTAgLSDRgdGC0YDQvtC60LAgNDAwICjQn9GA0LjQu9C+0LbQtdC90LjQtSDihJYyINC6INCb0LjRgdGC0YMgMDIpDQogICAgZGVmIG5hbEJhemEgPSBwcmliVWIgLSBkb2hJc2tsUHJpYiAtIDAgLSAwIC0gMA0KICAgIC8qKiDQndCw0LvQkdCw0LfQsNCY0YHRhywg0J3QsNC70JHQsNC30LDQntGA0LMuICovDQogICAgZGVmIG5hbEJhemFJc2NoID0gZ2V0TmFsQmF6YUlzY2gobmFsQmF6YSwgMCkNCg0KICAgIHRheEJhc2VBc0RlY2xhcmF0aW9uID0gbmFsQmF6YUlzY2gNCiAgICByZXR1cm4gdGF4QmFzZUFzRGVjbGFyYXRpb24NCn0NCg0KDQpkZWYgZ2V0RG9oVm5lcmVhbChkZWYgZGF0YVJvd3MsIGRlZiBkYXRhUm93c1NpbXBsZSkgew0KICAgIGRlZiByZXN1bHQgPSAwLjANCg0KICAgIC8vINCa0L7QtCDQstC40LTQsCDQtNC+0YXQvtC00LAgPSAxNDEyMCwgMTUxNzAsIDE1MTgwLCAxNTE5MCwgMTUyMDAsIDE1MjEwLCAxNTIyMCwgMTUyMzAsDQogICAgLy8gMTYxMTAsIDE2MTIwLCAxNjEzMCwgMTYxNDAsIDE2MjgwLCAxNjI5MCwgMTYzMDAsIDE2MzEwLCAxNjQyMCwgMTY0MzAsIDE2NDQwLCAxNjQ1MCwgMTY0NjAsIDE2NDcwLCAxNjQ4MCwNCiAgICAvLyAxNjQ5MCwgMTY1MDAsIDE2NTEwLCAxNjUyMCwgMTY1MzAsIDE2NTQwLCAxNjU1MCwgMTY1NjAsIDE2NTcwLCAxNjU4MCwgMTY1OTAsIDE2NjAwLCAxNjY2MCwgMTY2NzAsIDE2OTcwLA0KICAgIC8vIDE2OTgwLCAxNjk5MCwgMTcwMDAsIDE3MDEwLCAxNzAyMCwgMTcwMzAsIDE3MDQwLCAxNzA1MCwgMTcwNjAsIDE3MDcwLCAxNzA4MCwgMTcwOTAsIDE3MTAwLCAxNzExMCwgMTcxMjANCiAgICByZXN1bHQgKz0gZ2V0Q29tcGxleEluY29tZVN1bVJvd3M5KGRhdGFSb3dzLCBbMTQxMjAsIDE1MTcwLCAxNTE4MCwgMTUxOTAsIDE1MjAwLCAxNTIxMCwgMTUyMjAsIDE1MjMwLA0KICAgICAgICAgICAgMTYxMTAsIDE2MTIwLCAxNjEzMCwgMTYxNDAsIDE2MjgwLCAxNjI5MCwgMTYzMDAsIDE2MzEwLCAxNjQyMCwgMTY0MzAsIDE2NDQwLCAxNjQ1MCwgMTY0NjAsIDE2NDcwLCAxNjQ4MCwNCiAgICAgICAgICAgIDE2NDkwLCAxNjUwMCwgMTY1MTAsIDE2NTIwLCAxNjUzMCwgMTY1NDAsIDE2NTUwLCAxNjU2MCwgMTY1NzAsIDE2NTgwLCAxNjU5MCwgMTY2MDAsIDE2NjYwLCAxNjY3MCwgMTY5NzAsDQogICAgICAgICAgICAxNjk4MCwgMTY5OTAsIDE3MDAwLCAxNzAxMCwgMTcwMjAsIDE3MDMwLCAxNzA0MCwgMTcwNTAsIDE3MDYwLCAxNzA3MCwgMTcwODAsIDE3MDkwLCAxNzEwMCwgMTcxMTAsIDE3MTIwXSkNCg0KICAgIC8vINCa0L7QtCDQstC40LTQsCDQtNC+0YXQvtC00LAgPSAxNDAwMCwgMTQwMTAsIDE0MDIwLCAxNDAzMCwgMTQwNDAsIDE0MDUwLCAxNDA2MCwgMTQwNzAsIDE0MDgwLA0KICAgIC8vIDE0MDkwLCAxNDEwMCwgMTQxMTAsIDE0MTMwLCAxNDE0MCwgMTQxNTAsIDE0MTYwLCAxNDE3MCwgMTQxODAsIDE0MTkwLCAxNDIwMCwgMTQyMTAsIDE0MjIwLCAxNDIzMCwgMTQyNDAsDQogICAgLy8gMTQyNTAsIDE0MjYwLCAxNDI3MCwgMTQyODAsIDE0MjkwLCAxNDMwMCwgMTQzMTAsIDE0MzIwLCAxNDMzMCwgMTQzNDAsIDE0MzUwLCAxNDM2MCwgMTQzNzAsIDE0MzgwLCAxNDM5MCwNCiAgICAvLyAxNDQwMCwgMTQ0MTAsIDE0NDIwLCAxNDQzMCwgMTQ0NDAsIDE0NDUwLCAxNDQ2MCwgMTQ0NzAsIDE0NDgwLCAxNDQ5MCwgMTQ1MDAsIDE0NTEwLCAxNDUyMCwgMTQ1MzAsIDE0NTQwLA0KICAgIC8vIDE0NTUwLCAxNDU2MCwgMTQ1NzAsIDE0NTgwLCAxNDU5MCwgMTQ2MDAsIDE0NjEwLCAxNDYyMCwgMTQ2MzAsIDE0NjQwLCAxNDY1MCwgMTQ2NjAsIDE0NjcwLCAxNDY4MCwgMTQ2OTAsDQogICAgLy8gMTQ3MDAsIDE0NzEwLCAxNDcyMCwgMTQ3MzAsIDE0NzQwLCAxNDc1MCwgMTQ3NjAsIDE0NzcwLCAxNDc4MCwgMTQ3OTAsIDE0ODAwLCAxNDgxMCwgMTQ4MjAsIDE0ODMwLCAxNDg0MCwNCiAgICAvLyAxNDg1MCwgMTQ4NjAsIDE0ODcwLCAxNDg4MCwgMTQ4OTAsIDE0OTAwLCAxNDkxMCwgMTQ5MjAsIDE0OTMwLCAxNDk0MCwgMTQ5NTAsIDE0OTYwLCAxNDk3MCwgMTQ5ODAsIDE0OTkwLA0KICAgIC8vIDE1MDAwLCAxNTAxMCwgMTUwMjAsIDE1MDMwLCAxNTA0MCwgMTUwNTAsIDE1MDYwLCAxNTA3MCwgMTUwODAsIDE1MDkwLCAxNTEwMCwgMTUxMTAsIDE1MTIwLCAxNTEzMCwgMTUxNDAsDQogICAgLy8gMTUxNTAsIDE1MTYwLCAxNTI2MCwgMTUyNzAsIDE1MjgwLCAxNTI5MCwgMTUzMDAsIDE1MzEwLCAxNTMyMCwgMTUzMzAsIDE1MzQwLCAxNTM1MCwgMTUzNjAsIDE1MzcwLCAxNTM4MCwNCiAgICAvLyAxNTM5MCwgMTU0MDAsIDE1NDEwLCAxNTQyMCwgMTU0MzAsIDE1NDQwLCAxNTQ1MCwgMTU0NjAsIDE1NDcwLCAxNTQ4MCwgMTU0OTAsIDE1NTAwLCAxNTUxMCwgMTU1MjAsIDE1NTMwLA0KICAgIC8vIDE1NTQwLCAxNTU1MCwgMTU1NjAsIDE1NTcwLCAxNTU4MCwgMTU1OTAsIDE1NjAwLCAxNTYxMCwgMTU2MjAsIDE1NjMwLCAxNTY0MCwgMTU2NTAsIDE1NjYwLCAxNTY3MCwgMTU2ODAsDQogICAgLy8gMTU2OTAsIDE1NzAwLCAxNTcxMCwgMTU3MjAsIDE1NzMwLCAxNTc0MCwgMTU3NTAsIDE1NzYwLCAxNTc3MCwgMTU3ODAsIDE1NzkwLCAxNTgwMCwgMTU4MTAsIDE1ODIwLCAxNTgzMCwNCiAgICAvLyAxNTg0MCwgMTU4NTAsIDE1ODYwLCAxNTg3MCwgMTU4ODAsIDE1ODkwLCAxNTkwMCwgMTU5MTAsIDE1OTIwLCAxNTkzMCwgMTU5NDAsIDE1OTUwLCAxNTk2MCwgMTU5NzAsIDE1OTgwLA0KICAgIC8vIDE1OTkwLCAxNjAwMCwgMTYwMTAsIDE2MDIwLCAxNjAzMCwgMTYwNDAsIDE2MDUwLCAxNjA2MCwgMTYwNzAsIDE2MDgwLCAxNjA5MCwgMTYxMDAsIDE2MTUwLCAxNjE2MCwgMTYxNzAsDQogICAgLy8gMTYxODAsIDE2MTkwLCAxNjIwMCwgMTYyMTAsIDE2MjIwLCAxNjIzMCwgMTYyNDAsIDE2MjUwLCAxNjI2MCwgMTYyNzAsIDE2MzIwLCAxNjMzMCwgMTYzNDAsIDE2MzUwLCAxNjM2MCwNCiAgICAvLyAxNjM3MCwgMTYzODAsIDE2MzkwLCAxNjQwMCwgMTY0MTAsIDE2NjEwLCAxNjYyMCwgMTY2MzAsIDE2NjQwLCAxNjY1MCwgMTY2ODAsIDE2NjkwLCAxNjcwMCwgMTY3MTAsIDE2NzIwLA0KICAgIC8vIDE2NzMwLCAxNjc0MCwgMTY3NTAsIDE2NzYwLCAxNjc3MCwgMTY3ODAsIDE2NzkwLCAxNjgwMCwgMTY4MTAsIDE2ODIwLCAxNjgzMCwgMTY4NDAsIDE2ODUwLCAxNjg2MCwgMTY4NzAsDQogICAgLy8gMTY4ODAsIDE2ODkwLCAxNjkwMCwgMTY5MTAsIDE2OTIwLCAxNjkzMCwgMTY5NDAsIDE2OTUwLCAxNjk2MCwgMTcxNjAsIDE3MTcwLCAxNzE4MCwgMTcxOTAsIDE3MjAwLCAxNzIxMCwNCiAgICAvLyAxNzIyMCwgMTcyMzAsIDE3MjQwLCAxNzI1MCwgMTcyNjAsIDE3MjcwLCAxNzI4MCwgMTcyOTAsIDE3MzAwLCAxNzMxMA0KICAgIHJlc3VsdCArPSBnZXRTaW1wbGVJbmNvbWVTdW1Sb3dzOChkYXRhUm93c1NpbXBsZSwgWzE0MDAwLCAxNDAxMCwgMTQwMjAsIDE0MDMwLCAxNDA0MCwgMTQwNTAsIDE0MDYwLCAxNDA3MCwgMTQwODAsDQogICAgICAgICAgICAxNDA5MCwgMTQxMDAsIDE0MTEwLCAxNDEzMCwgMTQxNDAsIDE0MTUwLCAxNDE2MCwgMTQxNzAsIDE0MTgwLCAxNDE5MCwgMTQyMDAsIDE0MjEwLCAxNDIyMCwgMTQyMzAsIDE0MjQwLA0KICAgICAgICAgICAgMTQyNTAsIDE0MjYwLCAxNDI3MCwgMTQyODAsIDE0MjkwLCAxNDMwMCwgMTQzMTAsIDE0MzIwLCAxNDMzMCwgMTQzNDAsIDE0MzUwLCAxNDM2MCwgMTQzNzAsIDE0MzgwLCAxNDM5MCwNCiAgICAgICAgICAgIDE0NDAwLCAxNDQxMCwgMTQ0MjAsIDE0NDMwLCAxNDQ0MCwgMTQ0NTAsIDE0NDYwLCAxNDQ3MCwgMTQ0ODAsIDE0NDkwLCAxNDUwMCwgMTQ1MTAsIDE0NTIwLCAxNDUzMCwgMTQ1NDAsDQogICAgICAgICAgICAxNDU1MCwgMTQ1NjAsIDE0NTcwLCAxNDU4MCwgMTQ1OTAsIDE0NjAwLCAxNDYxMCwgMTQ2MjAsIDE0NjMwLCAxNDY0MCwgMTQ2NTAsIDE0NjYwLCAxNDY3MCwgMTQ2ODAsIDE0NjkwLA0KICAgICAgICAgICAgMTQ3MDAsIDE0NzEwLCAxNDcyMCwgMTQ3MzAsIDE0NzQwLCAxNDc1MCwgMTQ3NjAsIDE0NzcwLCAxNDc4MCwgMTQ3OTAsIDE0ODAwLCAxNDgxMCwgMTQ4MjAsIDE0ODMwLCAxNDg0MCwNCiAgICAgICAgICAgIDE0ODUwLCAxNDg2MCwgMTQ4NzAsIDE0ODgwLCAxNDg5MCwgMTQ5MDAsIDE0OTEwLCAxNDkyMCwgMTQ5MzAsIDE0OTQwLCAxNDk1MCwgMTQ5NjAsIDE0OTcwLCAxNDk4MCwgMTQ5OTAsDQogICAgICAgICAgICAxNTAwMCwgMTUwMTAsIDE1MDIwLCAxNTAzMCwgMTUwNDAsIDE1MDUwLCAxNTA2MCwgMTUwNzAsIDE1MDgwLCAxNTA5MCwgMTUxMDAsIDE1MTEwLCAxNTEyMCwgMTUxMzAsIDE1MTQwLA0KICAgICAgICAgICAgMTUxNTAsIDE1MTYwLCAxNTI2MCwgMTUyNzAsIDE1MjgwLCAxNTI5MCwgMTUzMDAsIDE1MzEwLCAxNTMyMCwgMTUzMzAsIDE1MzQwLCAxNTM1MCwgMTUzNjAsIDE1MzcwLCAxNTM4MCwNCiAgICAgICAgICAgIDE1MzkwLCAxNTQwMCwgMTU0MTAsIDE1NDIwLCAxNTQzMCwgMTU0NDAsIDE1NDUwLCAxNTQ2MCwgMTU0NzAsIDE1NDgwLCAxNTQ5MCwgMTU1MDAsIDE1NTEwLCAxNTUyMCwgMTU1MzAsDQogICAgICAgICAgICAxNTU0MCwgMTU1NTAsIDE1NTYwLCAxNTU3MCwgMTU1ODAsIDE1NTkwLCAxNTYwMCwgMTU2MTAsIDE1NjIwLCAxNTYzMCwgMTU2NDAsIDE1NjUwLCAxNTY2MCwgMTU2NzAsIDE1NjgwLA0KICAgICAgICAgICAgMTU2OTAsIDE1NzAwLCAxNTcxMCwgMTU3MjAsIDE1NzMwLCAxNTc0MCwgMTU3NTAsIDE1NzYwLCAxNTc3MCwgMTU3ODAsIDE1NzkwLCAxNTgwMCwgMTU4MTAsIDE1ODIwLCAxNTgzMCwNCiAgICAgICAgICAgIDE1ODQwLCAxNTg1MCwgMTU4NjAsIDE1ODcwLCAxNTg4MCwgMTU4OTAsIDE1OTAwLCAxNTkxMCwgMTU5MjAsIDE1OTMwLCAxNTk0MCwgMTU5NTAsIDE1OTYwLCAxNTk3MCwgMTU5ODAsDQogICAgICAgICAgICAxNTk5MCwgMTYwMDAsIDE2MDEwLCAxNjAyMCwgMTYwMzAsIDE2MDQwLCAxNjA1MCwgMTYwNjAsIDE2MDcwLCAxNjA4MCwgMTYwOTAsIDE2MTAwLCAxNjE1MCwgMTYxNjAsIDE2MTcwLA0KICAgICAgICAgICAgMTYxODAsIDE2MTkwLCAxNjIwMCwgMTYyMTAsIDE2MjIwLCAxNjIzMCwgMTYyNDAsIDE2MjUwLCAxNjI2MCwgMTYyNzAsIDE2MzIwLCAxNjMzMCwgMTYzNDAsIDE2MzUwLCAxNjM2MCwNCiAgICAgICAgICAgIDE2MzcwLCAxNjM4MCwgMTYzOTAsIDE2NDAwLCAxNjQxMCwgMTY2MTAsIDE2NjIwLCAxNjYzMCwgMTY2NDAsIDE2NjUwLCAxNjY4MCwgMTY2OTAsIDE2NzAwLCAxNjcxMCwgMTY3MjAsDQogICAgICAgICAgICAxNjczMCwgMTY3NDAsIDE2NzUwLCAxNjc2MCwgMTY3NzAsIDE2NzgwLCAxNjc5MCwgMTY4MDAsIDE2ODEwLCAxNjgyMCwgMTY4MzAsIDE2ODQwLCAxNjg1MCwgMTY4NjAsIDE2ODcwLA0KICAgICAgICAgICAgMTY4ODAsIDE2ODkwLCAxNjkwMCwgMTY5MTAsIDE2OTIwLCAxNjkzMCwgMTY5NDAsIDE2OTUwLCAxNjk2MCwgMTcxNjAsIDE3MTcwLCAxNzE4MCwgMTcxOTAsIDE3MjAwLCAxNzIxMCwNCiAgICAgICAgICAgIDE3MjIwLCAxNzIzMCwgMTcyNDAsIDE3MjUwLCAxNzI2MCwgMTcyNzAsIDE3MjgwLCAxNzI5MCwgMTczMDAsIDE3MzEwXSkNCg0KICAgIC8vINCa0L7QtCDQstC40LTQsCDQtNC+0YXQvtC00LAgPSAxNDE5MCwgMTQyMDAsIDE0MjEwLCAxNDIyMCwgMTQyNDAsIDE0MjUwLCAxNTI0MCwgMTUyNTAsIDE3MTMwLCAxNzE0MCwNCiAgICAvLyAxNzE1MCwgMTcyNTAsIDE3MjYwLCAxNzI3MCwgMTcyODAsIDE3MzAwLCAxNzMxMCwgMTczMjANCiAgICAvLyDQs9GA0LDRhNCwIDUNCiAgICByZXN1bHQgKz0gZ2V0U3VtUm93c0J5Q29sKGRhdGFSb3dzU2ltcGxlLCAnaW5jb21lVHlwZUlkJywgJ3JudTZGaWVsZDEwU3VtJywgWzE0MTkwLCAxNDIwMCwgMTQyMTAsIDE0MjIwLCAxNDI0MCwNCiAgICAgICAgICAgIDE0MjUwLCAxNTI0MCwgMTUyNTAsIDE3MTMwLCAxNzE0MCwgMTcxNTAsIDE3MjUwLCAxNzI2MCwgMTcyNzAsIDE3MjgwLCAxNzMwMCwgMTczMTAsIDE3MzIwXSkNCiAgICAvLyDQs9GA0LDRhNCwIDYNCiAgICAvLyDQmtC+0LQg0LLQuNC00LAg0LTQvtGF0L7QtNCwID0gMTQxOTAsIDE0MjAwLCAxNDIxMCwgMTQyMjAsIDE0MjQwLCAxNDI1MCwgMTcxMzAsIDE3MTQw'
        longString += 'LCAxNzE1MCwgMTcyNTAsIDE3MjYwLCAxNzI3MCwgMTcyODAsIDE3MzAwLCAxNzMxMCwgMTczMjANCiAgICByZXN1bHQgLT0gZ2V0U3VtUm93c0J5Q29sKGRhdGFSb3dzU2ltcGxlLCAnaW5jb21lVHlwZUlkJywgJ3JudTZGaWVsZDEyQWNjZXB0ZWQnLCBbMTQxOTAsIDE0MjAwLCAxNDIxMCwgMTQyMjAsIDE0MjQwLA0KICAgICAgICAgICAgMTQyNTAsIDE3MTMwLCAxNzE0MCwgMTcxNTAsIDE3MjUwLCAxNzI2MCwgMTcyNzAsIDE3MjgwLCAxNzMwMCwgMTczMTAsIDE3MzIwXSkNCg0KICAgIHJldHVybiBnZXRMb25nKHJlc3VsdCkNCn0NCg0KZGVmIGdldENvbXBsZXhJbmNvbWVTdW1Sb3dzOShkZWYgZGF0YVJvd3MsIGRlZiBjb2Rlcykgew0KICAgIHJldHVybiBnZXRTdW1Sb3dzQnlDb2woZGF0YVJvd3MsICdpbmNvbWVUeXBlSWQnLCAnaW5jb21lVGF4U3VtUycsIGNvZGVzKQ0KfQ0KDQpkZWYgZ2V0Q29tcGxleENvbnN1bXB0aW9uU3VtUm93czkoZGVmIGRhdGFSb3dzLCBkZWYgY29kZXMpIHsNCiAgICByZXR1cm4gZ2V0U3VtUm93c0J5Q29sKGRhdGFSb3dzLCAnY29uc3VtcHRpb25UeXBlSWQnLCAnY29uc3VtcHRpb25UYXhTdW1TJywgY29kZXMpDQp9DQoNCmRlZiBnZXRTaW1wbGVJbmNvbWVTdW1Sb3dzOChkZWYgZGF0YVJvd3MsIGRlZiBjb2Rlcykgew0KICAgIHJldHVybiBnZXRTdW1Sb3dzQnlDb2woZGF0YVJvd3MsICdpbmNvbWVUeXBlSWQnLCAncm51NEZpZWxkNUFjY2VwdGVkJywgY29kZXMpDQp9DQoNCmRlZiBnZXRTdW1Sb3dzQnlDb2woZGVmIGRhdGFSb3dzLCBkZWYgY29sdW1uQ29kZSwgZGVmIGNvbHVtblN1bSwgZGVmIGNvZGVzKSB7DQogICAgZGVmIHJlc3VsdCA9IDANCiAgICBpZiAoIWRhdGFSb3dzKSB7DQogICAgICAgIHJldHVybiByZXN1bHQNCiAgICB9DQogICAgZGF0YVJvd3MuZWFjaCB7IHJvdyAtPg0KICAgICAgICBkZWYgY2VsbCA9IHJvdy5nZXRDZWxsKGNvbHVtblN1bSkNCiAgICAgICAgaWYgKHJvdy5nZXRDZWxsKGNvbHVtbkNvZGUpLnZhbHVlIGluIChTdHJpbmcgW10pY29kZXMgJiYgIWNlbGwuaGFzVmFsdWVPd25lcigpKSB7DQogICAgICAgICAgICByZXN1bHQgKz0gKGNlbGwudmFsdWUgPzogMCkNCiAgICAgICAgfQ0KICAgIH0NCiAgICByZXR1cm4gcmVzdWx0DQp9DQoNCmRlZiBnZXRWaXJSZWFsVG92U29iKGRlZiBkYXRhUm93cywgZGVmIGRhdGFSb3dzU2ltcGxlKSB7DQogICAgZGVmIHJlc3VsdCA9IDAuMA0KDQogICAgLy8g0JrQvtC0INCy0LjQtNCwINC00L7RhdC+0LTQsCA9IDEwODMwDQogICAgcmVzdWx0ICs9IGdldENvbXBsZXhJbmNvbWVTdW1Sb3dzOShkYXRhUm93cywgWzEwODMwXSkNCg0KICAgIC8vINCa0L7QtCDQstC40LTQsCDQtNC+0YXQvtC00LAgPSAxMDAwMCwgMTAwMTAsIDEwMDIwLCAxMDAzMCwgMTAwNDAsIDEwMDUwLCAxMDA2MCwgMTAwNzAsIDEwMDgwLA0KICAgIC8vIDEwMDkwLCAxMDEwMCwgMTAxMTAsIDEwMTIwLCAxMDEzMCwgMTAxNDAsIDEwMTUwLCAxMDE2MCwgMTAxNzAsIDEwMTgwLCAxMDE5MCwgMTAyMDAsIDEwMjEwLCAxMDIyMCwgMTAyMzAsDQogICAgLy8gMTAyNDAsIDEwMjUwLCAxMDI2MCwgMTAyNzAsIDEwMjgwLCAxMDI5MCwgMTAzMDAsIDEwMzEwLCAxMDMyMCwgMTAzMzAsIDEwMzQwLCAxMDM1MCwgMTAzNjAsIDEwMzcwLCAxMDM4MCwNCiAgICAvLyAxMDM5MCwgMTA0MDAsIDEwNDEwLCAxMDQyMCwgMTA0MzAsIDEwNDQwLCAxMDQ1MCwgMTA0NjAsIDEwNDcwLCAxMDQ4MCwgMTA0OTAsIDEwNTAwLCAxMDUxMCwgMTA1MjAsIDEwNTMwLA0KICAgIC8vIDEwNTQwLCAxMDU1MCwgMTA1NjAsIDEwNTcwLCAxMDU4MCwgMTA1OTAsIDEwNjAwLCAxMDYxMCwgMTA2MjAsIDEwNjMwLCAxMDY0MCwgMTA2NTAsIDEwNjYwLCAxMDY3MCwgMTA2ODAsDQogICAgLy8gMTA2OTAsIDEwNzAwLCAxMDcxMCwgMTA3MjAsIDEwNzMwLCAxMDc0MCwgMTA3NTAsIDEwNzgwLCAxMDc5MCwgMTA4MDAsIDEwODEwLCAxMDgyMCwgMTA4NDAsIDEwODUwLCAxMDg2MCwNCiAgICAvLyAxMDg3MCwgMTA4OTAsIDEwOTAwLCAxMDk5MCwgMTEwMDAsIDExMDEwLCAxMTAyMCwgMTEwMzAsIDExMTYwLCAxMTE3MCwgMTExODAsIDExMTkwLCAxMTIwMCwgMTEyMTAsIDExMjIwLA0KICAgIC8vIDExMjMwLCAxMTI0MCwgMTEyNTAsIDExMjYwLCAxMTI3MCwgMTEyODAsIDExMjkwLCAxMTMwMCwgMTEzMTANCiAgICByZXN1bHQgKz0gZ2V0U2ltcGxlSW5jb21lU3VtUm93czgoZGF0YVJvd3NTaW1wbGUsIFsxMDAwMCwgMTAwMTAsIDEwMDIwLCAxMDAzMCwgMTAwNDAsIDEwMDUwLCAxMDA2MCwgMTAwNzAsIDEwMDgwLA0KICAgICAgICAgICAgMTAwOTAsIDEwMTAwLCAxMDExMCwgMTAxMjAsIDEwMTMwLCAxMDE0MCwgMTAxNTAsIDEwMTYwLCAxMDE3MCwgMTAxODAsIDEwMTkwLCAxMDIwMCwgMTAyMTAsIDEwMjIwLCAxMDIzMCwNCiAgICAgICAgICAgIDEwMjQwLCAxMDI1MCwgMTAyNjAsIDEwMjcwLCAxMDI4MCwgMTAyOTAsIDEwMzAwLCAxMDMxMCwgMTAzMjAsIDEwMzMwLCAxMDM0MCwgMTAzNTAsIDEwMzYwLCAxMDM3MCwgMTAzODAsDQogICAgICAgICAgICAxMDM5MCwgMTA0MDAsIDEwNDEwLCAxMDQyMCwgMTA0MzAsIDEwNDQwLCAxMDQ1MCwgMTA0NjAsIDEwNDcwLCAxMDQ4MCwgMTA0OTAsIDEwNTAwLCAxMDUxMCwgMTA1MjAsIDEwNTMwLA0KICAgICAgICAgICAgMTA1NDAsIDEwNTUwLCAxMDU2MCwgMTA1NzAsIDEwNTgwLCAxMDU5MCwgMTA2MDAsIDEwNjEwLCAxMDYyMCwgMTA2MzAsIDEwNjQwLCAxMDY1MCwgMTA2NjAsIDEwNjcwLCAxMDY4MCwNCiAgICAgICAgICAgIDEwNjkwLCAxMDcwMCwgMTA3MTAsIDEwNzIwLCAxMDczMCwgMTA3NDAsIDEwNzUwLCAxMDc4MCwgMTA3OTAsIDEwODAwLCAxMDgxMCwgMTA4MjAsIDEwODQwLCAxMDg1MCwgMTA4NjAsDQogICAgICAgICAgICAxMDg3MCwgMTA4OTAsIDEwOTAwLCAxMDk5MCwgMTEwMDAsIDExMDEwLCAxMTAyMCwgMTEwMzAsIDExMTYwLCAxMTE3MCwgMTExODAsIDExMTkwLCAxMTIwMCwgMTEyMTAsIDExMjIwLA0KICAgICAgICAgICAgMTEyMzAsIDExMjQwLCAxMTI1MCwgMTEyNjAsIDExMjcwLCAxMTI4MCwgMTEyOTAsIDExMzAwLCAxMTMxMF0pDQoNCiAgICAvLyDQmtC+0LQg0LLQuNC00LAg0LTQvtGF0L7QtNC+0LIgPSAxMDE2MCwgMTAyMzAsIDEwMjQwLCAxMDI1MCwgMTAyNjAsIDEwMjcwLCAxMDI4MCwgMTAzMzAsIDEwNzYwLCAxMDc3MCwgMTA4ODAsIDExMTcwLCAxMTMwMCwgMTEzMTANCiAgICBkZWYgY29kZXMgPSBbMTAxNjAsIDEwMjMwLCAxMDI0MCwgMTAyNTAsIDEwMjYwLCAxMDI3MCwgMTAyODAsIDEwMzMwLCAxMDc2MCwgMTA3NzAsIDEwODgwLCAxMTE3MCwgMTEzMDAsIDExMzEwXQ0KDQogICAgLy8g0LPRgNCw0YTQsCA1DQogICAgcmVzdWx0ICs9IGdldFN1bVJvd3NCeUNvbChkYXRhUm93c1NpbXBsZSwgJ2luY29tZVR5cGVJZCcsICdybnU2RmllbGQxMFN1bScsIGNvZGVzKQ0KICAgIC8vINCz0YDQsNGE0LAgNg0KICAgIHJlc3VsdCAtPSBnZXRTdW1Sb3dzQnlDb2woZGF0YVJvd3NTaW1wbGUsICdpbmNvbWVUeXBlSWQnLCAncm51NkZpZWxkMTJBY2NlcHRlZCcsIGNvZGVzKQ0KDQogICAgcmV0dXJuIGdldExvbmcocmVzdWx0KQ0KfQ0KDQpkZWYgZ2V0Q29zdlJhc2hWcyhkZWYgZGF0YVJvd3MsIGRlZiBkYXRhUm93c1NpbXBsZSkgew0KICAgIGRlZiByZXN1bHQgPSAwDQoNCiAgICAvLyDQmtC+0LQg0LLQuNC00LAg0YDQsNGB0YXQvtC00LAgPSAyMDAyMCwgMjAwMzAsIDIwMDUwLCAyMDEzMCwgMjAyMDAsIDIwMjEwLCAyMDI4MCwgMjA0NzAsIDIwNDkwLA0KICAgIC8vIDIwNTAwLCAyMDUxMCwgMjA2MzAsIDIwODIwLCAyMDg1MCwgMjA5MzAsIDIwOTQwLCAyMDk1MCwgMjA5NjAsIDIwOTcwLCAyMDk4MCwgMjExNzANCiAgICByZXN1bHQgKz0gZ2V0Q29tcGxleENvbnN1bXB0aW9uU3VtUm93czkoZGF0YVJvd3MsIFsyMDAyMCwgMjAwMzAsIDIwMDUwLCAyMDEzMCwgMjAyMDAsIDIwMjEwLCAyMDI4MCwgMjA0NzAsIDIwNDkwLA0KICAgICAgICAgICAgMjA1MDAsIDIwNTEwLCAyMDYzMCwgMjA4MjAsIDIwODUwLCAyMDkzMCwgMjA5NDAsIDIwOTUwLCAyMDk2MCwgMjA5NzAsIDIwOTgwLCAyMTE3MF0pDQoNCiAgICAvLyDQmtC+0LQg0LLQuNC00LAg0YDQsNGB0YXQvtC00LAgPSAyMDAwMCwgMjAwMTAsIDIwMDQwLCAyMDA2MCwgMjAwNzAsIDIwMDgwLCAyMDA5MCwgMjAxMDAsIDIwMTEwLA0KICAgIC8vIDIwMTIwLCAyMDE0MCwgMjAxNTAsIDIwMTYwLCAyMDE3MCwgMjAxODAsIDIwMTkwLCAyMDIyMCwgMjAyMzAsIDIwMjQwLCAyMDI1MCwgMjAyNjAsIDIwMjcwLCAyMDI5MCwgMjAzMDAsDQogICAgLy8gMjAzMTAsIDIwMzIwLCAyMDMzMCwgMjAzNDAsIDIwMzUwLCAyMDM2MCwgMjAzNzAsIDIwMzgwLCAyMDQwMCwgMjA0MTAsIDIwNDMwLCAyMDQ1MCwgMjA1MzAsIDIwNTQwLCAyMDU1MCwNCiAgICAvLyAyMDU2MCwgMjA1NzAsIDIwNTgwLCAyMDU5MCwgMjA2MDAsIDIwNjEwLCAyMDYyMCwgMjA2NDAsIDIwNjUwLCAyMDY2MCwgMjA2NzAsIDIwNjgwLCAyMDY5MCwgMjA3MDAsIDIwNzEwLA0KICAgIC8vIDIwNzIwLCAyMDczMCwgMjA3NDAsIDIwNzUwLCAyMDc2MCwgMjA3NzAsIDIwNzgwLCAyMDc5MCwgMjA4MDAsIDIwODEwLCAyMDgzMCwgMjA4NjAsIDIwODcwLCAyMDg4MCwgMjA4OTAsDQogICAgLy8gMjA5MDAsIDIwOTEwLCAyMDkyMCwgMjA5OTAsIDIxMDAwLCAyMTAxMCwgMjEwMjAsIDIxMDQwLCAyMTEyMCwgMjExMzAsIDIxMTQwLCAyMTE1MCwgMjExNjAsIDIxMTgwLCAyMTE5MCwNCiAgICAvLyAyMTIwMCwgMjEyMTAsIDIxMjIwLCAyMTM0MCwgMjEzNTAsIDIxMzYwLCAyMTM3MCwgMjEzODAsIDIxNDMwLCAyMTQ0MCwgMjE0NTAsIDIxNDYwLCAyMTQ3MCwgMjE0ODAsIDIxNDkwDQogICAgcmVzdWx0ICs9IGdldFNpbXBsZUNvbnN1bXB0aW9uU3VtUm93czgoZGF0YVJvd3NTaW1wbGUsIFsyMDAwMCwgMjAwMTAsIDIwMDQwLCAyMDA2MCwgMjAwNzAsIDIwMDgwLCAyMDA5MCwgMjAxMDAsIDIwMTEwLA0KICAgICAgICAgICAgMjAxMjAsIDIwMTQwLCAyMDE1MCwgMjAxNjAsIDIwMTcwLCAyMDE4MCwgMjAxOTAsIDIwMjIwLCAyMDIzMCwgMjAyNDAsIDIwMjUwLCAyMDI2MCwgMjAyNzAsIDIwMjkwLCAyMDMwMCwNCiAgICAgICAgICAgIDIwMzEwLCAyMDMyMCwgMjAzMzAsIDIwMzQwLCAyMDM1MCwgMjAzNjAsIDIwMzcwLCAyMDM4MCwgMjA0MDAsIDIwNDEwLCAyMDQzMCwgMjA0NTAsIDIwNTMwLCAyMDU0MCwgMjA1NTAsDQogICAgICAgICAgICAyMDU2MCwgMjA1NzAsIDIwNTgwLCAyMDU5MCwgMjA2MDAsIDIwNjEwLCAyMDYyMCwgMjA2NDAsIDIwNjUwLCAyMDY2MCwgMjA2NzAsIDIwNjgwLCAyMDY5MCwgMjA3MDAsIDIwNzEwLA0KICAgICAgICAgICAgMjA3MjAsIDIwNzMwLCAyMDc0MCwgMjA3NTAsIDIwNzYwLCAyMDc3MCwgMjA3ODAsIDIwNzkwLCAyMDgwMCwgMjA4MTAsIDIwODMwLCAyMDg2MCwgMjA4NzAsIDIwODgwLCAyMDg5MCwNCiAgICAgICAgICAgIDIwOTAwLCAyMDkxMCwgMjA5MjAsIDIwOTkwLCAyMTAwMCwgMjEwMTAsIDIxMDIwLCAyMTA0MCwgMjExMjAsIDIxMTMwLCAyMTE0MCwgMjExNTAsIDIxMTYwLCAyMTE4MCwgMjExOTAsDQogICAgICAgICAgICAyMTIwMCwgMjEyMTAsIDIxMjIwLCAyMTM0MCwgMjEzNTAsIDIxMzYwLCAyMTM3MCwgMjEzODAsIDIxNDMwLCAyMTQ0MCwgMjE0NTAsIDIxNDYwLCAyMTQ3MCwgMjE0ODAsIDIxNDkwXSkNCg0KICAgIC8vINCz0YDQsNGE0LAgNQ0KICAgIC8vINCa0L7QtCDQstC40LTQsCDQtNC+0YXQvtC00LAgPSAyMDAxMCwgMjAxMTAsIDIwMTIwLCAyMDE2MCwNCiAgICAvLyAyMDE3MCwgMjAxODAsIDIwMTkwLCAyMDIyMCwgMjAyMzAsIDIwMjQwLCAyMDI1MCwgMjAyNjAsIDIwMjcwLCAyMDI5MCwgMjAzMDAsIDIwMzEwLCAyMDMyMCwgMjAzMzAsIDIwMzQwLA0KICAgIC8vIDIwMzUwLCAyMDM2MCwgMjAzNzAsIDIwMzgwLCAyMDQwMCwgMjA0MTAsIDIwNDUwLCAyMDU4MCwgMjA1OTAsIDIwNjAwLCAyMDYxMCwgMjA2MjAsIDIwNjQwLCAyMDY1MCwgMjA2NjAsDQogICAgLy8gMjA2NzAsIDIwNjgwLCAyMDY5MCwgMjA3MDAsIDIwNzMwLCAyMDc0MCwgMjA3NTAsIDIwNzYwLCAyMDc4MCwgMjA4MDAsIDIwODEwLCAyMDgzMCwgMjEwNDAsIDIxMzgwLCAyMTQ0MCwNCiAgICAvLyAyMTQ1MCwgMjE0NjAsIDIxNDcwDQogICAgcmVzdWx0ICs9IGdldFN1bVJvd3NCeUNvbChkYXRhUm93c1NpbXBsZSwgJ2NvbnN1bXB0aW9uVHlwZUlkJywgJ3JudTdGaWVsZDEwU3VtJywgWzIwMDEwLCAyMDExMCwgMjAxMjAsIDIwMTYwLA0KICAgICAgICAgICAgMjAxNzAsIDIwMTgwLCAyMDE5MCwgMjAyMjAsIDIwMjMwLCAyMDI0MCwgMjAyNTAsIDIwMjYwLCAyMDI3MCwgMjAyOTAsIDIwMzAwLCAyMDMxMCwgMjAzMjAsIDIwMzMwLCAyMDM0MCwNCiAgICAgICAgICAgIDIwMzUwLCAyMDM2MCwgMjAzNzAsIDIwMzgwLCAyMDQwMCwgMjA0MTAsIDIwNDUwLCAyMDU4MCwgMjA1OTAsIDIwNjAwLCAyMDYxMCwgMjA2MjAsIDIwNjQwLCAyMDY1MCwgMjA2NjAsDQogICAgICAgICAgICAyMDY3MCwgMjA2ODAsIDIwNjkwLCAyMDcwMCwgMjA3MzAsIDIwNzQwLCAyMDc1MCwgMjA3NjAsIDIwNzgwLCAyMDgwMCwgMjA4MTAsIDIwODMwLCAyMTA0MCwgMjEzODAsIDIxNDQwLA0KICAgICAgICAgICAgMjE0NTAsIDIxNDYwLCAyMTQ3MF0pDQoNCiAgICAvLyDQs9GA0LDRhNCwIDYNCiAgICAvLyDQmtC+0LQg0LLQuNC00LAg0LTQvtGF0L7QtNCwID0gMjAwMTAsIDIwMTEwLCAyMDEyMCwgMjAxNjAsDQogICAgLy8gMjAxNzAsIDIwMTgwLCAyMDE5MCwgMjAyMjAsIDIwMjMwLCAyMDI0MCwgMjAyNTAsIDIwMjYwLCAyMDI3MCwgMjAyOTAsIDIwMzAwLCAyMDMxMCwgMjAzMjAsIDIwMzMwLCAyMDM0MCwNCiAgICAvLyAyMDM1MCwgMjAzNjAsIDIwMzcwLCAyMDM4MCwgMjA0MDAsIDIwNDEwLCAyMDQ1MCwgMjA1ODAsIDIwNTkwLCAyMDYwMCwgMjA2MTAsIDIwNjIwLCAyMDY0MCwgMjA2NTAsIDIwNjYwLA0KICAgIC8vIDIwNjcwLCAyMDY4MCwgMjA2OTAsIDIwNzAwLCAyMDczMCwgMjA3NDAsIDIwNzUwLCAyMDc2MCwgMjA3ODAsIDIwODAwLCAyMDgxMCwgMjA4MzAsIDIxMDQwLCAyMTM4MCwgMjE0NDAsDQogICAgLy8gMjE0NTAsIDIxNDYwLCAyMTQ3MA0KICAgIHJlc3VsdCAtPSBnZXRTdW1Sb3dzQnlDb2woZGF0YVJvd3NTaW1wbGUsICdjb25zdW1wdGlvblR5cGVJZCcsICdybnU3RmllbGQxMkFjY2VwdGVkJywgWzIwMDEwLCAyMDExMCwgMjAxMjAsIDIwMTYwLA0KICAgICAgICAgICAgMjAxNzAsIDIwMTgwLCAyMDE5MCwgMjAyMjAsIDIwMjMwLCAyMDI0MCwgMjAyNTAsIDIwMjYwLCAyMDI3MCwgMjAyOTAsIDIwMzAwLCAyMDMxMCwgMjAzMjAsIDIwMzMwLCAyMDM0MCwNCiAgICAgICAgICAgIDIwMzUwLCAyMDM2MCwgMjAzNzAsIDIwMzgwLCAyMDQwMCwgMjA0MTAsIDIwNDUwLCAyMDU4MCwgMjA1OTAsIDIwNjAwLCAyMDYxMCwgMjA2MjAsIDIwNjQwLCAyMDY1MCwgMjA2NjAsDQogICAgICAgICAgICAyMDY3MCwgMjA2ODAsIDIwNjkwLCAyMDcwMCwgMjA3MzAsIDIwNzQwLCAyMDc1MCwgMjA3NjAsIDIwNzgwLCAyMDgwMCwgMjA4MTAsIDIwODMwLCAyMTA0MCwgMjEzODAsIDIxNDQwLA0KICAgICAgICAgICAgMjE0NTAsIDIxNDYwLCAyMTQ3MF0pDQoNCiAgICByZXR1cm4gZ2V0TG9uZyhyZXN1bHQpDQp9DQoNCmRlZiBnZXRTaW1wbGVDb25zdW1wdGlvblN1bVJvd3M4KGRlZiBkYXRhUm93cywgZGVmIGNvZGVzKSB7DQogICAgcmV0dXJuIGdldFN1bVJvd3NCeUNvbChkYXRhUm93cywgJ2NvbnN1bXB0aW9uVHlwZUlkJywgJ3JudTVGaWVsZDVBY2NlcHRlZCcsIGNvZGVzKQ0KfQ0KDQpkZWYgZ2V0UmFzaFZuZXJlYWxWcyhkZWYgZGF0YVJvd3MsIGRlZiBkYXRhUm93c1NpbXBsZSkgew0KICAgIGRlZiByZXN1bHQgPSAwLjANCg0KICAgIC8vINCz0YDQsNGE0LAgOQ0KICAgIC8vINCa0L7QtCDQstC40LTQsCDRgNCw0YHRhdC+0LTQsCA9IDI0NjYwLCAyNDY3MCwgMjU2ODAsIDI1NjkwLCAyNTgzMCwgMjYzMTAsIDI2MzIwLCAyNjMzMCwgMjYzNDAsDQogICAgLy8gMjYzNjAsIDI2MzcwLCAyNjgyMCwgMjY4MzAsIDI2ODQwLCAyNjg1MCwgMjY4NjAsIDI2ODcwLCAyNjg4MCwgMjY4OTAsIDI2OTAwLCAyNzA2MA0KICAgIHJlc3VsdCArPSBnZXRDb21wbGV4Q29uc3VtcHRpb25TdW1Sb3dzOShkYXRhUm93cywgWzI0NjYwLCAyNDY3MCwgMjU2ODAsIDI1NjkwLCAyNTgzMCwgMjYzMTAsIDI2MzIwLCAyNjMzMCwgMjYzNDAsDQogICAgICAgICAgICAyNjM2MCwgMjYzNzAsIDI2ODIwLCAyNjgzMCwgMjY4NDAsIDI2ODUwLCAyNjg2MCwgMjY4NzAsIDI2ODgwLCAyNjg5MCwgMjY5MDAsIDI3MDYwXSkNCg0KICAgIC8vINCz0YDQsNGE0LAgOCArIDUgLSA2DQogICAgLy8g0JrQvtC0INCy0LjQtNCwINGA0LDRgdGF0L7QtNCwID0gMjQwMDAsIDI0MDEwLCAyNDAyMCwgMjQwMzAsIDI0MDQwLCAyNDA1MCwgMjQwNjAsIDI0MDcwLCAyNDA4MCwgMjQwOTAsIDI0MTAwLCAyNDExMCwgMjQxMjAsIDI0MTMwLCAyNDE0MCwNCiAgICAvLyAyNDE1MCwgMjQxNjAsIDI0MTcwLCAyNDE4MCwgMjQxOTAsIDI0MjAwLCAyNDIxMCwgMjQyMjAsIDI0MjMwLCAyNDI0MCwgMjQyNTAsIDI0MjYwLCAyNDI3MCwgMjQyODAsIDI0MjkwLA0KICAgIC8vIDI0MzAwLCAyNDMxMCwgMjQzMjAsIDI0MzMwLCAyNDM0MCwgMjQzNTAsIDI0MzYwLCAyNDM3MCwgMjQzODAsIDI0MzkwLCAyNDQwMCwgMjQ0MTAsIDI0NDIwLCAyNDQzMCwgMjQ0NDAsDQogICAgLy8gMjQ0NTAsIDI0NDYwLCAyNDQ3MCwgMjQ0ODAsIDI0NDkwLCAyNDUwMCwgMjQ1MTAsIDI0NTIwLCAyNDUzMCwgMjQ1NDAsIDI0NTUwLCAyNDU2MCwgMjQ1NzAsIDI0NTgwLCAyNDU5MCwNCiAgICAvLyAyNDYwMCwgMjQ2MTAsIDI0NjIwLCAyNDYzMCwgMjQ2NDAsIDI0NjgwLCAyNDY5MCwgMjQ3MDAsIDI0NzEwLCAyNDcyMCwgMjQ3MzAsIDI0NzQwLCAyNDc1MCwgMjQ3NjAsIDI0NzcwLA0KICAgIC8vIDI0NzgwLCAyNDc5MCwgMjQ4MDAsIDI0ODEwLCAyNDgyMCwgMjQ4MzAsIDI0ODQwLCAyNDg1MCwgMjQ4NjAsIDI0ODcwLCAyNDg4MCwgMjQ4OTAsIDI0OTAwLCAyNDkxMCwgMjQ5MjAsDQogICAgLy8gMjQ5MzAsIDI0OTQwLCAyNDk1MCwgMjQ5NjAsIDI0OTcwLCAyNDk4MCwgMjQ5OTAsIDI1MDAwLCAyNTAxMCwgMjUwMjAsIDI1MDMwLCAyNTA0MCwgMjUwNTAsIDI1MDYwLCAyNTA3MCwNCiAgICAvLyAyNTA4MCwgMjUwOTAsIDI1MTAwLCAyNTExMCwgMjUxMjAsIDI1MTMwLCAyNTE0MCwgMjUxNTAsIDI1MTYwLCAyNTE3MCwgMjUxODAsIDI1MTkwLCAyNTIwMCwgMjUyMTAsIDI1MjIwLA0KICAgIC8vIDI1MjMwLCAyNTI0MCwgMjUyNTAsIDI1MjYwLCAyNTI3MCwgMjUyODAsIDI1MjkwLCAyNTMwMCwgMjUzMTAsIDI1MzIwLCAyNTMzMCwgMjUzNDAsIDI1MzUwLCAyNTM2MCwgMjUzNzAsDQogICAgLy8gMjUzODAsIDI1MzkwLCAyNTQwMCwgMjU0MTAsIDI1NDIwLCAyNTQzMCwgMjU0NDAsIDI1NDUwLCAyNTQ2MCwgMjU0NzAsIDI1NDgwLCAyNTQ5MCwgMjU1MDAsIDI1NTEwLCAyNTUyMCwNCiAgICAvLyAyNTUzMCwgMjU1NDAsIDI1NTUwLCAyNTU2MCwgMjU1NzAsIDI1NTgwLCAyNTU5MCwgMjU2MDAsIDI1NjEwLCAyNTYyMCwgMjU2MzAsIDI1NjQwLCAyNTY1MCwgMjU2NjAsIDI1NjcwLA0KICAgIC8vIDI1NzAwLCAyNTcxMCwgMjU3MjAsIDI1NzMwLCAyNTc0MCwgMjU3NTAsIDI1NzYwLCAyNTc3MCwgMjU3ODAsIDI1NzkwLCAyNTgwMCwgMjU4MTAsIDI1ODIwLCAyNTg0MCwgMjU4NTAsDQogICAgLy8gMjU4NjAsIDI1ODcwLCAyNTg4MCwgMjU4OTAsIDI1OTAwLCAyNTkxMCwgMjU5MjAsIDI1OTMwLCAyNTk0MCwgMjU5NTAsIDI1OTYwLCAyNTk3MCwgMjU5ODAsIDI1OTkwLCAyNjAwMCwNCiAgICAvLyAyNjAxMCwgMjYwMjAsIDI2MDMwLCAyNjA0MCwgMjYwNTAsIDI2MDYwLCAyNjA3MCwgMjYwODAsIDI2MDkwLCAyNjEwMCwgMjYxMTAsIDI2MTIwLCAyNjEzMCwgMjYxNDAsIDI2MTUwLA0KICAgIC8vIDI2MTYwLCAyNjE3MCwgMjYxODAsIDI2MTkwLCAyNjIwMCwgMjYyMTAsIDI2MjIwLCAyNjIzMCwgMjYyNDAsIDI2MjUwLCAyNjI2MCwgMjYyNzAsIDI2MjgwLCAyNjI5MCwgMjYzMDAsDQogICAgLy8gMjYzNTAsIDI2MzgwLCAyNjM5MCwgMjY0MDAsIDI2NDEwLCAyNjQyMCwgMjY0MzAsIDI2NDQwLCAyNjQ1MCwgMjY0NjAsIDI2NDcwLCAyNjQ4MCwgMjY0OTAsIDI2NTAwLCAyNjUxMCwNCiAgICAvLyAyNjUyMCwgMjY1MzAsIDI2NTQwLCAyNjU1MCwgMjY1NjAsIDI2NTcwLCAyNjU4MCwgMjY1OTAsIDI2NjAwLCAyNjYxMCwgMjY2MjAsIDI2NjMwLCAyNjY0MCwgMjY2NTAsIDI2NjYwLA0KICAgIC8vIDI2NjcwLCAyNjY4MCwgMjY2OTAsIDI2NzAwLCAyNjcxMCwgMjY3MjAsIDI2NzMwLCAyNjc0MCwgMjY3NTAsIDI2NzYwLCAyNjc3MCwgMjY3ODAsIDI2NzkwLCAyNjgwMCwgMjY4MTAsDQogICAgLy8gMjcwMTAsIDI3MDIwLCAyNzAzMCwgMjcwNDAsIDI3MDUwLCAyNzA3MCwgMjcwODANCiAgICBkZWYga251ID0gWzI0MDAwLCAyNDAxMCwgMjQwMjAsIDI0MDMwLCAyNDA0MCwgMjQwNTAsIDI0MDYwLCAyNDA3MCwgMjQwODAsIDI0MDkwLCAyNDEwMCwgMjQxMTAsIDI0MTIwLCAyNDEzMCwgMjQxNDAsDQogICAgICAgICAgICAyNDE1MCwgMjQxNjAsIDI0MTcwLCAyNDE4MCwgMjQxOTAsIDI0MjAwLCAyNDIxMCwgMjQyMjAsIDI0MjMwLCAyNDI0MCwgMjQyNTAsIDI0MjYwLCAyNDI3MCwgMjQyODAsIDI0MjkwLA0KICAgICAgICAgICAgMjQzMDAsIDI0MzEwLCAyNDMyMCwgMjQzMzAsIDI0MzQwLCAyNDM1MCwgMjQzNjAsIDI0MzcwLCAyNDM4MCwgMjQzOTAsIDI0NDAwLCAyNDQxMCwgMjQ0MjAsIDI0NDMwLCAyNDQ0MCwNCiAgICAgICAgICAgIDI0NDUwLCAyNDQ2MCwgMjQ0NzAsIDI0NDgwLCAyNDQ5MCwgMjQ1MDAsIDI0NTEwLCAyNDUyMCwgMjQ1MzAsIDI0NTQwLCAyNDU1MCwgMjQ1NjAsIDI0NTcwLCAyNDU4MCwgMjQ1OTAsDQogICAgICAgICAgICAyNDYwMCwgMjQ2MTAsIDI0NjIwLCAyNDYzMCwgMjQ2NDAsIDI0NjgwLCAyNDY5MCwgMjQ3MDAsIDI0NzEwLCAyNDcyMCwgMjQ3MzAsIDI0NzQwLCAyNDc1MCwgMjQ3NjAsIDI0NzcwLA0KICAgICAgICAgICAgMjQ3ODAsIDI0NzkwLCAyNDgwMCwgMjQ4MTAsIDI0ODIwLCAyNDgzMCwgMjQ4NDAsIDI0ODUwLCAyNDg2MCwgMjQ4NzAsIDI0ODgwLCAyNDg5MCwgMjQ5MDAsIDI0OTEwLCAyNDkyMCwNCiAgICAgICAgICAgIDI0OTMwLCAyNDk0MCwgMjQ5NTAsIDI0OTYwLCAyNDk3MCwgMjQ5ODAsIDI0OTkwLCAyNTAwMCwgMjUwMTAsIDI1MDIwLCAyNTAzMCwgMjUwNDAsIDI1MDUwLCAyNTA2MCwgMjUwNzAsDQogICAgICAgICAgICAyNTA4MCwgMjUwOTAsIDI1MTAwLCAyNTExMCwgMjUxMjAsIDI1MTMwLCAyNTE0MCwgMjUxNTAsIDI1MTYwLCAyNTE3MCwgMjUxODAsIDI1MTkwLCAyNTIwMCwgMjUyMTAsIDI1MjIwLA0KICAgICAgICAgICAgMjUyMzAsIDI1MjQwLCAyNTI1MCwgMjUyNjAsIDI1MjcwLCAyNTI4MCwgMjUyOTAsIDI1MzAwLCAyNTMxMCwgMjUzMjAsIDI1MzMwLCAyNTM0MCwgMjUzNTAsIDI1MzYwLCAyNTM3MCwNCiAgICAgICAgICAgIDI1MzgwLCAyNTM5MCwgMjU0MDAsIDI1NDEwLCAyNTQyMCwgMjU0MzAsIDI1NDQwLCAyNTQ1MCwgMjU0NjAsIDI1NDcwLCAyNTQ4MCwgMjU0OTAsIDI1NTAwLCAyNTUxMCwgMjU1MjAsDQogICAgICAgICAgICAyNTUzMCwgMjU1NDAsIDI1NTUwLCAyNTU2MCwgMjU1NzAsIDI1NTgwLCAyNTU5MCwgMjU2MDAsIDI1NjEwLCAyNTYyMCwgMjU2MzAsIDI1NjQwLCAyNTY1MCwgMjU2NjAsIDI1NjcwLA0KICAgICAgICAgICAgMjU3MDAsIDI1NzEwLCAyNTcyMCwgMjU3MzAsIDI1NzQwLCAyNTc1MCwgMjU3NjAsIDI1NzcwLCAyNTc4MCwgMjU3OTAsIDI1ODAwLCAyNTgxMCwgMjU4MjAsIDI1ODQwLCAyNTg1MCwNCiAgICAgICAgICAgIDI1ODYwLCAyNTg3MCwgMjU4ODAsIDI1ODkwLCAyNTkwMCwgMjU5MTAsIDI1OTIwLCAyNTkzMCwgMjU5NDAsIDI1OTUwLCAyNTk2MCwgMjU5NzAsIDI1OTgwLCAyNTk5MCwgMjYwMDAsDQogICAgICAgICAgICAyNjAxMCwgMjYwMjAsIDI2MDMwLCAyNjA0MCwgMjYwNTAsIDI2MDYwLCAyNjA3MCwgMjYwODAsIDI2MDkwLCAyNjEwMCwgMjYxMTAsIDI2MTIwLCAyNjEzMCwgMjYxNDAsIDI2MTUwLA0KICAgICAgICAgICAgMjYxNjAsIDI2MTcwLCAyNjE4MCwgMjYxOTAsIDI2MjAwLCAyNjIxMCwgMjYyMjAsIDI2MjMwLCAyNjI0MCwgMjYyNTAsIDI2MjYwLCAyNjI3MCwgMjYyODAsIDI2MjkwLCAyNjMwMCwNCiAgICAgICAgICAgIDI2MzUwLCAyNjM4MCwgMjYzOTAsIDI2NDAwLCAyNjQxMCwgMjY0MjAsIDI2NDMwLCAyNjQ0MCwgMjY0NTAsIDI2NDYwLCAyNjQ3MCwgMjY0ODAsIDI2NDkwLCAyNjUwMCwgMjY1MTAsDQogICAgICAgICAgICAyNjUyMCwgMjY1MzAsIDI2NTQwLCAyNjU1MCwgMjY1NjAsIDI2NTcwLCAyNjU4MCwgMjY1OTAsIDI2NjAwLCAyNjYxMCwgMjY2MjAsIDI2NjMwLCAyNjY0MCwgMjY2NTAsIDI2NjYwLA0KICAgICAgICAgICAgMjY2NzAsIDI2NjgwLCAyNjY5MCwgMjY3MDAsIDI2NzEwLCAyNjcyMCwgMjY3MzAsIDI2NzQwLCAyNjc1MCwgMjY3NjAsIDI2NzcwLCAyNjc4MCwgMjY3OTAsIDI2ODAwLCAyNjgxMCwNCiAgICAgICAgICAgIDI3MDEwLCAyNzAyMCwgMjcwMzAsIDI3MDQwLCAyNzA1MCwgMjcwNzAsIDI3MDgwXQ0KICAgIHJlc3VsdCArPSBnZXRDYWxjdWxhdGVkU2ltcGxlQ29uc3VtcHRpb24oZGF0YVJvd3NTaW1wbGUsIGtudSkNCg0KICAgIC8vINCz0YDQsNGE0LAgOQ0KICAgIC8vINCa0L7QtCDQstC40LTQsCDRgNCw0YHRhdC+0LTQsCA9IDI0NjUwLCAyNjkxMCwgMjY5MjAsIDI2OTMwLCAyNjk0MCwgMjY5NTAsIDI2OTYwLCAyNjk3MCwgMjY5ODAsIDI2OTkwLCAyNzAwMA0KICAgIHJlc3VsdCAtPSBnZXRDb21wbGV4Q29uc3VtcHRpb25TdW1Sb3dzOShkYXRhUm93cywgWzI0NjUwLCAyNjkxMCwgMjY5MjAsIDI2OTMwLCAyNjk0MCwgMjY5NTAsIDI2OTYwLCAyNjk3MCwgMjY5ODAsIDI2OTkwLCAyNzAwMF0pDQoNCiAgICByZXR1cm4gZ2V0TG9uZyhyZXN1bHQpDQp9DQoNCi8qKiDQn9C+0LTRgdGH0LXRgiDQv9GA0L7RgdGC0YvRhSDRgNCw0YHRhdC+0LTQvtCyOiDRgdGD0LzQvNCwKNCz0YDQsNGE0LAgOCArINCz0YDQsNGE0LAgNSAtINCz0YDQsNGE0LAgNikuICovDQpkZWYgZ2V0Q2FsY3VsYXRlZFNpbXBsZUNvbnN1bXB0aW9uKGRlZiBkYXRhUm93c1NpbXBsZSwgZGVmIGNvZGVzKSB7DQogICAgZGVmIHJlc3VsdCA9IDANCiAgICBpZiAoZGF0YVJvd3NTaW1wbGUgPT0gbnVsbCkgew0KICAgICAgICByZXR1cm4gcmVzdWx0DQogICAgfQ0KICAgIGRhdGFSb3dzU2ltcGxlLmVhY2ggeyByb3cgLT4NCiAgICAgICAgaWYgKHJvdy5nZXRDZWxsKCdjb25zdW1wdGlvblR5cGVJZCcpLnZhbHVlIGluIChTdHJpbmcgW10pY29kZXMpIHsNCiAgICAgICAgICAgIHJlc3VsdCArPQ0KICAgICAgICAgICAgICAgICAgICAocm93LnJudTVGaWVsZDVBY2NlcHRlZCA/OiAwKSArDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgKHJvdy5ybnU3RmllbGQxMFN1bSA/OiAwKSAtDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgKHJvdy5ybnU3RmllbGQxMkFjY2VwdGVkID86IDApDQogICAgICAgIH0NCiAgICB9DQogICAgcmV0dXJuIHJlc3VsdA0KfQ0KDQoNCmRlZiBnZXROYWxCYXphSXNjaChkZWYgcm93MTAwLCBkZWYgcm93MTEwKSB7DQogICAgZGVmIHJlc3VsdA0KICAgIGlmIChyb3cxMDAgIT0gbnVsbCAmJiByb3cxMTAgIT0gbnVsbCAmJiAocm93MTAwIDwgMCB8fCByb3cxMDAgPT0gcm93MTEwKSkgew0KICAgICAgICByZXN1bHQgPSAwLjANCiAgICB9IGVsc2Ugew0KICAgICAgICByZXN1bHQgPSByb3cxMDAgLSByb3cxMTANCiAgICB9DQogICAgcmV0dXJuIGdldExvbmcocmVzdWx0KQ0KfQ0KDQovLyDQn9C+0LvRg9GH0LjRgtGMINC+0LrRgNGD0LPQu9C10L3QvdC+0LUsINGG0LXQu9C+0YfQuNGB0LvQtdC90L3QvtC1INC30L3QsNGH0LXQvdC40LUuDQpkZWYgZ2V0TG9uZyhkZWYgdmFsdWUpIHsNCiAgICBpZiAodmFsdWUgPT0gbnVsbCkgew0KICAgICAgICByZXR1cm4gMA0KICAgIH0NCiAgICByZXR1cm4gcm91bmRWYWx1ZSh2YWx1ZSwgMCkNCn0NCg0KLyoqDQogKiDQn9C+0YHRh9C40YLQsNGC0Ywg0LfQvdCw0YfQtdC90LjQtSDQs9GA0LDRhNGLIDE0Li4yMS4NCiAqDQogKiBAcGFyYW0gcm93INGB0YLRgNC+0LrQsA0KICogQHBhcmFtIHN1bU5hbCDQt9C90LDRh9C10L3QuNC1INC40Lcg0L3QsNGB0YLRgNC+0LXQuiDQv9C+0LTRgNCw0LfQtNC70LXQvdC40Y8gItCh0YPQvNC80LAg0L3QsNC70L7Qs9CwINC90LAg0L/RgNC40LHRi9C70YwsINCy0YvQv9C70LDRh9C10L3QvdCw0Y8g0LfQsCDQv9GA0LXQtNC10LvQsNC80Lgg0KDQvtGB0YHQuNC50YHQutC+0Lkg0KTQtdC00LXRgNCw0YbQuNC4INCyINC+0YLRh9GR0YLQvdC+0Lwg0L/QtdGA0LjQvtC00LUiDQogKiBAcGFyYW0gcmVwb3J0UGVyaW9kINC+0YLRh9C10YLQvdGL0Lkg0L/QtdGA0LjQvtC0DQogKi8NCnZvaWQgY2FsY0NvbHVtbkZyb20xNFRvMjEoZGVmIHByZXZEYXRhUm93cywgZGVmIHJvdywgZGVmIHNvdXJjZVJvdywgZGVmIHN1bU5hbCwgZGVmIHJlcG9ydFBlcmlvZCkgew0KICAgIC8vINCz0YDQsNGE0LAgMTUNCiAgICBpZiAoc3VtTmFsID09IG51bGwgfHwgc291cmNlUm93LmJhc2VUYXhPZiA9PSBudWxsIHx8ICFjaGVja0NvbHVtbjExKHNvdXJjZVJvdy5iYXNlVGF4T2YpKSB7DQogICAgICAgIHJvdy50YXhTdW1PdXRzaWRlID0gMA0KICAgIH0gZWxzZSB7DQogICAgICAgIHJvdy50YXhTdW1PdXRzaWRlID0gcm91bmRWYWx1ZShyb3VuZFZhbHVlKHN1bU5hbCAqIDAuOSwgMCkgKiBuZXcgQmlnRGVjaW1hbChzb3VyY2VSb3cuYmFzZVRheE9mKSAvIDEwMCwgMCkNCiAgICB9DQoNCiAgICAvLyDQs9GA0LDRhNCwIDE2DQogICAgaWYgKHNvdXJjZVJvdy50YXhTdW0gPT0gbnVsbCB8fCBzb3VyY2VSb3cuc3ViamVjdFRheENyZWRpdCA9PSBudWxsIHx8IHJvdy50YXhTdW1PdXRzaWRlID09IG51bGwpIHsNCiAgICAgICAgcm93LnRheFN1bVRvUGF5ID0gMA0KICAgIH0gZWxzZSB7DQogICAgICAgIHJvdy50YXhTdW1Ub1BheSA9IChzb3VyY2VSb3cudGF4U3VtID4gc291cmNlUm93LnN1YmplY3RUYXhDcmVkaXQgKyByb3cudGF4U3VtT3V0c2lkZSA/DQogICAgICAgICAgICBzb3VyY2VSb3cudGF4U3VtIC0gKHNvdXJjZVJvdy5zdWJqZWN0VGF4Q3JlZGl0ICsgcm93LnRheFN1bU91dHNpZGUpIDogMCkNCiAgICB9DQoNCiAgICAvLyDQs9GA0LDRhNCwIDE3DQogICAgaWYgKHNvdXJjZVJvdy50YXhTdW0gPT0gbnVsbCB8fCBzb3VyY2VSb3cuc3ViamVjdFRheENyZWRpdCA9PSBudWxsIHx8IHJvdy50YXhTdW1PdXRzaWRlID09IG51bGwpIHsNCiAgICAgICAgcm93LnRheFN1bVRvUmVkdWN0aW9uID0gMA0KICAgIH0gZWxzZSB7DQogICAgICAgIHJvdy50YXhTdW1Ub1JlZHVjdGlvbiA9ICgoc291cmNlUm93LnRheFN1bSA8IChzb3VyY2VSb3cuc3ViamVjdFRheENyZWRpdCArIHJvdy50YXhTdW1PdXRzaWRlKSkgPw0KICAgICAgICAgICAgICAgICgoc291cmNlUm93LnN1YmplY3RUYXhDcmVkaXQgKyByb3cudGF4U3VtT3V0c2lkZSkgLSBzb3VyY2VSb3cudGF4U3VtKSA6IDApDQogICAgfQ0KDQogICAgLy8g0JfQvdCw0YfQtdC90LjRjyDQs9GA0LDRhCDRjdGC0L7Qs9C+INC20LUg0L/QvtC00YDQsNC30LTQtdC70LXQvdC40Y8g0LIg0YTQvtGA0LzQtSDQv9GA0LXQtC4g0L/QtdGA0LjQvtC00LANCiAgICBkZWYgcHJldjE5ID0gbnVsbA0KICAgIGRlZiBwcmV2MjAgPSBudWxsDQoNCiAgICBpZiAoKHJlcG9ydFBlcmlvZC5vcmRlciA9PSAyIHx8IHJlcG9ydFBlcmlvZC5vcmRlciA9PSAzKSAmJiBzb3VyY2VSb3cucmVnaW9uQmFua0RpdmlzaW9uICE9IG51bGwgJiYgcHJldkRhdGFSb3dzICE9IG51bGwpIHsNCiAgICAgICAgZm9yIChkZWYgcHJldlJvdyA6IHByZXZEYXRhUm93cykgew0KICAgICAgICAgICAgaWYgKHNvdXJjZVJvdy5yZWdpb25CYW5rRGl2aXNpb24uZXF1YWxzKHByZXZSb3cucmVnaW9uQmFua0RpdmlzaW9uKSkgew0KICAgICAgICAgICAgICAgIC8vINCz0YDQsNGE0LAgMjAg0L/RgNC10LQuINC/0LXRgNC40L7QtNCwDQogICAgICAgICAgICAgICAgcHJldjE5ID0gcHJldlJvdy5ldmVyeU1vbnRoRm9yU2Vjb25kS3ZhcnRhbE5leHRQZXJpb2QNCiAgICAgICAgICAgICAgICAvLyDQs9GA0LDRhNCwIDIxINC/0YDQtdC0LiDQv9C10YDQuNC+0LTQsA0KICAgICAgICAgICAgICAgIHByZXYyMCA9IHByZXZSb3cuZXZlcnlNb250aEZvclRoaXJkS3ZhcnRhbE5leHRQZXJpb2QNCiAgICAgICAgICAgICAgICBicmVhaw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgfQ0KICAgIC8vINCV0YHQu9C4INC90LUg0L3QsNGI0LvQvtGB0YwsINGB0YfQuNGC0LDQtdC8IDANCiAgICBwcmV2MTkgPSBwcmV2MTkgPT0gbnVsbCA/IDAgOiBwcmV2MTkNCiAgICBwcmV2MjAgPSBwcmV2MjAgPT0gbnVsbCA/IDAgOiBwcmV2MjANCg0KICAgIC8vINCz0YDQsNGE0LAgMjANCiAgICByb3cuZXZlcnlNb250aEZvclNlY29uZEt2YXJ0YWxOZXh0UGVyaW9kID0gKHJlcG9ydFBlcmlvZC5vcmRlciA9PSAxID8gc291cmNlUm93LnRheFN1bSA6IHByZXYxOSkNCg0KICAgIC8vINCz0YDQsNGE0LAgMjENCiAgICBpZiAocmVwb3J0UGVyaW9kLm9yZGVyICE9IDIgfHwgc291cmNlUm93LnRheFN1bSA9PSBudWxsIHx8IHJvdy5ldmVyeU1vbnRoRm9yU2Vjb25kS3ZhcnRhbE5leHRQZXJpb2QgPT0gbnVsbCB8fCBzb3VyY2VSb3cuZXZlcnlNb250aEZvckt2YXJ0YWxOZXh0UGVyaW9kID09IG51bGwpIHsNCiAgICAgICAgcm93LmV2ZXJ5TW9udGhGb3JUaGlyZEt2YXJ0YWxOZXh0UGVyaW9kID0gcHJldjIwDQogICAgfSBlbHNlIHsNCiAgICAgICAgcm93LmV2ZXJ5TW9udGhGb3JUaGlyZEt2YXJ0YWxOZXh0UGVyaW9kID0NCiAgICAgICAgICAgICAgICAoKHJlcG9ydFBlcmlvZC5vcmRlciA9PSAyKSA/IChzb3VyY2VSb3cudGF4U3VtIC0gcm93LmV2ZXJ5TW9udGhGb3JTZWNvbmRLdmFydGFsTmV4dFBlcmlvZCAtIHNvdXJjZVJvdy5ldmVyeU1vbnRoRm9yS3ZhcnRhbE5leHRQZXJpb2QpIDogcHJldjIwKQ0KICAgIH0NCg0KICAgIC8vINCz0YDQsNGE0LAgMjINCiAgICBpZiAocmVwb3J0UGVyaW9kLm9yZGVyICE9IDMgfHwgc291cmNlUm93LnRheFN1bSA9PSBudWxsIHx8IHJvdy5ldmVyeU1vbnRoRm9yVGhpcmRLdmFydGFsTmV4dFBlcmlvZCA9PSBudWxsKSB7DQogICAgICAgIHJvdy5ldmVyeU1vbnRoRm9yRm91cnRoS3ZhcnRhbE5leHRQZXJpb2QgPSAwDQogICAgfSBlbHNlIHsNCiAgICAgICAgcm93LmV2ZXJ5TW9udGhGb3JGb3VydGhLdmFydGFsTmV4dFBlcmlvZCA9DQogICAgICAgICAgICAgICAgKChyZXBvcnRQZXJpb2Qub3JkZXIgPT0gMykgPyAoc291cmNlUm93LnRheFN1bSAtIHJvdy5ldmVyeU1vbnRoRm9yVGhpcmRLdmFydGFsTmV4dFBlcmlvZCkgOiAwKQ0KICAgIH0NCn0NCg0KLyoqDQogKiDQndCw0LnRgtC4INGB0YLRgNC+0LrRgyDQptCQDQogKi8NCmRlZiBmaW5kQ0EoZGVmIGRhdGFSb3dzKSB7DQogICAgZGVmIHJlc3VsdFJvdyA9IG51bGwNCiAgICBpZiAoZGF0YVJvd3MgIT0gbnVsbCkgew0KICAgICAgICBmb3IgKGRlZiByb3cgOiBkYXRhUm93cykgew0KICAgICAgICAgICAgaWYgKHJvdy5yZWdpb25CYW5rID09IGNlbnRyYWxJZCkgew0KICAgICAgICAgICAgICAgIHJlc3VsdFJvdyA9IHJvdw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgfQ0KICAgIHJldHVybiByZXN1bHRSb3cNCn0NCg0KLyoqDQogKiDQntC60YDRg9Cz0LvRj9C10YIg0YfQuNGB0LvQviDQtNC+INGC0YDQtdCx0YPQtdC80L7QuSDRgtC+0YfQvdC+0YHRgtC4Lg0KICoNCiAqIEBwYXJhbSB2YWx1ZSDQvtC60YDRg9Cz0LvRj9C10LzQvtC1INGH0LjRgdC70L4NCiAqIEBwYXJhbSBwcmVjaXNpb24g0YLQvtGH0L3QvtGB0YLRjCDQvtC60YDRg9Cz0LvQtdC90LjRjywg0LfQvdCw0LrQuCDQv9C+0YHQu9C1INC30LDQv9GP0YLQvtC5DQogKiBAcmV0dXJuINC+0LrRgNGD0LPQu9C10L3QvdC+0LUg0YfQuNGB0LvQvg0KICovDQpkZWYgcm91bmRWYWx1ZShCaWdEZWNpbWFsIHZhbHVlLCBkZWYgcHJlY2lzaW9uKSB7DQogICAgdmFsdWUuc2V0U2NhbGUocHJlY2lzaW9uLCBCaWdEZWNpbWFsLlJPVU5EX0hBTEZfVVApDQp9DQoNCi8qKiDQn9C+0LvRg9GH0LjRgtGMINGB0YLRgNC+0LrQuCDQt9CwINC/0YDQtdC00YvQtNGD0YnQuNC5INC+0YLRh9C10YLQvdGL0Lkg0L/QtdGA0LjQvtC0LiAqLw0KZGVmIGdldFByZXZEYXRhUm93cygpIHsNCiAgICBkZWYgcHJldkZvcm1EYXRhID0gZm9ybURhdGFTZXJ2aWNlLmdldEZvcm1EYXRhUHJldihmb3JtRGF0YSkNCiAgICByZXR1cm4gKHByZXZGb3JtRGF0YSAhPSBudWxsID8gZm9ybURhdGFTZXJ2aWNlLmdldERhdGFSb3dIZWxwZXIocHJldkZvcm1EYXRhKT8uYWxsU2F2ZWQgOiBudWxsKQ0KfQ0KDQovLyDQodC+0YDRgtC40YDQvtCy0LrQsCDQs9GA0YPQv9C/INC4INGB0YLRgNC+0LoNCnZvaWQgc29ydEZvcm1EYXRhUm93cyhkZWYgc2F2ZUluREIgPSB0cnVlKSB7DQogICAgZGVmIGRhdGFSb3dIZWxwZXIgPSBmb3JtRGF0YVNlcnZpY2UuZ2V0RGF0YVJvd0hlbHBlcihmb3JtRGF0YSkNCiAgICBkZWYgZGF0YVJvd3MgPSBkYXRhUm93SGVscGVyLmFsbENhY2hlZA0KICAgIC8vINC10YHRgtGMINC40YLQ'
        longString += 'vtCz0L7QstGL0LUg0YHRgtGA0L7QutC4DQogICAgaWYgKGRhdGFSb3dzLnNpemUoKSA+IDIpIHsNCiAgICAgICAgc29ydFJvd3MocmVmQm9va1NlcnZpY2UsIGxvZ2dlciwgZGF0YVJvd3MsIFtkYXRhUm93cy5maW5kIHsgaXQuZ2V0QWxpYXMoKSA9PSAnY2EnIH1dLCBkYXRhUm93cy5maW5kIHsgaXQuZ2V0QWxpYXMoKSA9PSAndG90YWwnIH0sIHRydWUpDQogICAgICAgIGlmIChzYXZlSW5EQikgew0KICAgICAgICAgICAgZGF0YVJvd0hlbHBlci5zYXZlU29ydCgpDQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICB1cGRhdGVJbmRleGVzKGRhdGFSb3dzKTsNCiAgICAgICAgfQ0KICAgIH0NCn0NCg0KLy8g0J/QvtC70YPRh9C40YLRjCDRgdGC0YDQvtC60Lgg0YTQvtGA0LzRiw0KZGVmIGdldERhdGFSb3dzKGRlZiBmb3JtSWQsIGRlZiBraW5kKSB7DQogICAgLy9kZWYgZm9ybUlkID0gNDIxDQogICAgLy9kZWYgZm9ybURhdGFLaW5kID0gRm9ybURhdGFLaW5kLlNVTU1BUlkNCiAgICBkZWYgZGVwYXJ0bWVudElkID0gZm9ybURhdGEuZGVwYXJ0bWVudElkDQogICAgZGVmIHJlcG9ydFBlcmlvZElkID0gZm9ybURhdGEucmVwb3J0UGVyaW9kSWQNCiAgICBkZWYgcGVyaW9kT3JkZXIgPSBmb3JtRGF0YS5wZXJpb2RPcmRlcg0KICAgIGRlZiBzb3VyY2VGb3JtRGF0YSA9IGZvcm1EYXRhU2VydmljZS5nZXRMYXN0KGZvcm1JZCwga2luZCwgZGVwYXJ0bWVudElkLCByZXBvcnRQZXJpb2RJZCwgcGVyaW9kT3JkZXIsIGZvcm1EYXRhLmNvbXBhcmF0aXZlUGVyaW9kSWQsIGZvcm1EYXRhLmFjY3J1aW5nKQ0KICAgIGlmIChzb3VyY2VGb3JtRGF0YSAhPSBudWxsICYmIHNvdXJjZUZvcm1EYXRhLmlkICE9IG51bGwpDQogICAgICAgIHJldHVybiBmb3JtRGF0YVNlcnZpY2UuZ2V0RGF0YVJvd0hlbHBlcihzb3VyY2VGb3JtRGF0YSk/LmFsbFNhdmVkDQogICAgcmV0dXJuIG51bGwNCn0NCg0KLyoqDQogKiDQn9C+0LvRg9GH0LjRgtGMINC30L3QsNGH0LXQvdC40LUg0Y/Rh9C10LnQutC4INGE0LjQutGB0LjRgNC+0LLQsNC90L3QvtC5INGB0YLRgNC+0LrQuCDQuNC3INC90LDQu9C+0LPQvtCy0L7QuSDRhNC+0YDQvNGLLg0KICoNCiAqIEBwYXJhbSBkYXRhUm93cyDRgdGC0YDQvtC60Lgg0L3RhA0KICogQHBhcmFtIGNvbHVtbk5hbWUg0L3QsNC30LLQsNC90LjQtSDRgdGC0L7Qu9Cx0YbQsA0KICogQHBhcmFtIGFsaWFzINCw0LvQuNCw0YEg0YHRgtGA0L7QutC4DQogKiBAcmV0dXJuINC30L3QsNGH0LXQvdC40LUg0YHRgtC+0LvQsdGG0LANCiAqDQogKi8NCmRlZiBnZXRBbGlhc0Zyb21Gb3JtKGRlZiBkYXRhUm93cywgZGVmIGNvbHVtbk5hbWUsIGRlZiBhbGlhcykgew0KICAgIGlmIChkYXRhUm93cyAhPSBudWxsICYmICFkYXRhUm93cy5pc0VtcHR5KCkpIHsNCiAgICAgICAgZGVmIGFsaWFzUm93ID0gZ2V0RGF0YVJvdyhkYXRhUm93cywgYWxpYXMpDQogICAgICAgIHJldHVybiBhbGlhc1Jvdy5nZXRDZWxsKGNvbHVtbk5hbWUpLnZhbHVlDQogICAgfQ0KICAgIHJldHVybiAwDQp9DQoNCi8qKiDQn9C+0LvRg9GH0LXQvdC40LUg0L/RgNC+0LLQsNC50LTQtdGA0LAg0YEg0LjRgdC/0L7Qu9GM0LfQvtCy0LDQvdC40LXQvCDQutC10YjQuNGA0L7QstCw0L3QuNGPLiAqLw0KZGVmIGdldFByb3ZpZGVyKGRlZiBsb25nIHByb3ZpZGVySWQpIHsNCiAgICByZXR1cm4gZm9ybURhdGFTZXJ2aWNlLmdldFJlZkJvb2tQcm92aWRlcihyZWZCb29rRmFjdG9yeSwgcHJvdmlkZXJJZCwgcHJvdmlkZXJDYWNoZSkNCn0NCg0KLy8g0J/QvtC70YPRh9C10L3QuNC1INC/0LDRgNCw0LzQtdGC0YDQvtCyINC/0L7QtNGA0LDQt9C00LXQu9C10L3QuNGPLCDRhNC+0YDQvNCwINC90LDRgdGC0YDQvtC10Log0LrQvtGC0L7RgNC+0LPQviDQsdGD0LTQtdGCINC40YHQv9C+0LvRjNC30L7QstCw0YLRjNGB0Y8NCi8vINC00LvRjyDQv9C+0LvRg9GH0LXQvdC40Y8g0LTQsNC90L3Ri9GFICjRgdC+0LPQu9Cw0YHQvdC+INCw0LvQs9C+0YDQuNGC0LzRgyA2LjIuNS44LjcuMSkNCmRlZiBnZXREZXBQYXJhbShkZWYgZGVwYXJ0bWVudFBhcmFtKSB7DQogICAgZGVmIGRlcGFydG1lbnRJZCA9IGRlcGFydG1lbnRQYXJhbS5nZXQoUmVmQm9vay5SRUNPUkRfSURfQUxJQVMpLm51bWJlclZhbHVlIGFzIGludA0KICAgIGRlZiBkZXBhcnRtZW50VHlwZSA9IGRlcGFydG1lbnRTZXJ2aWNlLmdldChkZXBhcnRtZW50SWQpLmdldFR5cGUoKQ0KICAgIGRlZiBkZXBQYXJhbQ0KICAgIGlmIChkZXBhcnRtZW50VHlwZS5lcXVhbHMoZGVwYXJ0bWVudFR5cGUuVEVSUl9CQU5LKSkgew0KICAgICAgICBkZXBQYXJhbSA9IGRlcGFydG1lbnRQYXJhbQ0KICAgIH0gZWxzZSB7DQogICAgICAgIGRlZiB0YkNvZGUgPSAoSW50ZWdlcikgZGVwYXJ0bWVudFBhcmFtLmdldCgnUEFSRU5UX0lEJykuZ2V0UmVmZXJlbmNlVmFsdWUoKQ0KICAgICAgICBpZiAodGJDb2RlID09IG51bGwpIHsNCiAgICAgICAgICAgIHJldHVybiBudWxsDQogICAgICAgIH0NCiAgICAgICAgZGVmIHRheFBsYW5pbmdUeXBlQ29kZSA9IGRlcGFydG1lbnRTZXJ2aWNlLmdldCh0YkNvZGUpLmdldFR5cGUoKS5NQU5BR0VNRU5ULmdldENvZGUoKQ0KICAgICAgICBkZXBQYXJhbSA9IGdldFByb3ZpZGVyKDMwKS5nZXRSZWNvcmRzKGdldFJlcG9ydFBlcmlvZEVuZERhdGUoKSwgbnVsbCwgIlBBUkVOVF9JRCA9ICR7ZGVwYXJ0bWVudFBhcmFtLmdldCgnUEFSRU5UX0lEJykuZ2V0UmVmZXJlbmNlVmFsdWUoKX0gYW5kIFRZUEUgPSAkdGF4UGxhbmluZ1R5cGVDb2RlIiwgbnVsbCkuZ2V0KDApDQogICAgfQ0KICAgIHJldHVybiBkZXBQYXJhbQ0KfQ0KDQovLyDQn9C+0LvRg9GH0LXQvdC40LUg0L/QsNGA0LDQvNC10YLRgNC+0LIgKNGB0L/RgNCw0LLQvtGH0L3QuNC6IDMzMCkNCmRlZiBnZXRJbmNvbWVQYXJhbVRhYmxlKGRlZiBkZXBQYXJhbSkgew0KICAgIGRlZiBkZXBJZCA9IChkZXBQYXJhbT8uZ2V0KFJlZkJvb2suUkVDT1JEX0lEX0FMSUFTKT8ubnVtYmVyVmFsdWUgPzogLTEpIGFzIGxvbmcNCiAgICBkZWYgaW5jb21lUGFyYW0NCiAgICBpZiAoZGVwSWQgIT0gLTEpIHsNCiAgICAgICAgaW5jb21lUGFyYW0gPSBnZXRQcm92aWRlcigzMykuZ2V0UmVjb3JkcyhnZXRSZXBvcnRQZXJpb2RFbmREYXRlKCkgLSAxLCBudWxsLCAiREVQQVJUTUVOVF9JRCA9ICRkZXBJZCIsIG51bGwpDQogICAgfQ0KICAgIGlmIChpbmNvbWVQYXJhbSAhPSBudWxsICYmICFpbmNvbWVQYXJhbS5pc0VtcHR5KCkpIHsNCiAgICAgICAgZGVmIGxpbmsgPSBpbmNvbWVQYXJhbS5nZXQoMCkucmVjb3JkX2lkLnZhbHVlDQogICAgICAgIGRlZiBpbmNvbWVQYXJhbVRhYmxlID0gZ2V0UHJvdmlkZXIoMzMwKS5nZXRSZWNvcmRzKGdldFJlcG9ydFBlcmlvZEVuZERhdGUoKSAtIDEsIG51bGwsICJMSU5LID0gJGxpbmsiLCBudWxsKQ0KICAgICAgICByZXR1cm4gaW5jb21lUGFyYW1UYWJsZQ0KICAgIH0NCiAgICByZXR1cm4gbnVsbA0KfQ0KDQpARmllbGQNCmRlZiByZXBvcnRQZXJpb2QgPSBudWxsDQoNCmRlZiBnZXRSZXBvcnRQZXJpb2QoKSB7DQogICAgaWYgKHJlcG9ydFBlcmlvZCA9PSBudWxsKSB7DQogICAgICAgIHJlcG9ydFBlcmlvZCA9IHJlcG9ydFBlcmlvZFNlcnZpY2UuZ2V0KGZvcm1EYXRhLnJlcG9ydFBlcmlvZElkKQ0KICAgIH0NCiAgICByZXR1cm4gcmVwb3J0UGVyaW9kDQp9'

        addLongText(form_template_id, longString, 'SCRIPT')
        logger.info("К версии макета добавлен скрипт")
    }

} catch (Exception ex) {
    logger.error("Error: ${ex.getLocalizedMessage()}. Все изменения откатаны")
}

def void addTypeTemplate(FormType formType, FormTemplate formTemplate, boolean createType, boolean createTemplate) {
    def form_type_id = formType.id ?: ""
    def form_type_name = formType.name ?: ""
    def form_type_tax_type = formType.taxType.code ?: ""
    def form_type_is_ifrs = formType.isIfrs ? 1 : 0
    def form_type_ifrs_name = formType.ifrsName ?: ""
    def form_type_ifrs_code = formType.code ?: ""

    def form_template_id = formTemplate.id ?: ""
    def form_template_is_fixed_rows = formTemplate.isFixedRows() ? 1 : 0
    def form_template_name = formTemplate.name ?: ""
    def form_template_fullname = formTemplate.fullName ?: ""
    def form_template_version = formTemplate.version.format("dd.MM.yy")
    def form_template_monthly = formTemplate.isMonthly() ? 1 : 0
    def form_template_comparative = formTemplate.isComparative() ? 1 : 0
    def form_template_header = formTemplate.header ?: ""
    def form_template_accruing = formTemplate.isAccruing() ? 1 : 0
    def form_template_updating = formTemplate.isUpdating() ? 1 : 0

    String formTypeSql = "INSERT INTO FORM_TYPE (ID, NAME, TAX_TYPE, STATUS, IS_IFRS, IFRS_NAME, CODE) VALUES " +
            "('$form_type_id', '$form_type_name', '$form_type_tax_type', '0', '$form_type_is_ifrs', '$form_type_ifrs_name', '$form_type_ifrs_code')"
    if (createType) {
        namedParameterJdbcTemplate.update(formTypeSql, [:])
        logger.info("Создан тип НФ с id = $form_type_id без версии макета, колонок, стилей, заголовка, фиксированных строк и скрипта")
    }

    String formTemplateSql = "INSERT INTO FORM_TEMPLATE (ID, TYPE_ID, FIXED_ROWS, NAME, FULLNAME, VERSION, STATUS, MONTHLY, HEADER, COMPARATIVE, ACCRUING, UPDATING) VALUES " +
            "($form_template_id, '$form_type_id', '$form_template_is_fixed_rows', '$form_template_name', '$form_template_fullname', TO_DATE('$form_template_version', 'DD.MM.RR'), '1', '$form_template_monthly', '$form_template_header', '$form_template_comparative', '$form_template_accruing', '$form_template_updating')"
    if (createTemplate) {
        namedParameterJdbcTemplate.update(formTemplateSql, [:])
        logger.info("Создан тип НФ с id = $form_template_id для версии макета с id = $form_type_id, но без колонок, стилей, заголовка, фиксированных строк и скрипта")
    }
}

def void addLongText (def form_template_id, String longString, String alias) {
    final int MAX_LENGTH = 2000
    namedParameterJdbcTemplate.update("UPDATE FORM_TEMPLATE SET $alias = null where id = $form_template_id", [:])
    int start = 0
    longString = new String(longString.decodeBase64(), "UTF-8")
    while (start < longString.length()) {
        int end = (start + MAX_LENGTH) < longString.length() ? (start + MAX_LENGTH) : longString.length()
        String text = longString.substring(start, end)
       namedParameterJdbcTemplate.update('UPDATE FORM_TEMPLATE SET ' + alias + ' = ' + alias + ' || :text where id = ' +form_template_id, ['text' : text])
        start += MAX_LENGTH
    }
}