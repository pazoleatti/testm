import groovy.transform.Field
import org.springframework.jndi.JndiTemplate

import javax.sql.DataSource

@Field
def dataSourceName = "java:comp/env/jdbc/TaxAccDS"

updateRef()

void updateRef() {
    try {
		Map<String, Object> params = new HashMap<String, Object>();
		
		//ОКАТО
		namedParameterJdbcTemplate.update("insert into ref_book_record (id, record_id, ref_book_id, version, status) select seq_ref_book_record.nextval, seq_ref_book_record_row_id.nextval, 3, to_date('01.01.2015', 'DD.MM.YYYY'), 0 from dual where not exists (select 1 from ref_book_value where attribute_id = 7 and string_value = '35000000000')", params)	
		namedParameterJdbcTemplate.update("insert into ref_book_value (record_id, attribute_id, string_value) select seq_ref_book_record.currval, 7, '35000000000' from dual where not exists (select 1 from ref_book_value where attribute_id = 7 and string_value = '35000000000')", params)
		namedParameterJdbcTemplate.update("insert into ref_book_value (record_id, attribute_id, string_value) select seq_ref_book_record.currval, 8, 'Республика Крым' from dual where not exists (select 1 from ref_book_value where attribute_id = 8 and string_value = 'Республика Крым')", params)

		namedParameterJdbcTemplate.update("insert into ref_book_record (id, record_id, ref_book_id, version, status) select seq_ref_book_record.nextval, seq_ref_book_record_row_id.nextval, 3, to_date('01.01.2015', 'DD.MM.YYYY'), 0 from dual where not exists (select 1 from ref_book_value where attribute_id = 7 and string_value = '67000000000') ", params)
		namedParameterJdbcTemplate.update("insert into ref_book_value (record_id, attribute_id, string_value) select seq_ref_book_record.currval, 7, '67000000000' from dual where not exists (select 1 from ref_book_value where attribute_id = 7 and string_value = '67000000000') ", params)
		namedParameterJdbcTemplate.update("insert into ref_book_value (record_id, attribute_id, string_value) select seq_ref_book_record.currval, 8, 'Город федерального значения Севастополь' from dual where not exists (select 1 from ref_book_value where attribute_id = 8 and string_value = 'Город федерального значения Севастополь') ", params)

	  
	  	//ОКТМО
		namedParameterJdbcTemplate.update("insert into ref_book_oktmo (id, code, name, version, status, record_id) \n"+
										  "   select seq_ref_book_oktmo.nextval as id, \n"+
										  "          '35000000' as code, \n"+
										  "          'Муниципальные образования Республики Крым' as name, \n"+
										  "          to_date('01.01.2015', 'DD.MM.YYYY') as version, \n"+
										  "          0 as status, \n"+
										  "          seq_ref_book_oktmo.currval as record_id \n"+
										  "     from dual \n"+
										  "    where not exists (select 1 from ref_book_oktmo where code = '35000000') ", params)
	  
	  	namedParameterJdbcTemplate.update("insert into ref_book_oktmo (id, code, name, version, status, record_id) \n"+
										  "   select seq_ref_book_oktmo.nextval as id, \n"+
										  "          '67000000' as code, \n"+
										  "          'Муниципальные образования города федерального значения Севастополя' as name, \n"+
										  "          to_date('01.01.2015', 'DD.MM.YYYY') as version, \n"+
										  "          0 as status, \n"+
										  "          seq_ref_book_oktmo.currval as record_id \n"+
										  "     from dual \n"+
										  "    where not exists (select 1 from ref_book_oktmo where code = '67000000') ", params)
	} catch (Exception ex) {
		logger.error("Ошибка: ${ex}")
	}
}